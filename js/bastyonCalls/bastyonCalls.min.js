/*! For license information please see bastyonCalls.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.libraryStarter=t():e.libraryStarter=t()}(this,(()=>(()=>{"use strict";var e={287:(e,t,n)=>{n.d(t,{A:()=>c});var o=n(601),r=n.n(o),i=n(314),a=n.n(i)()(r());a.push([e.id,'@keyframes callPulse{0%{opacity:1}50%{opacity:0}100%{opacity:1}}@keyframes fadeIn{from{opacity:0;transform:scale(0.9)}to{opacity:1;transform:scale(1)}}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes answerPulse{from{-moz-box-shadow:0 0 0 0 rgba(var(--color-bg-ac-bright), 0.4);box-shadow:0 0 0 0 rgba(var(--color-bg-ac-bright), 0.4)}50%{-moz-box-shadow:0 0 0 .6em rgba(var(--color-bg-ac-bright), 0.4);box-shadow:0 0 0 .6em rgba(var(--color-bg-ac-bright), 0.4)}to{-moz-box-shadow:0 0 0 0 rgba(var(--color-bg-ac-bright), 0.4);box-shadow:0 0 0 0 rgba(var(--color-bg-ac-bright), 0.4)}}#bc-root{-moz-transition:.05s transform;-o-transition:.05s transform;-webkit-transition:.05s transform;transition:.05s transform}#bc-root button{outline:none;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}#bc-root button:after{content:"";display:block;position:absolute;border-radius:4em;left:0;top:0;width:100%;height:100%;opacity:0;transition:all .5s;box-shadow:0 0 10px 40px rgba(var(--neutral-grad-2), 0.4)}#bc-root button.loading *{display:none}#bc-root button.loading:before{content:"";position:absolute;width:16px;height:16px;border:2px solid rgba(0,0,0,0);border-top-color:rgb(var(--text-color));border-radius:50%;animation:spin .6s linear infinite;display:block}#bc-root button:active:after{box-shadow:0 0 0 0 rgba(var(--neutral-grad-2), 0.4);position:absolute;border-radius:4em;left:0;top:0;opacity:1;transition:0s}#bc-root.full{position:fixed !important;z-index:300000;width:100vw;height:100vh;top:0}#bc-root.full #bc-format i::before{content:""}#bc-root.middle{position:fixed !important;z-index:300000;width:100vw;height:100vh;top:0}#bc-root.middle .bc-format{display:none}@media screen and (min-width: 1280px){#bc-root.middle{z-index:300000;width:70vw;height:80vh;top:10vh}#bc-root.middle .bc-topnav{width:70vw}#bc-root.middle .bc-topnav .bc-format{display:initial}#bc-root.middle .bc-video-container{width:70vw;height:80vh;position:relative}#bc-root.middle .bc-video-container .active video{max-width:70vw;max-height:80vh}#bc-root.middle .bc-video-container .minified{position:absolute}#bc-root.middle .bc-controls{max-width:70vw;bottom:10vh;padding:2% 0}}#bc-root.middle #bc-format i::before{content:""}#bc-root.minified{position:fixed;width:auto;height:auto;top:initial;right:initial;bottom:20px;left:20px;border:1px solid rgba(0,0,0,0);border-radius:30px;overflow:hidden}#bc-root.minified .status{display:none !important}#bc-root.minified .bc-topnav{width:auto;padding:5%;opacity:0}#bc-root.minified .bc-topnav .bc-call-info{max-width:100%}#bc-root.minified .bc-topnav .bc-call-info .info{overflow:hidden}#bc-root.minified .bc-topnav .bc-call-info .info .name{width:auto;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}#bc-root.minified .bc-topnav .options{display:none}#bc-root.minified .bc-video-container{width:auto;height:auto;max-height:initial !important;padding-bottom:0;transition:width,height .3s ease}#bc-root.minified .bc-video-container.vertical{max-width:250px}#bc-root.minified .bc-video-container.vertical .active{max-width:250px}#bc-root.minified .bc-video.minified{display:none}#bc-root.minified .bc-video.active{height:100%;max-width:350px}#bc-root.minified .bc-video.active.novid{max-height:250px;padding:1em;max-width:250px}#bc-root.minified .bc-video.active video{transition:all .3s ease;width:auto}@media screen and (max-width: 768px){#bc-root.minified .bc-video .name{display:none}}#bc-root.minified .bc-video-btn{display:none}#bc-root.minified .bc-controls{position:absolute;bottom:0;min-width:initial !important;justify-content:space-between;opacity:0;transition:opacity .3s ease}@media screen and (max-width: 768px){#bc-root.minified .bc-controls{display:none !important}}#bc-root.minified .bc-controls .bc-btn{width:37px;height:37px;display:flex;justify-content:center;align-items:center;position:relative;max-width:55px;max-height:55px;font-size:.8rem;margin:0}#bc-root.minified .bc-controls .bc-btn.bc-camera,#bc-root.minified .bc-controls .bc-btn.bc-hide{display:none}#bc-root.minified .bc-controls .bc-btn#bc-expand{display:flex}#bc-root.minified:hover .bc-controls,#bc-root.minified:hover .bc-topnav{display:flex;opacity:1}@media screen and (max-width: 768px){#bc-root.minified{top:65px !important;right:10px !important;left:initial !important;bottom:initial !important;border-radius:10px;overflow:hidden}#bc-root.minified .bc-video-container{max-width:250px}#bc-root.minified .bc-video-container.vertical{max-width:25vw}#bc-root.minified .bc-topnav{display:none !important}}.bc{-webkit-tap-highlight-color:rgba(0,0,0,0) !important}.bc-container{font-family:"Segoe UI Variable","Segoe UI",SegoeUI,"Helvetica Neue",Helvetica,Arial,sans-serif;display:flex;flex-wrap:wrap;justify-content:space-evenly;align-items:center}.bc-container>div{z-index:333333}.bc-notify{z-index:4444444 !important;position:fixed;top:28px}@media screen and (max-width: 768px){.bc-notify{top:56px}}.bc-incoming-call{z-index:33333;padding:10px;width:494px;display:flex;flex-wrap:wrap;justify-content:space-between;align-items:center;background:radial-gradient(87.44% 183.75% at 50% 50%, rgba(0, 0, 0, 0) 0%, #000000 100%),#242f3d;box-shadow:0 4px 20px rgba(0,0,0,.5);border-radius:12px}@media screen and (max-width: 576px){.bc-incoming-call{padding:16px;width:90vw}}.bc-incoming-call .user{display:flex;justify-content:space-between;max-width:50%}@media screen and (max-width: 576px){.bc-incoming-call .user{max-width:70%;margin-bottom:16px}}.bc-incoming-call .user .title{text-align:center;text-overflow:ellipsis;white-space:nowrap;overflow:hidden;line-height:20px;color:rgb(var(--color-cc-white))}.bc-incoming-call .user .title .name{font-size:16px;text-align:left;color:rgb(var(--text-on-bg-ac-color));width:200px;overflow:hidden;text-overflow:ellipsis}.bc-incoming-call .user .title .description{color:rgb(var(--neutral-grad-2));font-size:14px;text-align:left}.bc-incoming-call .user .avatar{margin-right:16px;border:2px solid rgba(0,0,0,0);min-width:44px;width:44px;height:44px;border-radius:50%;overflow:hidden;display:flex;justify-content:center;align-items:center;font-size:1.4em;color:rgba(var(--background-hidden-layer, 0.1))}.bc-incoming-call .user .avatar img{object-fit:cover;height:100%;width:100%}.bc-incoming-call .buttons{display:flex;justify-content:space-between}@media screen and (max-width: 576px){.bc-incoming-call .buttons{width:100%;justify-content:space-between}.bc-incoming-call .buttons .bc-btn{width:48% !important;margin:0}}.bc-incoming-call .buttons .bc-btn{width:56px;height:48px;border-radius:12px;margin:0 10px;border:none;cursor:pointer}.bc-incoming-call .buttons .bc-answer{background:linear-gradient(90deg, #495AFF 0%, #0ACFFE 100%),#00a4ff;animation:answerPulse .8s infinite;box-shadow:0 0 0 0 #00a4ff;transition:box-shadow .3s ease}.bc-incoming-call .buttons .bc-answer:hover{animation:none;filter:brightness(90%)}.bc-incoming-call .buttons #bc-answer-voice{height:48px;width:48px;border-radius:24px;background:linear-gradient(90deg, rgba(73, 90, 255, 0.3333333333) 0%, rgba(10, 207, 254, 0.3333333333) 100%),rgba(0,164,255,.3333333333)}.bc-incoming-call .buttons .bc-decline{background:linear-gradient(90deg, #EB3349 2.65%, #F45C43 100.53%),#eb5757}.bc-incoming-call .buttons .bc-decline i{transform:rotate(225deg)}.bc-incoming-call .buttons i{color:rgb(var(--text-on-bg-ac-color))}.bc-ended-call{width:100%;height:100%;display:flex;align-items:center;justify-content:center;flex-direction:column;background:radial-gradient(87.44% 183.75% at 50% 50%, rgba(0, 0, 0, 0) 0%, #000000 100%),#242f3d;color:rgb(var(--text-on-bg-ac-color))}.bc-ended-call .avatar{display:flex;border:2px solid rgba(var(--background-hidden-layer, 0.1));width:160px;height:160px;border-radius:50%;overflow:hidden;justify-content:center;align-items:center;font-size:1.6em;color:rgba(var(--background-hidden-layer, 0.1))}.bc-ended-call .avatar img{object-fit:cover;width:100%;height:100%}.bc-ended-call .name{font-size:28px;font-weight:600;margin-top:42px;width:400px;text-align:center;max-width:90vw;overflow:hidden;text-overflow:ellipsis}.bc-ended-call .description{color:#838383;font-size:16px;line-height:24px;margin-top:4px}.bc-ended-call button{cursor:pointer}.bc-video{position:relative;display:flex;justify-content:center}@media screen and (orientation: portrait){.bc-video{max-width:100%}}.bc-video-container{display:flex;justify-content:center;flex-wrap:wrap;align-items:center;width:100vw;height:100vh;background:radial-gradient(55.29% 79.17% at 50% 47.76%, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.88) 100%),#242f3d;box-shadow:0 32px 64px rgba(0,0,0,.56),0 2px 21px rgba(0,0,0,.55);animation:fadeIn .5s ease-out}@media screen and (orientation: portrait){.bc-video{justify-content:center}}.bc-video .name{position:absolute;bottom:0;left:0;text-align:center;font-size:12px;height:12px;line-height:12px;min-width:60px;background-color:rgba(255,255,255,.4)}.bc-video video{max-height:100%;width:100%}@media screen and (orientation: portrait){.bc-video video{max-height:40vh}}.bc-video.active{width:100%;margin:0 auto;height:100vh;max-height:100vh}.bc-video.active .avatar{border:2px solid rgba(var(--background-hidden-layer, 0.1));width:160px;height:160px;margin-bottom:20px;border-radius:50%;overflow:hidden;display:none;justify-content:center;align-items:center;font-size:1.6em;color:rgba(var(--background-hidden-layer, 0.1))}.bc-video.active .avatar img{object-fit:cover;width:100%;height:100%}.bc-video.active .status{display:none;height:0;color:rgba(var(--background-hidden-layer, 0.1));transition:opacity .3s ease;animation:2s callPulse infinite;text-align:center}.bc-video.active video{max-height:100vh;max-width:100vw;width:auto !important}.bc-video.active.novid{max-height:100%;align-items:center;align-content:center;flex-wrap:wrap;max-width:200px}.bc-video.active.novid .avatar{margin-bottom:0;display:flex}.bc-video.active.novid video{display:none}.bc-video.active.novid.connecting .status{display:block}.bc-video.minified{margin:0;border-radius:20px;z-index:33333333;position:fixed;right:20px;bottom:10%;overflow:hidden}.bc-video.minified video{transform:scale(-1, 1);height:15vh;width:auto;max-height:150px}@media screen and (orientation: portrait){.bc-video.minified video{height:15vh;width:auto}}@media screen and (max-width: 768px){.bc-video.minified{bottom:120px}}.bc-controls{display:flex;justify-content:center;position:fixed;background:linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.99466) 99.44%);bottom:0;width:100%;padding:5%;min-width:280px !important;max-width:100vw}.bc-controls .bc-btn{margin:0 20px;background:rgba(var(--neutral-grad-2), 0.4);text-align:center;font-size:1em;font-weight:600;border-radius:50%;width:55px;height:55px;display:flex;align-items:center;justify-content:center;cursor:pointer;border:none}.bc-controls .bc-btn:disabled{cursor:not-allowed;opacity:.5;background:rgba(var(--neutral-grad-2), 0.2)}.bc-controls .bc-btn.active{background:rgb(var(--text-on-bg-ac-color))}.bc-controls .bc-btn.active i{color:rgb(var(--text-color))}@media screen and (max-width: 768px){.bc-controls .bc-btn{margin:0 10px;width:45px;height:45px}}.bc-controls .bc-btn i{pointer-events:none;color:rgb(var(--text-on-bg-ac-color))}.bc-controls .bc-btn.bc-decline{background:rgb(var(--color-bad));border:1px solid rgba(0,0,0,0);transform:rotate(225deg)}.bc-controls .bc-btn.bc-expand{display:none}.bc-controls .bc-device-selector{margin:0 20px}@media screen and (max-width: 768px){.bc-controls .bc-device-selector{margin:0 10px}}.bc-controls .bc-device-selector .bc-btn{margin:0 !important}@media screen and (max-width: 768px){.bc-controls{padding-bottom:60px}}.bc-topnav{z-index:4444444 !important;display:flex;justify-content:space-between;align-items:center;position:absolute;top:0;right:0;left:0;color:rgb(var(--text-on-bg-ac-color));background:linear-gradient(180deg, rgba(0, 0, 0, 0.799466) 0%, rgba(0, 0, 0, 0) 99.44%);padding:26px 28px;width:100vw}.bc-topnav .options button{background:rgba(0,0,0,0);border:none;cursor:pointer}.bc-topnav .options button i{color:rgb(var(--text-on-bg-ac-color))}@media screen and (max-width: 768px){.bc-topnav{padding-top:44px}}.bc-call-info{display:flex;align-items:center}.bc-call-info .avatar{display:flex;min-width:40px;width:40px;height:40px;border-radius:50%;overflow:hidden;justify-content:center;align-items:center;font-size:1.6em;color:rgba(var(--background-hidden-layer, 0.1));background:rgb(var(--neutral-grad-0))}.bc-call-info .avatar img{object-fit:cover;height:100%}.bc-call-info .info{margin-left:10px;display:flex;flex-direction:column}.bc-call-info .info .name{font-weight:700;width:200px;overflow:hidden;text-overflow:ellipsis;transition:width .3s ease}@media(pointer: fine){.bc-call-info .info .name:hover{width:400px}}#controls[data-call-type=voice] #bc-video-on{display:none}#controls[data-call-type=voice] #bc-video-off{background:rgb(var(--text-on-bg-ac-color))}#controls[data-call-type=voice] #bc-video-off i{color:rgb(var(--text-color))}#controls[data-call-type=video] #bc-video-off{display:none}.hidden{display:none}.bc-device-selector{position:relative;display:inline-block;margin:0 20px}@media screen and (max-width: 768px){.bc-device-selector{margin:0 10px}}.bc-device-selector .bc-btn{margin:0 !important;position:relative}.bc-device-selector .bc-btn:not(:disabled){opacity:1;cursor:pointer;background:rgba(var(--neutral-grad-2), 0.4)}.bc-device-selector .bc-btn:disabled+.bc-selector-arrow{display:none}.bc-device-selector .bc-selector-arrow{position:absolute;top:-4px;right:-4px;background:rgb(var(--color-bg-ac));border-radius:50%;width:16px;height:16px;display:flex;align-items:center;justify-content:center;font-size:10px;color:#fff;pointer-events:none;z-index:1}.bc-device-selector .bc-selector-arrow::after{content:"▼";font-size:8px}.bc-audio-dropdown{position:fixed;bottom:90px;left:50%;transform:translateX(-50%);background:rgba(var(--background-secondary-theme), 0.95);border:1px solid rgba(var(--neutral-grad-2), 0.3);border-radius:16px;color:rgb(var(--text-color));min-width:280px;max-width:400px;max-height:60vh;overflow-y:auto;box-shadow:0 12px 28px rgba(0,0,0,.5);z-index:999999;font-size:14px;backdrop-filter:blur(20px);opacity:0;transition:all .3s ease;transform-origin:bottom center;scale:.9}.bc-audio-dropdown.show{opacity:1;scale:1}@media screen and (max-width: 768px){.bc-audio-dropdown{bottom:130px;left:10px;right:10px;transform:none;min-width:auto;max-width:none}}.bc-audio-dropdown-header{padding:16px 20px 12px 20px;font-weight:600;font-size:13px;color:rgb(var(--neutral-grad-3));background:rgba(var(--neutral-grad-1), 0.2);text-transform:uppercase;letter-spacing:.5px;border-bottom:1px solid rgba(var(--neutral-grad-2), 0.2)}.bc-audio-dropdown-header i{margin-right:10px;color:rgb(var(--color-bg-ac));font-size:14px}.bc-audio-dropdown-separator{height:1px;background:rgba(var(--neutral-grad-2), 0.2);margin:12px 0}.bc-audio-dropdown-item{padding:16px 20px;cursor:pointer;font-size:14px;border-bottom:1px solid rgba(var(--neutral-grad-2), 0.1);transition:all .2s ease;display:flex;align-items:center;position:relative}.bc-audio-dropdown-item:hover{background:rgba(var(--color-bg-ac), 0.1)}.bc-audio-dropdown-item:last-child{border-bottom:none}.bc-audio-dropdown-item i{margin-right:16px;width:24px;text-align:center;color:rgb(var(--neutral-grad-2));font-size:18px}.bc-audio-dropdown-item.selected{background:rgba(var(--color-bg-ac), 0.15);border-left:4px solid rgb(var(--color-bg-ac))}.bc-audio-dropdown-item.selected::after{content:"✓";position:absolute;right:20px;color:rgb(var(--color-bg-ac));font-weight:bold;font-size:18px}.bc-audio-dropdown-item.selected i{color:rgb(var(--color-bg-ac))}.bc-audio-dropdown-item span{flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;font-weight:500}.bc-btn.bc-audio-output{position:relative}.bc-btn.bc-audio-output.active{background:rgb(var(--text-on-bg-ac-color))}.bc-btn.bc-audio-output.active i{color:rgb(var(--text-color))}.bc-btn.bc-speaker-toggle.speaker-mode{background:rgba(var(--color-bg-ac), 0.8) !important}.bc-btn.bc-speaker-toggle.speaker-mode i{color:rgb(var(--text-on-bg-ac-color))}.bc-controls{display:flex;justify-content:center;position:fixed;align-items:center;background:linear-gradient(180deg, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.99466) 99.44%);bottom:0;width:100%;padding:5%;min-width:280px !important;max-width:100vw;gap:12px;flex-wrap:wrap}.bc-controls .bc-control-group{display:flex;align-items:center;background:rgba(48,52,60,.95);border-radius:24px;padding:4px;backdrop-filter:blur(15px);border:1px solid rgba(var(--neutral-grad-2), 0.6);box-shadow:0 4px 12px rgba(0,0,0,.3);flex-shrink:0}.bc-controls .bc-control-group .bc-device-selector{margin:0}.bc-controls .bc-control-group .bc-device-selector .bc-btn{margin:0;width:48px;height:48px;border-radius:50%;background:rgba(0,0,0,0);border:none;color:rgb(var(--text-on-bg-ac-color));transition:all .2s ease}.bc-controls .bc-control-group .bc-device-selector .bc-btn:hover:not(:disabled){background:rgba(70,75,85,.7)}.bc-controls .bc-control-group .bc-device-selector .bc-btn:disabled{opacity:.4;cursor:not-allowed}.bc-controls .bc-control-group .bc-device-selector .bc-btn.active{background:rgb(var(--color-bg-ac));color:#fff}.bc-controls .bc-control-group .bc-device-selector .bc-btn.bc-mute.active{background:rgb(var(--color-bad));color:#fff}.bc-controls .bc-control-group .bc-device-selector .bc-btn i{font-size:20px}.bc-controls .bc-control-group .bc-selector-button{width:32px;height:48px;background:rgba(0,0,0,0);border:none;border-left:1px solid rgba(var(--neutral-grad-2), 0.6);color:rgb(var(--text-on-bg-ac-color));cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s ease}.bc-controls .bc-control-group .bc-selector-button:hover{background:rgba(70,75,85,.7)}.bc-controls .bc-control-group .bc-selector-button:disabled{opacity:.4;cursor:not-allowed}.bc-controls .bc-control-group .bc-selector-button i{font-size:12px}.bc-controls .bc-btn:not(.bc-control-group .bc-btn){margin:0;width:56px;height:56px;border-radius:50%;background:rgba(48,52,60,.95);border:1px solid rgba(var(--neutral-grad-2), 0.6);color:rgb(var(--text-on-bg-ac-color));backdrop-filter:blur(15px);font-size:20px;transition:all .2s ease;box-shadow:0 4px 12px rgba(0,0,0,.2);flex-shrink:0}.bc-controls .bc-btn:not(.bc-control-group .bc-btn):hover:not(:disabled){background:rgba(70,75,85,.9);transform:scale(1.05)}.bc-controls .bc-btn:not(.bc-control-group .bc-btn):disabled{opacity:.4;cursor:not-allowed}.bc-controls .bc-btn:not(.bc-control-group .bc-btn).active{background:rgb(var(--color-bg-ac));color:#fff}.bc-controls .bc-btn:not(.bc-control-group .bc-btn).bc-decline{background:rgb(var(--color-bad));color:#fff;transform:rotate(225deg)}.bc-controls .bc-btn:not(.bc-control-group .bc-btn).bc-decline:hover{background:rgba(var(--color-bad), 0.8);transform:rotate(225deg) scale(1.05)}.bc-controls .bc-btn:not(.bc-control-group .bc-btn).bc-speaker-toggle.speaker-mode{background:rgb(var(--color-bg-ac));color:#fff}@media screen and (max-width: 1024px){.bc-controls{gap:10px;padding:4%}.bc-controls .bc-control-group .bc-btn{width:44px;height:44px}.bc-controls .bc-control-group .bc-selector-button{width:30px;height:44px}.bc-controls .bc-btn:not(.bc-control-group .bc-btn){width:52px;height:52px;font-size:18px}}@media screen and (max-width: 768px){.bc-controls{padding:3% 2%;padding-bottom:60px;gap:8px;justify-content:space-around;flex-wrap:wrap}.bc-controls .bc-control-group .bc-btn{width:40px;height:40px}.bc-controls .bc-control-group .bc-btn i{font-size:18px}.bc-controls .bc-control-group .bc-selector-button{width:28px;height:40px}.bc-controls .bc-control-group .bc-selector-button i{font-size:10px}.bc-controls .bc-btn:not(.bc-control-group .bc-btn){width:48px;height:48px;font-size:16px}}@media screen and (max-width: 480px){.bc-controls{padding:2% 1%;gap:6px}.bc-controls .bc-control-group{border-radius:20px}.bc-controls .bc-control-group .bc-btn{width:36px;height:36px}.bc-controls .bc-control-group .bc-btn i{font-size:16px}.bc-controls .bc-control-group .bc-selector-button{width:24px;height:36px}.bc-controls .bc-btn:not(.bc-control-group .bc-btn){width:44px;height:44px;font-size:14px}}@media screen and (max-width: 400px){.bc-controls .bc-speaker-toggle{display:none}.bc-controls .bc-expand{display:none}}.bc-btn.bc-screen-share.active{background:rgb(var(--text-on-bg-ac-color))}.bc-btn.bc-screen-share.active i{color:rgb(var(--text-color))}.bc-btn.bc-screen-share:disabled{cursor:not-allowed;opacity:.5;background:rgba(var(--neutral-grad-2), 0.2)}.bc-btn.bc-screen-share i{pointer-events:none;color:rgb(var(--text-on-bg-ac-color))}.bc-btn.bc-screen-share:hover:not(:disabled){background:rgba(var(--neutral-grad-2), 0.6)}.bc-btn.bc-screen-share.active:hover{background:rgba(var(--text-on-bg-ac-color), 0.9)}.bc-btn.bc-screen-share.active:hover i{color:rgb(var(--text-color))}',""]);const c=a},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,o,r,i){"string"==typeof e&&(e=[[null,e,void 0]]);var a={};if(o)for(var c=0;c<this.length;c++){var l=this[c][0];null!=l&&(a[l]=!0)}for(var s=0;s<e.length;s++){var d=[].concat(e[s]);o&&a[d[0]]||(void 0!==i&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=i),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),r&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=r):d[4]="".concat(r)),t.push(d))}},t}},601:e=>{e.exports=function(e){return e[1]}},7:e=>{var t,n="object"==typeof Reflect?Reflect:null,o=n&&"function"==typeof n.apply?n.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};t=n&&"function"==typeof n.ownKeys?n.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var r=Number.isNaN||function(e){return e!=e};function i(){i.init.call(this)}e.exports=i,e.exports.once=function(e,t){return new Promise((function(n,o){function r(n){e.removeListener(t,i),o(n)}function i(){"function"==typeof e.removeListener&&e.removeListener("error",r),n([].slice.call(arguments))}h(e,t,i,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&h(e,"error",t,{once:!0})}(e,r)}))},i.EventEmitter=i,i.prototype._events=void 0,i.prototype._eventsCount=0,i.prototype._maxListeners=void 0;var a=10;function c(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?i.defaultMaxListeners:e._maxListeners}function s(e,t,n,o){var r,i,a,s;if(c(n),void 0===(i=e._events)?(i=e._events=Object.create(null),e._eventsCount=0):(void 0!==i.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),i=e._events),a=i[t]),void 0===a)a=i[t]=n,++e._eventsCount;else if("function"==typeof a?a=i[t]=o?[n,a]:[a,n]:o?a.unshift(n):a.push(n),(r=l(e))>0&&a.length>r&&!a.warned){a.warned=!0;var d=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");d.name="MaxListenersExceededWarning",d.emitter=e,d.type=t,d.count=a.length,s=d,console&&console.warn&&console.warn(s)}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,n){var o={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},r=d.bind(o);return r.listener=n,o.wrapFn=r,r}function p(e,t,n){var o=e._events;if(void 0===o)return[];var r=o[t];return void 0===r?[]:"function"==typeof r?n?[r.listener||r]:[r]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(r):f(r,r.length)}function v(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function f(e,t){for(var n=new Array(t),o=0;o<t;++o)n[o]=e[o];return n}function h(e,t,n,o){if("function"==typeof e.on)o.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function r(i){o.once&&e.removeEventListener(t,r),n(i)}))}}Object.defineProperty(i,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),i.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||r(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},i.prototype.getMaxListeners=function(){return l(this)},i.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var c=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw c.context=a,c}var l=i[e];if(void 0===l)return!1;if("function"==typeof l)o(l,this,t);else{var s=l.length,d=f(l,s);for(n=0;n<s;++n)o(d[n],this,t)}return!0},i.prototype.addListener=function(e,t){return s(this,e,t,!1)},i.prototype.on=i.prototype.addListener,i.prototype.prependListener=function(e,t){return s(this,e,t,!0)},i.prototype.once=function(e,t){return c(t),this.on(e,u(this,e,t)),this},i.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,u(this,e,t)),this},i.prototype.removeListener=function(e,t){var n,o,r,i,a;if(c(t),void 0===(o=this._events))return this;if(void 0===(n=o[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete o[e],o.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(r=-1,i=n.length-1;i>=0;i--)if(n[i]===t||n[i].listener===t){a=n[i].listener,r=i;break}if(r<0)return this;0===r?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,r),1===n.length&&(o[e]=n[0]),void 0!==o.removeListener&&this.emit("removeListener",e,a||t)}return this},i.prototype.off=i.prototype.removeListener,i.prototype.removeAllListeners=function(e){var t,n,o;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var r,i=Object.keys(n);for(o=0;o<i.length;++o)"removeListener"!==(r=i[o])&&this.removeAllListeners(r);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(o=t.length-1;o>=0;o--)this.removeListener(e,t[o]);return this},i.prototype.listeners=function(e){return p(this,e,!0)},i.prototype.rawListeners=function(e){return p(this,e,!1)},i.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):v.call(e,t)},i.prototype.listenerCount=v,i.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},72:e=>{var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var i={},a=[],c=0;c<e.length;c++){var l=e[c],s=o.base?l[0]+o.base:l[0],d=i[s]||0,u="".concat(s," ").concat(d);i[s]=d+1;var p=n(u),v={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==p)t[p].references++,t[p].updater(v);else{var f=r(v,o);o.byIndex=c,t.splice(c,0,{identifier:u,updater:f,references:1})}a.push(u)}return a}function r(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,r){var i=o(e=e||[],r=r||{});return function(e){e=e||[];for(var a=0;a<i.length;a++){var c=n(i[a]);t[c].references--}for(var l=o(e,r),s=0;s<i.length;s++){var d=n(i[s]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}i=l}}},659:e=>{var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},825:e=>{e.exports=function(e){var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var r=void 0!==n.layer;r&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,r&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var i=n.sourceMap;i&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(i))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={id:o,exports:{}};return e[o](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nc=void 0;var o={};n.r(o),n.d(o,{default:()=>U});var r=n(7),i=n(72),a=n.n(i),c=n(825),l=n.n(c),s=n(659),d=n.n(s),u=n(56),p=n.n(u),v=n(540),f=n.n(v),h=n(113),b=n.n(h),g=n(287),m={};function y(e){return y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},y(e)}function x(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=w(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,r=function(){};return{s:r,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return a=e.done,e},e:function(e){c=!0,i=e},f:function(){try{a||null==n.return||n.return()}finally{if(c)throw i}}}}function w(e,t){if(e){if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?k(e,t):void 0}}function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function C(){C=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},r=o.iterator||"@@iterator",i=o.asyncIterator||"@@asyncIterator",a=o.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(e){c=function(e,t,n){return e[t]=n}}function l(e,t,n,o){var r=t&&t.prototype instanceof u?t:u,i=Object.create(r.prototype),a=new S(o||[]);return i._invoke=function(e,t,n){var o="suspendedStart";return function(r,i){if("executing"===o)throw new Error("Generator is already running");if("completed"===o){if("throw"===r)throw i;return{value:void 0,done:!0}}for(n.method=r,n.arg=i;;){var a=n.delegate;if(a){var c=w(a,n);if(c){if(c===d)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===o)throw o="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o="executing";var l=s(e,t,n);if("normal"===l.type){if(o=n.done?"completed":"suspendedYield",l.arg===d)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(o="completed",n.method="throw",n.arg=l.arg)}}}(e,n,a),i}function s(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=l;var d={};function u(){}function p(){}function v(){}var f={};c(f,r,(function(){return this}));var h=Object.getPrototypeOf,b=h&&h(h(I([])));b&&b!==t&&n.call(b,r)&&(f=b);var g=v.prototype=u.prototype=Object.create(f);function m(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function x(e,t){function o(r,i,a,c){var l=s(e[r],e,i);if("throw"!==l.type){var d=l.arg,u=d.value;return u&&"object"==y(u)&&n.call(u,"__await")?t.resolve(u.__await).then((function(e){o("next",e,a,c)}),(function(e){o("throw",e,a,c)})):t.resolve(u).then((function(e){d.value=e,a(d)}),(function(e){return o("throw",e,a,c)}))}c(l.arg)}var r;this._invoke=function(e,n){function i(){return new t((function(t,r){o(e,n,t,r)}))}return r=r?r.then(i,i):i()}}function w(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,w(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var o=s(n,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,d;var r=o.arg;return r?r.done?(t[e.resultName]=r.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):r:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function A(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function I(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function t(){for(;++o<e.length;)if(n.call(e,o))return t.value=e[o],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}return p.prototype=v,c(g,"constructor",v),c(v,"constructor",p),p.displayName=c(v,a,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,c(e,a,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},m(x.prototype),c(x.prototype,i,(function(){return this})),e.AsyncIterator=x,e.async=function(t,n,o,r,i){void 0===i&&(i=Promise);var a=new x(l(t,n,o,r),i);return e.isGeneratorFunction(n)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},m(g),c(g,a,"Generator"),c(g,r,(function(){return this})),c(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var o=t.pop();if(o in e)return n.value=o,n.done=!1,n}return n.done=!0,n}},e.values=I,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function o(n,o){return a.type="throw",a.arg=e,t.next=n,o&&(t.method="next",t.arg=void 0),!!o}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],a=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),l=n.call(i,"finallyLoc");if(c&&l){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(e,t){for(var o=this.tryEntries.length-1;o>=0;--o){var r=this.tryEntries[o];if(r.tryLoc<=this.prev&&n.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),A(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var o=n.completion;if("throw"===o.type){var r=o.arg;A(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:I(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}function A(e,t,n,o,r,i,a){try{var c=e[i](a),l=c.value}catch(e){return void n(e)}c.done?t(l):Promise.resolve(l).then(o,r)}function S(e){return function(){var t=this,n=arguments;return new Promise((function(o,r){var i=e.apply(t,n);function a(e){A(i,o,r,a,c,"next",e)}function c(e){A(i,o,r,a,c,"throw",e)}a(void 0)}))}}function I(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function E(e,t){return E=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},E(e,t)}function L(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function T(e){return T=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},T(e)}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}m.styleTagTransform=b(),m.setAttributes=p(),m.insert=d().bind(null,"head"),m.domAPI=l(),m.insertStyleElement=f(),a()(g.A,m),g.A&&g.A.locals&&g.A.locals;var B="video",O="voice",M=function(e){return e===B},V=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&E(e,t)}(A,e);var t,n,o,r,i,a,c,l,s,d,u,p,v,f,h,b,g,m=(b=A,g=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=T(b);if(g){var n=T(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return function(e,t){if(t&&("object"===y(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return L(e)}(this,e)});function A(e,t,n,o){var r;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,A),j(L(r=m.call(this)),"controls",{}),j(L(r),"isFrontalCamera",!1),j(L(r),"videoStreams",null),j(L(r),"isMuted",!1),j(L(r),"isScreenSharing",!1),j(L(r),"isCompositeActive",!1),j(L(r),"screenStream",null),j(L(r),"cameraStream",null),j(L(r),"originalVideoTrack",null),j(L(r),"compositeCanvas",null),j(L(r),"cameraVideoElement",null),j(L(r),"screenVideoElement",null),j(L(r),"activeCall",null),j(L(r),"secondCall",null),j(L(r),"syncInterval",null),j(L(r),"isWaitingForConnect",!1),j(L(r),"signal",null),j(L(r),"timer",null),j(L(r),"timeInterval",null),j(L(r),"title",null),j(L(r),"destroyed",!1),j(L(r),"view","middle"),j(L(r),"templates",{incomingCall:function(e){var t=M(e.type),n=t?"incomingVideoCall":"incomingAudioCall";return'\n\t\t\t<div class="bc-incoming-call">\n\t\t\t\t<div class="user">\n\t\t\t\t\t<div class="avatar">\n\t\t\t\t\t\t'.concat(this.getAvatar(e),'\n\t\t\t\t\t</div>\n\t\t\t\t\t<div class="title">\n\t\t\t\t\t\t<div class="name">').concat(e.initiator.source.name,'</div>\n\t\t\t\t\t\t<div class="description">').concat(this.options.getWithLocale(n),'</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t\t<div class="buttons">\n\t\t\t\t\t<button class="bc-btn bc-decline" id="bc-decline"><i class="fas fa-phone"></i></button>\n\t\t\t\t\t').concat(t?'<button class="bc-btn bc-answer" id="bc-answer-video"><i class="fa fa-video"></i></button>':"",'\n\t\t\t\t\t<button class="bc-btn bc-answer " id="bc-answer-voice"><i class="fas fa-flip-horizontal fa-phone"></i></button>\n\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t')},endedCall:function(e){return'\n\t\t\t<div class="bc-ended-call">\n\t\t\t\t<div class="avatar">\n\t\t\t\t\t\t'.concat(this.getAvatar(e),'\n\t\t\t\t</div>\n\t\t\t\t<div class="name">').concat(this.activeCall.initiator.source.name,'</div>\n\t\t\t\t<div class="description">').concat(this.options.getWithLocale("endedCall"),"</div>\n\t\t\t</div>")},videoCall:function(){return'\n        <div class="bc-topnav">\n          <div class="bc-call-info">\n            <div class="avatar">\n              '.concat(this.getAvatar(),'\n            </div>\n            <div class="info">\n              <div class="name">').concat(this.activeCall.initiator.source.name,'</div>\n              <div class="time" id="time">0:00</div>\n            </div>\n          </div>\n          <div class="options">\n            <button class="bc-btn bc-pip" id="bc-pip"><i class="fas fa-minus"></i></button>\n            <button class="bc-btn bc-format" id="bc-format"><i class="fas"></i></button>\n          </div>\n        </div>\n        <div class="bc-video-container">\n          <div class="bc-video active novid" id="remote-scene">\n            <video id="remote" pip="false" autoplay disablePictureInPicture="true" playsinline poster="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="></video>\n            <div class="avatar">\n              ').concat(this.getAvatar(),'\n            </div>\n            <div class="status">').concat(this.options.getWithLocale("connecting"),'</div>\n          </div>\n          <div class="bc-video minified">\n            <video id="local" muted pip="false" disablePictureInPicture="true" autoplay playsinline poster="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="></video>\n          </div>\n        </div>\n        <div class="bc-controls" data-call-type="video" id="controls">\n          <button disabled class="bc-btn bc-camera" id="bc-camera"><i class="fas fa-sync-alt"></i></button>\n          <button class="bc-btn bc-screen-share" id="bc-screen-share" title="Screen Share"><i class="fas fa-desktop"></i></button>\n          <button class="bc-btn bc-video-on call-update-control" disabled id="bc-video-on"><i class="fas fa-video"></i></button>\n          <button class="bc-btn bc-video-off call-update-control" id="bc-video-off"><i class="fas fa-video-slash"></i></button>\n          <div class="bc-control-group">\n            <div class="bc-device-selector">\n              <button class="bc-btn bc-mute" id="bc-mute" title="Microphone"><i class="fas fa-microphone"></i></button>\n            </div>\n            <button class="bc-selector-button" id="bc-audio-selector" title="Audio Settings">\n              <i class="fas fa-chevron-up"></i>\n            </button>\n          </div>\n          <button class="bc-btn bc-decline" id="bc-decline"><i class="fas fa-phone"></i></button>\n          <button class="bc-btn bc-expand" id="bc-expand"><i class="fas fa-expand"></i></button>\n        </div>\n      ')},voiceCall:function(){return'<div class="bc-topnav">\n        <div class="bc-call-info">\n          <div class="avatar">\n            '.concat(this.getAvatar(),'\n          </div>\n          <div class="info">\n            <div class="name">').concat(this.activeCall.initiator.source.name,'</div>\n            <div class="time" id="time">0:00</div>\n          </div>\n        </div>\n        <div class="options">\n          <button class="bc-btn bc-pip" id="bc-pip"><i class="fas fa-minus"></i></button>\n          <button class="bc-btn bc-format" id="bc-format"><i class="fas"></i></button>\n        </div>\n      </div>\n      <div class="bc-video-container">\n        <div class="bc-video active novid" id="remote-scene">\n          <video id="remote" pip="false" autoplay playsinline poster="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="></video>\n          <div class="avatar">\n            ').concat(this.getAvatar(),'\n          </div>\n          <div class="status">').concat(this.options.getWithLocale("connecting"),'</div>\n        </div>\n        <div class="bc-video minified">\n          <video id="local" class="hidden" muted pip="false" autoplay playsinline poster="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="></video>\n        </div>\n      </div>\n      <div data-call-type="voice" class="bc-controls voice" id="controls">\n        <button class="bc-btn bc-camera" disabled id="bc-camera"><i class="fas fa-sync-alt"></i></button>\n        <button class="bc-btn bc-video-on call-update-control" id="bc-video-on"><i class="fas fa-video"></i></button>\n        <button class="bc-btn bc-video-off call-update-control" disabled id="bc-video-off"><i class="fas fa-video-slash"></i></button>\n        <div class="bc-control-group">\n          <div class="bc-device-selector">\n            <button class="bc-btn bc-mute" id="bc-mute" title="Microphone"><i class="fas fa-microphone"></i></button>\n          </div>\n          <button class="bc-selector-button" id="bc-audio-selector" title="Audio Settings">\n            <i class="fas fa-chevron-up"></i>\n          </button>\n        </div>\n        <button class="bc-btn bc-decline" id="bc-decline"><i class="fas fa-phone"></i></button>\n        <button class="bc-btn bc-expand" id="bc-expand"><i class="fas fa-expand"></i></button>\n      </div>\n    ')}}),j(L(r),"renderTemplates",{call:function(e){if(r.root){var t=document.getElementById("controls"),n=!!t,o=M(e);if(n){var i=document.getElementById("bc-camera"),a=document.getElementById("local");t.dataset.callType=e,i&&(i.disabled=!o),a&&a.classList.toggle("hidden",!o)}else{var c=r.templates["".concat(e,"Call")];if(!c)throw Error("No template for ".concat(e));r.root.innerHTML=(null==c?void 0:c.call(L(r)))||"",r.initCallInterface("videoCall")}}},incomingCall:function(e){var t,n,o,i,a;r.notify&&("ringing"!==(null===(t=L(r))||void 0===t||null===(n=t.activeCall)||void 0===n?void 0:n.state)||(null===(o=L(r))||void 0===o||null===(i=o.activeCall)||void 0===i?void 0:i.callId)===e.callId?(r.notify.innerHTML=(null===(a=r.templates.incomingCall)||void 0===a?void 0:a.call(L(r),e))||"",r.initCallInterface("incomingCall",e)):e.reject("busy"))},clearNotify:function(){r.notify&&(r.notify.innerHTML="")},clearVideo:function(){r.root&&(r.root.innerHTML="")},clearInterface:function(){r.root&&(r.root.classList.remove("active"),r.cancelMini(),r.root.classList.remove("middle"),r.root.classList.remove("full"))},endedCall:function(e){var t;r.root&&(r.root.classList.contains("minified")&&r.cancelMini(),r.root.innerHTML=(null===(t=r.templates.endedCall)||void 0===t?void 0:t.call(L(r),e))||"")}}),j(L(r),"updateCall",function(){var e=S(C().mark((function e(t){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.handleCallUpdate(S(C().mark((function e(){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!M(t)){e.next=6;break}return e.next=4,r.activeCall.upgradeCall(!0,!0);case 4:e.next=7;break;case 6:r.activeCall.setLocalVideoMuted(!0);case 7:r.renderTemplates.call(t),r.isScreenSharing&&r.screenStream&&r.updateInterfaceForScreenShare(r.screenStream);case 9:case"end":return e.stop()}}),e)}))));case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),r.client=e,r.matrixcs=t,r.initEvents(),r.initSignals(),r.initTemplates(n),r.options=o,r.initAudioEventListeners(),console.log("ss",e,t),console.log("dd",t),r}return t=A,n=[{key:"setupCallKit",value:function(){var e,t,n=this;if(null!==(e=window.cordova)&&void 0!==e&&null!==(t=e.plugins)&&void 0!==t&&t.CordovaCall){console.log("CallKit plugin found!");try{var o,r;null===(o=window.cordova)||void 0===o||null===(r=o.plugins)||void 0===r||r.CordovaCall.setAppName("Bastyon",(function(){return console.log("App name set")}),(function(e){return console.error("App name error:",e)})),window.CordovaCall.setIncludeInRecents(!0,(function(){return console.log("Include in recents enabled")}),(function(e){return console.error("Include in recents error:",e)})),window.cordova.plugins.CordovaCall.on("answer",(function(e){console.log("CallKit answered:",e),n.handleCallKitAnswer(e)})),window.cordova.plugins.CordovaCall.on("reject",(function(e){console.log("CallKit rejected:",e),n.handleCallKitReject(e)})),window.cordova.plugins.CordovaCall.on("hangup",(function(e){console.log("CallKit hangup:",e),n.handleCallKitHangup(e)})),console.log("CallKit initialized successfully"),this.callKitPlugin=window.cordova.plugins.CordovaCall}catch(e){console.error("CallKit initialization error:",e)}}else console.log("CallKit plugin not found"),console.log("Available globals:",Object.keys(window).filter((function(e){return e.includes("Call")||e.includes("cordova")})))}},{key:"getAudioDevices",value:(h=S(C().mark((function e(){var t;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.enumerateDevices();case 3:return t=e.sent,e.abrupt("return",{speakers:t.filter((function(e){return"audiooutput"===e.kind})),microphones:t.filter((function(e){return"audioinput"===e.kind}))});case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error getting audio devices:",e.t0),e.abrupt("return",{speakers:[],microphones:[]});case 11:case"end":return e.stop()}}),e,null,[[0,7]])}))),function(){return h.apply(this,arguments)})},{key:"setMicrophoneInput",value:(f=S(C().mark((function e(t){var n,o,r,i,a;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.activeCall){e.next=3;break}return e.abrupt("return",!1);case 3:return n={audio:!t||{deviceId:{exact:t}},video:!1},e.next=6,navigator.mediaDevices.getUserMedia(n);case 6:if(o=e.sent,r=o.getAudioTracks()[0],i=this.activeCall.peerConn.getSenders(),!(a=i.find((function(e){return e.track&&"audio"===e.track.kind})))){e.next=17;break}return e.next=13,a.replaceTrack(r);case 13:return a.track&&a.track.stop(),localStorage.setItem("preferredMicrophoneInput",t||"default"),console.log("Microphone changed to:",t||"default"),e.abrupt("return",!0);case 17:return e.abrupt("return",!1);case 20:return e.prev=20,e.t0=e.catch(0),console.error("Error setting microphone:",e.t0),this.showAudioError("Failed to change microphone"),e.abrupt("return",!1);case 25:case"end":return e.stop()}}),e,this,[[0,20]])}))),function(e){return f.apply(this,arguments)})},{key:"showAudioError",value:function(e){var t=document.createElement("div");t.style.cssText="\n          position: fixed;\n          top: 20px;\n          right: 20px;\n          background: rgb(var(--color-bad));\n          color: white;\n          padding: 10px 15px;\n          border-radius: 5px;\n          z-index: 999999;\n          font-size: 14px;\n      ",t.textContent=e,document.body.appendChild(t),setTimeout((function(){return t.remove()}),3e3)}},{key:"setAudioOutput",value:(v=S(C().mark((function e(t){var n,o,r,i,a,c;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("Trying to set audio output to:",t),n=document.getElementById("remote"),o=document.getElementById("local"),!n||"function"!=typeof n.setSinkId){e.next=15;break}return e.prev=5,e.next=8,n.setSinkId(t);case 8:console.log("Remote video sink set successfully"),e.next=15;break;case 11:throw e.prev=11,e.t0=e.catch(5),console.error("Failed to set remote sink:",e.t0),e.t0;case 15:if(!o||"function"!=typeof o.setSinkId){e.next=25;break}return e.prev=16,e.next=19,o.setSinkId(t);case 19:console.log("Local video sink set successfully"),e.next=25;break;case 22:e.prev=22,e.t1=e.catch(16),console.warn("Failed to set local sink:",e.t1);case 25:r=document.querySelectorAll("audio"),i=x(r),e.prev=27,i.s();case 29:if((a=i.n()).done){e.next=42;break}if("function"!=typeof(c=a.value).setSinkId){e.next=40;break}return e.prev=32,e.next=35,c.setSinkId(t);case 35:e.next=40;break;case 37:e.prev=37,e.t2=e.catch(32),console.warn("Failed to set audio sink:",e.t2);case 40:e.next=29;break;case 42:e.next=47;break;case 44:e.prev=44,e.t3=e.catch(27),i.e(e.t3);case 47:return e.prev=47,i.f(),e.finish(47);case 50:return localStorage.setItem("preferredAudioOutput",t||"default"),console.log("Audio output successfully changed to:",t||"default"),e.abrupt("return",!0);case 55:return e.prev=55,e.t4=e.catch(0),console.error("Error setting audio output:",e.t4),this.showAudioError("Failed to change audio output"),e.abrupt("return",!1);case 60:case"end":return e.stop()}}),e,this,[[0,55],[5,11],[16,22],[27,44,47,50],[32,37]])}))),function(e){return v.apply(this,arguments)})},{key:"initAudioEventListeners",value:function(){var e,t=this;null!==(e=navigator.mediaDevices)&&void 0!==e&&e.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",S(C().mark((function e(){var n,o,r,i,a,c,l;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.getAudioDevices();case 3:if(r=e.sent,!window.isios||!window.isios()){e.next=6;break}return e.abrupt("return");case 6:if(null===(n=window.cordova)||void 0===n||null===(o=n.plugins)||void 0===o||!o.audioManagement||!t.activeCall){e.next=16;break}return e.prev=7,e.next=10,window.cordova.plugins.audioManagement.configureAudioSession({category:"playAndRecord",mode:"voiceChat",options:["allowBluetooth","allowBluetoothA2DP"]});case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(7),console.error("Cordova audio config failed:",e.t0);case 15:return e.abrupt("return");case 16:if(i=r.speakers.find((function(e){var t=e.label.toLowerCase();return t.includes("bluetooth")||t.includes("airpod")||t.includes("airbuds")||t.includes("wh-")||t.includes("buds")||t.includes("headset")||t.includes("headphone")})),a=r.speakers.find((function(e){var t=e.label.toLowerCase();return t.includes("headphone")||t.includes("headset")||t.includes("wired")||t.includes("3.5mm")})),!(c=i||a)||!t.activeCall){e.next=26;break}return e.next=22,t.setAudioOutput(c.deviceId);case 22:if(!(l=r.microphones.find((function(e){return e.groupId===c.groupId||e.label.toLowerCase().includes(c.label.toLowerCase().split(" ")[0])})))){e.next=26;break}return e.next=26,t.setMicrophoneInput(l.deviceId);case 26:e.next=31;break;case 28:e.prev=28,e.t1=e.catch(0),console.error("Error handling device change:",e.t1);case 31:case"end":return e.stop()}}),e,null,[[0,28],[7,12]])}))))}},{key:"destroy",value:function(){var e;this.destroyed=!0,this.activeCall&&this.activeCall.hangup(),this.secondCall&&this.secondCall.hangup(),this.isScreenSharing&&this.stopScreenShare(),this.clearTimer(),this.clearBlinking(),clearInterval(this.syncInterval),null===(e=this.signal)||void 0===e||e.pause(),this.signal=null,this.renderTemplates.clearInterface(),this.renderTemplates.clearVideo(),this.renderTemplates.clearNotify(),this.container&&this.container.remove(),this.container=null,this.root=null,this.notify=null}},{key:"initTemplates",value:function(e){var t=this;e.insertAdjacentHTML("beforeend",'<div class="bc-container" id="bc-container"><div id="bc-notify" class="bc-notify"></div><div id="bc-root"></div></div>'),this.root=document.getElementById("bc-root"),this.notify=document.getElementById("bc-notify"),this.container=document.getElementById("bc-container"),window&&(window.onbeforeunload=function(){t.activeCall&&t.activeCall.hangup()})}},{key:"initEvents",value:function(){var e=this;this.client.on("Call.incoming",function(){var t=S(C().mark((function t(n){var o,r,i,a,c;return C().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("fledgling"!=n.state){t.next=3;break}return t.next=3,R((function(){return"fledgling"!=n.state}),50);case 3:if(!n.hangupParty&&!n.hangupReason){t.next=5;break}return t.abrupt("return");case 5:e.clearBlinking(),e.setBlinking(),e.emit("initcall"),null!=e&&null!==(o=e.options)&&void 0!==o&&o.onIncomingCall&&e.options.onIncomingCall(n),r=e.client.store.rooms[n.roomId].currentState.members,i=Object.keys(r).filter((function(t){return t!==e.client.credentials.userId})),a=r[i],c=r[e.client.credentials.userId],n.initiator=a,n.user=c,e.options.getUserInfo(a.userId).then((function(t){if(!n.hangupParty&&!n.hangupReason){if(a.source=t[0]||t,e.addCallListeners(n),e.activeCall){if(e.secondCall)n.reject("busy"),n.hangup("busy");else if(e.secondCall=n,"ringing"!==e.activeCall.state)return void e.showIncomingCall(n)}else e.activeCall=n;e.showIncomingCall(n)}}));case 16:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"initSignals",value:function(){this.signal=new Audio}},{key:"clearTimer",value:function(){this.timer=null,clearInterval(this.timeInterval),this.timeInterval=null}},{key:"initTimer",value:function(){this.timer=0;var e=document.getElementById("time");this.timeInterval=setInterval(function(){this.timer++;var t=Math.floor(this.timer/60),n=this.timer%60;e.innerHTML="".concat(t,":").concat(n>=10?n:"0"+n)}.bind(this),1e3)}},{key:"answer",value:function(){var e,t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B,o=M(n);null===(e=this.signal)||void 0===e||e.pause();var r=function(){return t.activeCall.answer(!0,o)};this.initCordovaPermisions(n).then((function(){try{"connected"!==t.activeCall.state&&"ended"!==t.activeCall.state?(r(),t.renderTemplates.clearNotify(),t.renderTemplates.call(n)):(t.isWaitingForConnect=!0,t.renderTemplates.clearNotify(),t.activeCall.hangup(),setTimeout((function(){if(!t.destroyed)try{r(),t.isWaitingForConnect=!1,t.renderTemplates.call(n)}catch(e){console.error("Ошибка при ответе на вторую линию",e)}}),1e3))}catch(e){return Promise.reject(e)}return Promise.resolve()})).catch((function(e){console.error(e)}))}},{key:"initsync",value:function(){var e=this,t=document.querySelector(".bc-video-container");this.activeCall.peerConn.getStats(null).then((function(e){var t;(t=e,function(e){if(Array.isArray(e))return k(e)}(t)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||w(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).filter((function(e){return"candidate-pair"===e[1].type})).forEach((function(e){}))}));var n=!1;this.syncInterval&&clearInterval(this.syncInterval),this.syncInterval=setInterval((function(){var o;if(null!=e&&null!==(o=e.activeCall)&&void 0!==o&&o.remoteUsermediaStream){var r,i,a,c=null===(r=e.activeCall)||void 0===r||null===(i=r.remoteUsermediaStream)||void 0===i?void 0:i.getVideoTracks()[0],l=null!==(a=null==c?void 0:c.getSettings().aspectRatio)&&void 0!==a?a:1.3,s=!c;if(s||c&&l||window.isios&&window.isios()){if(!n){var d=document.getElementById("remote-scene");s?d.classList.add("novid"):d.classList.remove("novid"),d.classList.remove("connecting")}n=!0}if(l)return t.style.aspectRatio=1/l,void(l>1?t.classList.add("vertical"):t.classList.remove("vertical"));1!=t.style.aspectRatio&&(t.style.aspectRatio=1)}}),300)}},{key:"mute",value:function(e){e.stopPropagation();var t=this.activeCall.peerConn.getSenders().find((function(e){return"audio"===e.track.kind})),n=document.querySelector(".bc-mute");t.track.enabled?(n.firstChild.classList.remove("fa-microphone"),n.classList.add("active"),n.firstChild.classList.add("fa-microphone-slash")):(n.firstChild.classList.remove("fa-microphone-slash"),n.classList.remove("active"),n.firstChild.classList.add("fa-microphone")),t.track.enabled=!t.track.enabled}},{key:"handleCallUpdate",value:(p=S(C().mark((function e(t){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setCallUpdateControlsLoading(!0),e.prev=1,e.next=4,t();case 4:return e.prev=4,this.setCallUpdateControlsLoading(!1),e.finish(4);case 7:case"end":return e.stop()}}),e,this,[[1,,4,7]])}))),function(e){return p.apply(this,arguments)})},{key:"setCallUpdateControlsLoading",value:function(e){document.querySelectorAll(".call-update-control").forEach((function(t){t.disabled=e,t.classList.toggle("loading",e)}))}},{key:"hide",value:function(e){e.stopPropagation();var t=this.activeCall.peerConn.getSenders().find((function(e){var t;return"video"===(null===(t=e.track)||void 0===t?void 0:t.kind)||!e.track}));t.track.enabled,t.track.enabled=!t.track.enabled}},{key:"cameraCount",value:function(){navigator.mediaDevices.enumerateDevices().then((function(e){e.filter((function(e){return"videoinput"===e.kind})).length<=1&&(document.getElementById("bc-camera").style.display="none")}))}},{key:"getVideoDevices",value:(u=S(C().mark((function e(){var t;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.enumerateDevices();case 3:return t=e.sent,e.abrupt("return",t.filter((function(e){return"videoinput"===e.kind})));case 7:return e.prev=7,e.t0=e.catch(0),console.error("Error getting video devices:",e.t0),e.abrupt("return",[]);case 11:case"end":return e.stop()}}),e,null,[[0,7]])}))),function(){return u.apply(this,arguments)})},{key:"devices",value:function(){return navigator.mediaDevices.enumerateDevices().then((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return window.cordova&&window.cordova.plugins.EnumerateDevicesPlugin?cordova.plugins.EnumerateDevicesPlugin.getEnumerateDevices().then((function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n={},o=[];return t.reverse(),console.log("cdevices",t),console.log("devices",e),e.forEach((function(e){var r={deviceId:e.deviceId,groupId:e.groupId,kind:e.kind,label:e.label},i=t.find((function(e,t){return r.kind==e.kind&&!n[e.deviceId]}));i&&(n[i.deviceId]=!0,r.label||(r.label=(i.label||"").toLowerCase())),o.push(r)})),console.log(o),Promise.resolve(o)})):Promise.resolve(e)}))}},{key:"camera",value:function(e){var t=this,n=this;try{this.devices().then((function(e){console.log("devices",e);var o,r=e.filter((function(e){return"videoinput"===e.kind})),i=n.activeCall.peerConn.getSenders().find((function(e){return"video"===e.track.kind}));if(console.log("video",r),console.log("sender",i),i&&r.length>1&&(i.track.label.includes("front")||i.track.label.includes("передней")?(console.log("to back"),o=r.reverse().find((function(e){return e.label.includes("back")||e.label.includes("задней")}))):i.track.label.includes("back")||i.track.label.includes("задней")?(console.log("to front"),o=r.find((function(e){return e.label.includes("front")||e.label.includes("передней")}))):(console.log("no labeled"),o=r.find((function(e){return e.label!==i.track.label}))),console.log("target",o),o)){var a={};a.deviceId={exact:o.deviceId},console.log("videoConstraints",a);var c={video:a,audio:!1};navigator.mediaDevices.getUserMedia(c).then((function(e){e.getTracks().forEach((function(t){var o=n.activeCall.peerConn.getSenders().find((function(e){return e.track.kind==t.kind}));o.track.label!==t.label&&(t.muted,o.replaceTrack(t),o.track.stop(),n.videoStreams.local.srcObject=e)})),t.hide()})).catch((function(e){}))}})).catch((function(e){}))}catch(e){}}},{key:"switchCamera",value:(d=S(C().mark((function e(t){var n,o,r,i,a,c,l;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.activeCall){e.next=3;break}return e.abrupt("return",!1);case 3:return n={video:!t||{deviceId:{exact:t}},audio:!1},e.next=6,navigator.mediaDevices.getUserMedia(n);case 6:if(o=e.sent,r=o.getVideoTracks()[0],i=this.activeCall.peerConn.getSenders(),!(a=i.find((function(e){return e.track&&"video"===e.track.kind})))){e.next=18;break}return c=a.track,e.next=14,a.replaceTrack(r);case 14:return(l=document.getElementById("local"))&&(l.srcObject=o),c&&c.stop(),e.abrupt("return",!0);case 18:return e.abrupt("return",!1);case 21:return e.prev=21,e.t0=e.catch(0),console.error("Error switching camera:",e.t0),e.abrupt("return",!1);case 25:case"end":return e.stop()}}),e,this,[[0,21]])}))),function(e){return d.apply(this,arguments)})},{key:"format",value:function(){console.log("format",this.root),this.root.classList.contains("middle")?(this.root.classList.remove("middle"),this.toFull()):this.root.classList.contains("full")&&(this.root.classList.remove("full"),this.toMiddle())}},{key:"pip",value:function(e){console.log("E",e),this.root.classList.contains("middle")?(this.root.classList.remove("middle"),this.toMini()):this.root.classList.contains("full")?(this.root.classList.remove("full"),this.toMini()):(this.cancelMini(),this.toMiddle())}},{key:"toMiddle",value:function(){var e;this.root.classList.add("middle"),localStorage.setItem("callSizeSettings","middle"),this.view="middle",null!=this&&null!==(e=this.options)&&void 0!==e&&e.changeView&&this.options.changeView(this.activeCall,this)}},{key:"toFull",value:function(){var e;this.root.classList.add("full"),localStorage.setItem("callSizeSettings","full"),this.view="full",null!=this&&null!==(e=this.options)&&void 0!==e&&e.changeView&&this.options.changeView(this.activeCall,this)}},{key:"getRootTranslate",value:function(){var e=((this.root.style.transform||"").replace("translate3d(","").replace(")","").replace(/px/g,"")||"0,0,0").split(",");return{x:Number(e[0]),y:Number(e[1])}}},{key:"setRootTranslate",value:function(e){var t=this,n=e.x,o=e.y;window.requestAnimationFrame((function(){t.root.style.transform="translate3d("+(n||0)+"px,"+(o||0)+"px,0px)"}))}},{key:"toMini",value:function(){var e,t=this;this.root.classList.add("minified"),localStorage.setItem("callSizeSettings","mini"),this.view="mini",null!=this&&null!==(e=this.options)&&void 0!==e&&e.changeView&&this.options.changeView(this.activeCall,this);var n=JSON.parse(localStorage.getItem("callPositionSettings"));console.log("pospos",n),n&&n.top&&n.left&&(this.root.style.bottom="auto",this.root.style.top=n.top,this.root.style.left=n.left),this.root.onmousedown=function(e){if(console.log("mouse down"),e.preventDefault(),!e.target.classList.contains("bc-btn")){var n=e.clientX-t.root.getBoundingClientRect().left,o=e.clientY-t.root.getBoundingClientRect().top;t.root.style.cursor="grabbing",t.root.style.zIndex=1e7,document.onmousemove=function(e){t.root.style.bottom="auto",e.pageY&&(window.innerHeight-t.root.getBoundingClientRect().bottom>10&&e.clientY-o>10?window.innerHeight-t.root.offsetHeight-11>=e.clientY-o&&(t.root.style.top=t.getPercents("height",e.clientY-o)):window.innerHeight-t.root.getBoundingClientRect().bottom<=10&&e.movementY<0?t.root.style.top=t.getPercents("height",window.innerHeight-t.root.offsetHeight-11):console.log("y out",window.innerHeight-t.root.getBoundingClientRect().bottom,e.clientY-o),e.pageX&&(0<e.clientX-n&&e.clientX-n<10&&e.movementX>0?t.root.style.left=e.pageX-n+"px":e.clientX-n>10&&document.body.clientWidth-t.root.getBoundingClientRect().left-t.root.offsetWidth>70?document.body.clientWidth-t.root.offsetWidth-71>=e.pageX-n&&(t.root.style.left=t.getPercents("width",e.pageX-n)):document.body.clientWidth-t.root.getBoundingClientRect().left-t.root.offsetWidth<=70&&e.movementX<0?t.root.style.left=t.root.style.left=t.getPercents("width",document.body.clientWidth-t.root.offsetWidth-71):console.log("x out",document.body.clientWidth-t.root.getBoundingClientRect().left-t.root.offsetWidth)))},document.onmouseleave=function(e){e.preventDefault(),console.log("leave"),document.onmousemove=null,t.root.onmouseup=null,t.root.ontouchend=null},document.onmouseup=function(e){console.log("mouse up"),localStorage.setItem("callPositionSettings",JSON.stringify({left:t.root.style.left,top:t.root.style.top})),document.onmousemove=null,t.root.style.cursor="grab",document.onmouseup=null},document.ontouchend=function(e){localStorage.setItem("callPositionSettings",JSON.stringify({left:t.root.style.left,top:t.root.style.top})),e.target.classList.contains("bc-btn")||e.preventDefault(),document.onmousemove=null,t.root.style.cursor="grab",document.ontouchend=null},e.stopPropagation()}},this.root.ondragstart=function(){return!1}}},{key:"getPercents",value:function(e,t){var n;switch(e){case"width":n=parseInt(t,10)/window.innerWidth;break;case"height":n=parseInt(t,10)/window.innerHeight}return"".concat(100*n+"%")}},{key:"cancelMini",value:function(){var e;this.root.classList.remove("minified"),this.hammertime&&(this.hammertime.off("pan"),this.hammertime.destroy()),document.onmousemove=null,this.root.style={},this.root.onmousedown=null,null!=this&&null!==(e=this.options)&&void 0!==e&&e.onCancelMini&&this.options.onCancelMini(this.activeCall,this)}},{key:"initCall",value:function(e){var t,n,o,r=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:B,a=M(i);return(null==this||null===(t=this.activeCall)||void 0===t?void 0:t.roomId)===e?(console.log("only one call in room",null==this||null===(n=this.activeCall)||void 0===n?void 0:n.state),"ringing"===(null==this||null===(o=this.activeCall)||void 0===o?void 0:o.state)&&(console.log("answer to incoming from same room"),this.answer(i)),Promise.reject()):(console.log("init call"),this.initCordovaPermisions(i).then((function(){var t=r.client.store.rooms[e].currentState.members,n=t[Object.keys(t).filter((function(e){return e!==r.client.credentials.userId}))],o=t[r.client.credentials.userId];return r.options.getUserInfo(n.userId).then((function(t){n.source=t[0]||t,console.log(t,n),r.emit("initcall");var c=r.matrixcs.createNewMatrixCall(r.client,e);if(!r.activeCall){r.activeCall=c;var l=new Audio("js/lib");return l.autoplay=!0,l.loop=!0,l.volume=.5,r.signal=l,console.log("init call2"),c.placeCall(!0,a).then((function(){return console.log("init call3"),c.initiator=n,c.user=o,r.addCallListeners(c),r.signal.src="sounds/calling.mp3",r.renderTemplates.call(i),c}))}})).catch((function(e){return console.log("get user info error",e),Promise.reject(e)}))})))}},{key:"hexDecode",value:function(e){for(var t=0,n="",o=2;o<=e.length;o+=2){var r;(t=parseInt(e.substring(o-2,o),16))>=128&&(t+=848),n+=t=String.fromCharCode("0x"+(null===(r=t)||void 0===r?void 0:r.toString(16)))}return n}},{key:"hangup",value:function(e){e.stopPropagation(),this.activeCall.hangup("ended",!1),this.renderTemplates.clearVideo(),this.signal.pause()}},{key:"reject",value:function(e){e.reject("busy"),this.signal.pause()}},{key:"setLocalElement",value:function(){var e,t=this,n=null===(e=this.activeCall.feeds.find((function(e){return e.userId===t.activeCall.user.userId})))||void 0===e?void 0:e.stream;try{n&&document.getElementById("local")&&!document.getElementById("local").srcObject&&(document.getElementById("local").srcObject=n)}catch(e){console.log(e)}}},{key:"setRemoteElement",value:function(){var e,t=this,n=null===(e=this.activeCall.feeds.find((function(e){return e.userId!==t.activeCall.user.userId})))||void 0===e?void 0:e.stream;try{if(n&&document.getElementById("remote")){document.getElementById("remote").srcObject=n;var o=localStorage.getItem("preferredAudioOutput");o&&"default"!==o&&document.getElementById("remote").setSinkId&&document.getElementById("remote").setSinkId(o).catch(console.error),this.updateAudioButtonState(o||"default")}}catch(e){console.log(e)}}},{key:"initCallInterface",value:function(e,t){var n,o=this;switch(e){case"incomingCall":document.getElementById("bc-answer-voice").addEventListener("click",(function(){return o.answer(O)})),null===(n=document.getElementById("bc-answer-video"))||void 0===n||n.addEventListener("click",(function(){return o.answer(B)})),document.getElementById("bc-decline").addEventListener("click",(function(){return o.reject(t)}));break;case"videoCall":this.videoStreams={remote:document.getElementById("remote"),local:document.getElementById("local")};try{var r;console.log("init call interface",this.activeCall),this.cameraCount(),this.root.style={};var i=null===(r=localStorage.getItem("callSizeSettings"))||void 0===r?void 0:r.toString();switch(this.setLocalElement(),console.log("init with "+i),i){case"mini":this.toMini();break;case"middle":default:this.toMiddle();break;case"full":this.toFull()}this.addVideoInterfaceListeners()}catch(e){console.log("init interface error",e)}}}},{key:"addVideoInterfaceListeners",value:function(){var e,t,n,o,r,i,a,c,l,s,d,u=this;null===(e=document.getElementById("bc-decline"))||void 0===e||e.addEventListener("click",(function(e){return u.hangup.call(u,e)})),null===(t=document.getElementById("bc-mute"))||void 0===t||t.addEventListener("click",(function(e){return u.mute.call(u,e)})),null===(n=document.getElementById("bc-video-on"))||void 0===n||n.addEventListener("click",(function(e){return u.updateCall(O)})),null===(o=document.getElementById("bc-video-off"))||void 0===o||o.addEventListener("click",(function(e){return u.updateCall(B)})),null===(r=document.getElementById("bc-camera"))||void 0===r||r.addEventListener("click",(function(e){return u.camera.call(u,e)})),null===(i=document.getElementById("bc-screen-share"))||void 0===i||i.addEventListener("click",(function(e){return u.toggleScreenShare.call(u,e)})),null===(a=document.getElementById("bc-audio-selector"))||void 0===a||a.addEventListener("click",(function(e){return u.showAudioDevices.call(u,e)})),null===(c=document.getElementById("bc-expand"))||void 0===c||c.addEventListener("click",(function(e){return u.pip.call(u,e)})),null===(l=document.getElementById("remote-scene"))||void 0===l||l.addEventListener("click",(function(e){return u.pip.call(u,e)})),null===(s=document.getElementById("bc-pip"))||void 0===s||s.addEventListener("click",(function(e){return u.pip.call(u,e)})),null===(d=document.getElementById("bc-format"))||void 0===d||d.addEventListener("click",(function(e){return u.format.call(u,e)}))}},{key:"showAudioDevices",value:(s=S(C().mark((function e(t){var n,o,r,i,a,c,l,s,d,u,p,v=this;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stopPropagation(),!(n=document.querySelector(".bc-audio-dropdown"))){e.next=5;break}return n.remove(),e.abrupt("return");case 5:return e.next=7,this.getAudioDevices();case 7:o=e.sent,r=localStorage.getItem("preferredAudioOutput")||"default",i=localStorage.getItem("preferredMicrophoneInput")||"default",(a=document.createElement("div")).className="bc-audio-dropdown",(c=document.createElement("div")).className="bc-audio-dropdown-header",c.innerHTML='<i class="fas fa-volume-up"></i> Speakers / Headphones',a.appendChild(c),(l=document.createElement("div")).className="bc-audio-dropdown-item ".concat("default"===r?"selected":""),l.innerHTML='\n          <i class="fas fa-volume-up"></i>\n          <span>Default Speaker</span>\n      ',l.addEventListener("click",S(C().mark((function e(){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.setAudioOutput("");case 2:e.sent&&(v.updateDropdownSelection(a,l,"speaker"),a.remove());case 4:case"end":return e.stop()}}),e)})))),a.appendChild(l),o.speakers.forEach((function(e,t){var n=document.createElement("div");n.className="bc-audio-dropdown-item ".concat(e.deviceId===r?"selected":"");var o="fas fa-volume-up",i=e.label.toLowerCase();i.includes("headphone")||i.includes("headset")?o="fas fa-headphones":(i.includes("bluetooth")||i.includes("airpod")||i.includes("wh-"))&&(o="fab fa-bluetooth-b");var c=e.label||"Speaker ".concat(t+1);n.innerHTML='\n              <i class="'.concat(o,'"></i>\n              <span title="').concat(c,'">').concat(c,"</span>\n          "),n.addEventListener("click",S(C().mark((function t(){return C().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("Setting audio output to:",e.deviceId),t.next=3,v.setAudioOutput(e.deviceId);case 3:t.sent&&(v.updateDropdownSelection(a,n,"speaker"),a.remove());case 5:case"end":return t.stop()}}),t)})))),a.appendChild(n)})),(s=document.createElement("div")).className="bc-audio-dropdown-separator",a.appendChild(s),(d=document.createElement("div")).className="bc-audio-dropdown-header",d.innerHTML='<i class="fas fa-microphone"></i> Microphones',a.appendChild(d),(u=document.createElement("div")).className="bc-audio-dropdown-item ".concat("default"===i?"selected":""),u.innerHTML='\n          <i class="fas fa-microphone"></i>\n          <span>Default Microphone</span>\n      ',u.addEventListener("click",S(C().mark((function e(){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v.setMicrophoneInput("");case 2:e.sent&&(v.updateDropdownSelection(a,u,"microphone"),a.remove());case 4:case"end":return e.stop()}}),e)})))),a.appendChild(u),o.microphones.forEach((function(e,t){var n=document.createElement("div");n.className="bc-audio-dropdown-item ".concat(e.deviceId===i?"selected":"");var o="fas fa-microphone",r=e.label.toLowerCase();r.includes("bluetooth")||r.includes("airpod")||r.includes("wh-")?o="fab fa-bluetooth-b":(r.includes("headset")||r.includes("headphone"))&&(o="fas fa-headset");var c=e.label||"Microphone ".concat(t+1);n.innerHTML='\n              <i class="'.concat(o,'"></i>\n              <span title="').concat(c,'">').concat(c,"</span>\n          "),n.addEventListener("click",S(C().mark((function t(){return C().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,v.setMicrophoneInput(e.deviceId);case 2:t.sent&&(v.updateDropdownSelection(a,n,"microphone"),a.remove());case 4:case"end":return t.stop()}}),t)})))),a.appendChild(n)})),document.body.appendChild(a),setTimeout((function(){return a.style.opacity="1"}),10),p=function e(t){a.contains(t.target)||t.target.closest("#bc-audio-output")||(a.style.opacity="0",setTimeout((function(){a.parentNode&&a.remove()}),200),document.removeEventListener("click",e))},setTimeout((function(){document.addEventListener("click",p)}),100),setTimeout((function(){a.parentNode&&(a.style.opacity="0",setTimeout((function(){return a.remove()}),200))}),2e4);case 40:case"end":return e.stop()}}),e,this)}))),function(e){return s.apply(this,arguments)})},{key:"updateDropdownSelection",value:function(e,t,n){var o,r=e.querySelectorAll(".bc-audio-dropdown-header"),i=null,a=null;"speaker"===n?(i=Array.from(r).find((function(e){return e.innerHTML.includes("Speakers")})),a=Array.from(r).find((function(e){return e.innerHTML.includes("Microphones")}))):i=Array.from(r).find((function(e){return e.innerHTML.includes("Microphones")}));for(var c=null===(o=i)||void 0===o?void 0:o.nextElementSibling;c&&c!==a;)c.classList.contains("bc-audio-dropdown-item")&&c.classList.remove("selected"),c=c.nextElementSibling;t.classList.add("selected")}},{key:"updateAudioButtonState",value:function(e){var t=document.getElementById("bc-audio-output");t&&this.getAudioDevices().then((function(n){var o=n.speakers.find((function(t){return t.deviceId===e})),r="fas fa-volume-up";if(o){var i=o.label.toLowerCase();i.includes("headphone")||i.includes("headset")?r="fas fa-headphones":(i.includes("bluetooth")||i.includes("airpod"))&&(r="fab fa-bluetooth-b")}t.innerHTML='<i class="'.concat(r,'"></i>'),t.classList.add("active")}))}},{key:"updateCallElements",value:function(){this.setRemoteElement(),this.setLocalElement()}},{key:"addCallListeners",value:function(e){var t=this;console.log("addCallListeners"),this.on("muteStateChanged",(function(){console.log("changed idas df as")})),e.on("feeds_changed",(function(e,n){console.log("feed",e),t.updateCallElements()})),this.client.on("Room.timeline",(function(e){var n,o,r,i=e.event,a="m.call.negotiate"===i.type&&i.room_id===(null==t||null===(n=t.activeCall)||void 0===n?void 0:n.roomId),c="answer"===(null===(o=i.content)||void 0===o||null===(r=o.description)||void 0===r?void 0:r.type);a&&c&&t.initsync()})),e.on("state",(function(n,o){var r,i,a,c,l;if(console.log("state",n,e),null!==(r=window)&&void 0!==r&&null!==(i=r.cordova)&&void 0!==i&&null!==(a=i.plugins)&&void 0!==a&&a.CordovaCall&&e.callKitUUID)try{"connected"===n?window.cordova.plugins.CordovaCall.connectCall((function(){return console.log("CallKit connected")}),(function(e){return console.error("CallKit connect error:",e)})):"ended"===n&&(window.cordova.plugins.CordovaCall.endCall((function(){return console.log("CallKit ended")}),(function(e){return console.error("CallKit end error:",e)})),t.callKitCalls[e.callKitUUID]&&delete t.callKitCalls[e.callKitUUID])}catch(e){console.error("CallKit state update error:",e)}"connecting"!==n&&"invite_sent"!==n||(t.signal.pause(),t.showConnecting()),"connected"===n&&(t.signal.pause(),t.showRemoteVideo(),t.timeInterval||t.initTimer(),t.clearBlinking(),t.initsync(),t.setCallUpdateControlsLoading(!1),null!=t&&null!==(c=t.options)&&void 0!==c&&c.onConnected&&t.options.onConnected(e,t)),"ended"===n&&(t.clearTimer(),clearInterval(t.syncInterval),t.syncInterval=null,t.signal.pause(),t.clearBlinking(),null!=t&&null!==(l=t.options)&&void 0!==l&&l.onEnded&&t.options.onEnded(e,t))})),e.on("hangup",(function(e){var n,o,r;if(console.log("hangup",e),t.isScreenSharing&&t.stopScreenShare(),clearInterval(t.syncInterval),t.syncInterval=null,console.log("Call ended",e.callId),e){if(e.callId===(null===(n=t.secondCall)||void 0===n?void 0:n.callId)&&(t.secondCall=null,"ringing"!==(null==t||null===(r=t.activeCall)||void 0===r?void 0:r.state)&&t.renderTemplates.clearNotify()),e.callId===(null===(o=t.activeCall)||void 0===o?void 0:o.callId)){if(t.isWaitingForConnect)return t.activeCall=t.secondCall,void(t.secondCall=null);if(t.renderTemplates.clearVideo(),t.renderTemplates.clearNotify(),"local"===e.hangupParty||e.localVideoElement)return t.root.classList.contains("minified")||!t.root.classList.length?(t.renderTemplates.clearVideo(),t.renderTemplates.clearInterface(),void(t.activeCall=null)):(t.renderTemplates.endedCall(e),"user_hangup"!==e.hangupReason||e.remoteStream||"local"===e.hangupParty||(t.signal.loop=!1,t.signal.src="sounds/busy.mp3"),void setTimeout((function(){t.renderTemplates.clearVideo(),t.renderTemplates.clearInterface(),t.activeCall=null}),1e3));t.signal.pause(),t.renderTemplates.clearInterface(),t.activeCall=null}}else t.renderTemplates.clearNotify()})),e.on("replaced",(function(e){console.log("replaced",e),console.log("old",t.activeCall),t.activeCall=null,t.signal.pause();var n=t.client.store.rooms[e.roomId].currentState.members,o=n[Object.keys(n).filter((function(e){return e!==t.client.credentials.userId}))],r=n[t.client.credentials.userId];e.initiator=o,e.user=r,t.options.getUserInfo(o.userId).then((function(n){e.hangupParty||e.hangupReason||(o.source=n[0]||n,t.addCallListeners(e),console.log("listen added",t,e),t.activeCall?t.secondCall?(console.log("all lines"),e.hangup("busy"),e.reject("busy")):(t.secondCall=e,console.log("now second",t.secondCall)):(t.activeCall=e,t.answer(),console.log("now active",t.activeCall)),"wait_local_media"===e.state?(console.log("wait media!"),setTimeout(function(){this.answer()}.bind(t),1e3)):t.answer())}))})),e.on("error",(function(n){console.error("some error",n,t),e.hangup("error"),t.signal.pause(),t.renderTemplates.clearVideo(),t.emit("error",n)}))}},{key:"getAvatar",value:function(e){var t,n,o,r;return null!=e&&null!==(t=e.initiator)&&void 0!==t&&null!==(n=t.source)&&void 0!==n&&n.image?'<img src="'.concat("undefined"!=typeof replaceArchiveInImage?replaceArchiveInImage(e.initiator.source.image):e.initiator.source.image,'"/>'):null!==(o=this.activeCall.initiator)&&void 0!==o&&null!==(r=o.source)&&void 0!==r&&r.image?'<img src="'.concat("undefined"!=typeof replaceArchiveInImage?replaceArchiveInImage(this.activeCall.initiator.source.image):this.activeCall.initiator.source.image,'"/>'):"<span>".concat(this.activeCall.initiator.source.name[0].toUpperCase(),"</span>")}},{key:"showRemoteVideo",value:function(){this.setRemoteElement()}},{key:"showConnecting",value:function(){document.getElementById("remote-scene").classList.add("connecting")}},{key:"setBlinking",value:function(){this.options.changeTitle&&this.options.changeTitle(this.options.getWithLocale("incomingCall"))}},{key:"clearBlinking",value:function(){this.options.changeTitle&&this.options.changeTitle()}},{key:"initCallKitIntegration",value:function(){var e,t;window.BastyonCallsInstance=this,this.callKitCalls={},null!==(e=window.cordova)&&void 0!==e&&null!==(t=e.plugins)&&void 0!==t&&t.CordovaCall&&this.setupCallKit()}},{key:"isCallKitAvailable",value:function(){return!(!window.CallKitBridge||!window.CallKitBridge.isAvailable())}},{key:"generateUUID",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}},{key:"showIncomingCall",value:function(e){var t,n,o=this;if(null!==(t=window.cordova)&&void 0!==t&&null!==(n=t.plugins)&&void 0!==n&&n.CordovaCall){var r,i;console.log("Using CallKit for incoming call"),console.log(e,"call");var a=this.generateUUID();e.callKitUUID=a,this.callKitCalls||(this.callKitCalls={}),this.callKitCalls[a]=e;var c=(null===(r=e.initiator)||void 0===r||null===(i=r.source)||void 0===i?void 0:i.name)||"Unknown";try{return void window.cordova.plugins.CordovaCall.receiveCall(c,a,(function(){return console.log("CallKit call displayed")}),(function(t){console.error("CallKit receiveCall error:",t),o.showWebIncomingCall(e)}))}catch(e){console.error("CallKit error:",e)}}console.log("Using web UI for incoming call");var l=new Audio("js/lib");l.autoplay=!0,l.loop=!0,l.volume=.5,this.signal=l,this.signal.src="sounds/incoming.mp3",this.renderTemplates.incomingCall(e)}},{key:"handleCallKitAnswer",value:function(e){if(this.callKitCalls[e.callUUID]){var t=e.isVideo?B:O;this.answer(t)}}},{key:"handleCallKitReject",value:function(e){var t=this.callKitCalls[e.callUUID];t&&(this.reject(t),delete this.callKitCalls[e.callUUID])}},{key:"handleCallKitHangup",value:function(e){var t=this.callKitCalls[e.callUUID];t&&(t.hangup(),delete this.callKitCalls[e.callUUID])}},{key:"createCompositeStream",value:(l=S(C().mark((function e(t,n){var o,r,i,a,c,l,s,d=this;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,console.log("Creating composite stream..."),n&&n.getVideoTracks().length){e.next=5;break}return console.error("Invalid screen stream"),e.abrupt("return",null);case 5:return o=document.createElement("canvas"),r=o.getContext("2d"),o.width=1280,o.height=720,(i=document.createElement("video")).srcObject=n,i.muted=!0,i.playsInline=!0,a=document.createElement("video"),c=!1,t&&t.getVideoTracks().length>0&&(a.srcObject=t,a.muted=!0,a.playsInline=!0),e.next=18,new Promise((function(e,t){var n=setTimeout((function(){return t(new Error("Screen video timeout"))}),5e3);i.onloadeddata=function(){clearTimeout(n),e()},i.onerror=function(e){clearTimeout(n),t(e)},i.play().catch(t)}));case 18:if(!(t&&t.getVideoTracks().length>0)){e.next=27;break}return e.prev=19,e.next=22,new Promise((function(e){var t=setTimeout((function(){console.log("Camera timeout, continuing without"),e()}),3e3);a.onloadeddata=function(){clearTimeout(t),c=!0,console.log("Camera video ready"),e()},a.onerror=function(){clearTimeout(t),console.log("Camera error, continuing without"),e()},a.play().catch((function(){clearTimeout(t),e()}))}));case 22:e.next=27;break;case 24:e.prev=24,e.t0=e.catch(19),console.log("Camera setup failed:",e.t0);case 27:return l=function e(){if(d.isCompositeActive)try{if(r.fillStyle="transparent",r.fillRect(0,0,o.width,o.height),i.readyState>=2&&r.drawImage(i,0,0,o.width,o.height),c&&a.readyState>=2){var t=o.width-160-15;r.fillRect(t-3,12,166,126),r.lineWidth=3,r.strokeRect(t,15,160,120),r.drawImage(a,t,15,160,120)}requestAnimationFrame(e)}catch(t){console.error("Draw frame error:",t),d.isCompositeActive&&requestAnimationFrame(e)}},this.isCompositeActive=!0,l(),s=o.captureStream(30),n.getAudioTracks().forEach((function(e){s.addTrack(e)})),this.compositeCanvas=o,this.screenVideoElement=i,this.cameraVideoElement=a,e.abrupt("return",s);case 39:return e.prev=39,e.t1=e.catch(0),console.error("Error creating composite stream:",e.t1),this.isCompositeActive=!1,e.abrupt("return",null);case 44:case"end":return e.stop()}}),e,this,[[0,39],[19,24]])}))),function(e,t){return l.apply(this,arguments)})},{key:"startScreenShare",value:(c=S(C().mark((function e(){var t,n,o,r,i,a,c,l,s,d,u,p,v,f,h,b=this;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.activeCall&&this.activeCall.peerConn&&"connected"===this.activeCall.state){e.next=4;break}return this.showAudioError("No active call to share screen"),e.abrupt("return",!1);case 4:return e.next=6,navigator.mediaDevices.getDisplayMedia({video:{cursor:"always",displaySurface:"monitor"},audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1}});case 6:if((t=e.sent).getVideoTracks()[0].addEventListener("ended",(function(){console.log("Screen share ended by user"),b.stopScreenShare()})),n=this.activeCall.peerConn.getSenders(),o=n.find((function(e){return e.track&&"video"===e.track.kind})),r=document.getElementById("controls"),i=r&&"voice"===r.dataset.callType,a=o&&o.track&&o.track.enabled,console.log("Call type:",i?"voice":"video","Has active video:",a),!a){e.next=25;break}console.log("5a. Creating composite stream (video + screen)..."),l=null;try{(s=document.getElementById("local"))&&s.srcObject?l=s.srcObject:o.track&&(l=new MediaStream([o.track]))}catch(e){console.log("Failed to get camera stream:",e)}if(!l){e.next=22;break}return e.next=21,this.createCompositeStream(l,t);case 21:c=e.sent;case 22:c||(console.log("Composite failed, using screen only"),c=t),e.next=28;break;case 25:console.log("5b. No active video, setting up screen-only sharing..."),o||(o=n.find((function(e){return!e.track})))||(console.log("Creating new video sender..."),(d=document.createElement("canvas")).width=1,d.height=1,(u=d.getContext("2d")).fillStyle="transparent",u.fillRect(0,0,1,1),p=d.captureStream(1),v=p.getVideoTracks()[0],o=this.activeCall.peerConn.addTrack(v,p),setTimeout((function(){return v.stop()}),100)),c=t;case 28:if(c){e.next=30;break}throw new Error("Failed to create stream");case 30:return this.originalVideoTrack=o.track,this.screenStream=t,this.hadActiveVideoBeforeScreenShare=a,f=c.getVideoTracks()[0],e.next=36,o.replaceTrack(f);case 36:return(h=document.getElementById("local"))&&(h.srcObject=c),this.ensureVideoAreaVisible(i),this.isScreenSharing=!0,this.updateScreenShareButton(),console.log("Screen share started successfully"),e.abrupt("return",!0);case 45:return e.prev=45,e.t0=e.catch(0),console.error("Error starting screen share:",e.t0),this.screenStream&&(this.screenStream.getTracks().forEach((function(e){return e.stop()})),this.screenStream=null),"NotAllowedError"===e.t0.name?this.showAudioError("Screen sharing permission denied"):this.showAudioError("Failed to start screen sharing"),e.abrupt("return",!1);case 51:case"end":return e.stop()}}),e,this,[[0,45]])}))),function(){return c.apply(this,arguments)})},{key:"ensureRemoteVideoReady",value:function(){var e=document.getElementById("remote"),t=document.getElementById("remote-scene");t&&(t.classList.remove("novid"),t.classList.remove("connecting")),e&&(e.style.display="block",e.srcObject||(e.poster="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII="))}},{key:"ensureVideoSender",value:(a=S(C().mark((function e(){var t,n,o,r,i,a,c,l;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==(t=this.activeCall)&&void 0!==t&&t.peerConn){e.next=2;break}throw new Error("No peer connection");case 2:if(n=this.activeCall.peerConn.getSenders(),o=n.find((function(e){var t;return"video"===(null===(t=e.track)||void 0===t?void 0:t.kind)}))){e.next=27;break}return console.log("Creating video sender..."),(r=document.createElement("canvas")).width=640,r.height=480,(i=r.getContext("2d")).fillStyle="transparent",i.fillRect(0,0,r.width,r.height),a=r.captureStream(1),c=a.getVideoTracks()[0],o=this.activeCall.peerConn.addTrack(c,a),e.prev=15,e.next=18,this.activeCall.peerConn.createOffer();case 18:return l=e.sent,e.next=21,this.activeCall.peerConn.setLocalDescription(l);case 21:console.log("Renegotiation offer created"),e.next=27;break;case 24:e.prev=24,e.t0=e.catch(15),console.error("Renegotiation failed:",e.t0);case 27:return e.abrupt("return",o);case 28:case"end":return e.stop()}}),e,this,[[15,24]])}))),function(){return a.apply(this,arguments)})},{key:"stopScreenShare",value:(i=S(C().mark((function e(){var t,n,o,r,i,a,c,l,s,d,u;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,this.isCompositeActive=!1,this.screenStream&&(this.screenStream.getTracks().forEach((function(e){return e.stop()})),this.screenStream=null),this.cameraStream&&this.cameraStream!==(null===(t=document.getElementById("local"))||void 0===t?void 0:t.srcObject)&&(this.cameraStream.getTracks().forEach((function(e){return e.stop()})),this.cameraStream=null),this.cameraVideoElement&&(this.cameraVideoElement.remove(),this.cameraVideoElement=null),this.screenVideoElement&&(this.screenVideoElement.remove(),this.screenVideoElement=null),this.compositeCanvas&&(this.compositeCanvas.remove(),this.compositeCanvas=null),null!==(n=this.activeCall)&&void 0!==n&&n.peerConn){e.next=12;break}return this.restoreInterfaceAfterScreenShare(),this.isScreenSharing=!1,this.updateScreenShareButton(),e.abrupt("return",!0);case 12:if(o=this.activeCall.peerConn.getSenders(),!(r=o.find((function(e){return e.track&&"video"===e.track.kind})))){e.next=49;break}if(i=r.track,!this.hadActiveVideoBeforeScreenShare){e.next=43;break}if(console.log("Restoring camera..."),!this.originalVideoTrack||"live"!==this.originalVideoTrack.readyState){e.next=25;break}return e.next=21,r.replaceTrack(this.originalVideoTrack);case 21:(a=document.getElementById("local"))&&(c=new MediaStream([this.originalVideoTrack]),a.srcObject=c),e.next=41;break;case 25:return e.prev=25,e.next=28,navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:640},height:{ideal:360}},audio:!1});case 28:return l=e.sent,s=l.getVideoTracks()[0],e.next=32,r.replaceTrack(s);case 32:(d=document.getElementById("local"))&&(d.srcObject=l),e.next=41;break;case 36:return e.prev=36,e.t0=e.catch(25),console.log("Failed to restore camera:",e.t0),e.next=41,r.replaceTrack(null);case 41:e.next=48;break;case 43:return console.log("No video was active before, disabling video track..."),e.next=46,r.replaceTrack(null);case 46:(u=document.getElementById("local"))&&(u.srcObject=null);case 48:i&&i!==this.originalVideoTrack&&i.stop();case 49:return this.restoreInterfaceAfterScreenShare(),this.isScreenSharing=!1,this.originalVideoTrack=null,this.hadActiveVideoBeforeScreenShare=!1,this.updateScreenShareButton(),console.log("Screen share stopped successfully"),e.abrupt("return",!0);case 58:return e.prev=58,e.t1=e.catch(0),console.error("Error stopping screen share:",e.t1),this.isScreenSharing=!1,this.isCompositeActive=!1,this.hadActiveVideoBeforeScreenShare=!1,this.updateScreenShareButton(),e.abrupt("return",!1);case 66:case"end":return e.stop()}}),e,this,[[0,58],[25,36]])}))),function(){return i.apply(this,arguments)})},{key:"restoreInterfaceAfterScreenShare",value:function(){var e=document.getElementById("remote-scene"),t=document.getElementById("local"),n=document.getElementById("controls"),o=n&&"voice"===n.dataset.callType;e&&(e.classList.remove("screen-sharing"),o&&!this.hadActiveVideoBeforeScreenShare&&e.classList.add("novid")),t&&(t.classList.remove("screen-share-temp"),o&&!this.hadActiveVideoBeforeScreenShare&&t.classList.add("hidden")),console.log("Interface restored after screen sharing")}},{key:"startScreenOnlyShare",value:(r=S(C().mark((function e(){var t,n,o,r,i,a=this;return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("Starting screen-only share..."),e.prev=1,this.activeCall){e.next=6;break}return console.log("No active call"),this.showAudioError("No active call to share screen"),e.abrupt("return",!1);case 6:return e.next=8,navigator.mediaDevices.getDisplayMedia({video:{cursor:"always",displaySurface:"monitor"},audio:{echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1}});case 8:if((t=e.sent).getVideoTracks()[0].addEventListener("ended",(function(){console.log("Screen share ended by user"),a.stopScreenShare()})),n=this.activeCall.peerConn.getSenders(),o=n.find((function(e){return e.track&&"video"===e.track.kind}))){e.next=17;break}return console.error("No video sender found"),this.showAudioError("No video track available for screen sharing"),t.getTracks().forEach((function(e){return e.stop()})),e.abrupt("return",!1);case 17:return r=t.getVideoTracks()[0],this.originalVideoTrack=o.track,this.screenStream=t,e.next=22,o.replaceTrack(r);case 22:return(i=document.getElementById("local"))&&(i.srcObject=t),this.isScreenSharing=!0,this.updateScreenShareButton(),e.abrupt("return",!0);case 29:return e.prev=29,e.t0=e.catch(1),console.error("Error starting screen-only share:",e.t0),"NotAllowedError"===e.t0.name?this.showAudioError("Screen sharing permission denied"):"NotSupportedError"===e.t0.name?this.showAudioError("Screen sharing not supported in this browser"):this.showAudioError("Failed to start screen sharing"),e.abrupt("return",!1);case 34:case"end":return e.stop()}}),e,this,[[1,29]])}))),function(){return r.apply(this,arguments)})},{key:"updateScreenShareButton",value:function(){var e=document.getElementById("bc-screen-share");e&&(this.isScreenSharing?(e.classList.add("active"),e.innerHTML='<i class="fas fa-desktop"></i>',e.title="Stop Screen Share"):(e.classList.remove("active"),e.innerHTML='<i class="far fa-desktop"></i>',e.title="Start Screen Share"))}},{key:"toggleScreenShare",value:(o=S(C().mark((function e(t){return C().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.stopPropagation(),this.activeCall&&"connected"===this.activeCall.state){e.next=4;break}return this.showAudioError("No active call for screen sharing"),e.abrupt("return");case 4:if(!this.isScreenSharing){e.next=8;break}return e.next=7,this.stopScreenShare();case 7:return e.abrupt("return");case 8:return e.next=10,this.startScreenShare();case 10:case"end":return e.stop()}}),e,this)}))),function(e){return o.apply(this,arguments)})},{key:"updateInterfaceForScreenShare",value:function(e){var t=document.getElementById("remote-scene"),n=document.getElementById("local"),o=document.getElementById("remote");t&&(t.classList.remove("novid"),t.classList.remove("connecting")),n&&(n.classList.remove("hidden"),n.srcObject=e),o&&(o.srcObject&&0!==o.srcObject.getVideoTracks().length||(o.poster="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=")),console.log("Interface updated for screen sharing")}},{key:"ensureVideoAreaVisible",value:function(e){var t=document.getElementById("remote-scene"),n=document.getElementById("local");t&&(t.classList.remove("novid"),t.classList.remove("connecting"),t.classList.add("screen-sharing")),n&&(n.classList.remove("hidden"),e&&n.classList.add("screen-share-temp")),console.log("Video area visible for screen sharing")}},{key:"updateInterfaceAfterScreenShare",value:function(e){var t=document.getElementById("controls"),n=t&&"voice"===t.dataset.callType,o=document.getElementById("remote-scene"),r=document.getElementById("local");r&&(e?(r.srcObject=e,n?r.classList.add("hidden"):r.classList.remove("hidden")):(r.srcObject=null,n&&r.classList.add("hidden"))),o&&n&&!e&&o.classList.add("novid"),console.log("Interface restored after screen sharing")}},{key:"initCordovaPermisions",value:function(){var e=M(arguments.length>0&&void 0!==arguments[0]?arguments[0]:B);return new Promise((function(t,n){var o;null!==(o=window)&&void 0!==o&&o.cordova?window.BSTMedia.permissions({audio:!0,video:e}).then((function(){console.log("camera is turned on"),setTimeout((function(){t()}),50)})).catch((function(e){console.log("Camera permission is not turned on"),n(e)})):S(C().mark((function o(){var r,i,a,c;return C().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:return o.prev=0,r=!!navigator.webkitGetUserMedia,o.next=4,navigator.mediaDevices.getUserMedia({audio:!0,video:e&&{facingMode:["user","environment"],width:r?{exact:640}:{ideal:640},height:r?{exact:360}:{ideal:360}}});case 4:i=o.sent,t(),a=x(i.getTracks());try{for(a.s();!(c=a.n()).done;)c.value.stop()}catch(e){a.e(e)}finally{a.f()}if(console.log("resolve",i),!(window.cordova&&window.plugins&&window.plugins.audioManagement)){o.next=18;break}return o.prev=10,o.next=13,window.plugins.audioManagement.configureAudioSession({category:"playAndRecord",mode:"voiceChat",options:["allowBluetooth","allowBluetoothA2DP"]});case 13:o.next=18;break;case 15:o.prev=15,o.t0=o.catch(10),console.error("Audio session configuration failed:",o.t0);case 18:o.next=24;break;case 20:o.prev=20,o.t1=o.catch(0),console.log("reject",o.t1),n(o.t1);case 24:case"end":return o.stop()}}),o,null,[[0,20],[10,15]])})))()}))}}],n&&I(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),A}(r.EventEmitter);if(void 0===P)var P=function(e,t,n,o){if(e())t&&t();else{n||(n=20);var r=0,i=setInterval((function(){(e()||o&&o<=r)&&(clearInterval(i),t&&t()),r+=n}),n)}},R=function(e,t,n){return new Promise((function(o,r){P(e,o,t,n)}))};window.BastyonCalls=V;const U=V;return o})()));