(globalThis.webpackChunkpeertube_client=globalThis.webpackChunkpeertube_client||[]).push([[524],{1524:(e,t,n)=>{"use strict";n.r(t),n.d(t,{PeertubePlayerManager:()=>dr,videojs:()=>o()}),n(3059);var r=n(3654),o=n.n(r);function i(){return i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=s(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},i.apply(this,arguments)}function s(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=u(e)););return e}function a(e,t){return a=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},a(e,t)}function l(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}let c=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&a(e,t)}(p,e);var t,n,r,s,c=(r=p,s=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=u(r);if(s){var n=u(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return l(this,e)});function p(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),(n=c.call(this,e,t)).dashOffsetTotal=586,n.dashOffsetStart=293,n.interval=50,n.upNextEvents=new(o().EventTarget),n.ticks=0,n.totalTicks=n.options_.timeout/n.interval,e.on("ended",(t=>{n.options_.condition()&&(e.addClass("vjs-upnext--showing"),n.showCard((t=>{e.removeClass("vjs-upnext--showing"),n.container.style.display="none",t||n.options_.next()})))})),e.on("playing",(()=>{n.upNextEvents.trigger("playing")})),n}return t=p,(n=[{key:"createEl",value:function(){let e=i(u(p.prototype),"createEl",this).call(this,"div",{className:"vjs-upnext-content",innerHTML:(t=this.options_,`\n    <div class="vjs-upnext-top">\n      <span class="vjs-upnext-headtext">${t.headText}</span>\n      <div class="vjs-upnext-title"></div>\n    </div>\n    <div class="vjs-upnext-autoplay-icon">\n      <svg height="100%" version="1.1" viewbox="0 0 98 98" width="100%">\n        <circle class="vjs-upnext-svg-autoplay-circle" cx="49" cy="49" fill="#000" fill-opacity="0.8" r="48"></circle>\n        <circle class="vjs-upnext-svg-autoplay-ring" cx="-49" cy="49" fill-opacity="0" r="46.5"\n                stroke="#FFFFFF" stroke-width="4" transform="rotate(-90)"\n        ></circle>\n        <polygon class="vjs-upnext-svg-autoplay-triangle" fill="#fff" points="32,27 72,49 32,71"></polygon></svg>\n    </div>\n    <span class="vjs-upnext-bottom">\n      <span class="vjs-upnext-cancel">\n        <button class="vjs-upnext-cancel-button" tabindex="0" aria-label="Cancel autoplay">${t.cancelText}</button>\n      </span>\n      <span class="vjs-upnext-suspended">${t.suspendedText}</span>\n    </span>\n  `)});var t;return this.container=e,e.style.display="none",this.autoplayRing=e.getElementsByClassName("vjs-upnext-svg-autoplay-ring")[0],this.title=e.getElementsByClassName("vjs-upnext-title")[0],this.cancelButton=e.getElementsByClassName("vjs-upnext-cancel-button")[0],this.suspendedMessage=e.getElementsByClassName("vjs-upnext-suspended")[0],this.nextButton=e.getElementsByClassName("vjs-upnext-autoplay-icon")[0],this.cancelButton.onclick=()=>{this.upNextEvents.trigger("cancel")},this.nextButton.onclick=()=>{this.upNextEvents.trigger("next")},e}},{key:"showCard",value:function(e){let t;this.autoplayRing.setAttribute("stroke-dasharray",`${this.dashOffsetStart}`),this.autoplayRing.setAttribute("stroke-dashoffset",""+-this.dashOffsetStart),this.title.innerHTML=this.options_.getTitle(),this.upNextEvents.one("cancel",(()=>{clearTimeout(t),e(!0)})),this.upNextEvents.one("playing",(()=>{clearTimeout(t),e(!0)})),this.upNextEvents.one("next",(()=>{clearTimeout(t),e(!1)}));let n=e=>{let t=Math.max(-this.dashOffsetTotal,-this.dashOffsetStart-e*this.dashOffsetTotal/2/100);this.autoplayRing.setAttribute("stroke-dashoffset",""+t)},r=()=>{n(100*this.ticks++/this.totalTicks)},o=()=>{this.options_.suspended()?(this.suspendedMessage.innerText=this.options_.suspendedText,n(0),this.ticks=0,t=setTimeout(o.bind(this),300)):this.ticks>=this.totalTicks?(clearTimeout(t),e(!1)):(this.suspendedMessage.innerText="",r(),t=setTimeout(o.bind(this),this.interval))};this.container.style.display="block",t=setTimeout(o.bind(this),this.interval)}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),p}(o().getComponent("Component"));function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},d(e,t)}function f(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}o().registerComponent("EndCard",c);let y=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}(i,e);var t,n,r,o=(n=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=h(n);if(r){var o=h(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return f(this,e)});function i(e){var t;let n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};p(this,i);let r={next:n.next,getTitle:n.getTitle,timeout:n.timeout||5e3,cancelText:n.cancelText||"Cancel",headText:n.headText||"Up Next",suspendedText:n.suspendedText||"Autoplay is suspended",condition:n.condition,suspended:n.suspended};return(t=o.call(this,e)).player.ready((()=>{e.addClass("vjs-upnext")})),e.addChild("EndCard",r),t}return t=i,Object.defineProperty(t,"prototype",{writable:!1}),t}(o().getPlugin("plugin"));o().registerPlugin("upnext",y);var v=n(8859);function b(e){if(!e)return 0;if("number"==typeof e)return e;let t=e.match(/^((\d+)[h:])?((\d+)[m:])?((\d+)s?)?$/);return t?3600*parseInt(t[2]||"0",10)+60*parseInt(t[4]||"0",10)+parseInt(t[6]||"0",10):0}function m(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r="";if(0===e&&!t)return"0s";let o=n||"h",i=n||"m",s=t?"":"s",a=Math.floor(e/3600);a>=1?r=a+o:t&&(r="0"+o),e%=3600;let l=Math.floor(e/60);return l>=1&&l<10&&t?r+="0"+l+i:l>=1?r+=l+i:t&&(r+="00"+i),(e%=60)>=1&&e<10&&t?r+="0"+e+s:e>=1?r+=e+s:t&&(r+="00"),r}function g(e,t){let n={};for(let r of t)Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}var w=n(1301);let O={"ar-001":"ar",ca:"ca-ES",cs:"cs-CZ",de:"de-DE",el:"el-GR",en:"en-US",es:"es-ES",eu:"eu-ES",fi:"fi-FI",gl:"gl-ES",fa:"fa-IR",fr:"fr-FR",hu:"hu-HU",it:"it-IT",ja:"ja-JP",nl:"nl-NL",pl:"pl-PL",pt:"pt-BR",nb:"nb-NO",ru:"ru-RU",sv:"sv-SE",th:"th-TH",vi:"vi-VN","zh-CN":"zh-Hans-CN","zh-Hans":"zh-Hans-CN","zh-Hant":"zh-Hant-TW","zh-TW":"zh-Hant-TW",zh:"zh-Hans-CN"};function E(e){return e&&O[e]?O[e]:e}Object.keys({"en-US":"English",ar:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629","ca-ES":"Catal\xe0","cs-CZ":"\u010ce\u0161tina","de-DE":"Deutsch","el-GR":"\u03b5\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac",eo:"Esperanto","es-ES":"Espa\xf1ol","eu-ES":"Euskara","fi-FI":"suomi","fr-FR":"Fran\xe7ais",gd:"G\xe0idhlig","gl-ES":"galego",hr:"hrvatski","hu-HU":"magyar","fa-IR":"\u0641\u0627\u0631\u0633\u06cc","it-IT":"Italiano","ja-JP":"\u65e5\u672c\u8a9e",kab:"Taqbaylit","nl-NL":"Nederlands",oc:"Occitan","pl-PL":"Polski","pt-BR":"Portugu\xeas (Brasil)","pt-PT":"Portugu\xeas (Portugal)","ru-RU":"\u0440\u0443\u0441\u0441\u043a\u0438\u0439",sq:"Shqip","sv-SE":"Svenska",nn:"norsk nynorsk","nb-NO":"norsk bokm\xe5l","th-TH":"\u0e44\u0e17\u0e22","vi-VN":"Ti\u1ebfng Vi\u1ec7t",tok:"Toki Pona","zh-Hans-CN":"\u7b80\u4f53\u4e2d\u6587\uff08\u4e2d\u56fd\uff09","zh-Hant-TW":"\u7e41\u9ad4\u4e2d\u6587\uff08\u53f0\u7063\uff09"}).concat(Object.keys(O)).map((e=>"/"+e));let j=["linkify","autolink","emphasis","link","newline","entity","list"],P=j.concat(["html_inline","html_block"]);function k(e){return function(e){if(Array.isArray(e))return C(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?C(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function T(e){return e.charAt(0).toUpperCase()+e.slice(1)}j.concat(["image"]),P.concat(["image"]).concat(["block","inline","heading","paragraph"]);let _=[{max:1024,type:"B",decimals:0},{max:1048576,type:"KB",decimals:0},{max:1073741824,type:"MB",decimals:0},{max:10995116e5,type:"GB",decimals:1}];function R(e){let t=_.find((t=>e<t.max))||_[_.length-1];return[(e/(t.max/1024)).toFixed(t.decimals),t.type]}function S(e,t,n,r,o,i,s){try{var a=e[i](s),l=a.value}catch(u){return void n(u)}a.done?t(l):Promise.resolve(l).then(r,o)}function L(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function s(e){S(i,r,o,s,a,"next",e)}function a(e){S(i,r,o,s,a,"throw",e)}s(void 0)}))}}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){return x=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},x(e,t)}function I(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function D(e){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},D(e)}let B=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&x(e,t)}(a,e);var t,n,r,i,s=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=D(r);if(i){var n=D(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return I(this,e)});function a(){var e;return M(this,a),(e=s.apply(this,arguments)).metadataStore={},e.intervalMs=300,e.playerNetworkInfo={},e}return t=a,(n=[{key:"createEl",value:function(){this.containerEl=o().dom.createEl("div",{className:"vjs-stats-content"}),this.containerEl.style.display="none",this.infoListEl=o().dom.createEl("div",{className:"vjs-stats-list"});let e=o().dom.createEl("button",{className:"vjs-stats-close",tabindex:"0",title:"Close stats",innerText:"[x]"},{"aria-label":"Close stats"});return e.onclick=()=>this.hide(),this.containerEl.appendChild(e),this.containerEl.appendChild(this.infoListEl),this.populateInfoBlocks(),this.player_.on("p2pInfo",((e,t)=>{if(!t)return;this.mode=t.source;let n=t.p2p,r=t.http;this.playerNetworkInfo.downloadSpeed=R(n.downloadSpeed+r.downloadSpeed).join(" "),this.playerNetworkInfo.uploadSpeed=R(n.uploadSpeed+r.uploadSpeed).join(" "),this.playerNetworkInfo.totalDownloaded=R(n.downloaded+r.downloaded).join(" "),this.playerNetworkInfo.totalUploaded=R(n.uploaded+r.uploaded).join(" "),this.playerNetworkInfo.numPeers=n.numPeers,this.playerNetworkInfo.averageBandwidth=R(t.bandwidthEstimate).join(" ")+"/s","p2p-media-loader"===t.source&&(this.playerNetworkInfo.downloadedFromServer=R(r.downloaded).join(" "),this.playerNetworkInfo.downloadedFromPeers=R(n.downloaded).join(" "))})),this.containerEl}},{key:"toggle",value:function(){this.updateInterval?this.hide():this.show()}},{key:"show",value:function(){var e=this;this.containerEl.style.display="block",this.updateInterval=setInterval(L((function*(){try{let t=e.buildHLSOptions();e.populateInfoValues(t)}catch(t){v.k.error("Cannot update stats.",t),clearInterval(e.updateInterval)}})),this.intervalMs)}},{key:"hide",value:function(){clearInterval(this.updateInterval),this.containerEl.style.display="none"}},{key:"buildHLSOptions",value:function(){let e,t,n=this.player_.p2pMediaLoader(),r=n.getCurrentLevel(),o=(null==r?void 0:r.videoCodec)||(null==r?void 0:r.audioCodec)?`${(null==r?void 0:r.videoCodec)||""} / ${(null==r?void 0:r.audioCodec)||""}`:void 0,i=`${null==r?void 0:r.height}p${(null==r?void 0:r.attrs["FRAME-RATE"])||""}`,s=this.timeRangesToString(this.player().buffered());return this.options_.videoIsLive?t=m(n.getLiveLatency()):e=this.player().bufferedPercent(),{playerNetworkInfo:this.playerNetworkInfo,resolution:i,codecs:o,buffer:s,latency:t,progress:e}}},{key:"populateInfoBlocks",value:function(){this.playerMode=this.buildInfoRow(this.player().localize("Player mode")),this.p2p=this.buildInfoRow(this.player().localize("P2P")),this.uuid=this.buildInfoRow(this.player().localize("Video UUID")),this.viewport=this.buildInfoRow(this.player().localize("Viewport / Frames")),this.resolution=this.buildInfoRow(this.player().localize("Resolution")),this.volume=this.buildInfoRow(this.player().localize("Volume")),this.codecs=this.buildInfoRow(this.player().localize("Codecs")),this.color=this.buildInfoRow(this.player().localize("Color")),this.connection=this.buildInfoRow(this.player().localize("Connection Speed")),this.network=this.buildInfoRow(this.player().localize("Network Activity")),this.transferred=this.buildInfoRow(this.player().localize("Total Transfered")),this.download=this.buildInfoRow(this.player().localize("Download Breakdown")),this.bufferProgress=this.buildInfoRow(this.player().localize("Buffer Progress")),this.bufferState=this.buildInfoRow(this.player().localize("Buffer State")),this.liveLatency=this.buildInfoRow(this.player().localize("Live Latency")),this.infoListEl.appendChild(this.playerMode.root),this.infoListEl.appendChild(this.p2p.root),this.infoListEl.appendChild(this.uuid.root),this.infoListEl.appendChild(this.viewport.root),this.infoListEl.appendChild(this.resolution.root),this.infoListEl.appendChild(this.volume.root),this.infoListEl.appendChild(this.codecs.root),this.infoListEl.appendChild(this.color.root),this.infoListEl.appendChild(this.connection.root),this.infoListEl.appendChild(this.network.root),this.infoListEl.appendChild(this.transferred.root),this.infoListEl.appendChild(this.download.root),this.infoListEl.appendChild(this.bufferProgress.root),this.infoListEl.appendChild(this.bufferState.root),this.infoListEl.appendChild(this.liveLatency.root)}},{key:"populateInfoValues",value:function(e){let{playerNetworkInfo:t,progress:n,colorSpace:r,codecs:o,resolution:i,buffer:s,latency:a}=e,l=this.player(),u=l.getVideoPlaybackQuality(),c=`${Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)}x${Math.max(document.documentElement.clientHeight||0,window.innerHeight||0)}*${(window.devicePixelRatio||1).toFixed(2)} / ${u.droppedVideoFrames} dropped of ${u.totalVideoFrames}`,p=l.duration(),d=`${Math.round(100*l.volume())}`;l.muted()&&(d+=" (muted)");let f=t.downloadSpeed?`${t.downloadSpeed} &dArr; / ${t.uploadSpeed} &uArr;`:void 0,h=t.totalDownloaded?`${t.totalDownloaded} &dArr; / ${t.totalUploaded} &uArr;`:void 0,y=t.downloadedFromServer?`${t.downloadedFromServer} from servers \xb7 ${t.downloadedFromPeers} from peers`:void 0,v=void 0!==n?`${(100*n).toFixed(1)}% (${(n*p).toFixed(1)}s)`:void 0;this.setInfoValue(this.playerMode,this.mode||"HTTP"),this.setInfoValue(this.p2p,l.localize(this.options_.p2pEnabled?"enabled":"disabled")),this.setInfoValue(this.uuid,this.options_.videoUUID),this.setInfoValue(this.viewport,c),this.setInfoValue(this.resolution,i),this.setInfoValue(this.volume,d),this.setInfoValue(this.codecs,o),this.setInfoValue(this.color,r),this.setInfoValue(this.connection,t.averageBandwidth),this.setInfoValue(this.network,f),this.setInfoValue(this.transferred,h),this.setInfoValue(this.download,y),this.setInfoValue(this.bufferProgress,v),this.setInfoValue(this.bufferState,s),this.setInfoValue(this.liveLatency,a)}},{key:"setInfoValue",value:function(e,t){t?(e.root.style.display="block",e.value.innerHTML!==t&&(e.value.innerHTML=t)):e.root.style.display="none"}},{key:"buildInfoRow",value:function(e,t){let n=o().dom.createEl("div");n.style.display="none";let r=o().dom.createEl("div",{innerText:e}),i=o().dom.createEl("span",{innerHTML:t});return n.appendChild(r),n.appendChild(i),{root:n,value:i}}},{key:"timeRangesToString",value:function(e){let t="";for(let n=0;n<e.length;n++){let r=Math.floor(e.start(n)),o=Math.floor(e.end(n));t+=`[${m(r)}, ${m(o)}] `}return t}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(o().getComponent("Component"));function A(e,t){return A=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},A(e,t)}function N(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function H(e){return H=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},H(e)}o().registerComponent("StatsCard",B);let F=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&A(e,t)}(s,e);var t,n,r,o,i=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=H(r);if(o){var n=H(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return N(this,e)});function s(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);let r=Object.assign({},t);return(n=i.call(this,e)).player.ready((()=>{e.addClass("vjs-stats-for-nerds")})),n.statsCard=new B(e,t),e.addChild(n.statsCard,r),n}return t=s,(n=[{key:"show",value:function(){this.statsCard.show()}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(o().getPlugin("plugin"));function z(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)}function U(){return U="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=V(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},U.apply(this,arguments)}function V(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=W(e)););return e}function $(e,t){return $=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},$(e,t)}function K(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function W(e){return W=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},W(e)}o().registerPlugin("stats",F);let q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$(e,t)}(s,e);var t,n,r,o,i=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=W(r);if(o){var n=W(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return K(this,e)});function s(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),n=i.call(this,e,t),z()?K(n):(e.on("pause",(t=>{e.seeking()||e.ended()||(n.container.innerHTML='\n  <div class="vjs-bezels-pause">\n    <div class="vjs-bezel" role="status" aria-label="Pause">\n      <div class="vjs-bezel-icon">\n        <svg height="100%" version="1.1" viewBox="0 0 36 36" width="100%">\n          <use class="vjs-svg-shadow" xlink:href="#vjs-id-1"></use>\n          <path class="vjs-svg-fill" d="M 12,26 16,26 16,10 12,10 z M 21,26 25,26 25,10 21,10 z" id="vjs-id-1"></path>\n        </svg>\n      </div>\n    </div>\n  </div>\n  ',n.showBezel())})),e.on("play",(t=>{e.seeking()||(n.container.innerHTML='\n  <div class="vjs-bezels-play">\n    <div class="vjs-bezel" role="status" aria-label="Play">\n      <div class="vjs-bezel-icon">\n        <svg height="100%" version="1.1" viewBox="0 0 36 36" width="100%">\n          <use class="vjs-svg-shadow" xlink:href="#vjs-id-2"></use>\n          <path class="vjs-svg-fill" d="M 12,26 18.5,22 18.5,14 12,10 z M 18.5,22 25,18 25,18 18.5,14 z" id="ytp-id-2"></path>\n        </svg>\n      </div>\n    </div>\n  </div>\n  ',n.showBezel())})),n)}return t=s,(n=[{key:"createEl",value:function(){return this.container=U(W(s.prototype),"createEl",this).call(this,"div",{className:"vjs-bezels-content"}),this.container.style.display="none",this.container}},{key:"showBezel",value:function(){this.container.style.display="inherit",setTimeout((()=>{this.container.style.display="none"}),500)}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(o().getComponent("Component"));function G(e,t){return G=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},G(e,t)}function J(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Y(e){return Y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Y(e)}o().registerComponent("PauseBezel",q);let Q=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&G(e,t)}(i,e);var t,n,r,o=(n=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Y(n);if(r){var o=Y(this).constructor;e=Reflect.construct(t,arguments,o)}else e=t.apply(this,arguments);return J(this,e)});function i(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),(n=o.call(this,e)).player.ready((()=>{e.addClass("vjs-bezels")})),e.addChild("PauseBezel",t),n}return t=i,Object.defineProperty(t,"prototype",{writable:!1}),t}(o().getPlugin("plugin"));o().registerPlugin("bezels",Q);var X=n(7642),Z=n.n(X);let ee="peertube-videojs-";function te(e){try{return localStorage.getItem(ee+e)}catch(t){return}}function ne(e,t){try{localStorage.setItem(ee+e,t)}catch(n){}}function re(e,t){return re=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},re(e,t)}function oe(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ie(e)}function ie(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function se(e){return se=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},se(e)}let ae=Z()("peertube:player:peertube"),le=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&re(e,t)}(s,e);var t,n,r,o,i=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=se(r);if(o){var n=se(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return oe(this,e)});function s(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=i.call(this,e)).CONSTANTS={USER_VIEW_VIDEO_INTERVAL:3e4},n.menuOpened=!1,n.mouseInControlBar=!1,n.mouseInSettings=!1,n.videoViewUrl=t.videoViewUrl,n.authorizationHeader=t.authorizationHeader,n.videoUUID=t.videoUUID,n.startTime=b(t.startTime),n.initialInactivityTimeout=n.player.options_.inactivityTimeout,t.autoplay&&n.player.addClass("vjs-has-autoplay"),n.player.on("autoplay-failure",(()=>{n.player.removeClass("vjs-has-autoplay")})),n.player.ready((()=>{let e=n.player.options_,r=function(){let e=te("volume");if(null!=e){let t=parseFloat(e);if(isNaN(t))return;return t}}();void 0!==r&&n.player.volume(r);let o=void 0!==e.muted?e.muted:function(){let e=te("mute");if(null!=e)return"true"===e}();if(void 0!==o&&n.player.muted(o),n.defaultSubtitle=t.subtitle||te("last-subtitle"),n.player.on("volumechange",(()=>{ne("volume",n.player.volume().toString()),ne("mute",n.player.muted().toString())})),t.stopTime){let e=b(t.stopTime),r=ie(n);n.player.on("timeupdate",(function t(){r.player.currentTime()>e&&(r.player.pause(),r.player.trigger("stopped"),r.player.off("timeupdate",t))}))}n.player.textTracks().addEventListener("change",(()=>{let e=n.player.textTracks().tracks_.find((e=>"captions"===e.kind&&"showing"===e.mode));ne("last-subtitle",e?e.language:"off")})),n.player.duration(t.videoDuration),n.initializePlayer(),n.runUserViewing()})),n}return t=s,(n=[{key:"dispose",value:function(){this.stopListen(),this.videoViewInterval&&clearInterval(this.videoViewInterval)}},{key:"onMenuOpened",value:function(){this.menuOpened=!0,this.alterInactivity()}},{key:"onMenuClosed",value:function(){this.menuOpened=!1,this.alterInactivity()}},{key:"displayFatalError",value:function(){this.player.addClass("vjs-error-display-enabled")}},{key:"hideFatalError",value:function(){this.player.removeClass("vjs-error-display-enabled")}},{key:"initializePlayer",value:function(){z()&&this.player.addClass("vjs-is-mobile"),this.listenControlBarMouse(),this.listenFullScreenChange()}},{key:"runUserViewing",value:function(){let e,t=this.startTime;this.player.one("play",(()=>{this.notifyUserIsWatching(Math.round(this.startTime),e)})),this.player.on("seeked",(()=>{Math.abs(this.player.currentTime()-t)<3||(e="seek")})),this.player.one("ended",(()=>{let n=Math.round(this.player.duration());t=n,this.notifyUserIsWatching(n,e),e=void 0})),this.videoViewInterval=setInterval((()=>{let n=Math.round(this.player.currentTime());var r,o;n!==t&&(t=n,this.notifyUserIsWatching(n,e).catch((e=>v.k.error("Cannot notify user is watching.",e))),e=void 0,this.authorizationHeader||(r=this.videoUUID,o=n,ne("video-watch-history",JSON.stringify(Object.assign(Object.assign({},function(e){let t;try{let e=te("video-watch-history");if(!e)return{};t=JSON.parse(e)}catch(n){v.k.error("Cannot parse video watch history from local storage/",n)}return t=t||{},t}()),{[r]:{duration:o,date:`${(new Date).toISOString()}`}})))))}),this.CONSTANTS.USER_VIEW_VIDEO_INTERVAL)}},{key:"notifyUserIsWatching",value:function(e,t){if(!this.videoViewUrl)return Promise.resolve(void 0);let n={currentTime:e,viewEvent:t},r=new Headers({"Content-type":"application/json; charset=UTF-8"});return this.authorizationHeader&&r.set("Authorization",this.authorizationHeader),fetch(this.videoViewUrl,{method:"POST",body:JSON.stringify(n),headers:r}).catch((e=>Promise.resolve()))}},{key:"listenFullScreenChange",value:function(){this.player.on("fullscreenchange",(()=>{this.player.isFullscreen()&&this.player.focus()}))}},{key:"stopListen",value:function(){let e=this.player.controlBar,t=e.settingsButton;e&&(e.off("mouseenter"),e.off("mouseleave")),t&&(t.dialog.off("mouseenter"),t.dialog.off("mouseleave"))}},{key:"listenControlBarMouse",value:function(){let e=this.player.controlBar,t=e.settingsButton;e.on("mouseenter",(()=>{this.mouseInControlBar=!0,this.alterInactivity()})),e.on("mouseleave",(()=>{this.mouseInControlBar=!1,this.alterInactivity()})),t.dialog.on("mouseenter",(()=>{this.mouseInSettings=!0,this.alterInactivity()})),t.dialog.on("mouseleave",(()=>{this.mouseInSettings=!1,this.alterInactivity()}))}},{key:"alterInactivity",value:function(){this.menuOpened||this.mouseInSettings||this.mouseInControlBar?this.setInactivityTimeout(0):(this.setInactivityTimeout(this.initialInactivityTimeout),this.player.reportUserActivity(!0))}},{key:"setInactivityTimeout",value:function(e){this.player.cache_.inactivityTimeout=e,this.player.options_.inactivityTimeout=e,ae("Set player inactivity to "+e)}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(o().getPlugin("plugin"));function ue(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function ce(e,t){return ce=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},ce(e,t)}function pe(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function de(e){return de=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},de(e)}o().registerPlugin("peertube",le);let fe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&ce(e,t)}(s,e);var t,n,r,o,i=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=de(r);if(o){var n=de(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return pe(this,e)});function s(){var e;return ue(this,s),(e=i.apply(this,arguments)).resolutions=[],e.autoResolutionEnabled=!0,e}return t=s,(n=[{key:"add",value:function(e){for(let t of e)this.resolutions.push(t);this.currentSelection=this.getSelected(),this.sort(),this.trigger("resolutionsAdded")}},{key:"getResolutions",value:function(){return this.resolutions}},{key:"getSelected",value:function(){return this.resolutions.find((e=>e.selected))}},{key:"getAutoResolutionChosen",value:function(){return this.resolutions.find((e=>e.id===this.autoResolutionChosenId))}},{key:"select",value:function(e){var t;let{id:n,autoResolutionChosenId:r,byEngine:o}=e;if((null===(t=this.currentSelection)||void 0===t?void 0:t.id)!==n||this.autoResolutionChosenId!==r){this.autoResolutionChosenId=r;for(let e of this.resolutions)e.selected=e.id===n,e.selected&&(this.currentSelection=e,o||e.selectCallback());this.trigger("resolutionChanged")}}},{key:"disableAutoResolution",value:function(){this.autoResolutionEnabled=!1,this.trigger("autoResolutionEnabledChanged")}},{key:"enabledAutoResolution",value:function(){this.autoResolutionEnabled=!0,this.trigger("autoResolutionEnabledChanged")}},{key:"isAutoResolutionEnabeld",value:function(){return this.autoResolutionEnabled}},{key:"sort",value:function(){this.resolutions.sort(((e,t)=>-1===e.id?1:-1===t.id||e.height>t.height?-1:e.height===t.height?0:1))}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(o().getPlugin("plugin"));function he(e,t){return he=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},he(e,t)}function ye(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function ve(e){return ve=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ve(e)}o().registerPlugin("peertubeResolutions",fe);let be=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&he(e,t)}(a,e);var t,n,r,i,s=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ve(r);if(i){var n=ve(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ye(this,e)});function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=s.call(this,e,t)).nextPreviousVideoButtonOptions=t,n.update(),n}return t=a,(n=[{key:"createEl",value:function(){let e=this.options_.type,t=o().dom.createEl("button",{className:"vjs-"+e+"-video"}),n=o().dom.createEl("span",{className:"icon icon-"+e});return t.appendChild(n),t.title=this.player_.localize("next"===e?"Next video":"Previous video"),t}},{key:"handleClick",value:function(){this.nextPreviousVideoButtonOptions.handler()}},{key:"update",value:function(){this.nextPreviousVideoButtonOptions.isDisabled()?this.addClass("vjs-disabled"):this.removeClass("vjs-disabled")}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(o().getComponent("Button"));function me(e,t){return me=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},me(e,t)}function ge(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function we(e){return we=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},we(e)}o().registerComponent("NextVideoButton",be),o().registerComponent("PreviousVideoButton",be);let Oe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&me(e,t)}(a,e);var t,n,r,i,s=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=we(r);if(i){var n=we(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ge(this,e)});function a(e,t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),s.call(this,e,t)}return t=a,(n=[{key:"createEl",value:function(){let e=o().dom.createEl("div",{className:"vjs-peertube"}),t=o().dom.createEl("div",{className:"vjs-peertube-hidden"});if(e.appendChild(t),!this.options_.p2pEnabled)return e;let n=o().dom.createEl("span",{className:"icon icon-download"});t.appendChild(n);let r=o().dom.createEl("span",{className:"download-speed-text"}),i=o().dom.createEl("span",{className:"download-speed-number"}),s=o().dom.createEl("span");r.appendChild(i),r.appendChild(s),t.appendChild(r);let a=o().dom.createEl("span",{className:"icon icon-upload"});t.appendChild(a);let l=o().dom.createEl("span",{className:"upload-speed-text"}),u=o().dom.createEl("span",{className:"upload-speed-number"}),c=o().dom.createEl("span");l.appendChild(u),l.appendChild(c),t.appendChild(l);let p=o().dom.createEl("span",{className:"peers-text"}),d=o().dom.createEl("span",{className:"peers-number"});t.appendChild(d),t.appendChild(p);let f=o().dom.createEl("div",{className:"vjs-peertube-hidden"}),h=o().dom.createEl("span",{className:"http-fallback",textContent:"HTTP"});return f.appendChild(h),e.appendChild(f),this.player_.on("p2pInfo",((e,n)=>{if(!n)return f.className="vjs-peertube-displayed",void(t.className="vjs-peertube-hidden");let r=n.p2p,o=n.http,a=R(r.downloadSpeed+o.downloadSpeed),l=R(r.uploadSpeed+o.uploadSpeed),h=R(r.downloaded+o.downloaded),y=R(r.uploaded+o.uploaded),v=r.numPeers;if(t.title=this.player().localize("Total downloaded: ")+h.join(" ")+"\n","p2p-media-loader"===n.source){let e=R(o.downloaded).join(" "),n=R(r.downloaded).join(" ");t.title+=" * "+this.player().localize("From servers: ")+e+"\n * "+this.player().localize("From peers: ")+n+"\n"}t.title+=this.player().localize("Total uploaded: ")+y.join(" "),i.textContent=a[0],s.textContent=" "+a[1],u.textContent=l[0],c.textContent=" "+l[1],d.textContent=v.toString(),p.textContent=" "+(v>1?this.player().localize("peers"):this.player_.localize("peer")),f.className="vjs-peertube-hidden",t.className="vjs-peertube-displayed"})),e}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(o().getComponent("Button"));function Ee(){return Ee="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=je(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},Ee.apply(this,arguments)}function je(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ce(e)););return e}function Pe(e,t){return Pe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Pe(e,t)}function ke(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Ce(e){return Ce=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ce(e)}o().registerComponent("P2PInfoButton",Oe),o().getComponent("Button");let Te=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Pe(e,t)}(s,e);var t,n,r,o,i=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ce(r);if(o){var n=Ce(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return ke(this,e)});function s(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=i.call(this,e,t)).controlText("Mini Player"),n}return t=s,(n=[{key:"createEl",value:function(){return this.buildElement()}},{key:"handleClick",value:function(e){this.player_.trigger("pictureInPictureRequest",e)}},{key:"buildElement",value:function(){let e=Ee(Ce(s.prototype),"createEl",this).call(this);return e.classList.add("vjs-picture-in-picture-control"),e}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(o().getComponent("MenuButton"));function _e(){return _e="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=Re(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},_e.apply(this,arguments)}function Re(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Me(e)););return e}function Se(e,t){return Se=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Se(e,t)}function Le(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Me(e){return Me=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Me(e)}o().registerComponent("PictureInPictureBastyon",Te);let xe=o().getComponent("Component");function Ie(){return Ie="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=De(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},Ie.apply(this,arguments)}function De(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ne(e)););return e}function Be(e,t){return Be=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Be(e,t)}function Ae(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Ne(e){return Ne=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ne(e)}xe.registerComponent("PeerTubeLoadProgressBar",function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Se(e,t)}(s,e);var t,n,r,o,i=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Me(r);if(o){var n=Me(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Le(this,e)});function s(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=i.call(this,e,t)).on(e,"progress",n.update),n}return t=s,(n=[{key:"createEl",value:function(){return _e(Me(s.prototype),"createEl",this).call(this,"div",{className:"vjs-load-progress",innerHTML:`<span class="vjs-control-text"><span>${this.localize("Loaded")}</span>: 0%</span>`})}},{key:"dispose",value:function(){_e(Me(s.prototype),"dispose",this).call(this)}},{key:"update",value:function(){}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(xe));let He=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Be(e,t)}(s,e);var t,n,r,o,i=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ne(r);if(o){var n=Ne(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ae(this,e)});function s(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),n=i.call(this,e,t);let r=function(){let e=te("theater-enabled");return null!=e&&"true"===e}();return!0===r&&(n.player().addClass(s.THEATER_MODE_CLASS),n.handleTheaterChange()),n.controlText("Theater mode"),n.player().theaterEnabled=r,n}return t=s,(n=[{key:"buildCSSClass",value:function(){return`vjs-theater-control ${Ie(Ne(s.prototype),"buildCSSClass",this).call(this)}`}},{key:"handleTheaterChange",value:function(){let e=this.isTheaterEnabled();this.controlText(e?"Normal mode":"Theater mode"),ne("theater-enabled",e.toString()),this.player_.trigger("theaterChange",e)}},{key:"handleClick",value:function(){this.player_.toggleClass(s.THEATER_MODE_CLASS),this.handleTheaterChange()}},{key:"isTheaterEnabled",value:function(){return this.player_.hasClass(s.THEATER_MODE_CLASS)}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(o().getComponent("Button"));function Fe(){return Fe="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=ze(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},Fe.apply(this,arguments)}function ze(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=$e(e)););return e}function Ue(e,t){return Ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ue(e,t)}function Ve(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function $e(e){return $e=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},$e(e)}He.THEATER_MODE_CLASS="vjs-theater-enabled",o().registerComponent("TheaterButton",He);let Ke=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ue(e,t)}(s,e);var t,n,r,o,i=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=$e(r);if(o){var n=$e(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ve(this,e)});function s(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),t.selectable=!0,(n=i.call(this,e,t)).autoResolutionEnabled=!0,n.autoResolutionChosen="",n.resolutionId=t.resolutionId,n.label=t.label,e.peertubeResolutions().on("resolutionChanged",(()=>n.updateSelection())),-1===n.resolutionId&&e.peertubeResolutions().on("autoResolutionEnabledChanged",(()=>n.updateAutoResolution())),n}return t=s,(n=[{key:"handleClick",value:function(e){!1===this.autoResolutionEnabled&&-1===this.resolutionId||(Fe($e(s.prototype),"handleClick",this).call(this,e),this.player().peertubeResolutions().select({id:this.resolutionId,byEngine:!1}))}},{key:"updateSelection",value:function(){var e;let t=this.player().peertubeResolutions().getSelected();-1===this.resolutionId&&(this.autoResolutionChosen=null===(e=this.player().peertubeResolutions().getAutoResolutionChosen())||void 0===e?void 0:e.label),this.selected(this.resolutionId===t.id)}},{key:"updateAutoResolution",value:function(){let e=this.player().peertubeResolutions().isAutoResolutionEnabeld();!1===e?this.addClass("disabled"):this.removeClass("disabled"),this.autoResolutionEnabled=e}},{key:"getLabel",value:function(){return-1===this.resolutionId?this.label+" <small>"+this.autoResolutionChosen+"</small>":this.label}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(o().getComponent("MenuItem"));function We(){return We="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=qe(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},We.apply(this,arguments)}function qe(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Ye(e)););return e}function Ge(e,t){return Ge=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ge(e,t)}function Je(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Ye(e){return Ye=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Ye(e)}o().registerComponent("ResolutionMenuItem",Ke);let Qe=o().getComponent("Menu"),Xe=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ge(e,t)}(a,e);var t,n,r,i,s=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Ye(r);if(i){var n=Ye(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Je(this,e)});function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=s.call(this,e,t)).controlText("Quality"),e.peertubeResolutions().on("resolutionsAdded",(()=>n.buildQualities())),e.peertubeResolutions().on("resolutionChanged",(()=>{setTimeout((()=>n.trigger("labelUpdated")))})),n}return t=a,n=[{key:"createEl",value:function(){let e=We(Ye(a.prototype),"createEl",this).call(this);return this.labelEl_=o().dom.createEl("div",{className:"vjs-resolution-value"}),e.appendChild(this.labelEl_),e}},{key:"updateARIAAttributes",value:function(){this.el().setAttribute("aria-label","Quality")}},{key:"createMenu",value:function(){return new Qe(this.player_)}},{key:"buildCSSClass",value:function(){return We(Ye(a.prototype),"buildCSSClass",this).call(this)+" vjs-resolution-button"}},{key:"buildWrapperCSSClass",value:function(){return"vjs-resolution-control "+We(Ye(a.prototype),"buildWrapperCSSClass",this).call(this)}},{key:"addClickListener",value:function(e){e.on("click",(()=>{let t=this.menu.children();for(let n of t)e!==n&&n.selected(!1)}))}},{key:"buildQualities",value:function(){for(let e of this.player().peertubeResolutions().getResolutions()){let t="0p"===e.label?this.player().localize("Audio-only"):e.label;this.menu.addChild(new Ke(this.player_,{id:e.id+"",resolutionId:e.id,label:t,selected:e.selected}))}for(let e of this.menu.children())this.addClickListener(e);this.trigger("menuChanged")}}],n&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(o().getComponent("MenuButton"));function Ze(){return Ze="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=et(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},Ze.apply(this,arguments)}function et(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=rt(e)););return e}function tt(e,t){return tt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},tt(e,t)}function nt(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function rt(e){return rt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},rt(e)}o().registerComponent("ResolutionMenuButton",Xe);let ot=o().getComponent("Component");function it(){return it="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=st(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},it.apply(this,arguments)}function st(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=ct(e)););return e}function at(e,t){return at=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},at(e,t)}function lt(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ut(e)}function ut(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ct(e){return ct=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},ct(e)}ot.registerComponent("SettingsDialog",function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tt(e,t)}(s,e);var t,n,r,o,i=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=rt(r);if(o){var n=rt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return nt(this,e)});function s(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(t=i.call(this,e)).hide(),t}return t=s,(n=[{key:"createEl",value:function(){let e=this.id(),t="TTsettingsDialogLabel-"+e,n="TTsettingsDialogDescription-"+e;return Ze(rt(s.prototype),"createEl",this).call(this,"div",{className:"vjs-settings-dialog vjs-modal-overlay",innerHTML:"",tabIndex:-1},{role:"dialog","aria-labelledby":t,"aria-describedby":n})}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(ot));let pt=o().getComponent("MenuItem"),dt=o().getComponent("Component"),ft=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&at(e,t)}(a,e);var t,n,r,i,s=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=ct(r);if(i){var n=ct(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return lt(this,e)});function a(e,t){var n;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=s.call(this,e,t)).settingsButton=t.menuButton,n.dialog=n.settingsButton.dialog,n.mainMenu=n.settingsButton.menu,n.panel=n.dialog.getChild("settingsPanel"),n.panelChild=n.panel.getChild("settingsPanelChild"),n.panelChildEl=n.panelChild.el(),n.size=null,n.menuToLoad="mainmenu";let r=T(t.entry),i=o().getComponent(r);if(!i)throw new Error(`Component ${r} does not exist`);let l=Object.assign({},t,{entry:t.menuButton,menuButton:ut(n)});n.subMenu=new i(n.player(),l);let u=n.subMenu.buildCSSClass().split(" ")[0];return n.settingsSubMenuEl_.className+=" "+u,n.eventHandlers(),e.ready((()=>{setTimeout((()=>{n.player_&&(n.build(),e.on("ratechange",n.submenuClickHandler),"CaptionsButton"===r&&e.on("captionsChanged",(()=>{setTimeout((()=>{n.settingsSubMenuEl_.innerHTML="",n.settingsSubMenuEl_.appendChild(n.subMenu.menu.el()),n.update(),n.bindClickEvents()}),0)})),n.reset())}),0)})),n}return t=a,n=[{key:"eventHandlers",value:function(){this.submenuClickHandler=this.onSubmenuClick.bind(this),this.transitionEndHandler=this.onTransitionEnd.bind(this)}},{key:"onSubmenuClick",value:function(e){let t=null;t="tap"===e.type?e.target:e.currentTarget||e.target,(null==t?void 0:t.classList.contains("vjs-back-button"))?this.loadMainMenu():(setTimeout((()=>this.update(e)),0),this.subMenu.menu.removeClass("vjs-hidden"))}},{key:"createEl",value:function(){let e=o().dom.createEl("li",{className:"vjs-menu-item",tabIndex:-1});return this.settingsSubMenuTitleEl_=o().dom.createEl("div",{className:"vjs-settings-sub-menu-title"}),e.appendChild(this.settingsSubMenuTitleEl_),this.settingsSubMenuValueEl_=o().dom.createEl("div",{className:"vjs-settings-sub-menu-value"}),e.appendChild(this.settingsSubMenuValueEl_),this.settingsSubMenuEl_=o().dom.createEl("div",{className:"vjs-settings-sub-menu"}),e}},{key:"handleClick",value:function(e){if(this.menuToLoad="submenu",o().dom.removeClass(this.el(),"open"),it(ct(a.prototype),"handleClick",this).call(this,e),this.mainMenu.el().style.opacity="0",o().dom.hasClass(this.settingsSubMenuEl_,"vjs-hidden")){o().dom.removeClass(this.settingsSubMenuEl_,"vjs-hidden"),setTimeout((()=>{this.settingsSubMenuEl_.style.opacity="1",this.settingsSubMenuEl_.style.marginRight="0px"}),0),this.settingsButton.setDialogSize(this.size);let e=this.subMenu.menu.children()[0];e&&e.focus()}else o().dom.addClass(this.settingsSubMenuEl_,"vjs-hidden")}},{key:"createBackButton",value:function(){let e=this.subMenu.menu.addChild("MenuItem",{},0);e.addClass("vjs-back-button"),e.el().innerHTML=this.player().localize(this.subMenu.controlText())}},{key:"PrefixedEvent",value:function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"addEvent",o=["webkit","moz","MS","o",""];for(let i=0;i<o.length;i++)o[i]||(t=t.toLowerCase()),"addEvent"===r?e.addEventListener(o[i]+t,n,!1):"removeEvent"===r&&e.removeEventListener(o[i]+t,n,!1)}},{key:"onTransitionEnd",value:function(e){"margin-right"===e.propertyName&&"mainmenu"===this.menuToLoad&&(o().dom.addClass(this.settingsSubMenuEl_,"vjs-hidden"),this.settingsSubMenuEl_.style.opacity="0")}},{key:"reset",value:function(){o().dom.addClass(this.settingsSubMenuEl_,"vjs-hidden"),this.settingsSubMenuEl_.style.opacity="0",this.setMargin()}},{key:"loadMainMenu",value:function(){let e=this.mainMenu.el();this.menuToLoad="mainmenu",this.mainMenu.show(),e.style.opacity="0";let t=this.mainMenu;this.settingsButton.setDialogSize([t.width,t.height]),setTimeout((()=>{this.setMargin(),e.style.opacity="1";let t=this.mainMenu.children()[0];t&&t.focus()}),0)}},{key:"build",value:function(){this.subMenu.on("labelUpdated",(()=>{this.update()})),this.subMenu.on("menuChanged",(()=>{this.bindClickEvents(),this.setSize(),this.update()})),this.settingsSubMenuTitleEl_.innerHTML=this.player().localize(this.subMenu.controlText()),this.settingsSubMenuEl_.appendChild(this.subMenu.menu.el()),this.panelChildEl.appendChild(this.settingsSubMenuEl_),this.update(),this.createBackButton(),this.setSize(),this.bindClickEvents(),this.PrefixedEvent(this.settingsSubMenuEl_,"TransitionEnd",this.transitionEndHandler,"addEvent")}},{key:"update",value:function(e){let t=null,n=this.subMenu.name();if(e&&"tap"===e.type?t=e.target:e&&(t=e.currentTarget),"PlaybackRateMenuButton"===n){let e=this.subMenu.labelEl_.innerHTML;setTimeout((()=>{this.settingsSubMenuValueEl_.innerHTML=e}),250)}else for(let r of this.subMenu.menu.children_)if(r instanceof dt&&r.hasClass("vjs-selected")){let e=r;if("function"==typeof e.getLabel){this.settingsSubMenuValueEl_.innerHTML=e.getLabel();break}this.settingsSubMenuValueEl_.innerHTML=this.player().localize(e.options_.label)}t&&!t.classList.contains("vjs-back-button")&&this.settingsButton.hideDialog()}},{key:"bindClickEvents",value:function(){for(let e of this.subMenu.menu.children())e instanceof dt&&e.on(["tap","click"],this.submenuClickHandler)}},{key:"setSize",value:function(){this.dialog.removeClass("vjs-hidden"),o().dom.removeClass(this.settingsSubMenuEl_,"vjs-hidden"),this.size=this.settingsButton.getComponentSize(this.settingsSubMenuEl_),this.setMargin(),this.dialog.addClass("vjs-hidden"),o().dom.addClass(this.settingsSubMenuEl_,"vjs-hidden")}},{key:"setMargin",value:function(){if(!this.size)return;let[e]=this.size;this.settingsSubMenuEl_.style.marginRight=`-${e}px`}},{key:"hideSubMenu",value:function(){this.el()&&o().dom.hasClass(this.el(),"open")&&(o().dom.addClass(this.settingsSubMenuEl_,"vjs-hidden"),o().dom.removeClass(this.el(),"open"))}}],n&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(pt);function ht(){return ht="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=yt(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},ht.apply(this,arguments)}function yt(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=gt(e)););return e}function vt(e,t){return vt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},vt(e,t)}function bt(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return mt(e)}function mt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function gt(e){return gt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},gt(e)}ft.prototype.contentElType="button",o().registerComponent("SettingsMenuItem",ft);let wt=o().getComponent("Button"),Ot=o().getComponent("Menu"),Et=o().getComponent("Component");function jt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Pt(){return Pt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=kt(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},Pt.apply(this,arguments)}function kt(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_t(e)););return e}function Ct(e,t){return Ct=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ct(e,t)}function Tt(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function _t(e){return _t=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},_t(e)}Et.registerComponent("SettingsButton",function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&vt(e,t)}(a,e);var t,n,r,i,s=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=gt(r);if(i){var n=gt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return bt(this,e)});function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=s.call(this,e,t)).settingsButtonOptions=t,n.controlText("Settings"),n.dialog=n.player().addChild("settingsDialog"),n.dialogEl=n.dialog.el(),n.menu=null,n.panel=n.dialog.addChild("settingsPanel"),n.panelChild=n.panel.addChild("settingsPanelChild"),n.addClass("vjs-settings"),n.el().setAttribute("aria-label","Settings Button"),n.addSettingsItemHandler=n.onAddSettingsItem.bind(mt(n)),n.disposeSettingsItemHandler=n.onDisposeSettingsItem.bind(mt(n)),n.documentClickHandler=n.onDocumentClick.bind(mt(n)),n.userInactiveHandler=n.onUserInactive.bind(mt(n)),n.buildMenu(),n.bindEvents(),n.player().one("play",(()=>n.hideDialog())),n}return t=a,(n=[{key:"onDocumentClick",value:function(e){var t,n,r;let o=e.target;(null===(t=null==o?void 0:o.classList)||void 0===t?void 0:t.contains("vjs-settings"))||(null===(r=null===(n=null==o?void 0:o.parentElement)||void 0===n?void 0:n.classList)||void 0===r?void 0:r.contains("vjs-settings"))||this.dialog.hasClass("vjs-hidden")||this.hideDialog()}},{key:"onDisposeSettingsItem",value:function(e,t){if(void 0===t){let e=this.menu.children();for(;e.length>0;)e[0].dispose(),this.menu.removeChild(e[0]);this.addClass("vjs-hidden")}else{let e=this.menu.getChild(t);e&&(e.dispose(),this.menu.removeChild(e))}this.hideDialog(),0===this.settingsButtonOptions.entries.length&&this.addClass("vjs-hidden")}},{key:"dispose",value:function(){document.removeEventListener("click",this.documentClickHandler),this.isInIframe()&&window.removeEventListener("blur",this.documentClickHandler)}},{key:"onAddSettingsItem",value:function(e,t){let[n,r]=t;this.addMenuItem(n,r),this.removeClass("vjs-hidden")}},{key:"onUserInactive",value:function(){this.dialog.hasClass("vjs-hidden")||this.hideDialog()}},{key:"bindEvents",value:function(){document.addEventListener("click",this.documentClickHandler),this.isInIframe()&&window.addEventListener("blur",this.documentClickHandler),this.player().on("addsettingsitem",this.addSettingsItemHandler),this.player().on("disposesettingsitem",this.disposeSettingsItemHandler),this.player().on("userinactive",this.userInactiveHandler)}},{key:"buildCSSClass",value:function(){return`vjs-icon-settings ${ht(gt(a.prototype),"buildCSSClass",this).call(this)}`}},{key:"handleClick",value:function(){this.dialog.hasClass("vjs-hidden")?this.showDialog():this.hideDialog()}},{key:"showDialog",value:function(){this.player().peertube().onMenuOpened(),this.menu.el().style.opacity="1",this.dialog.show(),this.el().setAttribute("aria-expanded","true"),this.setDialogSize(this.getComponentSize(this.menu));let e=this.menu.children()[0];e&&e.focus()}},{key:"hideDialog",value:function(){this.player_.peertube().onMenuClosed(),this.dialog.hide(),this.el().setAttribute("aria-expanded","false"),this.setDialogSize(this.getComponentSize(this.menu)),this.menu.el().style.opacity="1",this.resetChildren()}},{key:"getComponentSize",value:function(e){let t=null,n=null;if(e instanceof Et){let r=e.el();t=r.offsetWidth,n=r.offsetHeight,e.width=t,e.height=n}else t=e.offsetWidth,n=e.offsetHeight;return[t,n]}},{key:"setDialogSize",value:function(e){let[t,n]=e;if("number"!=typeof n)return;let r=this.settingsButtonOptions.setup.maxHeightOffset,o=this.player().el().offsetHeight-r,i=this.panel.el();n>o?(n=o,t+=17,i.style.maxHeight=`${n}px`):""!==i.style.maxHeight&&(i.style.maxHeight=""),this.dialogEl.style.width=`${t}px`,this.dialogEl.style.height=`${n}px`}},{key:"buildMenu",value:function(){this.menu=new Ot(this.player()),this.menu.addClass("vjs-main-menu");let e=this.settingsButtonOptions.entries;if(0===e.length)return this.addClass("vjs-hidden"),void this.panelChild.addChild(this.menu);for(let t of e)this.addMenuItem(t,this.settingsButtonOptions);this.panelChild.addChild(this.menu)}},{key:"addMenuItem",value:function(e,t){t.name=T(e);let n=Object.assign({},t,{entry:e,menuButton:this}),r=new ft(this.player(),n);this.menu.addChild(r),r.on("click",o().bind(this,this.hideChildren)),r.on("click",(function(){o().dom.hasClass(this.el_,"open")?o().dom.removeClass(this.el_,"open"):o().dom.addClass(this.el_,"open")}))}},{key:"resetChildren",value:function(){for(let e of this.menu.children())e.reset()}},{key:"hideChildren",value:function(){for(let e of this.menu.children())e.hideSubMenu()}},{key:"isInIframe",value:function(){return window.self!==window.top}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(wt));let Rt=o().getComponent("Component");function St(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Lt(){return Lt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=Mt(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},Lt.apply(this,arguments)}function Mt(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Dt(e)););return e}function xt(e,t){return xt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},xt(e,t)}function It(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function Dt(e){return Dt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Dt(e)}Rt.registerComponent("SettingsPanel",function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ct(e,t)}(s,e);var t,n,r,o,i=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=_t(r);if(o){var n=_t(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Tt(this,e)});function s(){return jt(this,s),i.apply(this,arguments)}return t=s,(n=[{key:"createEl",value:function(){return Pt(_t(s.prototype),"createEl",this).call(this,"div",{className:"vjs-settings-panel",innerHTML:"",tabIndex:-1})}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(Rt));let Bt=o().getComponent("Component");function At(){return At="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=Nt(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},At.apply(this,arguments)}function Nt(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=zt(e)););return e}function Ht(e,t){return Ht=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Ht(e,t)}function Ft(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function zt(e){return zt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},zt(e)}Bt.registerComponent("SettingsPanelChild",function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&xt(e,t)}(s,e);var t,n,r,o,i=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=Dt(r);if(o){var n=Dt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return It(this,e)});function s(){return St(this,s),i.apply(this,arguments)}return t=s,(n=[{key:"createEl",value:function(){return Lt(Dt(s.prototype),"createEl",this).call(this,"div",{className:"vjs-settings-panel-child",innerHTML:"",tabIndex:-1})}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(Bt));let Ut=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Ht(e,t)}(s,e);var t,n,r,o,i=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=zt(r);if(o){var n=zt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Ft(this,e)});function s(e,t){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),i.call(this,e,t)}return t=s,(n=[{key:"createEl",value:function(){this.wrapper=At(zt(s.prototype),"createEl",this).call(this,"div",{className:"vjs-playlist-button",innerHTML:"",tabIndex:-1});let e=At(zt(s.prototype),"createEl",this).call(this,"div",{className:"vjs-playlist-icon",innerHTML:"",tabIndex:-1});return this.playlistInfoElement=At(zt(s.prototype),"createEl",this).call(this,"div",{className:"vjs-playlist-info",innerHTML:"",tabIndex:-1}),this.wrapper.appendChild(e),this.wrapper.appendChild(this.playlistInfoElement),this.update(),this.wrapper}},{key:"update",value:function(){let e=this.options_;this.playlistInfoElement.innerHTML=e.getCurrentPosition()+"/"+e.playlist.videosLength,this.wrapper.title=this.player().localize("Playlist: {1}",[e.playlist.displayName])}},{key:"handleClick",value:function(){this.getPlaylistMenu().open()}},{key:"getPlaylistMenu",value:function(){return this.options_.playlistMenu}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(o().getComponent("ClickableComponent"));function Vt(){return Vt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=$t(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},Vt.apply(this,arguments)}function $t(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=qt(e)););return e}function Kt(e,t){return Kt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Kt(e,t)}function Wt(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function qt(e){return qt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},qt(e)}o().registerComponent("PlaylistButton",Ut);let Gt=o().getComponent("Component"),Jt=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Kt(e,t)}(s,e);var t,n,r,o,i=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=qt(r);if(o){var n=qt(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Wt(this,e)});function s(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=i.call(this,e,t)).emitTapEvents(),n.element=t.element,n.on(["click","tap"],(()=>n.switchPlaylistItem())),n.on("keydown",(e=>n.handleKeyDown(e))),n}return t=s,(n=[{key:"createEl",value:function(){let e=this.options_,t=Vt(qt(s.prototype),"createEl",this).call(this,"li",{className:"vjs-playlist-menu-item",innerHTML:""});e.element.video||t.classList.add("vjs-disabled");let n=Vt(qt(s.prototype),"createEl",this).call(this,"div",{className:"item-position-block"}),r=Vt(qt(s.prototype),"createEl",this).call(this,"div",{className:"item-position",innerHTML:e.element.position});return n.appendChild(r),t.appendChild(n),e.element.video?this.buildAvailableVideo(t,n,e):this.buildUnavailableVideo(t),t}},{key:"setSelected",value:function(e){e?this.addClass("vjs-selected"):this.removeClass("vjs-selected")}},{key:"getElement",value:function(){return this.element}},{key:"buildAvailableVideo",value:function(e,t,n){let r=n.element,o=Vt(qt(s.prototype),"createEl",this).call(this,"div",{className:"item-player"});t.appendChild(o);let i=Vt(qt(s.prototype),"createEl",this).call(this,"img",{src:window.location.origin+r.video.thumbnailPath}),a=Vt(qt(s.prototype),"createEl",this).call(this,"div",{className:"info-block"}),l=Vt(qt(s.prototype),"createEl",this).call(this,"div",{innerHTML:r.video.name,className:"title"}),u=Vt(qt(s.prototype),"createEl",this).call(this,"div",{innerHTML:r.video.channel.displayName,className:"channel"});if(a.appendChild(l),a.appendChild(u),r.startTimestamp||r.stopTimestamp){let e="";r.startTimestamp&&(e+=m(r.startTimestamp)),r.stopTimestamp&&(e+=" - "+m(r.stopTimestamp));let t=Vt(qt(s.prototype),"createEl",this).call(this,"div",{innerHTML:e,className:"timestamps"});a.append(t)}e.append(i),e.append(a)}},{key:"buildUnavailableVideo",value:function(e){let t=Vt(qt(s.prototype),"createEl",this).call(this,"div",{className:"item-unavailable",innerHTML:this.player().localize("Unavailable video")});e.appendChild(t)}},{key:"handleKeyDown",value:function(e){"Space"!==e.code&&"Enter"!==e.code||this.switchPlaylistItem()}},{key:"switchPlaylistItem",value:function(){this.options_.onClicked()}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(Gt);function Yt(){return Yt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=Qt(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},Yt.apply(this,arguments)}function Qt(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=tn(e)););return e}function Xt(e,t){return Xt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},Xt(e,t)}function Zt(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return en(e)}function en(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function tn(e){return tn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},tn(e)}Gt.registerComponent("PlaylistMenuItem",Jt);let nn=o().getComponent("Component"),rn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Xt(e,t)}(s,e);var t,n,r,o,i=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=tn(r);if(o){var n=tn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Zt(this,e)});function s(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),en(n=i.call(this,e,t)),n.el().addEventListener("mouseenter",n.mouseenter),n.el().addEventListener("mouseleave",n.mouseleave),n.player().on("click",(e=>{let t=e.target;do{if(t.classList.contains("vjs-playlist-menu")||t.classList.contains("vjs-playlist-button"))return;t=t.parentElement}while(t);n.close()})),n}return t=s,(n=[{key:"dispose",value:function(){this.el().removeEventListener("mouseenter",this.mouseenter),this.el().removeEventListener("mouseleave",this.mouseleave)}},{key:"userInactiveHandler",value:function(){self.close()}},{key:"mouseenter",value:function(){this.player().off("userinactive",this.userInactiveHandler)}},{key:"mouseleave",value:function(){this.player().one("userinactive",this.userInactiveHandler)}},{key:"createEl",value:function(){this.menuItems=[];let e=this.getOptions(),t=Yt(tn(s.prototype),"createEl",this).call(this,"div",{className:"vjs-playlist-menu",innerHTML:"",tabIndex:-1}),n=Yt(tn(s.prototype),"createEl",this).call(this,"div",{className:"header"}),r=Yt(tn(s.prototype),"createEl",this).call(this,"div"),o=Yt(tn(s.prototype),"createEl",this).call(this,"div",{innerHTML:e.playlist.displayName,className:"title"}),i=e.playlist.videoChannel,a=Yt(tn(s.prototype),"createEl",this).call(this,"div",{innerHTML:i?this.player().localize("By {1}",[i.displayName]):"",className:"channel"});r.appendChild(o),r.appendChild(a);let l=Yt(tn(s.prototype),"createEl",this).call(this,"div",{className:"cross"});l.addEventListener("click",(()=>this.close())),n.appendChild(r),n.appendChild(l);let u=Yt(tn(s.prototype),"createEl",this).call(this,"ol");for(let s of e.elements){let e=new Jt(this.player(),{element:s,onClicked:()=>this.onItemClicked(s)});u.appendChild(e.el()),this.menuItems.push(e)}return t.appendChild(n),t.appendChild(u),t}},{key:"update",value:function(){let e=this.getOptions();this.updateSelected(e.getCurrentPosition())}},{key:"open",value:function(){this.player().addClass("playlist-menu-displayed")}},{key:"close",value:function(){this.player().removeClass("playlist-menu-displayed")}},{key:"updateSelected",value:function(e){for(let t of this.menuItems)t.setSelected(t.getElement().position===e)}},{key:"getOptions",value:function(){return this.options_}},{key:"onItemClicked",value:function(e){this.getOptions().onItemClicked(e)}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(nn);function on(e,t){return on=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},on(e,t)}function sn(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function an(e){return an=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},an(e)}nn.registerComponent("PlaylistMenu",rn);let ln=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&on(e,t)}(s,e);var t,n,r,o,i=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=an(r);if(o){var n=an(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return sn(this,e)});function s(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=i.call(this,e,t)).options=t,n.player.ready((()=>{e.addClass("vjs-playlist")})),n.playlistMenu=new rn(e,t),n.playlistButton=new Ut(e,Object.assign(Object.assign({},t),{playlistMenu:n.playlistMenu})),e.addChild(n.playlistMenu,t),e.addChild(n.playlistButton,t),n}return t=s,(n=[{key:"updateSelected",value:function(){this.playlistMenu.updateSelected(this.options.getCurrentPosition())}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(o().getPlugin("plugin"));function un(e,t){return un=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},un(e,t)}function cn(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function pn(e){return pn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},pn(e)}o().registerPlugin("playlist",ln);let dn=Z()("peertube:player:mobile"),fn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&un(e,t)}(a,e);var t,n,r,i,s=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=pn(r);if(i){var n=pn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return cn(this,e)});function a(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=s.call(this,e,t)).seekAmount=0,n.peerTubeMobileButtons=e.addChild("PeerTubeMobileButtons",{reportTouchActivity:!1}),o().browser.IS_ANDROID&&screen.orientation&&n.handleFullscreenRotation(),n.player.options_.userActions||(n.player.options_.userActions={}),n.player.options_.userActions.click=!1,n.player.options_.userActions.doubleClick=!1,n.player.one("play",(()=>{n.initTouchStartEvents()})),n}return t=a,(n=[{key:"handleFullscreenRotation",value:function(){this.player.on("fullscreenchange",(()=>{this.player.isFullscreen()&&!this.isPortraitVideo()&&screen.orientation.lock("landscape").catch((e=>v.k.error("Cannot lock screen to landscape.",e)))}))}},{key:"isPortraitVideo",value:function(){return this.player.videoWidth()<this.player.videoHeight()}},{key:"initTouchStartEvents",value:function(){let e=e=>{if(this.tapTimeout&&(clearTimeout(this.tapTimeout),this.tapTimeout=void 0),this.lastTapEvent&&e.timeStamp-this.lastTapEvent.timeStamp<a.DOUBLE_TAP_DELAY_MS)return dn("Detected double tap"),this.lastTapEvent=void 0,void this.onDoubleTap(e);this.newActiveState=!this.player.userActive(),this.tapTimeout=setTimeout((()=>{dn("No double tap detected, set user active state to %s.",this.newActiveState),this.player.userActive(this.newActiveState)}),a.DOUBLE_TAP_DELAY_MS),this.lastTapEvent=e};this.player.on("touchstart",(t=>{this.player.userActive()||e(t)})),this.peerTubeMobileButtons.el().addEventListener("touchstart",(t=>{t.preventDefault(),e(t)}),{passive:!1})}},{key:"dispose",value:function(){this.player.off("touchstart")}},{key:"onDoubleTap",value:function(e){let t=this.player.currentWidth(),n=this.findPlayerTarget(e.target).getBoundingClientRect(),r=e.targetTouches[0].pageX-n.left;dn("Calculating double tap zone (player width: %d, offset X: %d)",t,r),r>.66*t?(this.seekAmount<0&&(this.seekAmount=0),this.seekAmount+=10,dn("Will forward %d seconds",this.seekAmount)):r<.33*t&&(this.seekAmount>0&&(this.seekAmount=0),this.seekAmount-=10,dn("Will rewind %d seconds",this.seekAmount)),this.peerTubeMobileButtons.displayFastSeek(this.seekAmount),this.scheduleSetCurrentTime()}},{key:"findPlayerTarget",value:function(e){return e.classList.contains("video-js")?e:this.findPlayerTarget(e.parentElement)}},{key:"scheduleSetCurrentTime",value:function(){this.player.pause(),this.player.addClass("vjs-fast-seeking"),this.setCurrentTimeTimeout&&clearTimeout(this.setCurrentTimeTimeout),this.setCurrentTimeTimeout=setTimeout((()=>{let e=this.player.currentTime()+this.seekAmount;this.seekAmount=0,e=Math.max(0,e),e=Math.min(this.player.duration(),e),this.player.currentTime(e),this.seekAmount=0,this.peerTubeMobileButtons.displayFastSeek(0),this.player.removeClass("vjs-fast-seeking"),this.player.userActive(!1),this.player.play()}),a.SET_CURRENT_TIME_DELAY)}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(o().getPlugin("plugin"));function hn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function yn(){return yn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=vn(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},yn.apply(this,arguments)}function vn(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=gn(e)););return e}function bn(e,t){return bn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},bn(e,t)}function mn(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function gn(e){return gn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},gn(e)}fn.DOUBLE_TAP_DELAY_MS=250,fn.SET_CURRENT_TIME_DELAY=1e3,o().registerPlugin("peertubeMobile",fn);let wn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&bn(e,t)}(s,e);var t,n,r,o,i=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=gn(r);if(o){var n=gn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return mn(this,e)});function s(){return hn(this,s),i.apply(this,arguments)}return t=s,(n=[{key:"createEl",value:function(){let e=yn(gn(s.prototype),"createEl",this).call(this,"div",{className:"vjs-mobile-buttons-overlay"}),t=yn(gn(s.prototype),"createEl",this).call(this,"div",{className:"main-button"});t.addEventListener("touchstart",(e=>{e.stopPropagation(),this.player_.paused()||this.player_.ended()?this.player_.play():this.player_.pause()})),this.rewind=yn(gn(s.prototype),"createEl",this).call(this,"div",{className:"rewind-button vjs-hidden"}),this.forward=yn(gn(s.prototype),"createEl",this).call(this,"div",{className:"forward-button vjs-hidden"});for(let n=0;n<3;n++)this.rewind.appendChild(yn(gn(s.prototype),"createEl",this).call(this,"span",{className:"icon"})),this.forward.appendChild(yn(gn(s.prototype),"createEl",this).call(this,"span",{className:"icon"}));return this.rewindText=this.rewind.appendChild(yn(gn(s.prototype),"createEl",this).call(this,"div",{className:"text"})),this.forwardText=this.forward.appendChild(yn(gn(s.prototype),"createEl",this).call(this,"div",{className:"text"})),e.appendChild(this.rewind),e.appendChild(t),e.appendChild(this.forward),e}},{key:"displayFastSeek",value:function(e){return 0===e?(this.hideRewind(),void this.hideForward()):e>0?(this.hideRewind(),void this.displayForward(e)):e<0?(this.hideForward(),void this.displayRewind(e)):void 0}},{key:"hideRewind",value:function(){this.rewind.classList.add("vjs-hidden"),this.rewindText.textContent=""}},{key:"displayRewind",value:function(e){this.rewind.classList.remove("vjs-hidden"),this.rewindText.textContent=this.player().localize("{1} seconds",[e+""])}},{key:"hideForward",value:function(){this.forward.classList.add("vjs-hidden"),this.forwardText.textContent=""}},{key:"displayForward",value:function(e){this.forward.classList.remove("vjs-hidden"),this.forwardText.textContent=this.player().localize("{1} seconds",[e+""])}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(o().getComponent("Component"));function On(e,t){return On=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},On(e,t)}function En(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function jn(e){return jn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},jn(e)}o().registerComponent("PeerTubeMobileButtons",wn);let Pn=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&On(e,t)}(s,e);var t,n,r,o,i=(r=s,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=jn(r);if(o){var n=jn(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return En(this,e)});function s(e,t){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s),(n=i.call(this,e,t)).handlers=n.buildHandlers(),n.handleKeyFunction=e=>n.onKeyDown(e),document.addEventListener("keydown",n.handleKeyFunction),n}return t=s,(n=[{key:"dispose",value:function(){document.removeEventListener("keydown",this.handleKeyFunction)}},{key:"onKeyDown",value:function(e){if(this.isValidKeyTarget(e.target))for(let t of this.handlers)if(t.accept(e))return void t.cb(e)}},{key:"buildHandlers",value:function(){let e=[{accept:e=>" "===e.key||"MediaPlayPause"===e.key,cb:e=>{e.preventDefault(),e.stopPropagation(),this.player.paused()?this.player.play():this.player.pause()}},{accept:e=>this.isNaked(e,"ArrowUp"),cb:e=>{e.preventDefault(),this.player.volume(this.player.volume()+s.VOLUME_STEP)}},{accept:e=>this.isNaked(e,"ArrowDown"),cb:e=>{e.preventDefault(),this.player.volume(this.player.volume()-s.VOLUME_STEP)}},{accept:e=>this.isNaked(e,"ArrowLeft")||this.isNaked(e,"MediaRewind"),cb:e=>{e.preventDefault();let t=Math.max(0,this.player.currentTime()-s.SEEK_STEP);this.player.currentTime(t)}},{accept:e=>this.isNaked(e,"ArrowRight")||this.isNaked(e,"MediaForward"),cb:e=>{e.preventDefault();let t=Math.min(this.player.duration(),this.player.currentTime()+s.SEEK_STEP);this.player.currentTime(t)}},{accept:e=>this.isNaked(e,"f")||!e.altKey&&e.ctrlKey&&"Enter"===e.key,cb:e=>{e.preventDefault(),this.player.isFullscreen()?this.player.exitFullscreen():this.player.requestFullscreen()}},{accept:e=>this.isNaked(e,"m"),cb:e=>{e.preventDefault(),this.player.muted(!this.player.muted())}},{accept:e=>">"===e.key,cb:()=>{let e=Math.min(this.player.playbackRate()+.1,5);this.player.playbackRate(parseFloat(e.toFixed(2)))}},{accept:e=>"<"===e.key,cb:()=>{let e=Math.max(this.player.playbackRate()-.1,.1);this.player.playbackRate(parseFloat(e.toFixed(2)))}},{accept:e=>","===e.key,cb:()=>{this.player.pause(),this.player.currentTime(this.player.currentTime()-1/30)}},{accept:e=>"."===e.key,cb:()=>{this.player.pause(),this.player.currentTime(this.player.currentTime()+1/30)}}];for(let t=0;t<10;t++)e.push({accept:e=>e.key===t+""&&!e.ctrlKey,cb:e=>{e.preventDefault(),this.player.currentTime(this.player.duration()*t*.1)}});return e}},{key:"isValidKeyTarget",value:function(e){let t=this.player.el(),n=document.activeElement,r=e.tagName.toLowerCase();return n===t||n===t.querySelector(".vjs-tech")||n===t.querySelector(".vjs-control-bar")||"content"===e.id||"body"===r||"video"===r}},{key:"isNaked",value:function(e,t){return!(e.ctrlKey||e.altKey||e.metaKey||e.shiftKey||e.key!==t)}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),s}(o().getPlugin("plugin"));Pn.VOLUME_STEP=.1,Pn.SEEK_STEP=5,o().registerPlugin("peerTubeHotkeysPlugin",Pn),n(2492);let kn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mode=n,this.options=t.common}var t,n;return t=e,(n=[{key:"getChildrenOptions",value:function(){let e={};return this.options.previousVideo&&Object.assign(e,this.getPreviousVideo()),Object.assign(e,{playToggle:{}}),this.options.nextVideo&&Object.assign(e,this.getNextVideo()),Object.assign(e,Object.assign(Object.assign(Object.assign({currentTimeDisplay:{},timeDivider:{},durationDisplay:{},liveDisplay:{},flexibleWidthSpacer:{}},this.getProgressControl()),{p2PInfoButton:{p2pEnabled:this.options.p2pEnabled},muteToggle:{},volumeControl:{}}),this.getSettingsButton())),Object.assign(e,{PictureInPictureBastyon:{}}),!0===this.options.theaterButton&&Object.assign(e,{theaterButton:{}}),Object.assign(e,{fullscreenToggle:{}}),e}},{key:"getSettingsButton",value:function(){let e=[];return e.push("playbackRateMenuButton"),e.push("resolutionMenuButton"),{settingsButton:{setup:{maxHeightOffset:40},entries:e}}}},{key:"getProgressControl",value:function(){return{progressControl:{children:{seekBar:{children:{loadProgressBar:{},mouseTimeDisplay:{},playProgressBar:{}}}}}}}},{key:"getPreviousVideo",value:function(){return{previousVideoButton:{type:"previous",handler:this.options.previousVideo,isDisabled:()=>!!this.options.hasPreviousVideo&&!this.options.hasPreviousVideo()}}}},{key:"getNextVideo",value:function(){return{nextVideoButton:{type:"next",handler:this.options.nextVideo,isDisabled:()=>!!this.options.hasNextVideo&&!this.options.hasNextVideo()}}}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Cn(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}let Tn=function(){function e(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];Cn(this,e),this.baseUrls=t}var t,n;return t=e,(n=[{key:"removeBySegmentUrl",value:function(e){v.k.info(`Removing redundancy of segment URL ${e}.`);let t=(0,w.dirname)(e);this.baseUrls=this.baseUrls.filter((e=>e!==t&&e!==t+"/"))}},{key:"buildUrl",value:function(e){let t=this.baseUrls.length+1,n=this.getRandomInt(t);if(n===t-1)return e;let r=this.baseUrls[n],o=r.endsWith("/")?"":"/";return r+o+(0,w.basename)(e)}},{key:"countBaseUrls",value:function(){return this.baseUrls.length}},{key:"getRandomInt",value:function(e){return Math.floor(Math.random()*Math.floor(e))}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function _n(e){return function(t){return e.buildUrl(t.url)}}function Rn(e){return new Promise((t=>{setTimeout((()=>t()),e)}))}function Sn(e,t,n,r,o,i,s){try{var a=e[i](s),l=a.value}catch(u){return void n(u)}a.done?t(l):Promise.resolve(l).then(r,o)}function Ln(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function s(e){Sn(i,r,o,s,a,"next",e)}function a(e){Sn(i,r,o,s,a,"throw",e)}s(void 0)}))}}function Mn(e,t){var n=void 0;for(var r in t=t.substring(36),e)e.hasOwnProperty(r)&&r.indexOf(t)>-1&&(n=e[r]);return n}function xn(e,t){let n=In(e),r=/bytes=(\d+)-(\d+)/;return function(){var o=Ln((function*(o,s,a){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;t&&(yield Rn(1e3));let u,c=(0,w.basename)(o.url),p=yield n,d=p[c]||(t?null:Mn(p,c));if(!d&&l>3)throw new Error(`Unknown segment name ${c} in segment validator`);if(!d)return v.k.info(`Refetching sha segments for ${c}`),yield Rn(1e3),n=In(e),void(yield i(o,s,a,l+1));let f="";if("string"==typeof d)u=d;else{let e=r.exec(o.range);f=e[1]+"-"+e[2],u=d[f]}if(void 0===u)throw new Error(`Unknown segment name ${c}/${f} in segment validator`);console.log("segment.data",o.url,f,o.data);let h=yield Dn(o.data);if(h!==u)throw new Error(`Hashes does not correspond for segment ${c}/${f}(expected: ${u} instead of ${h})`)}));function i(e,t,n){return o.apply(this,arguments)}return i}()}function In(e){return fetch(e).then((e=>e.json())).catch((e=>(v.k.error("Cannot get sha256 segments",e),{})))}function Dn(e){return Bn.apply(this,arguments)}function Bn(){return(Bn=Ln((function*(e){if(e)return window.crypto.subtle?window.crypto.subtle.digest("SHA-256",e).then((e=>An(e))):(new((yield n.e(875).then(n.t.bind(n,875,23))).default.sha256)).update(e).digest("hex")}))).apply(this,arguments)}function An(e){if(!e)return"";let t="",n="0123456789abcdef";return new Uint8Array(e).forEach((e=>{t+=n[e>>4]+n[15&e]})),t}let Nn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t,this.p2pMediaLoaderModule=n}var t,n;return t=e,n=[{key:"getPluginOptions",value:function(){let e=this.options.common,t=new Tn(this.options.p2pMediaLoader.redundancyBaseUrls),n=this.getP2PMediaLoaderOptions(t),r=new this.p2pMediaLoaderModule.Engine(n).createLoaderClass();return console.log("options 5",n),{p2pMediaLoader:{redundancyUrlManager:t,type:"application/x-mpegURL",startTime:e.startTime,src:this.options.p2pMediaLoader.playlistUrl,loader:r},hlsjs:{levelLabelHandler:e=>{let t=Math.min(e.height||0,e.width||0),n=this.options.p2pMediaLoader.videoFiles.find((e=>e.resolution.id===t));if(!n)return e.height;let r=n.resolution.label;return n.fps>=50&&(r+=n.fps),r}},html5:{hlsjsConfig:this.getHLSJSOptions(r)}}}},{key:"getP2PMediaLoaderOptions",value:function(e){var t,n;let r=!1;"cellular"===(null===(t=null===navigator||void 0===navigator?void 0:navigator.connection)||void 0===t?void 0:t.type)&&(v.k.info("We are on a cellular connection: disabling seeding."),r=!0);let o=this.options.p2pMediaLoader.trackerAnnounce.filter((e=>e.startsWith("ws"))),i=this.options.common.isLive?this.getP2PMediaLoaderLiveOptions():this.getP2PMediaLoaderVODOptions();return{loader:Object.assign({trackerAnnounce:o,rtcConfig:{iceServers:[{urls:"stun:turn.pocketnet.app",username:"stunuser",credential:"q1w2e3r4t5ASD!@#"},{urls:"turn:turn.pocketnet.app",username:"stunuser",credential:"q1w2e3r4t5ASD!@#"}].concat(k(["relay1.expressturn.com:443","relay2.expressturn.com:443","relay3.expressturn.com:443","relay1.expressturn.com:3478","relay2.expressturn.com:3478","relay4.expressturn.com:3478","relay5.expressturn.com:3478","relay6.expressturn.com:3478","relay8.expressturn.com:3478","relay1.expressturn.com:80","stun.relay.metered.ca:80"].map((e=>({urls:"stun:"+e})))),k(["relay2.expressturn.com:443","relay3.expressturn.com:80","relay3.expressturn.com:443","relay4.expressturn.com:3478","relay5.expressturn.com:3478","relay6.expressturn.com:3478","relay7.expressturn.com:3478","relay8.expressturn.com:3478"].map((e=>({urls:"turn:"+e,username:"efPU52K4SLOQ34W2QY",credential:"1TJPNFxHKXrZfelz"})))),k(["standard.relay.metered.ca:443?transport=tcp","standard.relay.metered.ca:443","standard.relay.metered.ca:80?transport=tcp","standard.relay.metered.ca:80"].map((e=>({urls:"turn:"+e,username:"6043b15711c81a940b09b977",credential:"RS3nKg8sYAv0QvcY"})))))},simultaneousHttpDownloads:1,httpFailedSegmentTimeout:1e3,segmentValidator:this.options.common.localTransport?void 0:xn(this.options.p2pMediaLoader.segmentsSha256Url,this.options.common.isLive),segmentUrlBuilder:_n(e),useP2P:this.options.common.p2pEnabled,consumeOnly:r,segmentsStorage:this.options.common.isLive?void 0:this.options.segmentsStorage,localTransport:this.options.common.localTransport},i),segments:{assetsStorage:this.options.common.isLive?void 0:this.options.assetsStorage,swarmId:this.options.p2pMediaLoader.playlistUrl,forwardSegmentCount:null!==(n=i.p2pDownloadMaxPriority)&&void 0!==n?n:20,localTransport:this.options.common.localTransport}}}},{key:"getP2PMediaLoaderLiveOptions",value:function(){let e={requiredSegmentsPriority:1};return 3===this.options.common.liveOptions.latencyMode?Object.assign(Object.assign({},e),{useP2P:!1,httpDownloadProbability:1}):e}},{key:"getP2PMediaLoaderVODOptions",value:function(){return{requiredSegmentsPriority:3,skipSegmentBuilderPriority:1,cachedSegmentExpiration:6e5,cachedSegmentsCount:30,httpDownloadMaxPriority:9,httpDownloadProbability:.06,httpDownloadProbabilitySkipIfNoPeers:!0,p2pDownloadMaxPriority:50}}},{key:"getHLSJSOptions",value:function(e){let t=this.options.common.isLive?this.getHLSLiveOptions():this.getHLSVODOptions(),n=Object.assign({capLevelToPlayerSize:!0,autoStartLoad:!1,loader:e},t),r=function(){let e=te("average-bandwidth");if(null!=e){let t=parseInt(e,10);if(isNaN(t))return;return t}}();return r?Object.assign(Object.assign({},n),{abrEwmaDefaultEstimate:8*r,backBufferLength:90,startLevel:-1,testBandwidth:!1,debug:!1}):n}},{key:"getHLSLiveOptions",value:function(){switch(this.options.common.liveOptions.latencyMode){case 3:return{liveSyncDurationCount:2};case 2:return{liveSyncDurationCount:10};default:return{liveSyncDurationCount:5}}}},{key:"getHLSVODOptions",value:function(){return{liveSyncDurationCount:5}}}],n&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();let Hn=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options=t,this.autoPlayValue=n}var t,n;return t=e,(n=[{key:"getPluginOptions",value:function(){let e=this.options.common,t=this.options.webtorrent,n=this.options.p2pMediaLoader;return{webtorrent:{autoplay:"play"===this.autoPlayValue,playerRefusedP2P:!1===e.p2pEnabled,videoDuration:e.videoDuration,playerElement:e.playerElement,videoFiles:0!==t.videoFiles.length?t.videoFiles:(null==n?void 0:n.videoFiles)||[],startTime:e.startTime}}}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();let Fn=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.mode=t,this.options=n,this.p2pMediaLoaderModule=r}var t,n;return t=e,(n=[{key:"getVideojsOptions",value:function(e){let t=this.options.common,n=this.getAutoPlayValue(t.autoplay,e),r={preloadTextTracks:!1},o={peertube:Object.assign({mode:this.mode,autoplay:n},g(t,["videoViewUrl","authorizationHeader","startTime","videoDuration","subtitle","stopTime","isLive","videoUUID"]))};if("p2p-media-loader"===this.mode){let e=new Nn(this.options,this.p2pMediaLoaderModule).getPluginOptions();Object.assign(o,g(e,["hlsjs","p2pMediaLoader"])),Object.assign(r,e.html5)}else if("webtorrent"===this.mode){let t=new Hn(this.options,this.getAutoPlayValue(n,e));Object.assign(o,t.getPluginOptions()),n=!1}Object.assign(o,{hotkeys:{}});let i=new kn(this.options,this.mode),s={html5:r,textTrackSettings:!1,controls:void 0===t.controls||t.controls,loop:void 0!==t.loop&&t.loop,muted:void 0!==t.muted?t.muted:void 0,autoplay:this.getAutoPlayValue(n,e),poster:t.poster,inactivityTimeout:t.inactivityTimeout,playbackRates:[.5,.75,1,1.25,1.5,1.75,2],plugins:o,sources:t.sources,controlBar:{children:i.getChildrenOptions()}};return t.language&&E(t.language)!==E("en-US")&&Object.assign(s,{language:t.language}),s}},{key:"getAutoPlayValue",value:function(e,t){return!0!==e?e:/iPad|iPhone|iPod/.test(navigator.platform)||navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&navigator.platform.includes("MacIntel")||/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?!!t&&"play":"play"}},{key:"getContextMenuOptions",value:function(e,t){return{content:()=>{let t=e.options_.loop,n=[{icon:"repeat",label:e.localize("Play in loop")+(t?'<span class="vjs-icon-tick-white"></span>':""),listener:function(){e.options_.loop=!t}}];return n.push({icon:"info",label:e.localize("Stats for nerds"),listener:()=>{e.stats().show()}}),n.map((e=>Object.assign(Object.assign({},e),{label:`<span class="vjs-icon-${e.icon||"link-2"}"></span>`+e.label})))}}}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();var zn=n(7382),Un=n(1819),Vn=n(4538),$n=n.n(Vn),Kn=n(8724);function Wn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const qn=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.paused=!0,this.registerListeners()}var t,n,r;return t=e,r=[{key:"isLevelAllowed",value:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return-1===t.indexOf(e)}},{key:"getMaxLevelByMediaSize",value:function(e,t,n){if(!e||!e.length)return-1;let r=e.length-1;for(let s=0;s<e.length;s+=1){let a=e[s];if((a.width>=t||a.height>=n)&&(o=a,!(i=e[s+1])||o.width!==i.width||o.height!==i.height)){r=s;break}}var o,i;return r}}],(n=[{key:"setStreamController",value:function(e){this.streamController=e}},{key:"destroy",value:function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}},{key:"registerListeners",value:function(){let{hls:e}=this;e.on(Kn.z.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(Kn.z.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(Kn.z.MANIFEST_PARSED,this.onManifestParsed,this),e.on(Kn.z.BUFFER_CODECS,this.onBufferCodecs,this),e.on(Kn.z.MEDIA_DETACHING,this.onMediaDetaching,this)}},{key:"unregisterListener",value:function(){let{hls:e}=this;e.off(Kn.z.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(Kn.z.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(Kn.z.MANIFEST_PARSED,this.onManifestParsed,this),e.off(Kn.z.BUFFER_CODECS,this.onBufferCodecs,this),e.off(Kn.z.MEDIA_DETACHING,this.onMediaDetaching,this)}},{key:"onFpsDropLevelCapping",value:function(t,n){e.isLevelAllowed(n.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(n.droppedLevel)}},{key:"onMediaAttaching",value:function(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null}},{key:"onManifestParsed",value:function(e,t){let n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}},{key:"onBufferCodecs",value:function(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}},{key:"onMediaDetaching",value:function(){this.stopCapping()}},{key:"detectPlayerSize",value:function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){let e=this.hls.levels;if(e.length){let t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}},{key:"getMaxLevel",value:function(t){let n=this.hls.levels;if(!n.length)return-1;let r=n.filter(((n,r)=>e.isLevelAllowed(r,this.restrictedLevels)&&r<=t));return this.clientRect=null,e.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)}},{key:"capp",value:function(){this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),this.detectPlayerSize()}},{key:"startCapping",value:function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e4),this.detectPlayerSize())}},{key:"stopCapping",value:function(){this.restrictedLevels=[],this.firstLevel=-1,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}},{key:"getDimensions",value:function(){if(this.paused&&this.clientRectLast)return this.clientRectLast;if(this.clientRect)return this.clientRect;let e=this.media,t={width:0,height:0};if(e){let n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,t.width||t.height||(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRectLast=this.clientRect=t,t}},{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){let e=1;try{e=self.devicePixelRatio}catch(t){}return e>1.5&&(e=1.5),e}}])&&Wn(t.prototype,n),r&&Wn(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();var Gn=n(7307),Jn=n(2988),Yn=n(3972),Qn=n(259);const Xn=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.hls=t;let n=t.config;this.bwEstimator=new Gn.Z(n.abrEwmaSlowVoD,n.abrEwmaFastVoD,n.abrEwmaDefaultEstimate),this.registerListeners()}var t,n;return t=e,(n=[{key:"registerListeners",value:function(){let{hls:e}=this;e.on(Kn.z.FRAG_LOADING,this.onFragLoading,this),e.on(Kn.z.FRAG_LOADED,this.onFragLoaded,this),e.on(Kn.z.FRAG_BUFFERED,this.onFragBuffered,this),e.on(Kn.z.LEVEL_LOADED,this.onLevelLoaded,this),e.on(Kn.z.ERROR,this.onError,this)}},{key:"unregisterListeners",value:function(){let{hls:e}=this;e.off(Kn.z.FRAG_LOADING,this.onFragLoading,this),e.off(Kn.z.FRAG_LOADED,this.onFragLoaded,this),e.off(Kn.z.FRAG_BUFFERED,this.onFragBuffered,this),e.off(Kn.z.LEVEL_LOADED,this.onLevelLoaded,this),e.off(Kn.z.ERROR,this.onError,this)}},{key:"destroy",value:function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null}},{key:"onFragLoading",value:function(e,t){var n;let r=t.frag;r.type===Yn.r.MAIN&&(this.timer||(this.fragCurrent=r,this.partCurrent=null!==(n=t.part)&&void 0!==n?n:null,this.timer=self.setInterval(this.onCheck,100)))}},{key:"onLevelLoaded",value:function(e,t){let n=this.hls.config;t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD)}},{key:"_abandonRulesCheck",value:function(){let{fragCurrent:e,partCurrent:t,hls:n}=this,{autoLevelEnabled:r,media:o}=n;if(!e||!o)return;let i=t?t.stats:e.stats,s=t?t.duration:e.duration;if(i.aborted||i.loaded&&i.loaded===i.total||0===e.level)return this.clearTimer(),void(this._nextAutoLevel=-1);if(!r||o.paused||!o.playbackRate||!o.readyState)return;let a=n.mainForwardBufferInfo;if(null===a)return;let l=performance.now()-i.loading.start,u=Math.abs(o.playbackRate);if(l<=500*s/u)return;let c=i.loaded&&i.loading.first,p=this.bwEstimator.getEstimate(),{levels:d,minAutoLevel:f}=n,h=i.total||Math.max(i.loaded,Math.round(s*d[e.level].maxBitrate/8)),y=c?1e3*i.loaded/l:0,v=y?(h-i.loaded)/y:8*h/p,b=a.len/u;if(v<=b)return;let m,g=Number.POSITIVE_INFINITY;for(m=e.level-1;m>f;m--){let e=d[m].maxBitrate;if(g=y?s*e/(6.4*y):s*e/p,g<b)break}g>=v||(Qn.k.warn(`Fragment ${e.sn}${t?" part "+t.index:""} of level ${e.level} is loading too slowly and will cause an underbuffer; aborting and switching to level ${m}\n      Current BW estimate: ${Number.isFinite(p)?(p/1024).toFixed(3):"Unknown"} Kb/s\n      Estimated load time for current fragment: ${v.toFixed(3)} s\n      Estimated load time for the next fragment: ${g.toFixed(3)} s\n      Time to underbuffer: ${b.toFixed(3)} s`),n.nextLoadLevel=m,c&&this.bwEstimator.sample(l,i.loaded),this.clearTimer(),e.loader&&(this.fragCurrent=this.partCurrent=null,e.loader.abort()),n.trigger(Kn.z.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:i}))}},{key:"onFragLoaded",value:function(e,t){let{frag:n,part:r}=t;if(n.type===Yn.r.MAIN&&Number.isFinite(n.sn)){let e=r?r.stats:n.stats,t=r?r.duration:n.duration;if(this.clearTimer(),this.lastLoadedFragLevel=n.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){let r=this.hls.levels[n.level],o=(r.loaded?r.loaded.bytes:0)+e.loaded,i=(r.loaded?r.loaded.duration:0)+t;r.loaded={bytes:o,duration:i},r.realBitrate=Math.round(8*o/i)}n.bitrateTest&&this.onFragBuffered(Kn.z.FRAG_BUFFERED,{stats:e,frag:n,part:r,id:n.type})}}},{key:"onFragBuffered",value:function(e,t){let{frag:n,part:r}=t,o=r?r.stats:n.stats;if(o.aborted)return;if(n.type!==Yn.r.MAIN||"initSegment"===n.sn)return;let i=o.parsing.end-o.loading.start;o.bwEstimateSample&&this.bwEstimator.sample(i,o.loaded),o.bwEstimate=this.bwEstimator.getEstimate(),console.log("stats.bwEstimate",o.bwEstimate),this.bitrateTestDelay=n.bitrateTest?i/1e3:0}},{key:"onError",value:function(e,t){switch(t.details){case Jn.B.FRAG_LOAD_ERROR:case Jn.B.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function(){self.clearInterval(this.timer),this.timer=void 0}},{key:"nextAutoLevel",get:function(){let e=this._nextAutoLevel;if(-1!==e&&!this.bwEstimator.canEstimate())return e;let t=this.getNextABRAutoLevel();return-1!==e&&this.hls.levels[t].loadError?e:(-1!==e&&(t=Math.min(e,t)),t)},set:function(e){this._nextAutoLevel=e}},{key:"getNextABRAutoLevel",value:function(){let{fragCurrent:e,partCurrent:t,hls:n}=this,{maxAutoLevel:r,config:o,minAutoLevel:i,media:s}=n,a=t?t.duration:e?e.duration:0,l=s&&0!==s.playbackRate?Math.abs(s.playbackRate):1,u=this.bwEstimator?this.bwEstimator.getEstimate():o.abrEwmaDefaultEstimate,c=n.mainForwardBufferInfo,p=(c?c.len:0)/l,d=this.findBestLevel(u,i,r,p,o.abrBandWidthFactor,o.abrBandWidthUpFactor);if(d>=0)return d;Qn.k.trace((p?"rebuffering expected":"buffer is empty")+", finding optimal quality level");let f=a?Math.min(a,o.maxStarvationDelay):o.maxStarvationDelay,h=o.abrBandWidthFactor,y=o.abrBandWidthUpFactor;if(!p){let e=this.bitrateTestDelay;e&&(f=(a?Math.min(a,o.maxLoadingDelay):o.maxLoadingDelay)-e,Qn.k.trace(`bitrate test took ${Math.round(1e3*e)}ms, set first fragment max fetchDuration to ${Math.round(1e3*f)} ms`),h=y=1)}return d=this.findBestLevel(u,i,r,p+f,h,y),Math.max(d,0)}},{key:"findBestLevel",value:function(e,t,n,r,o,i){var s;let{fragCurrent:a,partCurrent:l,lastLoadedFragLevel:u}=this,{levels:c}=this.hls,p=c[u],d=!!(null===(s=null==p?void 0:p.details)||void 0===s?void 0:s.live),f=null==p?void 0:p.codecSet,h=l?l.duration:a?a.duration:0;for(let y=n;y>=t;y--){let t=c[y];if(!t||f&&t.codecSet!==f)continue;let n,s=t.details,a=(l?null==s?void 0:s.partTarget:null==s?void 0:s.averagetargetduration)||h;n=y<=u?o*e:i*e;let p=c[y].maxBitrate,v=p*a/n;if(Qn.k.trace(`level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: ${y}/${Math.round(n)}/${p}/${a}/${r}/${v}`),n>p&&(0===v||!Number.isFinite(v)||d&&!this.bitrateTestDelay||v<r))return y}return-1}}])&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();function Zn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}let er=function(){function e(t,n,r){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.errorCounts={},this.maxNetworkErrorRecovery=10,this.hlsjsConfig=null,this._duration=null,this.metadata=null,this.isLive=null,this.dvrDuration=null,this.edgeMargin=null,this.handlers={play:null},this.vjs=t,this.source=n,this.tech=r,this.tech.name_="Hlsjs",this.videoElement=r.el(),this.player=t(r.options_.playerId),this.videoLogger=new v.Y(!0),this.videoElement.addEventListener("error",(e=>{let t,n=(e.currentTarget||e.target).error;if(n){switch(v.k.info(n),n.code){case n.MEDIA_ERR_ABORTED:t="You aborted the video playback";break;case n.MEDIA_ERR_DECODE:t="The video playback was aborted due to a corruption problem or because the video used features your browser did not support",this._handleMediaError(n);break;case n.MEDIA_ERR_NETWORK:t="A network error caused the video download to fail part-way";break;case n.MEDIA_ERR_SRC_NOT_SUPPORTED:t="The video could not be loaded, either because the server or network failed or because the format is not supported";break;default:t=n.message}v.k.error(`MEDIA_ERROR: ${t}`)}})),this.initialize()}var t,n,r;return t=e,r=[{key:"addHook",value:function(t,n){(e.hooks[t]=this.hooks[t]||[]).push(n)}},{key:"removeHook",value:function(t,n){if(void 0===e.hooks[t])return!1;let r=e.hooks[t].indexOf(n);return-1!==r&&(e.hooks[t].splice(r,1),!0)}}],(n=[{key:"duration",value:function(){return this._duration===1/0?1/0:isNaN(this.videoElement.duration)?this._duration||0:this.videoElement.duration}},{key:"seekable",value:function(){if(this.hls.media){if(!this.isLive)return this.vjs.createTimeRanges(0,this.hls.media.duration);let e=Math.round(this.hls.media.duration-this.dvrDuration),t=Math.round(this.hls.media.duration-this.edgeMargin);return this.vjs.createTimeRanges(e,t)}return this.vjs.createTimeRanges()}},{key:"dispose",value:function(){this.videoElement.removeEventListener("play",this.handlers.play);let e=this.hls;e.log=e.warn=()=>{},this.videoLogger.destroyLogs(),this.hls.destroy()}},{key:"_executeHooksFor",value:function(t){if(void 0!==e.hooks[t])for(let n=0;n<e.hooks[t].length;n++)e.hooks[t][n](this.player,this.hls)}},{key:"_handleMediaError",value:function(e){if(3==e.code){var t=this.player.currentTime()+2;return this.dispose(),this._initHlsjs(),this.player.currentTime(t),this.player.play(),void this.hls.once($n().Events.FRAG_LOADED,(()=>{this.player.play()}))}return 1===this.errorCounts[$n().ErrorTypes.MEDIA_ERROR]?(v.k.info("trying to recover media error"),void this.hls.recoverMediaError()):2===this.errorCounts[$n().ErrorTypes.MEDIA_ERROR]?(v.k.info("2nd try to recover media error (by swapping audio codec"),this.hls.swapAudioCodec(),void this.hls.recoverMediaError()):void(this.errorCounts[$n().ErrorTypes.MEDIA_ERROR]>2&&(v.k.info("bubbling media error up to VIDEOJS"),this.hls.destroy(),this.tech.error=()=>e,this.tech.trigger("error")))}},{key:"_handleNetworkError",value:function(e){if(!1!==navigator.onLine){if(this.errorCounts[$n().ErrorTypes.NETWORK_ERROR]<=this.maxNetworkErrorRecovery)return v.k.info("trying to recover network error"),setTimeout((()=>this.hls.startLoad()),1e3),void this.hls.once($n().Events.FRAG_LOADED,(()=>{this.errorCounts[$n().ErrorTypes.NETWORK_ERROR]=0}));v.k.info("bubbling network error up to VIDEOJS"),this.hls.destroy(),this.tech.error=()=>e,this.tech.trigger("error")}}},{key:"_onError",value:function(e,t){console.error(e),console.error(t);let n={message:`HLS.js error: ${t.type} - fatal: ${t.fatal} - ${t.details}`};this.videoLogger.log(n.message,{id:"HLS Error"}),this.errorCounts[t.type]?this.errorCounts[t.type]+=1:this.errorCounts[t.type]=1,t.fatal?v.k.error(n.message,{data:t}):v.k.warn(n.message),t.type===$n().ErrorTypes.NETWORK_ERROR?(n.code=2,this._handleNetworkError(n)):t.fatal&&t.type===$n().ErrorTypes.MEDIA_ERROR&&"manifestIncompatibleCodecsError"!==t.details?(n.code=3,this._handleMediaError(n)):t.fatal&&(this.hls.destroy(),v.k.info("bubbling error up to VIDEOJS"),this.tech.error=()=>n,this.tech.trigger("error"))}},{key:"buildLevelLabel",value:function(e){return this.player.srOptions_.levelLabelHandler?this.player.srOptions_.levelLabelHandler(e):e.height?e.height+"p":e.width?Math.round(9*e.width/16)+"p":e.bitrate?e.bitrate/1e3+"kbps":"0"}},{key:"_notifyVideoQualities",value:function(){if(!this.metadata)return;let e=[];this.metadata.levels.forEach(((t,n)=>{e.push({id:n,height:t.height,width:t.width,bitrate:t.bitrate,label:this.buildLevelLabel(t),selected:t.id===this.hls.manualLevel,selectCallback:()=>{this.hls.currentLevel=n}})})),e.push({id:-1,label:this.player.localize("Auto"),selected:!0,selectCallback:()=>this.hls.currentLevel=-1}),this.player.peertubeResolutions().add(e)}},{key:"_startLoad",value:function(){this.hls.startLoad(-1),this.videoElement.removeEventListener("play",this.handlers.play)}},{key:"_oneLevelObjClone",value:function(e){let t={},n=Object.keys(e);for(let r=0;r<n.length;r++)t[n[r]]=e[n[r]];return t}},{key:"sendLogsCache",value:function(e,t){this.videoLogger.returnLog(e,t)}},{key:"_onMetaData",value:function(e,t){this.metadata=t,this._notifyVideoQualities()}},{key:"_initHlsjs",value:function(){let e=this.player.srOptions_,t=(null==e?void 0:e.hlsjsConfig)||this.tech.options_.hlsjsConfig;this.hlsjsConfig=t?this._oneLevelObjClone(t):{},["","auto"].includes(this.videoElement.preload)&&!this.videoElement.autoplay&&void 0===this.hlsjsConfig.autoStartLoad&&(this.hlsjsConfig.autoStartLoad=!1),!1===this.hlsjsConfig.autoStartLoad&&(this.handlers.play=this._startLoad.bind(this),this.videoElement.addEventListener("play",this.handlers.play)),this.hlsjsConfig.capLevelController=qn,this.hlsjsConfig.abrController=Xn,this.hlsjsConfig.abrBandWidthUpFactor=.3,this.hls=new($n())(this.hlsjsConfig),this.player.hls=this.hls,this.hls.on($n().Events.ERROR,((e,t)=>this._onError(e,t))),this.hls.on($n().Events.MANIFEST_PARSED,((e,t)=>this._onMetaData(e,t))),this.hls.on($n().Events.LEVEL_LOADED,((e,t)=>{this.hlsjsConfig.liveSyncDuration?this.edgeMargin=this.hlsjsConfig.liveSyncDuration:this.hlsjsConfig.liveSyncDurationCount&&(this.edgeMargin=this.hlsjsConfig.liveSyncDurationCount*t.details.targetduration),this.isLive=t.details.live,this.dvrDuration=t.details.totalduration,this._duration=this.isLive?1/0:t.details.totalduration,this.player.duration(Math.round(this._duration)),this.isLive&&(this.maxNetworkErrorRecovery=300)})),this.hls.once($n().Events.FRAG_LOADED,(()=>{this.tech.trigger("loadedmetadata")})),this.hls.on($n().Events.FRAG_LOADED,((e,t)=>{console.log("frag",t)})),this.hls.on($n().Events.LEVEL_SWITCHING,((e,t)=>{let n=this.hls.autoLevelEnabled?-1:t.level,r=this.hls.autoLevelEnabled?t.level:-1;this.player.peertubeResolutions().select({id:n,autoResolutionChosenId:r,byEngine:!0})})),this.hls.attachMedia(this.videoElement),this.hls.loadSource(this.source.src)}},{key:"initialize",value:function(){this._initHlsjs()}}])&&Zn(t.prototype,n),r&&Zn(t,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function tr(e,t){return tr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},tr(e,t)}function nr(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function rr(e){return rr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},rr(e)}var or;er.hooks={},((or=o()).registerPlugin||or.plugin)("hlsjs",(function(e){let t=this;e&&(t.srOptions_||(t.srOptions_={}),t.srOptions_.hlsjsConfig||(t.srOptions_.hlsjsConfig=e.hlsjsConfig),e.levelLabelHandler&&!t.srOptions_.levelLabelHandler&&(t.srOptions_.levelLabelHandler=e.levelLabelHandler))})),function(e){if(!$n().isSupported())return void v.k.warn("Hls.js is not supported in this browser!");let t=e.getTech("Html5");t?(t.registerSourceHandler({canHandleSource:function(e){return/^application\/x-mpegURL|application\/vnd\.apple\.mpegurl$/i.test(e.type)?"probably":/\.m3u8/i.test(e.src)?"maybe":""},handleSource:function(t,n){return n.hlsProvider&&n.hlsProvider.dispose(),n.hlsProvider=new er(e,t,n),n.hlsProvider}},0),e.Html5Hlsjs=er):v.k.error("No Hml5 tech found in videojs")}(o());let ir=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&tr(e,t)}(a,e);var t,n,r,i,s=(r=a,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=rr(r);if(i){var n=rr(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return nr(this,e)});function a(e,t){var n;if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),(n=s.call(this,e)).CONSTANTS={INFO_SCHEDULER:1e3},n.statsP2PBytes={pendingDownload:[],pendingUpload:[],numPeers:0,totalDownload:0,totalUpload:0},n.statsHTTPBytes={pendingDownload:[],pendingUpload:[],totalDownload:0,totalUpload:0},n.options=t,!n.options)return nr(n);if(o().Html5Hlsjs)(0,Un.initVideoJsContribHlsJsPlayer)(e);else if(v.k.warn("HLS.js does not seem to be supported. Try to fallback to built in HLS."),!e.canPlayType("application/vnd.apple.mpegurl")){let t="Cannot fallback to built-in HLS";return v.k.warn(t),e.ready((()=>e.trigger("error",new Error(t)))),nr(n)}return n.startTime=b(n.options.startTime),e.src({type:n.options.type,src:n.options.src}),e.ready((()=>{n.initializeCore(),n.hlsjs=e.hls,o().Html5Hlsjs&&n.initializePlugin()})),n}return t=a,n=[{key:"dispose",value:function(){this.hlsjs&&this.hlsjs.destroy(),this.p2pEngine&&this.p2pEngine.destroy(),clearInterval(this.networkInfoInterval)}},{key:"getCurrentLevel",value:function(){return this.hlsjs.levels[this.hlsjs.currentLevel]}},{key:"getLiveLatency",value:function(){return Math.round(this.hlsjs.latency)}},{key:"getHLSJS",value:function(){return this.hlsjs}},{key:"initializeCore",value:function(){this.player.one("play",(()=>{this.player.addClass("vjs-has-big-play-button-clicked")})),this.player.one("canplay",(()=>{this.startTime&&this.player.currentTime(this.startTime)}))}},{key:"initializePlugin",value:function(){(0,Un.initHlsJsPlayer)(this.hlsjs),this.p2pEngine=this.options.loader.getEngine(),this.p2pEngine.on(zn.Events.SegmentError,((e,t)=>{v.k.error(`Segment ${e.id} error.`,t),e.requestUrl&&this.options.redundancyUrlManager.removeBySegmentUrl(e.requestUrl)})),this.statsP2PBytes.numPeers=1+this.options.redundancyUrlManager.countBaseUrls(),this.runStats()}},{key:"runStats",value:function(){this.p2pEngine.on(zn.Events.PieceBytesDownloaded,((e,t,n)=>{let r="p2p"===e?this.statsP2PBytes:this.statsHTTPBytes;r.pendingDownload.push(n),r.totalDownload+=n})),this.p2pEngine.on(zn.Events.PieceBytesUploaded,((e,t,n)=>{let r="p2p"===e?this.statsP2PBytes:this.statsHTTPBytes;r.pendingUpload.push(n),r.totalUpload+=n})),this.p2pEngine.on(zn.Events.PeerConnect,(()=>this.statsP2PBytes.numPeers++)),this.p2pEngine.on(zn.Events.PeerClose,(()=>this.statsP2PBytes.numPeers--)),this.networkInfoInterval=setInterval((()=>{let e=this.arraySum(this.statsP2PBytes.pendingDownload),t=this.arraySum(this.statsP2PBytes.pendingUpload),n=this.arraySum(this.statsHTTPBytes.pendingDownload),r=this.arraySum(this.statsHTTPBytes.pendingUpload);return this.statsP2PBytes.pendingDownload=[],this.statsP2PBytes.pendingUpload=[],this.statsHTTPBytes.pendingDownload=[],this.statsHTTPBytes.pendingUpload=[],this.player.trigger("p2pInfo",{source:"p2p-media-loader",http:{downloadSpeed:n,uploadSpeed:r,downloaded:this.statsHTTPBytes.totalDownload,uploaded:this.statsHTTPBytes.totalUpload},p2p:{downloadSpeed:e,uploadSpeed:t,numPeers:this.statsP2PBytes.numPeers,downloaded:this.statsP2PBytes.totalDownload,uploaded:this.statsP2PBytes.totalUpload},bandwidthEstimate:this.hlsjs.bandwidthEstimate/8})}),this.CONSTANTS.INFO_SCHEDULER)}},{key:"arraySum",value:function(e){return e.reduce(((e,t)=>e+t),0)}}],n&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t.prototype,n),Object.defineProperty(t,"prototype",{writable:!1}),a}(o().getPlugin("plugin"));function sr(e,t,n,r,o,i,s){try{var a=e[i](s),l=a.value}catch(u){return void n(u)}a.done?t(l):Promise.resolve(l).then(r,o)}function ar(e){return function(){var t=this,n=arguments;return new Promise((function(r,o){var i=e.apply(t,n);function s(e){sr(i,r,o,s,a,"next",e)}function a(e){sr(i,r,o,s,a,"throw",e)}s(void 0)}))}}o().registerPlugin("p2pMediaLoader",ir);let lr=n(483),ur=o().getComponent("Slider"),cr=o().getComponent("SeekBar");ur.prototype.update=function(){if(!this.el_||!this.bar)return;let e=this.getProgress();if(e===this.progress_)return e;this.progress_=e;var t=this.bar.el();return this.vertical()?(t.style["transform-origin"]="bottom",t.style.transform="scaleY("+e.toFixed(2)+")"):t.style.transform="scaleX("+e.toFixed(2)+")",e},cr.prototype.getPercent=function(){let e=this.player_.currentTime()/this.player_.duration();return e>=1?1:e},cr.prototype.setEventHandlers_=function(){this.update_=lr.bind(this,this.update),this.update=lr.throttle(this.update_,lr.UPDATE_REFRESH_INTERVAL),this.on(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=e=>this.enableInterval_(e),this.disableIntervalHandler_=e=>this.disableInterval_(e),this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in document&&"visibilityState"in document&&this.on(document,"visibilitychange",this.toggleVisibility_)},cr.prototype.enableInterval_=function(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,lr.UPDATE_REFRESH_INTERVAL))},cr.prototype.update=function(e){if("hidden"===document.visibilityState)return;let t=this.getPercent();var n=this.bar.el();return n.style["transform-origin"]="left",n.style.transform="scaleX("+t.toFixed(2)+")",t};let pr=o().getComponent("CaptionsButton");pr.prototype.controlText_="Subtitles/CC",pr.prototype.label_=" ";let dr=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r,i,s,a;return t=e,n=[{key:"initState",value:function(){this.alreadyPlayed=!1}},{key:"initialize",value:(a=ar((function*(e,t,n){return this.onPlayerChange=n,this.playerElementClassName=t.common.playerElement.className,"p2p-media-loader"===e&&(this.p2pMediaLoaderModule=Un),this.buildPlayer(e,t)})),function(e,t,n){return a.apply(this,arguments)})},{key:"buildPlayer",value:(s=ar((function*(e,t){let n=new Fn(e,t,this.p2pMediaLoaderModule),r=n.getVideojsOptions(this.alreadyPlayed);t&&t.isAudio&&r&&r.controlBar&&r.controlBar.children&&(r.controlBar.children.settingsButton.entries=["playbackRateMenuButton"],r.controlBar.fullscreenToggle=!1,r.inactivityTimeout=0,r.userActions=r.userActions||{},r.userActions.doubleClick=!1);let i=this;return new Promise((s=>{o()(t.common.playerElement,r,(function(){let r=this;return t&&t.isAudio&&r.addClass("vjs-is-audio"),r.one("error",(()=>{})),r.one("play",(()=>{i.alreadyPlayed=!0})),i.addContextMenu(n,r,t.common),(z()||t.mobile)&&r.peertubeMobile(),!1===t.common.controlBar&&r.controlBar.addClass("control-bar-hidden"),r.bezels(),"localvideo"!=e?(r.stats({videoUUID:t.common.videoUUID,videoIsLive:t.common.isLive,mode:e,p2pEnabled:t.common.p2pEnabled}),r.on("p2pInfo",((e,t)=>{"p2p-media-loader"!==t.source||isNaN(t.bandwidthEstimate)||ne("average-bandwidth",t.bandwidthEstimate.toString())}))):r.on("durationchange",(()=>{r.duration()!=t.common.videoDuration&&r.duration(t.common.videoDuration)})),s(r)}))}))})),function(e,t){return s.apply(this,arguments)})},{key:"tryToRecoverHLSError",value:(i=ar((function*(e,t,n){if(3===e.code){if(0===this.videojsDecodeErrors&&n.common.errorNotifier(t.localize("The video failed to play, will try to fast forward.")),20===this.videojsDecodeErrors)return void this.maybeFallbackToWebTorrent("p2p-media-loader",t,n);v.k.info("Fast forwarding HLS to recover from an error."),this.videojsDecodeErrors++,n.common.startTime=t.currentTime()+2,n.common.autoplay=!0,this.rebuildAndUpdateVideoElement(t,n.common);let e=yield this.buildPlayer("p2p-media-loader",n);this.onPlayerChange(e)}else this.maybeFallbackToWebTorrent("p2p-media-loader",t,n)})),function(e,t,n){return i.apply(this,arguments)})},{key:"maybeFallbackToWebTorrent",value:(r=ar((function*(e,t,n){if(0===n.webtorrent.videoFiles.length||"webtorrent"===e)return void t.peertube().displayFatalError();v.k.info("Fallback to webtorrent."),this.rebuildAndUpdateVideoElement(t,n.common);let r=yield this.buildPlayer("webtorrent",n);this.onPlayerChange(r)})),function(e,t,n){return r.apply(this,arguments)})},{key:"rebuildAndUpdateVideoElement",value:function(e,t){let n=document.createElement("video");n.className=this.playerElementClassName;let r=t.playerElement.parentNode;return r||(r=document.getElementById(t.playerElement.id).parentNode),r.parentNode.insertBefore(n,r),t.playerElement=n,t.onPlayerElementChange(n),e.dispose(),n}},{key:"addContextMenu",value:function(e,t,n){let r=e.getContextMenuOptions(t,n);t.contextmenuUI(r)}}],n&&function(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}(t,n),Object.defineProperty(t,"prototype",{writable:!1}),e}();dr.alreadyPlayed=!1,dr.videojsDecodeErrors=0},1301:(e,t,n)=>{"use strict";e.exports=n(1328)},483:(e,t,n)=>{"use strict";n.r(t),n.d(t,{UPDATE_REFRESH_INTERVAL:()=>s,bind:()=>a,debounce:()=>u,throttle:()=>l});let r=3;var o=n(7688),i=n.n(o);let s=30,a=function(e,t,n){t.guid||(t.guid=r++);let o=t.bind(e);return o.guid=n?n+"_"+t.guid:t.guid,o},l=function(e,t){let n=i().performance.now();return function(){let r=i().performance.now();r-n>=t&&(e.apply(void 0,arguments),n=r)}},u=function(e,t,n){let r,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:i(),s=()=>{o.clearTimeout(r),r=null},a=function(){let i=this,s=arguments,a=function(){r=null,a=null,n||e.apply(i,s)};!r&&n&&e.apply(i,s),o.clearTimeout(r),r=o.setTimeout(a,t)};return a.cancel=s,a}},2492:function(e,t,n){var r,o,i;i=function(e){"use strict";"undefined"!=typeof window&&(window.videojs_hotkeys={version:"0.2.27"}),(e.registerPlugin||e.plugin)("hotkeys",(function(t){var n=this,r=n.el(),o=document,i=(t=(e.mergeOptions||e.util.mergeOptions)({volumeStep:.1,seekStep:5,enableMute:!0,enableVolumeScroll:!1,enableHoverScroll:!1,enableFullscreen:!0,enableNumbers:!0,enableJogStyle:!1,alwaysCaptureHotkeys:!1,captureDocumentHotkeys:!1,documentHotkeysFocusElementFilter:function(){return!1},enableModifiersForNumbers:!0,enableInactiveFocus:!0,skipInitialFocus:!1,playPauseKey:function(e){return 32===e.which||179===e.which},rewindKey:function(e){return 37===e.which||177===e.which},forwardKey:function(e){return 39===e.which||176===e.which},volumeUpKey:function(e){return 38===e.which},volumeDownKey:function(e){return 40===e.which},muteKey:function(e){return 77===e.which},fullscreenKey:function(e){return 70===e.which},customKeys:{}},t||{})).volumeStep,s=t.seekStep,a=t.enableMute,l=t.enableVolumeScroll,u=t.enableHoverScroll,c=t.enableFullscreen,p=t.enableNumbers,d=t.enableJogStyle,f=t.alwaysCaptureHotkeys,h=t.captureDocumentHotkeys,y=t.documentHotkeysFocusElementFilter,v=t.enableModifiersForNumbers,b=t.enableInactiveFocus,m=t.skipInitialFocus,g=e.VERSION;r.hasAttribute("tabIndex")||r.setAttribute("tabIndex","-1"),r.style.outline="none",!f&&n.autoplay()||m||n.one("play",(function(){r.focus()})),b&&n.on("userinactive",(function(){var e=function(){clearTimeout(t)},t=setTimeout((function(){n.off("useractive",e);var t=o.activeElement,i=r.querySelector(".vjs-control-bar");t&&t.parentElement==i&&r.focus()}),10);n.one("useractive",e)})),n.on("play",(function(){var e=r.querySelector(".iframeblocker");e&&""===e.style.display&&(e.style.display="block",e.style.bottom="39px")}));var w=function(e){var s,l,u,b=e.which,m=e.preventDefault.bind(e),g=n.duration();if(n.controls()){var w=o.activeElement;if(f||h&&y(w)||w==r||w==r.querySelector(".vjs-tech")||w==r.querySelector(".vjs-control-bar")||w==r.querySelector(".iframeblocker"))switch(k(e,n)){case 1:m(),(f||h)&&e.stopPropagation(),n.paused()?null!=(u=n.play())&&"function"==typeof u.then&&u.then(null,(function(e){})):n.pause();break;case 2:s=!n.paused(),m(),(l=n.currentTime()-C(e))<=0&&(l=0),n.currentTime(l);break;case 3:s=!n.paused(),m(),(l=n.currentTime()+C(e))>=g&&(l=s?g-.001:g),n.currentTime(l);break;case 5:m(),d?(l=n.currentTime()-1,n.currentTime()<=1&&(l=0),n.currentTime(l)):n.volume(n.volume()-i);break;case 4:m(),d?((l=n.currentTime()+1)>=g&&(l=g),n.currentTime(l)):n.volume(n.volume()+i);break;case 6:a&&n.muted(!n.muted());break;case 7:c&&(n.isFullscreen()?n.exitFullscreen():n.requestFullscreen());break;default:if((b>47&&b<59||b>95&&b<106)&&(v||!(e.metaKey||e.ctrlKey||e.altKey))&&p){var O=48;b>95&&(O=96);var E=b-O;m(),n.currentTime(n.duration()*E*.1)}for(var j in t.customKeys){var P=t.customKeys[j];P&&P.key&&P.handler&&P.key(e)&&(m(),P.handler(n,t,e))}}}},O=function(e){if(null!=g&&g<="7.1.0"&&n.controls()){var t=e.relatedTarget||e.toElement||o.activeElement;t!=r&&t!=r.querySelector(".vjs-tech")&&t!=r.querySelector(".iframeblocker")||c&&(n.isFullscreen()?n.exitFullscreen():n.requestFullscreen())}},E=!1,j=r.querySelector(".vjs-volume-menu-button")||r.querySelector(".vjs-volume-panel");null!=j&&(j.onmouseover=function(){E=!0},j.onmouseout=function(){E=!1});var P=function(e){if(u)var t=0;else t=o.activeElement;if(n.controls()&&(f||t==r||t==r.querySelector(".vjs-tech")||t==r.querySelector(".iframeblocker")||t==r.querySelector(".vjs-control-bar")||E)&&l){e=window.event||e;var s=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));e.preventDefault(),1==s?n.volume(n.volume()+i):-1==s&&n.volume(n.volume()-i)}},k=function(e,n){return t.playPauseKey(e,n)?1:t.rewindKey(e,n)?2:t.forwardKey(e,n)?3:t.volumeUpKey(e,n)?4:t.volumeDownKey(e,n)?5:t.muteKey(e,n)?6:t.fullscreenKey(e,n)?7:void 0};function C(e){return"function"==typeof s?s(e):s}var T=!1;n.on("enablehotkeys",(function(){n.on("keydown",w),n.on("dblclick",O),n.on("mousewheel",P),n.on("DOMMouseScroll",P),h&&document.addEventListener("keydown",w),T=!0}));var _=function(){T&&(n.off("keydown",w),n.off("dblclick",O),n.off("mousewheel",P),n.off("DOMMouseScroll",P),h&&document.removeEventListener("keydown",w)),T=!1};return n.on("disablehotkeys",_),n.on("dispose",(function(){_(),n=null,r=null})),this}))},"undefined"!=typeof window&&window.videojs?i(window.videojs):(r=[n(3654)],o=function(e){return i(e.default||e)}.apply(t,r),void 0===o||(e.exports=o))}}]);
//# sourceMappingURL=524.chunk.js.map