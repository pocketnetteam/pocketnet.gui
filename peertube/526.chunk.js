(globalThis.webpackChunkpeertube_client=globalThis.webpackChunkpeertube_client||[]).push([[526],{483:(e,t,s)=>{"use strict";s.r(t),s.d(t,{UPDATE_REFRESH_INTERVAL:()=>a,bind:()=>l,debounce:()=>d,throttle:()=>r});let i=3;var n=s(7688),o=s.n(n);const a=30,l=function(e,t,s){t.guid||(t.guid=i++);const n=t.bind(e);return n.guid=s?s+"_"+t.guid:t.guid,n},r=function(e,t){let s=o().performance.now();return function(){const i=o().performance.now();i-s>=t&&(e.apply(void 0,arguments),s=i)}},d=function(e,t,s){let i,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:o();const a=()=>{n.clearTimeout(i),i=null},l=function(){const o=this,a=arguments;let l=function(){i=null,l=null,s||e.apply(o,a)};!i&&s&&e.apply(o,a),n.clearTimeout(i),i=n.setTimeout(l,t)};return l.cancel=a,l}},2492:function(e,t,s){var i,n,o;o=function(e){"use strict";"undefined"!=typeof window&&(window.videojs_hotkeys={version:"0.2.27"}),(e.registerPlugin||e.plugin)("hotkeys",(function(t){var s=this,i=s.el(),n=document,o=(t=(e.mergeOptions||e.util.mergeOptions)({volumeStep:.1,seekStep:5,enableMute:!0,enableVolumeScroll:!0,enableHoverScroll:!1,enableFullscreen:!0,enableNumbers:!0,enableJogStyle:!1,alwaysCaptureHotkeys:!1,captureDocumentHotkeys:!1,documentHotkeysFocusElementFilter:function(){return!1},enableModifiersForNumbers:!0,enableInactiveFocus:!0,skipInitialFocus:!1,playPauseKey:function(e){return 32===e.which||179===e.which},rewindKey:function(e){return 37===e.which||177===e.which},forwardKey:function(e){return 39===e.which||176===e.which},volumeUpKey:function(e){return 38===e.which},volumeDownKey:function(e){return 40===e.which},muteKey:function(e){return 77===e.which},fullscreenKey:function(e){return 70===e.which},customKeys:{}},t||{})).volumeStep,a=t.seekStep,l=t.enableMute,r=t.enableVolumeScroll,d=t.enableHoverScroll,u=t.enableFullscreen,h=t.enableNumbers,c=t.enableJogStyle,p=t.alwaysCaptureHotkeys,m=t.captureDocumentHotkeys,y=t.documentHotkeysFocusElementFilter,g=t.enableModifiersForNumbers,v=t.enableInactiveFocus,b=t.skipInitialFocus,f=e.VERSION;i.hasAttribute("tabIndex")||i.setAttribute("tabIndex","-1"),i.style.outline="none",!p&&s.autoplay()||b||s.one("play",(function(){i.focus()})),v&&s.on("userinactive",(function(){var e=function(){clearTimeout(t)},t=setTimeout((function(){s.off("useractive",e);var t=n.activeElement,o=i.querySelector(".vjs-control-bar");t&&t.parentElement==o&&i.focus()}),10);s.one("useractive",e)})),s.on("play",(function(){var e=i.querySelector(".iframeblocker");e&&""===e.style.display&&(e.style.display="block",e.style.bottom="39px")}));var C=function(e){var a,r,d,v=e.which,b=e.preventDefault.bind(e),f=s.duration();if(s.controls()){var C=n.activeElement;if(p||m&&y(C)||C==i||C==i.querySelector(".vjs-tech")||C==i.querySelector(".vjs-control-bar")||C==i.querySelector(".iframeblocker"))switch(k(e,s)){case 1:b(),(p||m)&&e.stopPropagation(),s.paused()?null!=(d=s.play())&&"function"==typeof d.then&&d.then(null,(function(e){console.log("E",e)})):s.pause();break;case 2:a=!s.paused(),b(),(r=s.currentTime()-M(e))<=0&&(r=0),s.currentTime(r);break;case 3:a=!s.paused(),b(),(r=s.currentTime()+M(e))>=f&&(r=a?f-.001:f),s.currentTime(r);break;case 5:b(),c?(r=s.currentTime()-1,s.currentTime()<=1&&(r=0),s.currentTime(r)):s.volume(s.volume()-o);break;case 4:b(),c?((r=s.currentTime()+1)>=f&&(r=f),s.currentTime(r)):s.volume(s.volume()+o);break;case 6:l&&s.muted(!s.muted());break;case 7:u&&(s.isFullscreen()?s.exitFullscreen():s.requestFullscreen());break;default:if((v>47&&v<59||v>95&&v<106)&&(g||!(e.metaKey||e.ctrlKey||e.altKey))&&h){var E=48;v>95&&(E=96);var w=v-E;b(),s.currentTime(s.duration()*w*.1)}for(var T in t.customKeys){var S=t.customKeys[T];S&&S.key&&S.handler&&S.key(e)&&(b(),S.handler(s,t,e))}}}},E=function(e){if(null!=f&&f<="7.1.0"&&s.controls()){var t=e.relatedTarget||e.toElement||n.activeElement;t!=i&&t!=i.querySelector(".vjs-tech")&&t!=i.querySelector(".iframeblocker")||u&&(s.isFullscreen()?s.exitFullscreen():s.requestFullscreen())}},w=!1,T=i.querySelector(".vjs-volume-menu-button")||i.querySelector(".vjs-volume-panel");null!=T&&(T.onmouseover=function(){w=!0},T.onmouseout=function(){w=!1});var S=function(e){if(d)var t=0;else t=n.activeElement;if(s.controls()&&(p||t==i||t==i.querySelector(".vjs-tech")||t==i.querySelector(".iframeblocker")||t==i.querySelector(".vjs-control-bar")||w)&&r){e=window.event||e;var a=Math.max(-1,Math.min(1,e.wheelDelta||-e.detail));e.preventDefault(),1==a?s.volume(s.volume()+o):-1==a&&s.volume(s.volume()-o)}},k=function(e,s){return t.playPauseKey(e,s)?1:t.rewindKey(e,s)?2:t.forwardKey(e,s)?3:t.volumeUpKey(e,s)?4:t.volumeDownKey(e,s)?5:t.muteKey(e,s)?6:t.fullscreenKey(e,s)?7:void 0};function M(e){return"function"==typeof a?a(e):a}var I=!1;s.on("enablehotkeys",(function(){s.on("keydown",C),s.on("dblclick",E),s.on("mousewheel",S),s.on("DOMMouseScroll",S),m&&document.addEventListener("keydown",C),I=!0}));var x=function(){I&&(s.off("keydown",C),s.off("dblclick",E),s.off("mousewheel",S),s.off("DOMMouseScroll",S),m&&document.removeEventListener("keydown",C)),I=!1};return s.on("disablehotkeys",x),s.on("dispose",(function(){x(),s=null,i=null})),this}))},"undefined"!=typeof window&&window.videojs?o(window.videojs):(i=[s(3654)],n=function(e){return o(e.default||e)}.apply(t,i),void 0===n||(e.exports=n))},4093:(e,t,s)=>{"use strict";s.d(t,{AO:()=>d,M_:()=>u,OV:()=>n,Pz:()=>m,W7:()=>o,ZC:()=>r,ao:()=>l,pW:()=>p,v_:()=>c,y_:()=>a,zZ:()=>h});var i=s(5168);function n(){const e=g("volume");if(null!=e){const t=parseFloat(e);if(isNaN(t))return;return t}}function o(){const e=g("mute");if(null!=e)return"true"===e}function a(){const e=g("theater-enabled");return null!=e&&"true"===e}function l(e){return v("volume",e.toString())}function r(e){return v("mute",e.toString())}function d(e){return v("theater-enabled",e.toString())}function u(e){return v("average-bandwidth",e.toString())}function h(){const e=g("average-bandwidth");if(null!=e){const t=parseInt(e,10);if(isNaN(t))return;return t}}function c(e){return v("last-subtitle",e)}function p(){return g("last-subtitle")}function m(e,t){return v("video-watch-history",JSON.stringify(Object.assign(Object.assign({},function(e){let t;try{const e=g("video-watch-history");if(!e)return{};t=JSON.parse(e)}catch(s){i.k.error("Cannot parse video watch history from local storage/",s)}return t=t||{},t}()),{[e]:{duration:t,date:`${(new Date).toISOString()}`}})))}const y="peertube-videojs-";function g(e){try{return localStorage.getItem(y+e)}catch(t){return}}function v(e,t){try{localStorage.setItem(y+e,t)}catch(s){}}},8526:(e,t,s)=>{"use strict";s.r(t),s.d(t,{PeertubePlayerManager:()=>be,videojs:()=>n()}),s(3059);var i=s(3654),n=s.n(i);const o=n().getComponent("Component");n().registerComponent("EndCard",class extends o{constructor(e,t){super(e,t),this.dashOffsetTotal=586,this.dashOffsetStart=293,this.interval=50,this.upNextEvents=new(n().EventTarget),this.ticks=0,this.totalTicks=this.options_.timeout/this.interval,e.on("ended",(t=>{this.options_.condition()&&(e.addClass("vjs-upnext--showing"),this.showCard((t=>{e.removeClass("vjs-upnext--showing"),this.container.style.display="none",t||this.options_.next()})))})),e.on("playing",(()=>{this.upNextEvents.trigger("playing")}))}createEl(){const e=super.createEl("div",{className:"vjs-upnext-content",innerHTML:(t=this.options_,`\n    <div class="vjs-upnext-top">\n      <span class="vjs-upnext-headtext">${t.headText}</span>\n      <div class="vjs-upnext-title"></div>\n    </div>\n    <div class="vjs-upnext-autoplay-icon">\n      <svg height="100%" version="1.1" viewbox="0 0 98 98" width="100%">\n        <circle class="vjs-upnext-svg-autoplay-circle" cx="49" cy="49" fill="#000" fill-opacity="0.8" r="48"></circle>\n        <circle class="vjs-upnext-svg-autoplay-ring" cx="-49" cy="49" fill-opacity="0" r="46.5"\n                stroke="#FFFFFF" stroke-width="4" transform="rotate(-90)"\n        ></circle>\n        <polygon class="vjs-upnext-svg-autoplay-triangle" fill="#fff" points="32,27 72,49 32,71"></polygon></svg>\n    </div>\n    <span class="vjs-upnext-bottom">\n      <span class="vjs-upnext-cancel">\n        <button class="vjs-upnext-cancel-button" tabindex="0" aria-label="Cancel autoplay">${t.cancelText}</button>\n      </span>\n      <span class="vjs-upnext-suspended">${t.suspendedText}</span>\n    </span>\n  `)});var t;return this.container=e,e.style.display="none",this.autoplayRing=e.getElementsByClassName("vjs-upnext-svg-autoplay-ring")[0],this.title=e.getElementsByClassName("vjs-upnext-title")[0],this.cancelButton=e.getElementsByClassName("vjs-upnext-cancel-button")[0],this.suspendedMessage=e.getElementsByClassName("vjs-upnext-suspended")[0],this.nextButton=e.getElementsByClassName("vjs-upnext-autoplay-icon")[0],this.cancelButton.onclick=()=>{this.upNextEvents.trigger("cancel")},this.nextButton.onclick=()=>{this.upNextEvents.trigger("next")},e}showCard(e){let t;this.autoplayRing.setAttribute("stroke-dasharray",`${this.dashOffsetStart}`),this.autoplayRing.setAttribute("stroke-dashoffset",""+-this.dashOffsetStart),this.title.innerHTML=this.options_.getTitle(),this.upNextEvents.one("cancel",(()=>{clearTimeout(t),e(!0)})),this.upNextEvents.one("playing",(()=>{clearTimeout(t),e(!0)})),this.upNextEvents.one("next",(()=>{clearTimeout(t),e(!1)}));const s=e=>{const t=Math.max(-this.dashOffsetTotal,-this.dashOffsetStart-e*this.dashOffsetTotal/2/100);this.autoplayRing.setAttribute("stroke-dashoffset",""+t)},i=()=>{s(100*this.ticks++/this.totalTicks)},n=()=>{this.options_.suspended()?(this.suspendedMessage.innerText=this.options_.suspendedText,s(0),this.ticks=0,t=setTimeout(n.bind(this),300)):this.ticks>=this.totalTicks?(clearTimeout(t),e(!1)):(this.suspendedMessage.innerText="",i(),t=setTimeout(n.bind(this),this.interval))};this.container.style.display="block",t=setTimeout(n.bind(this),this.interval)}});const a=n().getPlugin("plugin");n().registerPlugin("upnext",class extends a{constructor(e,t={}){const s={next:t.next,getTitle:t.getTitle,timeout:t.timeout||5e3,cancelText:t.cancelText||"Cancel",headText:t.headText||"Up Next",suspendedText:t.suspendedText||"Autoplay is suspended",condition:t.condition,suspended:t.suspended};super(e),this.player.ready((()=>{e.addClass("vjs-upnext")})),e.addChild("EndCard",s)}});var l=s(5168),r=s(2088),d=s(6939);const u=n().getComponent("Component");class h extends u{constructor(){super(...arguments),this.metadataStore={},this.intervalMs=300,this.playerNetworkInfo={}}createEl(){this.containerEl=n().dom.createEl("div",{className:"vjs-stats-content"}),this.containerEl.style.display="none",this.infoListEl=n().dom.createEl("div",{className:"vjs-stats-list"});const e=n().dom.createEl("button",{className:"vjs-stats-close",tabindex:"0",title:"Close stats",innerText:"[x]"},{"aria-label":"Close stats"});return e.onclick=()=>this.hide(),this.containerEl.appendChild(e),this.containerEl.appendChild(this.infoListEl),this.populateInfoBlocks(),this.player_.on("p2pInfo",((e,t)=>{if(!t)return;this.mode=t.source;const s=t.p2p,i=t.http;this.playerNetworkInfo.downloadSpeed=(0,d.aI)(s.downloadSpeed+i.downloadSpeed).join(" "),this.playerNetworkInfo.uploadSpeed=(0,d.aI)(s.uploadSpeed+i.uploadSpeed).join(" "),this.playerNetworkInfo.totalDownloaded=(0,d.aI)(s.downloaded+i.downloaded).join(" "),this.playerNetworkInfo.totalUploaded=(0,d.aI)(s.uploaded+i.uploaded).join(" "),this.playerNetworkInfo.numPeers=s.numPeers,this.playerNetworkInfo.averageBandwidth=(0,d.aI)(t.bandwidthEstimate).join(" ")+"/s","p2p-media-loader"===t.source&&(this.playerNetworkInfo.downloadedFromServer=(0,d.aI)(i.downloaded).join(" "),this.playerNetworkInfo.downloadedFromPeers=(0,d.aI)(s.downloaded).join(" "))})),this.containerEl}toggle(){this.updateInterval?this.hide():this.show()}show(){this.containerEl.style.display="block",this.updateInterval=setInterval((async()=>{try{const e="p2p-media-loader"===this.mode?this.buildHLSOptions():await this.buildWebTorrentOptions();this.populateInfoValues(e)}catch(e){l.k.error("Cannot update stats.",e),clearInterval(this.updateInterval)}}),this.intervalMs)}hide(){clearInterval(this.updateInterval),this.containerEl.style.display="none"}buildHLSOptions(){const e=this.player_.p2pMediaLoader(),t=e.getCurrentLevel(),s=(null==t?void 0:t.videoCodec)||(null==t?void 0:t.audioCodec)?`${(null==t?void 0:t.videoCodec)||""} / ${(null==t?void 0:t.audioCodec)||""}`:void 0,i=`${null==t?void 0:t.height}p${(null==t?void 0:t.attrs["FRAME-RATE"])||""}`,n=this.timeRangesToString(this.player().buffered());let o,a;return this.options_.videoIsLive?a=(0,r.nH)(e.getLiveLatency()):o=this.player().bufferedPercent(),{playerNetworkInfo:this.playerNetworkInfo,resolution:i,codecs:s,buffer:n,latency:a,progress:o}}async buildWebTorrentOptions(){var e;const t=this.player_.webtorrent().getCurrentVideoFile();this.metadataStore[t.fileUrl]||(this.metadataStore[t.fileUrl]=await fetch(t.metadataUrl).then((e=>e.json())));const s=this.metadataStore[t.fileUrl];let i="unknown",n="unknown";if(null==s?void 0:s.streams[0]){const e=s.streams[0];i="unknown"!==e.color_space?e.color_space:"bt709",n=e.codec_name||"avc1"}const o=(null==t?void 0:t.resolution.label)+(null==t?void 0:t.fps),a=this.timeRangesToString(this.player().buffered()),l=null===(e=this.player_.webtorrent().getTorrent())||void 0===e?void 0:e.progress;return{playerNetworkInfo:this.playerNetworkInfo,progress:l,colorSpace:i,codecs:n,resolution:o,buffer:a}}populateInfoBlocks(){this.playerMode=this.buildInfoRow(this.player().localize("Player mode")),this.p2p=this.buildInfoRow(this.player().localize("P2P")),this.uuid=this.buildInfoRow(this.player().localize("Video UUID")),this.viewport=this.buildInfoRow(this.player().localize("Viewport / Frames")),this.resolution=this.buildInfoRow(this.player().localize("Resolution")),this.volume=this.buildInfoRow(this.player().localize("Volume")),this.codecs=this.buildInfoRow(this.player().localize("Codecs")),this.color=this.buildInfoRow(this.player().localize("Color")),this.connection=this.buildInfoRow(this.player().localize("Connection Speed")),this.network=this.buildInfoRow(this.player().localize("Network Activity")),this.transferred=this.buildInfoRow(this.player().localize("Total Transfered")),this.download=this.buildInfoRow(this.player().localize("Download Breakdown")),this.bufferProgress=this.buildInfoRow(this.player().localize("Buffer Progress")),this.bufferState=this.buildInfoRow(this.player().localize("Buffer State")),this.liveLatency=this.buildInfoRow(this.player().localize("Live Latency")),this.infoListEl.appendChild(this.playerMode.root),this.infoListEl.appendChild(this.p2p.root),this.infoListEl.appendChild(this.uuid.root),this.infoListEl.appendChild(this.viewport.root),this.infoListEl.appendChild(this.resolution.root),this.infoListEl.appendChild(this.volume.root),this.infoListEl.appendChild(this.codecs.root),this.infoListEl.appendChild(this.color.root),this.infoListEl.appendChild(this.connection.root),this.infoListEl.appendChild(this.network.root),this.infoListEl.appendChild(this.transferred.root),this.infoListEl.appendChild(this.download.root),this.infoListEl.appendChild(this.bufferProgress.root),this.infoListEl.appendChild(this.bufferState.root),this.infoListEl.appendChild(this.liveLatency.root)}populateInfoValues(e){const{playerNetworkInfo:t,progress:s,colorSpace:i,codecs:n,resolution:o,buffer:a,latency:l}=e,r=this.player(),d=r.getVideoPlaybackQuality(),u=`${Math.max(document.documentElement.clientWidth||0,window.innerWidth||0)}x${Math.max(document.documentElement.clientHeight||0,window.innerHeight||0)}*${(window.devicePixelRatio||1).toFixed(2)} / ${d.droppedVideoFrames} dropped of ${d.totalVideoFrames}`,h=r.duration();let c=`${Math.round(100*r.volume())}`;r.muted()&&(c+=" (muted)");const p=t.downloadSpeed?`${t.downloadSpeed} &dArr; / ${t.uploadSpeed} &uArr;`:void 0,m=t.totalDownloaded?`${t.totalDownloaded} &dArr; / ${t.totalUploaded} &uArr;`:void 0,y=t.downloadedFromServer?`${t.downloadedFromServer} from servers \xb7 ${t.downloadedFromPeers} from peers`:void 0,g=void 0!==s?`${(100*s).toFixed(1)}% (${(s*h).toFixed(1)}s)`:void 0;this.setInfoValue(this.playerMode,this.mode||"HTTP"),this.setInfoValue(this.p2p,r.localize(this.options_.p2pEnabled?"enabled":"disabled")),this.setInfoValue(this.uuid,this.options_.videoUUID),this.setInfoValue(this.viewport,u),this.setInfoValue(this.resolution,o),this.setInfoValue(this.volume,c),this.setInfoValue(this.codecs,n),this.setInfoValue(this.color,i),this.setInfoValue(this.connection,t.averageBandwidth),this.setInfoValue(this.network,p),this.setInfoValue(this.transferred,m),this.setInfoValue(this.download,y),this.setInfoValue(this.bufferProgress,g),this.setInfoValue(this.bufferState,a),this.setInfoValue(this.liveLatency,l)}setInfoValue(e,t){t?(e.root.style.display="block",e.value.innerHTML!==t&&(e.value.innerHTML=t)):e.root.style.display="none"}buildInfoRow(e,t){const s=n().dom.createEl("div");s.style.display="none";const i=n().dom.createEl("div",{innerText:e}),o=n().dom.createEl("span",{innerHTML:t});return s.appendChild(i),s.appendChild(o),{root:s,value:o}}timeRangesToString(e){let t="";for(let s=0;s<e.length;s++){const i=Math.floor(e.start(s)),n=Math.floor(e.end(s));t+=`[${(0,r.nH)(i)}, ${(0,r.nH)(n)}] `}return t}}n().registerComponent("StatsCard",h);const c=n().getPlugin("plugin");n().registerPlugin("stats",class extends c{constructor(e,t){const s=Object.assign({},t);super(e),this.player.ready((()=>{e.addClass("vjs-stats-for-nerds")})),this.statsCard=new h(e,t),e.addChild(this.statsCard,s)}show(){this.statsCard.show()}});var p=s(327);const m=n().getComponent("Component");n().registerComponent("PauseBezel",class extends m{constructor(e,t){super(e,t),(0,p.tq)()||(e.on("pause",(t=>{e.seeking()||e.ended()||(this.container.innerHTML='\n  <div class="vjs-bezels-pause">\n    <div class="vjs-bezel" role="status" aria-label="Pause">\n      <div class="vjs-bezel-icon">\n        <svg height="100%" version="1.1" viewBox="0 0 36 36" width="100%">\n          <use class="vjs-svg-shadow" xlink:href="#vjs-id-1"></use>\n          <path class="vjs-svg-fill" d="M 12,26 16,26 16,10 12,10 z M 21,26 25,26 25,10 21,10 z" id="vjs-id-1"></path>\n        </svg>\n      </div>\n    </div>\n  </div>\n  ',this.showBezel())})),e.on("play",(t=>{e.seeking()||(this.container.innerHTML='\n  <div class="vjs-bezels-play">\n    <div class="vjs-bezel" role="status" aria-label="Play">\n      <div class="vjs-bezel-icon">\n        <svg height="100%" version="1.1" viewBox="0 0 36 36" width="100%">\n          <use class="vjs-svg-shadow" xlink:href="#vjs-id-2"></use>\n          <path class="vjs-svg-fill" d="M 12,26 18.5,22 18.5,14 12,10 z M 18.5,22 25,18 25,18 18.5,14 z" id="ytp-id-2"></path>\n        </svg>\n      </div>\n    </div>\n  </div>\n  ',this.showBezel())})))}createEl(){return this.container=super.createEl("div",{className:"vjs-bezels-content"}),this.container.style.display="none",this.container}showBezel(){this.container.style.display="inherit",setTimeout((()=>{this.container.style.display="none"}),500)}});const y=n().getPlugin("plugin");n().registerPlugin("bezels",class extends y{constructor(e,t){super(e),this.player.ready((()=>{e.addClass("vjs-bezels")})),e.addChild("PauseBezel",t)}});var g=s(7642),v=s.n(g),b=s(4093);const f=v()("peertube:player:peertube"),C=n().getPlugin("plugin");n().registerPlugin("peertube",class extends C{constructor(e,t){super(e),this.CONSTANTS={USER_VIEW_VIDEO_INTERVAL:5e3},this.menuOpened=!1,this.mouseInControlBar=!1,this.mouseInSettings=!1,this.videoViewUrl=t.videoViewUrl,this.authorizationHeader=t.authorizationHeader,this.videoUUID=t.videoUUID,this.startTime=(0,r.h8)(t.startTime),this.initialInactivityTimeout=this.player.options_.inactivityTimeout,t.autoplay&&this.player.addClass("vjs-has-autoplay"),this.player.on("autoplay-failure",(()=>{this.player.removeClass("vjs-has-autoplay")})),this.player.ready((()=>{const e=this.player.options_,s=(0,b.OV)();void 0!==s&&this.player.volume(s);const i=void 0!==e.muted?e.muted:(0,b.W7)();if(void 0!==i&&this.player.muted(i),this.defaultSubtitle=t.subtitle||(0,b.pW)(),this.player.on("volumechange",(()=>{(0,b.ao)(this.player.volume()),(0,b.ZC)(this.player.muted())})),t.stopTime){const e=(0,r.h8)(t.stopTime),s=this;this.player.on("timeupdate",(function t(){s.player.currentTime()>e&&(s.player.pause(),s.player.trigger("stopped"),s.player.off("timeupdate",t))}))}this.player.textTracks().addEventListener("change",(()=>{const e=this.player.textTracks().tracks_.find((e=>"captions"===e.kind&&"showing"===e.mode));(0,b.v_)(e?e.language:"off")})),this.player.duration(t.videoDuration),this.initializePlayer(),this.runUserViewing()}))}dispose(){this.videoViewInterval&&clearInterval(this.videoViewInterval)}onMenuOpened(){this.menuOpened=!0,this.alterInactivity()}onMenuClosed(){this.menuOpened=!1,this.alterInactivity()}displayFatalError(){this.player.addClass("vjs-error-display-enabled")}hideFatalError(){this.player.removeClass("vjs-error-display-enabled")}initializePlayer(){(0,p.tq)()&&this.player.addClass("vjs-is-mobile"),this.initSmoothProgressBar(),this.listenControlBarMouse(),this.listenFullScreenChange()}runUserViewing(){let e,t=this.startTime;this.player.one("play",(()=>{this.notifyUserIsWatching(this.startTime,e)})),this.player.on("seeked",(()=>{Math.abs(this.player.currentTime()-t)<3||(e="seek")})),this.player.one("ended",(()=>{const s=Math.round(this.player.duration());t=s,this.notifyUserIsWatching(s,e),e=void 0})),this.videoViewInterval=setInterval((()=>{const s=Math.round(this.player.currentTime());s!==t&&(t=s,this.notifyUserIsWatching(s,e).catch((e=>l.k.error("Cannot notify user is watching.",e))),e=void 0,this.authorizationHeader||(0,b.Pz)(this.videoUUID,s))}),this.CONSTANTS.USER_VIEW_VIDEO_INTERVAL)}notifyUserIsWatching(e,t){if(!this.videoViewUrl)return Promise.resolve(void 0);const s={currentTime:e,viewEvent:t},i=new Headers({"Content-type":"application/json; charset=UTF-8"});return this.authorizationHeader&&i.set("Authorization",this.authorizationHeader),fetch(this.videoViewUrl,{method:"POST",body:JSON.stringify(s),headers:i}).catch((e=>Promise.resolve()))}listenFullScreenChange(){this.player.on("fullscreenchange",(()=>{this.player.isFullscreen()&&this.player.focus()}))}listenControlBarMouse(){const e=this.player.controlBar,t=e.settingsButton;e.on("mouseenter",(()=>{this.mouseInControlBar=!0,this.alterInactivity()})),e.on("mouseleave",(()=>{this.mouseInControlBar=!1,this.alterInactivity()})),t.dialog.on("mouseenter",(()=>{this.mouseInSettings=!0,this.alterInactivity()})),t.dialog.on("mouseleave",(()=>{this.mouseInSettings=!1,this.alterInactivity()}))}alterInactivity(){this.menuOpened||this.mouseInSettings||this.mouseInControlBar?this.setInactivityTimeout(0):(this.setInactivityTimeout(this.initialInactivityTimeout),this.player.reportUserActivity(!0))}setInactivityTimeout(e){this.player.cache_.inactivityTimeout=e,this.player.options_.inactivityTimeout=e,f("Set player inactivity to "+e)}initSmoothProgressBar(){const e=n().getComponent("SeekBar");e.prototype.getPercent=function(){const e=this.player_.currentTime()/this.player_.duration();return e>=1?1:e},e.prototype.handleMouseMove=function(e){let t=this.calculateDistance(e)*this.player_.duration();t===this.player_.duration()&&(t-=.1),this.player_.currentTime(t),this.update()}}});const E=n().getPlugin("plugin");n().registerPlugin("peertubeResolutions",class extends E{constructor(){super(...arguments),this.resolutions=[],this.autoResolutionEnabled=!0}add(e){for(const t of e)this.resolutions.push(t);this.currentSelection=this.getSelected(),this.sort(),this.trigger("resolutionsAdded")}getResolutions(){return this.resolutions}getSelected(){return this.resolutions.find((e=>e.selected))}getAutoResolutionChosen(){return this.resolutions.find((e=>e.id===this.autoResolutionChosenId))}select(e){var t;const{id:s,autoResolutionChosenId:i,byEngine:n}=e;if((null===(t=this.currentSelection)||void 0===t?void 0:t.id)!==s||this.autoResolutionChosenId!==i){this.autoResolutionChosenId=i;for(const e of this.resolutions)e.selected=e.id===s,e.selected&&(this.currentSelection=e,n||e.selectCallback());this.trigger("resolutionChanged")}}disableAutoResolution(){this.autoResolutionEnabled=!1,this.trigger("autoResolutionEnabledChanged")}enabledAutoResolution(){this.autoResolutionEnabled=!0,this.trigger("autoResolutionEnabledChanged")}isAutoResolutionEnabeld(){return this.autoResolutionEnabled}sort(){this.resolutions.sort(((e,t)=>-1===e.id?1:-1===t.id||e.height>t.height?-1:e.height===t.height?0:1))}});const w=n().getComponent("Button");class T extends w{constructor(e,t){super(e,t),this.nextPreviousVideoButtonOptions=t,this.update()}createEl(){const e=this.options_.type,t=n().dom.createEl("button",{className:"vjs-"+e+"-video"}),s=n().dom.createEl("span",{className:"icon icon-"+e});return t.appendChild(s),t.title=this.player_.localize("next"===e?"Next video":"Previous video"),t}handleClick(){this.nextPreviousVideoButtonOptions.handler()}update(){this.nextPreviousVideoButtonOptions.isDisabled()?this.addClass("vjs-disabled"):this.removeClass("vjs-disabled")}}n().registerComponent("NextVideoButton",T),n().registerComponent("PreviousVideoButton",T);const S=n().getComponent("Button");n().registerComponent("P2PInfoButton",class extends S{constructor(e,t){super(e,t)}createEl(){const e=n().dom.createEl("div",{className:"vjs-peertube"}),t=n().dom.createEl("div",{className:"vjs-peertube-hidden"});if(e.appendChild(t),!this.options_.p2pEnabled)return e;const s=n().dom.createEl("span",{className:"icon icon-download"});t.appendChild(s);const i=n().dom.createEl("span",{className:"download-speed-text"}),o=n().dom.createEl("span",{className:"download-speed-number"}),a=n().dom.createEl("span");i.appendChild(o),i.appendChild(a),t.appendChild(i);const l=n().dom.createEl("span",{className:"icon icon-upload"});t.appendChild(l);const r=n().dom.createEl("span",{className:"upload-speed-text"}),u=n().dom.createEl("span",{className:"upload-speed-number"}),h=n().dom.createEl("span");r.appendChild(u),r.appendChild(h),t.appendChild(r);const c=n().dom.createEl("span",{className:"peers-text"}),p=n().dom.createEl("span",{className:"peers-number"});t.appendChild(p),t.appendChild(c);const m=n().dom.createEl("div",{className:"vjs-peertube-hidden"}),y=n().dom.createEl("span",{className:"http-fallback",textContent:"HTTP"});return m.appendChild(y),e.appendChild(m),this.player_.on("p2pInfo",((e,s)=>{if(!s)return m.className="vjs-peertube-displayed",void(t.className="vjs-peertube-hidden");const i=s.p2p,n=s.http,l=(0,d.aI)(i.downloadSpeed+n.downloadSpeed),r=(0,d.aI)(i.uploadSpeed+n.uploadSpeed),y=(0,d.aI)(i.downloaded+n.downloaded),g=(0,d.aI)(i.uploaded+n.uploaded),v=i.numPeers;if(t.title=this.player().localize("Total downloaded: ")+y.join(" ")+"\n","p2p-media-loader"===s.source){const e=(0,d.aI)(n.downloaded).join(" "),s=(0,d.aI)(i.downloaded).join(" ");t.title+=" * "+this.player().localize("From servers: ")+e+"\n * "+this.player().localize("From peers: ")+s+"\n"}t.title+=this.player().localize("Total uploaded: ")+g.join(" "),o.textContent=l[0],a.textContent=" "+l[1],u.textContent=r[0],h.textContent=" "+r[1],p.textContent=v.toString(),c.textContent=" "+(v>1?this.player().localize("peers"):this.player_.localize("peer")),m.className="vjs-peertube-hidden",t.className="vjs-peertube-displayed"})),e}}),n().getComponent("Button");const k=n().getComponent("MenuButton");n().registerComponent("PictureInPictureBastyon",class extends k{constructor(e,t){super(e,t),this.controlText("Mini Player")}createEl(){return this.buildElement()}handleClick(e){this.player_.trigger("pictureInPictureRequest",e)}buildElement(){const e=super.createEl();return e.classList.add("vjs-picture-in-picture-control"),e}});const M=n().getComponent("Component");M.registerComponent("PeerTubeLoadProgressBar",class extends M{constructor(e,t){super(e,t),this.on(e,"progress",this.update)}createEl(){return super.createEl("div",{className:"vjs-load-progress",innerHTML:`<span class="vjs-control-text"><span>${this.localize("Loaded")}</span>: 0%</span>`})}dispose(){super.dispose()}update(){const e=this.player().webtorrent().getTorrent();e&&(this.el().style["transform-origin"]="left"(this.el()).style.transform="scaleX("+e.progress.toFixed(2)+")")}});const I=n().getComponent("Button");class x extends I{constructor(e,t){super(e,t);const s=(0,b.y_)();!0===s&&(this.player().addClass(x.THEATER_MODE_CLASS),this.handleTheaterChange()),this.controlText("Theater mode"),this.player().theaterEnabled=s}buildCSSClass(){return`vjs-theater-control ${super.buildCSSClass()}`}handleTheaterChange(){const e=this.isTheaterEnabled();this.controlText(e?"Normal mode":"Theater mode"),(0,b.AO)(e),this.player_.trigger("theaterChange",e)}handleClick(){this.player_.toggleClass(x.THEATER_MODE_CLASS),this.handleTheaterChange()}isTheaterEnabled(){return this.player_.hasClass(x.THEATER_MODE_CLASS)}}x.THEATER_MODE_CLASS="vjs-theater-enabled",n().registerComponent("TheaterButton",x);const P=n().getComponent("MenuItem");class j extends P{constructor(e,t){t.selectable=!0,super(e,t),this.autoResolutionEnabled=!0,this.autoResolutionChosen="",this.resolutionId=t.resolutionId,this.label=t.label,e.peertubeResolutions().on("resolutionChanged",(()=>this.updateSelection())),-1===this.resolutionId&&e.peertubeResolutions().on("autoResolutionEnabledChanged",(()=>this.updateAutoResolution()))}handleClick(e){!1===this.autoResolutionEnabled&&-1===this.resolutionId||(super.handleClick(e),this.player().peertubeResolutions().select({id:this.resolutionId,byEngine:!1}))}updateSelection(){var e;const t=this.player().peertubeResolutions().getSelected();-1===this.resolutionId&&(this.autoResolutionChosen=null===(e=this.player().peertubeResolutions().getAutoResolutionChosen())||void 0===e?void 0:e.label),this.selected(this.resolutionId===t.id)}updateAutoResolution(){const e=this.player().peertubeResolutions().isAutoResolutionEnabeld();!1===e?this.addClass("disabled"):this.removeClass("disabled"),this.autoResolutionEnabled=e}getLabel(){return-1===this.resolutionId?this.label+" <small>"+this.autoResolutionChosen+"</small>":this.label}}n().registerComponent("ResolutionMenuItem",j);const L=n().getComponent("Menu"),_=n().getComponent("MenuButton");n().registerComponent("ResolutionMenuButton",class extends _{constructor(e,t){super(e,t),this.controlText("Quality"),e.peertubeResolutions().on("resolutionsAdded",(()=>this.buildQualities())),e.peertubeResolutions().on("resolutionChanged",(()=>{setTimeout((()=>this.trigger("labelUpdated")))}))}createEl(){const e=super.createEl();return this.labelEl_=n().dom.createEl("div",{className:"vjs-resolution-value"}),e.appendChild(this.labelEl_),e}updateARIAAttributes(){this.el().setAttribute("aria-label","Quality")}createMenu(){return new L(this.player_)}buildCSSClass(){return super.buildCSSClass()+" vjs-resolution-button"}buildWrapperCSSClass(){return"vjs-resolution-control "+super.buildWrapperCSSClass()}addClickListener(e){e.on("click",(()=>{const t=this.menu.children();for(const s of t)e!==s&&s.selected(!1)}))}buildQualities(){for(const e of this.player().peertubeResolutions().getResolutions()){const t="0p"===e.label?this.player().localize("Audio-only"):e.label;this.menu.addChild(new j(this.player_,{id:e.id+"",resolutionId:e.id,label:t,selected:e.selected}))}for(const e of this.menu.children())this.addClickListener(e);this.trigger("menuChanged")}});const N=n().getComponent("Component");N.registerComponent("SettingsDialog",class extends N{constructor(e){super(e),this.hide()}createEl(){const e=this.id();return super.createEl("div",{className:"vjs-settings-dialog vjs-modal-overlay",innerHTML:"",tabIndex:-1},{role:"dialog","aria-labelledby":"TTsettingsDialogLabel-"+e,"aria-describedby":"TTsettingsDialogDescription-"+e})}});const R=n().getComponent("MenuItem"),B=n().getComponent("Component");class O extends R{constructor(e,t){super(e,t),this.settingsButton=t.menuButton,this.dialog=this.settingsButton.dialog,this.mainMenu=this.settingsButton.menu,this.panel=this.dialog.getChild("settingsPanel"),this.panelChild=this.panel.getChild("settingsPanelChild"),this.panelChildEl=this.panelChild.el(),this.size=null,this.menuToLoad="mainmenu";const s=(0,d.LF)(t.entry),i=n().getComponent(s);if(!i)throw new Error(`Component ${s} does not exist`);const o=Object.assign({},t,{entry:t.menuButton,menuButton:this});this.subMenu=new i(this.player(),o);const a=this.subMenu.buildCSSClass().split(" ")[0];this.settingsSubMenuEl_.className+=" "+a,this.eventHandlers(),e.ready((()=>{setTimeout((()=>{this.player_&&(this.build(),e.on("ratechange",this.submenuClickHandler),"CaptionsButton"===s&&e.on("captionsChanged",(()=>{setTimeout((()=>{this.settingsSubMenuEl_.innerHTML="",this.settingsSubMenuEl_.appendChild(this.subMenu.menu.el()),this.update(),this.bindClickEvents()}),0)})),this.reset())}),0)}))}eventHandlers(){this.submenuClickHandler=this.onSubmenuClick.bind(this),this.transitionEndHandler=this.onTransitionEnd.bind(this)}onSubmenuClick(e){let t=null;t="tap"===e.type?e.target:e.currentTarget||e.target,(null==t?void 0:t.classList.contains("vjs-back-button"))?this.loadMainMenu():(setTimeout((()=>this.update(e)),0),this.subMenu.menu.removeClass("vjs-hidden"))}createEl(){const e=n().dom.createEl("li",{className:"vjs-menu-item",tabIndex:-1});return this.settingsSubMenuTitleEl_=n().dom.createEl("div",{className:"vjs-settings-sub-menu-title"}),e.appendChild(this.settingsSubMenuTitleEl_),this.settingsSubMenuValueEl_=n().dom.createEl("div",{className:"vjs-settings-sub-menu-value"}),e.appendChild(this.settingsSubMenuValueEl_),this.settingsSubMenuEl_=n().dom.createEl("div",{className:"vjs-settings-sub-menu"}),e}handleClick(e){if(this.menuToLoad="submenu",n().dom.removeClass(this.el(),"open"),super.handleClick(e),this.mainMenu.el().style.opacity="0",n().dom.hasClass(this.settingsSubMenuEl_,"vjs-hidden")){n().dom.removeClass(this.settingsSubMenuEl_,"vjs-hidden"),setTimeout((()=>{this.settingsSubMenuEl_.style.opacity="1",this.settingsSubMenuEl_.style.marginRight="0px"}),0),this.settingsButton.setDialogSize(this.size);const e=this.subMenu.menu.children()[0];e&&e.focus()}else n().dom.addClass(this.settingsSubMenuEl_,"vjs-hidden")}createBackButton(){const e=this.subMenu.menu.addChild("MenuItem",{},0);e.addClass("vjs-back-button"),e.el().innerHTML=this.player().localize(this.subMenu.controlText())}PrefixedEvent(e,t,s,i="addEvent"){const n=["webkit","moz","MS","o",""];for(let o=0;o<n.length;o++)n[o]||(t=t.toLowerCase()),"addEvent"===i?e.addEventListener(n[o]+t,s,!1):"removeEvent"===i&&e.removeEventListener(n[o]+t,s,!1)}onTransitionEnd(e){"margin-right"===e.propertyName&&"mainmenu"===this.menuToLoad&&(n().dom.addClass(this.settingsSubMenuEl_,"vjs-hidden"),this.settingsSubMenuEl_.style.opacity="0")}reset(){n().dom.addClass(this.settingsSubMenuEl_,"vjs-hidden"),this.settingsSubMenuEl_.style.opacity="0",this.setMargin()}loadMainMenu(){const e=this.mainMenu.el();this.menuToLoad="mainmenu",this.mainMenu.show(),e.style.opacity="0";const t=this.mainMenu;this.settingsButton.setDialogSize([t.width,t.height]),setTimeout((()=>{this.setMargin(),e.style.opacity="1";const t=this.mainMenu.children()[0];t&&t.focus()}),0)}build(){this.subMenu.on("labelUpdated",(()=>{this.update()})),this.subMenu.on("menuChanged",(()=>{this.bindClickEvents(),this.setSize(),this.update()})),this.settingsSubMenuTitleEl_.innerHTML=this.player().localize(this.subMenu.controlText()),this.settingsSubMenuEl_.appendChild(this.subMenu.menu.el()),this.panelChildEl.appendChild(this.settingsSubMenuEl_),this.update(),this.createBackButton(),this.setSize(),this.bindClickEvents(),this.PrefixedEvent(this.settingsSubMenuEl_,"TransitionEnd",this.transitionEndHandler,"addEvent")}update(e){let t=null;const s=this.subMenu.name();if(e&&"tap"===e.type?t=e.target:e&&(t=e.currentTarget),"PlaybackRateMenuButton"===s){const e=this.subMenu.labelEl_.innerHTML;setTimeout((()=>{this.settingsSubMenuValueEl_.innerHTML=e}),250)}else for(const i of this.subMenu.menu.children_)if(i instanceof B&&i.hasClass("vjs-selected")){const e=i;if("function"==typeof e.getLabel){this.settingsSubMenuValueEl_.innerHTML=e.getLabel();break}this.settingsSubMenuValueEl_.innerHTML=this.player().localize(e.options_.label)}t&&!t.classList.contains("vjs-back-button")&&this.settingsButton.hideDialog()}bindClickEvents(){for(const e of this.subMenu.menu.children())e instanceof B&&e.on(["tap","click"],this.submenuClickHandler)}setSize(){this.dialog.removeClass("vjs-hidden"),n().dom.removeClass(this.settingsSubMenuEl_,"vjs-hidden"),this.size=this.settingsButton.getComponentSize(this.settingsSubMenuEl_),this.setMargin(),this.dialog.addClass("vjs-hidden"),n().dom.addClass(this.settingsSubMenuEl_,"vjs-hidden")}setMargin(){if(!this.size)return;const[e]=this.size;this.settingsSubMenuEl_.style.marginRight=`-${e}px`}hideSubMenu(){this.el()&&n().dom.hasClass(this.el(),"open")&&(n().dom.addClass(this.settingsSubMenuEl_,"vjs-hidden"),n().dom.removeClass(this.el(),"open"))}}O.prototype.contentElType="button",n().registerComponent("SettingsMenuItem",O);const H=n().getComponent("Button"),D=n().getComponent("Menu"),A=n().getComponent("Component");A.registerComponent("SettingsButton",class extends H{constructor(e,t){super(e,t),this.settingsButtonOptions=t,this.controlText("Settings"),this.dialog=this.player().addChild("settingsDialog"),this.dialogEl=this.dialog.el(),this.menu=null,this.panel=this.dialog.addChild("settingsPanel"),this.panelChild=this.panel.addChild("settingsPanelChild"),this.addClass("vjs-settings"),this.el().setAttribute("aria-label","Settings Button"),this.addSettingsItemHandler=this.onAddSettingsItem.bind(this),this.disposeSettingsItemHandler=this.onDisposeSettingsItem.bind(this),this.documentClickHandler=this.onDocumentClick.bind(this),this.userInactiveHandler=this.onUserInactive.bind(this),this.buildMenu(),this.bindEvents(),this.player().one("play",(()=>this.hideDialog()))}onDocumentClick(e){var t,s,i;const n=e.target;(null===(t=null==n?void 0:n.classList)||void 0===t?void 0:t.contains("vjs-settings"))||(null===(i=null===(s=null==n?void 0:n.parentElement)||void 0===s?void 0:s.classList)||void 0===i?void 0:i.contains("vjs-settings"))||this.dialog.hasClass("vjs-hidden")||this.hideDialog()}onDisposeSettingsItem(e,t){if(void 0===t){const e=this.menu.children();for(;e.length>0;)e[0].dispose(),this.menu.removeChild(e[0]);this.addClass("vjs-hidden")}else{const e=this.menu.getChild(t);e&&(e.dispose(),this.menu.removeChild(e))}this.hideDialog(),0===this.settingsButtonOptions.entries.length&&this.addClass("vjs-hidden")}dispose(){document.removeEventListener("click",this.documentClickHandler),this.isInIframe()&&window.removeEventListener("blur",this.documentClickHandler)}onAddSettingsItem(e,t){const[s,i]=t;this.addMenuItem(s,i),this.removeClass("vjs-hidden")}onUserInactive(){this.dialog.hasClass("vjs-hidden")||this.hideDialog()}bindEvents(){document.addEventListener("click",this.documentClickHandler),this.isInIframe()&&window.addEventListener("blur",this.documentClickHandler),this.player().on("addsettingsitem",this.addSettingsItemHandler),this.player().on("disposesettingsitem",this.disposeSettingsItemHandler),this.player().on("userinactive",this.userInactiveHandler)}buildCSSClass(){return`vjs-icon-settings ${super.buildCSSClass()}`}handleClick(){this.dialog.hasClass("vjs-hidden")?this.showDialog():this.hideDialog()}showDialog(){this.player().peertube().onMenuOpened(),this.menu.el().style.opacity="1",this.dialog.show(),this.el().setAttribute("aria-expanded","true"),this.setDialogSize(this.getComponentSize(this.menu));const e=this.menu.children()[0];e&&e.focus()}hideDialog(){this.player_.peertube().onMenuClosed(),this.dialog.hide(),this.el().setAttribute("aria-expanded","false"),this.setDialogSize(this.getComponentSize(this.menu)),this.menu.el().style.opacity="1",this.resetChildren()}getComponentSize(e){let t=null,s=null;if(e instanceof A){const i=e.el();t=i.offsetWidth,s=i.offsetHeight,e.width=t,e.height=s}else t=e.offsetWidth,s=e.offsetHeight;return[t,s]}setDialogSize([e,t]){if("number"!=typeof t)return;const s=this.settingsButtonOptions.setup.maxHeightOffset,i=this.player().el().offsetHeight-s,n=this.panel.el();t>i?(e+=17,n.style.maxHeight=`${t=i}px`):""!==n.style.maxHeight&&(n.style.maxHeight=""),this.dialogEl.style.width=`${e}px`,this.dialogEl.style.height=`${t}px`}buildMenu(){this.menu=new D(this.player()),this.menu.addClass("vjs-main-menu");const e=this.settingsButtonOptions.entries;if(0===e.length)return this.addClass("vjs-hidden"),void this.panelChild.addChild(this.menu);for(const t of e)this.addMenuItem(t,this.settingsButtonOptions);this.panelChild.addChild(this.menu)}addMenuItem(e,t){t.name=(0,d.LF)(e);const s=Object.assign({},t,{entry:e,menuButton:this}),i=new O(this.player(),s);this.menu.addChild(i),i.on("click",n().bind(this,this.hideChildren)),i.on("click",(function(){n().dom.hasClass(this.el_,"open")?n().dom.removeClass(this.el_,"open"):n().dom.addClass(this.el_,"open")}))}resetChildren(){for(const e of this.menu.children())e.reset()}hideChildren(){for(const e of this.menu.children())e.hideSubMenu()}isInIframe(){return window.self!==window.top}});const U=n().getComponent("Component");U.registerComponent("SettingsPanel",class extends U{createEl(){return super.createEl("div",{className:"vjs-settings-panel",innerHTML:"",tabIndex:-1})}});const V=n().getComponent("Component");V.registerComponent("SettingsPanelChild",class extends V{createEl(){return super.createEl("div",{className:"vjs-settings-panel-child",innerHTML:"",tabIndex:-1})}});const z=n().getComponent("ClickableComponent");class F extends z{constructor(e,t){super(e,t)}createEl(){this.wrapper=super.createEl("div",{className:"vjs-playlist-button",innerHTML:"",tabIndex:-1});const e=super.createEl("div",{className:"vjs-playlist-icon",innerHTML:"",tabIndex:-1});return this.playlistInfoElement=super.createEl("div",{className:"vjs-playlist-info",innerHTML:"",tabIndex:-1}),this.wrapper.appendChild(e),this.wrapper.appendChild(this.playlistInfoElement),this.update(),this.wrapper}update(){const e=this.options_;this.playlistInfoElement.innerHTML=e.getCurrentPosition()+"/"+e.playlist.videosLength,this.wrapper.title=this.player().localize("Playlist: {1}",[e.playlist.displayName])}handleClick(){this.getPlaylistMenu().open()}getPlaylistMenu(){return this.options_.playlistMenu}}n().registerComponent("PlaylistButton",F);const $=n().getComponent("Component");class K extends ${constructor(e,t){super(e,t),this.emitTapEvents(),this.element=t.element,this.on(["click","tap"],(()=>this.switchPlaylistItem())),this.on("keydown",(e=>this.handleKeyDown(e)))}createEl(){const e=this.options_,t=super.createEl("li",{className:"vjs-playlist-menu-item",innerHTML:""});e.element.video||t.classList.add("vjs-disabled");const s=super.createEl("div",{className:"item-position-block"}),i=super.createEl("div",{className:"item-position",innerHTML:e.element.position});return s.appendChild(i),t.appendChild(s),e.element.video?this.buildAvailableVideo(t,s,e):this.buildUnavailableVideo(t),t}setSelected(e){e?this.addClass("vjs-selected"):this.removeClass("vjs-selected")}getElement(){return this.element}buildAvailableVideo(e,t,s){const i=s.element,n=super.createEl("div",{className:"item-player"});t.appendChild(n);const o=super.createEl("img",{src:window.location.origin+i.video.thumbnailPath}),a=super.createEl("div",{className:"info-block"}),l=super.createEl("div",{innerHTML:i.video.name,className:"title"}),d=super.createEl("div",{innerHTML:i.video.channel.displayName,className:"channel"});if(a.appendChild(l),a.appendChild(d),i.startTimestamp||i.stopTimestamp){let e="";i.startTimestamp&&(e+=(0,r.nH)(i.startTimestamp)),i.stopTimestamp&&(e+=" - "+(0,r.nH)(i.stopTimestamp));const t=super.createEl("div",{innerHTML:e,className:"timestamps"});a.append(t)}e.append(o),e.append(a)}buildUnavailableVideo(e){const t=super.createEl("div",{className:"item-unavailable",innerHTML:this.player().localize("Unavailable video")});e.appendChild(t)}handleKeyDown(e){"Space"!==e.code&&"Enter"!==e.code||this.switchPlaylistItem()}switchPlaylistItem(){this.options_.onClicked()}}$.registerComponent("PlaylistMenuItem",K);const W=n().getComponent("Component");class q extends W{constructor(e,t){super(e,t);const s=this;function i(){s.close()}this.el().addEventListener("mouseenter",(()=>{this.player().off("userinactive",i)})),this.el().addEventListener("mouseleave",(()=>{this.player().one("userinactive",i)})),this.player().on("click",(e=>{let t=e.target;do{if(t.classList.contains("vjs-playlist-menu")||t.classList.contains("vjs-playlist-button"))return;t=t.parentElement}while(t);this.close()}))}createEl(){this.menuItems=[];const e=this.getOptions(),t=super.createEl("div",{className:"vjs-playlist-menu",innerHTML:"",tabIndex:-1}),s=super.createEl("div",{className:"header"}),i=super.createEl("div"),n=super.createEl("div",{innerHTML:e.playlist.displayName,className:"title"}),o=e.playlist.videoChannel,a=super.createEl("div",{innerHTML:o?this.player().localize("By {1}",[o.displayName]):"",className:"channel"});i.appendChild(n),i.appendChild(a);const l=super.createEl("div",{className:"cross"});l.addEventListener("click",(()=>this.close())),s.appendChild(i),s.appendChild(l);const r=super.createEl("ol");for(const d of e.elements){const e=new K(this.player(),{element:d,onClicked:()=>this.onItemClicked(d)});r.appendChild(e.el()),this.menuItems.push(e)}return t.appendChild(s),t.appendChild(r),t}update(){const e=this.getOptions();this.updateSelected(e.getCurrentPosition())}open(){this.player().addClass("playlist-menu-displayed")}close(){this.player().removeClass("playlist-menu-displayed")}updateSelected(e){for(const t of this.menuItems)t.setSelected(t.getElement().position===e)}getOptions(){return this.options_}onItemClicked(e){this.getOptions().onItemClicked(e)}}W.registerComponent("PlaylistMenu",q);const J=n().getPlugin("plugin");n().registerPlugin("playlist",class extends J{constructor(e,t){super(e,t),this.options=t,this.player.ready((()=>{e.addClass("vjs-playlist")})),this.playlistMenu=new q(e,t),this.playlistButton=new F(e,Object.assign(Object.assign({},t),{playlistMenu:this.playlistMenu})),e.addChild(this.playlistMenu,t),e.addChild(this.playlistButton,t)}updateSelected(){this.playlistMenu.updateSelected(this.options.getCurrentPosition())}});const G=v()("peertube:player:mobile"),Y=n().getPlugin("plugin");class Z extends Y{constructor(e,t){super(e,t),this.seekAmount=0,this.peerTubeMobileButtons=e.addChild("PeerTubeMobileButtons",{reportTouchActivity:!1}),n().browser.IS_ANDROID&&screen.orientation&&this.handleFullscreenRotation(),this.player.options_.userActions||(this.player.options_.userActions={}),this.player.options_.userActions.click=!1,this.player.options_.userActions.doubleClick=!1,this.player.one("play",(()=>{this.initTouchStartEvents()}))}handleFullscreenRotation(){this.player.on("fullscreenchange",(()=>{this.player.isFullscreen()&&!this.isPortraitVideo()&&screen.orientation.lock("landscape").catch((e=>l.k.error("Cannot lock screen to landscape.",e)))}))}isPortraitVideo(){return this.player.videoWidth()<this.player.videoHeight()}initTouchStartEvents(){const e=e=>{if(this.tapTimeout&&(clearTimeout(this.tapTimeout),this.tapTimeout=void 0),this.lastTapEvent&&e.timeStamp-this.lastTapEvent.timeStamp<Z.DOUBLE_TAP_DELAY_MS)return G("Detected double tap"),this.lastTapEvent=void 0,void this.onDoubleTap(e);this.newActiveState=!this.player.userActive(),this.tapTimeout=setTimeout((()=>{G("No double tap detected, set user active state to %s.",this.newActiveState),this.player.userActive(this.newActiveState)}),Z.DOUBLE_TAP_DELAY_MS),this.lastTapEvent=e};this.player.on("touchstart",(t=>{this.player.userActive()||e(t)})),this.peerTubeMobileButtons.el().addEventListener("touchstart",(t=>{t.preventDefault(),e(t)}),{passive:!1})}onDoubleTap(e){const t=this.player.currentWidth(),s=this.findPlayerTarget(e.target).getBoundingClientRect(),i=e.targetTouches[0].pageX-s.left;G("Calculating double tap zone (player width: %d, offset X: %d)",t,i),i>.66*t?(this.seekAmount<0&&(this.seekAmount=0),this.seekAmount+=10,G("Will forward %d seconds",this.seekAmount)):i<.33*t&&(this.seekAmount>0&&(this.seekAmount=0),this.seekAmount-=10,G("Will rewind %d seconds",this.seekAmount)),this.peerTubeMobileButtons.displayFastSeek(this.seekAmount),this.scheduleSetCurrentTime()}findPlayerTarget(e){return e.classList.contains("video-js")?e:this.findPlayerTarget(e.parentElement)}scheduleSetCurrentTime(){this.player.pause(),this.player.addClass("vjs-fast-seeking"),this.setCurrentTimeTimeout&&clearTimeout(this.setCurrentTimeTimeout),this.setCurrentTimeTimeout=setTimeout((()=>{let e=this.player.currentTime()+this.seekAmount;this.seekAmount=0,e=Math.max(0,e),e=Math.min(this.player.duration(),e),this.player.currentTime(e),this.seekAmount=0,this.peerTubeMobileButtons.displayFastSeek(0),this.player.removeClass("vjs-fast-seeking"),this.player.userActive(!1),this.player.play()}),Z.SET_CURRENT_TIME_DELAY)}}Z.DOUBLE_TAP_DELAY_MS=250,Z.SET_CURRENT_TIME_DELAY=1e3,n().registerPlugin("peertubeMobile",Z);const Q=n().getComponent("Component");n().registerComponent("PeerTubeMobileButtons",class extends Q{createEl(){const e=super.createEl("div",{className:"vjs-mobile-buttons-overlay"}),t=super.createEl("div",{className:"main-button"});t.addEventListener("touchstart",(e=>{e.stopPropagation(),this.player_.paused()||this.player_.ended()?this.player_.play():this.player_.pause()})),this.rewind=super.createEl("div",{className:"rewind-button vjs-hidden"}),this.forward=super.createEl("div",{className:"forward-button vjs-hidden"});for(let s=0;s<3;s++)this.rewind.appendChild(super.createEl("span",{className:"icon"})),this.forward.appendChild(super.createEl("span",{className:"icon"}));return this.rewindText=this.rewind.appendChild(super.createEl("div",{className:"text"})),this.forwardText=this.forward.appendChild(super.createEl("div",{className:"text"})),e.appendChild(this.rewind),e.appendChild(t),e.appendChild(this.forward),e}displayFastSeek(e){return 0===e?(this.hideRewind(),void this.hideForward()):e>0?(this.hideRewind(),void this.displayForward(e)):e<0?(this.hideForward(),void this.displayRewind(e)):void 0}hideRewind(){this.rewind.classList.add("vjs-hidden"),this.rewindText.textContent=""}displayRewind(e){this.rewind.classList.remove("vjs-hidden"),this.rewindText.textContent=this.player().localize("{1} seconds",[e+""])}hideForward(){this.forward.classList.add("vjs-hidden"),this.forwardText.textContent=""}displayForward(e){this.forward.classList.remove("vjs-hidden"),this.forwardText.textContent=this.player().localize("{1} seconds",[e+""])}});const X=n().getPlugin("plugin");class ee extends X{constructor(e,t){super(e,t),this.handlers=this.buildHandlers(),this.handleKeyFunction=e=>this.onKeyDown(e),document.addEventListener("keydown",this.handleKeyFunction)}dispose(){document.removeEventListener("keydown",this.handleKeyFunction)}onKeyDown(e){if(this.isValidKeyTarget(e.target))for(const t of this.handlers)if(t.accept(e))return void t.cb(e)}buildHandlers(){const e=[{accept:e=>" "===e.key||"MediaPlayPause"===e.key,cb:e=>{e.preventDefault(),e.stopPropagation(),this.player.paused()?this.player.play():this.player.pause()}},{accept:e=>this.isNaked(e,"ArrowUp"),cb:e=>{e.preventDefault(),this.player.volume(this.player.volume()+ee.VOLUME_STEP)}},{accept:e=>this.isNaked(e,"ArrowDown"),cb:e=>{e.preventDefault(),this.player.volume(this.player.volume()-ee.VOLUME_STEP)}},{accept:e=>this.isNaked(e,"ArrowLeft")||this.isNaked(e,"MediaRewind"),cb:e=>{e.preventDefault();const t=Math.max(0,this.player.currentTime()-ee.SEEK_STEP);this.player.currentTime(t)}},{accept:e=>this.isNaked(e,"ArrowRight")||this.isNaked(e,"MediaForward"),cb:e=>{e.preventDefault();const t=Math.min(this.player.duration(),this.player.currentTime()+ee.SEEK_STEP);this.player.currentTime(t)}},{accept:e=>this.isNaked(e,"f")||!e.altKey&&e.ctrlKey&&"Enter"===e.key,cb:e=>{e.preventDefault(),this.player.isFullscreen()?this.player.exitFullscreen():this.player.requestFullscreen()}},{accept:e=>this.isNaked(e,"m"),cb:e=>{e.preventDefault(),this.player.muted(!this.player.muted())}},{accept:e=>">"===e.key,cb:()=>{const e=Math.min(this.player.playbackRate()+.1,5);this.player.playbackRate(parseFloat(e.toFixed(2)))}},{accept:e=>"<"===e.key,cb:()=>{const e=Math.max(this.player.playbackRate()-.1,.1);this.player.playbackRate(parseFloat(e.toFixed(2)))}},{accept:e=>","===e.key,cb:()=>{this.player.pause(),this.player.currentTime(this.player.currentTime()-1/30)}},{accept:e=>"."===e.key,cb:()=>{this.player.pause(),this.player.currentTime(this.player.currentTime()+1/30)}}];for(let t=0;t<10;t++)e.push({accept:e=>e.key===t+""&&!e.ctrlKey,cb:e=>{e.preventDefault(),this.player.currentTime(this.player.duration()*t*.1)}});return e}isValidKeyTarget(e){const t=this.player.el(),s=document.activeElement,i=e.tagName.toLowerCase();return s===t||s===t.querySelector(".vjs-tech")||s===t.querySelector(".vjs-control-bar")||"content"===e.id||"body"===i||"video"===i}isNaked(e,t){return!(e.ctrlKey||e.altKey||e.metaKey||e.shiftKey||e.key!==t)}}function te(e){const t=document.createElement("textarea");t.value=e,t.setAttribute("readonly",""),t.style.position="absolute",t.style.left="-9999px",document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}function se(e){return new Promise((t=>{setTimeout((()=>t()),e)}))}ee.VOLUME_STEP=.1,ee.SEEK_STEP=5,n().registerPlugin("peerTubeHotkeysPlugin",ee),s(2492);var ie=s(4182);class ne{constructor(e,t){this.mode=t,this.options=e.common}getChildrenOptions(){const e={};return this.options.previousVideo&&Object.assign(e,this.getPreviousVideo()),Object.assign(e,{playToggle:{}}),this.options.nextVideo&&Object.assign(e,this.getNextVideo()),Object.assign(e,Object.assign(Object.assign(Object.assign({currentTimeDisplay:{},timeDivider:{},durationDisplay:{},liveDisplay:{},flexibleWidthSpacer:{}},this.getProgressControl()),{p2PInfoButton:{p2pEnabled:this.options.p2pEnabled},muteToggle:{},volumeControl:{}}),this.getSettingsButton())),Object.assign(e,{PictureInPictureBastyon:{}}),!0===this.options.theaterButton&&Object.assign(e,{theaterButton:{}}),Object.assign(e,{fullscreenToggle:{}}),e}getSettingsButton(){const e=[];return e.push("playbackRateMenuButton"),e.push("resolutionMenuButton"),{settingsButton:{setup:{maxHeightOffset:40},entries:e}}}getProgressControl(){return{progressControl:{children:{seekBar:{children:{["webtorrent"===this.mode?"peerTubeLoadProgressBar":"loadProgressBar"]:{},mouseTimeDisplay:{},playProgressBar:{}}}}}}}getPreviousVideo(){return{previousVideoButton:{type:"previous",handler:this.options.previousVideo,isDisabled:()=>!!this.options.hasPreviousVideo&&!this.options.hasPreviousVideo()}}}getNextVideo(){return{nextVideoButton:{type:"next",handler:this.options.nextVideo,isDisabled:()=>!!this.options.hasNextVideo&&!this.options.hasNextVideo()}}}}var oe=s(2776);class ae{constructor(e=[]){this.baseUrls=e}removeBySegmentUrl(e){l.k.info(`Removing redundancy of segment URL ${e}.`);const t=(0,oe.dirname)(e);this.baseUrls=this.baseUrls.filter((e=>e!==t&&e!==t+"/"))}buildUrl(e){const t=this.baseUrls.length+1,s=this.getRandomInt(t);if(s===t-1)return e;const i=this.baseUrls[s],n=i.endsWith("/")?"":"/";return i+n+(0,oe.basename)(e)}countBaseUrls(){return this.baseUrls.length}getRandomInt(e){return Math.floor(Math.random()*Math.floor(e))}}function le(e){return function(t){return e.buildUrl(t.url)}}var re=s(2236).Buffer;function de(e,t){let i=ue(e);const n=/bytes=(\d+)-(\d+)/;return async function o(a,r,d,u=1){t&&await se(1e3);const h=(0,oe.basename)(a.url),c=(await i)[h];if(!c&&u>3)throw new Error(`Unknown segment name ${h} in segment validator`);if(!c)return l.k.info(`Refetching sha segments for ${h}`),await se(1e3),i=ue(e),void(await o(a,r,d,u+1));let p,m="";if("string"==typeof c)p=c;else{const e=n.exec(a.range);m=e[1]+"-"+e[2],p=c[m]}if(void 0===p)throw new Error(`Unknown segment name ${h}/${m} in segment validator`);const y=await async function(e){if(e)return window.crypto.subtle?window.crypto.subtle.digest("SHA-256",e).then((e=>function(e){if(!e)return"";let t="";const s="0123456789abcdef";return new Uint8Array(e).forEach((e=>{t+=s[e>>4]+s[15&e]})),t}(e))):(new((await s.e(875).then(s.t.bind(s,875,23))).default.sha256)).update(re.from(e)).digest("hex")}(a.data);if(y!==p)throw new Error(`Hashes does not correspond for segment ${h}/${m}(expected: ${p} instead of ${y})`)}}function ue(e){return fetch(e).then((e=>e.json())).catch((e=>(l.k.error("Cannot get sha256 segments",e),{})))}class he{constructor(e,t){this.options=e,this.p2pMediaLoaderModule=t}getPluginOptions(){const e=this.options.common,t=new ae(this.options.p2pMediaLoader.redundancyBaseUrls),s=this.getP2PMediaLoaderOptions(t),i=new this.p2pMediaLoaderModule.Engine(s).createLoaderClass();return console.log("p2pMediaLoaderConfig",s),{p2pMediaLoader:{redundancyUrlManager:t,type:"application/x-mpegURL",startTime:e.startTime,src:this.options.p2pMediaLoader.playlistUrl,loader:i},hlsjs:{levelLabelHandler:e=>{const t=Math.min(e.height||0,e.width||0),s=this.options.p2pMediaLoader.videoFiles.find((e=>e.resolution.id===t));if(!s)return e.height;let i=s.resolution.label;return s.fps>=50&&(i+=s.fps),i}},html5:{hlsjsConfig:this.getHLSJSOptions(i)}}}getP2PMediaLoaderOptions(e){var t,s;let i=!1;"cellular"===(null===(t=null===navigator||void 0===navigator?void 0:navigator.connection)||void 0===t?void 0:t.type)&&(l.k.info("We are on a cellular connection: disabling seeding."),i=!0);const n=this.options.p2pMediaLoader.trackerAnnounce.filter((e=>e.startsWith("ws"))),o=this.options.common.isLive?this.getP2PMediaLoaderLiveOptions():this.getP2PMediaLoaderVODOptions();return{loader:Object.assign({trackerAnnounce:n,rtcConfig:(0,d.gI)(),simultaneousHttpDownloads:1,httpFailedSegmentTimeout:1e3,segmentValidator:this.options.common.localTransport?void 0:de(this.options.p2pMediaLoader.segmentsSha256Url,this.options.common.isLive),segmentUrlBuilder:le(e),useP2P:this.options.common.p2pEnabled,consumeOnly:i,segmentsStorage:this.options.segmentsStorage,localTransport:this.options.common.localTransport},o),segments:{assetsStorage:this.options.assetsStorage,swarmId:this.options.p2pMediaLoader.playlistUrl,forwardSegmentCount:null!==(s=o.p2pDownloadMaxPriority)&&void 0!==s?s:20}}}getP2PMediaLoaderLiveOptions(){const e={requiredSegmentsPriority:1};return 3===this.options.common.liveOptions.latencyMode?Object.assign(Object.assign({},e),{useP2P:!1,httpDownloadProbability:1}):e}getP2PMediaLoaderVODOptions(){return{requiredSegmentsPriority:3,skipSegmentBuilderPriority:1,cachedSegmentExpiration:864e5,cachedSegmentsCount:100,httpDownloadMaxPriority:9,httpDownloadProbability:.06,httpDownloadProbabilitySkipIfNoPeers:!0,p2pDownloadMaxPriority:50}}getHLSJSOptions(e){const t=this.options.common.isLive?this.getHLSLiveOptions():this.getHLSVODOptions(),s=Object.assign({capLevelToPlayerSize:!0,autoStartLoad:!1,loader:e},t),i=(0,b.zZ)();return i?Object.assign(Object.assign({},s),{abrEwmaDefaultEstimate:8*i,backBufferLength:90,startLevel:-1,testBandwidth:!1,debug:!1}):s}getHLSLiveOptions(){switch(this.options.common.liveOptions.latencyMode){case 3:return{liveSyncDurationCount:2};case 2:return{liveSyncDurationCount:10};default:return{liveSyncDurationCount:5}}}getHLSVODOptions(){return{liveSyncDurationCount:5}}}class ce{constructor(e,t){this.options=e,this.autoPlayValue=t}getPluginOptions(){const e=this.options.common,t=this.options.webtorrent,s=this.options.p2pMediaLoader;return{webtorrent:{autoplay:"play"===this.autoPlayValue,playerRefusedP2P:!1===e.p2pEnabled,videoDuration:e.videoDuration,playerElement:e.playerElement,videoFiles:0!==t.videoFiles.length?t.videoFiles:(null==s?void 0:s.videoFiles)||[],startTime:e.startTime}}}}class pe{constructor(e,t,s){this.mode=e,this.options=t,this.p2pMediaLoaderModule=s}getVideojsOptions(e){const t=this.options.common;let s=this.getAutoPlayValue(t.autoplay,e);const i={preloadTextTracks:!1},n={peertube:Object.assign({mode:this.mode,autoplay:s},(0,r.ei)(t,["videoViewUrl","authorizationHeader","startTime","videoDuration","subtitle","stopTime","isLive","videoUUID"]))};if("p2p-media-loader"===this.mode){const e=new he(this.options,this.p2pMediaLoaderModule).getPluginOptions();Object.assign(n,(0,r.ei)(e,["hlsjs","p2pMediaLoader"])),Object.assign(i,e.html5)}else if("webtorrent"===this.mode){const t=new ce(this.options,this.getAutoPlayValue(s,e));Object.assign(n,t.getPluginOptions()),s=!1}Object.assign(n,{hotkeys:{}});const o=new ne(this.options,this.mode),a={html5:i,textTrackSettings:!1,controls:void 0===t.controls||t.controls,loop:void 0!==t.loop&&t.loop,muted:void 0!==t.muted?t.muted:void 0,autoplay:this.getAutoPlayValue(s,e),poster:t.poster,inactivityTimeout:t.inactivityTimeout,playbackRates:[.5,.75,1,1.25,1.5,1.75,2],plugins:n,sources:t.sources,controlBar:{children:o.getChildrenOptions()}};return t.language&&!(0,ie.TF)(t.language)&&Object.assign(a,{language:t.language}),a}getAutoPlayValue(e,t){return!0!==e?e:(0,p.gn)()||(0,p.G6)()?!!t&&"play":"play"}getContextMenuOptions(e,t){return{content:()=>{const s=e.options_.loop,i=[{icon:"repeat",label:e.localize("Play in loop")+(s?'<span class="vjs-icon-tick-white"></span>':""),listener:function(){e.options_.loop=!s}},{label:e.localize("Copy the video URL"),listener:function(){te((0,r.d6)({shortUUID:t.videoShortUUID}))}},{label:e.localize("Copy the video URL at the current time"),listener:function(){const e=(0,r.d6)({shortUUID:t.videoShortUUID});te((0,r.fj)({url:e,startTime:this.currentTime()}))}}];return"webtorrent"===this.mode&&i.push({label:e.localize("Copy magnet URI"),listener:function(){te(this.webtorrent().getCurrentVideoFile().magnetUri)}}),i.push({icon:"info",label:e.localize("Stats for nerds"),listener:()=>{e.stats().show()}}),i.map((e=>Object.assign(Object.assign({},e),{label:`<span class="vjs-icon-${e.icon||"link-2"}"></span>`+e.label})))}}}}const me=s(483),ye=n().getComponent("Slider"),ge=n().getComponent("SeekBar");ye.prototype.update=function(){if(!this.el_||!this.bar)return;const e=this.getProgress();if(e===this.progress_)return e;this.progress_=e;var t=this.bar.el();return this.vertical()?(t.style["transform-origin"]="bottom",t.style.transform="scaleY("+e.toFixed(2)+")"):t.style.transform="scaleX("+e.toFixed(2)+")",e},ge.prototype.getPercent=function(){const e=this.player_.currentTime()/this.player_.duration();return e>=1?1:e},ge.prototype.setEventHandlers_=function(){this.update_=me.bind(this,this.update),this.update=me.throttle(this.update_,me.UPDATE_REFRESH_INTERVAL),this.on(this.player_,["ended","durationchange","timeupdate"],this.update),this.player_.liveTracker&&this.on(this.player_.liveTracker,"liveedgechange",this.update),this.updateInterval=null,this.enableIntervalHandler_=e=>this.enableInterval_(e),this.disableIntervalHandler_=e=>this.disableInterval_(e),this.on(this.player_,["playing"],this.enableIntervalHandler_),this.on(this.player_,["ended","pause","waiting"],this.disableIntervalHandler_),"hidden"in document&&"visibilityState"in document&&this.on(document,"visibilitychange",this.toggleVisibility_)},ge.prototype.enableInterval_=function(){this.updateInterval||(this.updateInterval=this.setInterval(this.update,me.UPDATE_REFRESH_INTERVAL))},ge.prototype.update=function(e){if("hidden"===document.visibilityState)return;const t=this.getPercent();var s=this.bar.el();return s.style["transform-origin"]="left",s.style.transform="scaleX("+t.toFixed(2)+")",t},ge.prototype.handleMouseMove=function(e){let t=this.calculateDistance(e)*this.player_.duration();t===this.player_.duration()&&(t-=.1),this.player_.currentTime(t),this.update()};const ve=n().getComponent("CaptionsButton");ve.prototype.controlText_="Subtitles/CC",ve.prototype.label_=" ";class be{static initState(){this.alreadyPlayed=!1}static async initialize(e,t,i){if(this.onPlayerChange=i,this.playerElementClassName=t.common.playerElement.className,"webtorrent"===e&&await Promise.all([s.e(647),s.e(569)]).then(s.bind(s,8169)),"p2p-media-loader"===e){const[e]=await Promise.all([s.e(819).then(s.t.bind(s,1819,23)),Promise.all([s.e(819),s.e(5),s.e(141)]).then(s.bind(s,141))]);this.p2pMediaLoaderModule=e}return this.buildPlayer(e,t)}static async buildPlayer(e,t){const s=new pe(e,t,this.p2pMediaLoaderModule),i=s.getVideojsOptions(this.alreadyPlayed),o=this;return new Promise((a=>{n()(t.common.playerElement,i,(function(){const i=this;let n=!1;return i.one("error",(()=>{n||(n=!0,"p2p-media-loader"===e&&o.tryToRecoverHLSError(i.error(),i,t))})),i.one("play",(()=>{o.alreadyPlayed=!0})),o.addContextMenu(s,i,t.common),((0,p.tq)()||t.mobile)&&i.peertubeMobile(),!1===t.common.controlBar&&i.controlBar.addClass("control-bar-hidden"),i.bezels(),i.stats({videoUUID:t.common.videoUUID,videoIsLive:t.common.isLive,mode:e,p2pEnabled:t.common.p2pEnabled}),i.on("p2pInfo",((e,t)=>{"p2p-media-loader"!==t.source||isNaN(t.bandwidthEstimate)||(0,b.M_)(t.bandwidthEstimate)})),a(i)}))}))}static async tryToRecoverHLSError(e,t,s){if(3===e.code){if(0===this.videojsDecodeErrors&&s.common.errorNotifier(t.localize("The video failed to play, will try to fast forward.")),20===this.videojsDecodeErrors)return void this.maybeFallbackToWebTorrent("p2p-media-loader",t,s);l.k.info("Fast forwarding HLS to recover from an error."),this.videojsDecodeErrors++,s.common.startTime=t.currentTime()+2,s.common.autoplay=!0,this.rebuildAndUpdateVideoElement(t,s.common);const e=await this.buildPlayer("p2p-media-loader",s);this.onPlayerChange(e)}else this.maybeFallbackToWebTorrent("p2p-media-loader",t,s)}static async maybeFallbackToWebTorrent(e,t,i){if(0===i.webtorrent.videoFiles.length||"webtorrent"===e)return void t.peertube().displayFatalError();l.k.info("Fallback to webtorrent."),this.rebuildAndUpdateVideoElement(t,i.common),await Promise.all([s.e(647),s.e(569)]).then(s.bind(s,8169));const n=await this.buildPlayer("webtorrent",i);this.onPlayerChange(n)}static rebuildAndUpdateVideoElement(e,t){const s=document.createElement("video");s.className=this.playerElementClassName;let i=t.playerElement.parentNode;return i||(i=document.getElementById(t.playerElement.id).parentNode),i.parentNode.insertBefore(s,i),t.playerElement=s,t.onPlayerElementChange(s),e.dispose(),s}static addContextMenu(e,t,s){const i=e.getContextMenuOptions(t,s);t.contextmenuUI(i)}}be.alreadyPlayed=!1,be.videojsDecodeErrors=0},6939:(e,t,s)=>{"use strict";function i(e){return e.charAt(0).toUpperCase()+e.slice(1)}s.d(t,{aI:()=>o,gI:()=>r,LF:()=>i,qx:()=>a,FE:()=>l});const n=[{max:1024,type:"B",decimals:0},{max:1048576,type:"KB",decimals:0},{max:1073741824,type:"MB",decimals:0},{max:10995116e5,type:"GB",decimals:1}];function o(e){const t=n.find((t=>e<t.max))||n[n.length-1];return[(e/(t.max/1024)).toFixed(t.decimals),t.type]}function a(e){let t=e[0];for(let s=1;s<e.length;s++){const i=e[s];t.resolution.id<i.resolution.id&&(t=i)}return t}function l(e){let t=e[0];for(let s=1;s<e.length;s++){const i=e[s];t.resolution.id>i.resolution.id&&(t=i)}return t}function r(){return{iceServers:[{urls:"stun:stun.stunprotocol.org"},{urls:"stun:stun.framasoft.org"}]}}},327:(e,t,s)=>{"use strict";function i(){return!!/iPad|iPhone|iPod/.test(navigator.platform)||!!(navigator.maxTouchPoints&&navigator.maxTouchPoints>2&&navigator.platform.includes("MacIntel"))}function n(){return/^((?!chrome|android).)*safari/i.test(navigator.userAgent)}function o(){return/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)}s.d(t,{G6:()=>n,gn:()=>i,tq:()=>o})},2776:(e,t,s)=>{"use strict";e.exports=s(1328)},4182:(e,t,s)=>{"use strict";s.d(t,{TF:()=>n});const i={"ar-001":"ar",ca:"ca-ES",cs:"cs-CZ",de:"de-DE",el:"el-GR",en:"en-US",es:"es-ES",eu:"eu-ES",fi:"fi-FI",gl:"gl-ES",fa:"fa-IR",fr:"fr-FR",hu:"hu-HU",it:"it-IT",ja:"ja-JP",nl:"nl-NL",pl:"pl-PL",pt:"pt-BR",nb:"nb-NO",ru:"ru-RU",sv:"sv-SE",th:"th-TH",vi:"vi-VN","zh-CN":"zh-Hans-CN","zh-Hans":"zh-Hans-CN","zh-Hant":"zh-Hant-TW","zh-TW":"zh-Hant-TW",zh:"zh-Hans-CN"};function n(e){return o(e)===o("en-US")}function o(e){return e&&i[e]?i[e]:e}Object.keys({"en-US":"English",ar:"\u0627\u0644\u0639\u0631\u0628\u064a\u0629","ca-ES":"Catal\xe0","cs-CZ":"\u010ce\u0161tina","de-DE":"Deutsch","el-GR":"\u03b5\u03bb\u03bb\u03b7\u03bd\u03b9\u03ba\u03ac",eo:"Esperanto","es-ES":"Espa\xf1ol","eu-ES":"Euskara","fi-FI":"suomi","fr-FR":"Fran\xe7ais",gd:"G\xe0idhlig","gl-ES":"galego",hr:"hrvatski","hu-HU":"magyar","fa-IR":"\u0641\u0627\u0631\u0633\u06cc","it-IT":"Italiano","ja-JP":"\u65e5\u672c\u8a9e",kab:"Taqbaylit","nl-NL":"Nederlands",oc:"Occitan","pl-PL":"Polski","pt-BR":"Portugu\xeas (Brasil)","pt-PT":"Portugu\xeas (Portugal)","ru-RU":"\u0440\u0443\u0441\u0441\u043a\u0438\u0439",sq:"Shqip","sv-SE":"Svenska",nn:"norsk nynorsk","nb-NO":"norsk bokm\xe5l","th-TH":"\u0e44\u0e17\u0e22","vi-VN":"Ti\u1ebfng Vi\u1ec7t",tok:"Toki Pona","zh-Hans-CN":"\u7b80\u4f53\u4e2d\u6587\uff08\u4e2d\u56fd\uff09","zh-Hant-TW":"\u7e41\u9ad4\u4e2d\u6587\uff08\u53f0\u7063\uff09"}).concat(Object.keys(i)).map((e=>"/"+e))},2088:(e,t,s)=>{"use strict";function i(e){if(!e)return 0;if("number"==typeof e)return e;const t=e.match(/^((\d+)[h:])?((\d+)[m:])?((\d+)s?)?$/);return t?3600*parseInt(t[2]||"0",10)+60*parseInt(t[4]||"0",10)+parseInt(t[6]||"0",10):0}function n(e,t=!1,s){let i="";if(0===e&&!t)return"0s";const n=s||"h",o=s||"m",a=t?"":"s",l=Math.floor(e/3600);l>=1?i=l+n:t&&(i="0"+n),e%=3600;const r=Math.floor(e/60);return r>=1&&r<10&&t?i+="0"+r+o:r>=1?i+=r+o:t&&(i+="00"+o),(e%=60)>=1&&e<10&&t?i+="0"+e+a:e>=1?i+=e+a:t&&(i+="00"),i}function o(e,t){const s={};for(const i of t)Object.prototype.hasOwnProperty.call(e,i)&&(s[i]=e[i]);return s}function a(e,t){return(null!=t?t:window.location.origin)+function(e){return"/w/"+e.shortUUID}(e)}function l(e){const{url:t}=e,s=new URLSearchParams;if(null!=e.startTime){const t=Math.floor(e.startTime);s.set("start",n(t))}if(e.stopTime){const t=Math.floor(e.stopTime);s.set("stop",n(t))}return e.subtitle&&s.set("subtitle",e.subtitle),!0===e.loop&&s.set("loop","1"),!0===e.autoplay&&s.set("autoplay","1"),!0===e.muted&&s.set("muted","1"),!1===e.title&&s.set("title","0"),!1===e.warningTitle&&s.set("warningTitle","0"),!1===e.controls&&s.set("controls","0"),!1===e.controlBar&&s.set("controlBar","0"),!1===e.peertubeLink&&s.set("peertubeLink","0"),void 0!==e.p2p&&s.set("p2p",e.p2p?"1":"0"),function(e,t){let s=!1;return t.forEach((()=>{s=!0})),s?e+"?"+t.toString():e}(t,s)}s.d(t,{d6:()=>a,fj:()=>l,ei:()=>o,nH:()=>n,h8:()=>i}),s(2776),s(4182);const r=["linkify","autolink","emphasis","link","newline","entity","list"],d=r.concat(["html_inline","html_block"]);r.concat(["image"]),d.concat(["image"]).concat(["block","inline","heading","paragraph"])}}]);
//# sourceMappingURL=526.chunk.js.map