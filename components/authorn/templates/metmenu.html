<%
var m = [];
var all = {
	block : {
		icon : '<i class="fas fa-user-slash"></i>',
		text : function() { return author.isGroup ? e('block_group') : e('blockuser') },
		class : 'block'
	},
    unblock : {
		icon : '<i class="fas fa-user-check"></i>',
		text : function() { return author.isGroup ? e('unblock_group') : e('unblockuser') },
		class : 'unblock'
	},
	complain : {
		icon : '<i class="fas fa-ban"></i>',
		text : function() { return author.isGroup ? e('report_group') : e('reportuser') },
		class : 'complain'
	},
	donate : {
		icon : '<i class="fas fa-heart"></i>',
		text : e('donate'),
		class : 'donate'
	},
	startchat : {
		icon : '<i class="far fa-comment"></i>',
		text : function() { return author.isGroup ? e('write_to_group') : e('startchat') },
		class : 'startchat'
	},
	unsubscribe : {
		icon : '<i class="fas fa-user-times"></i>',
		text : function() { return author.isGroup ? e('leave_group') : e('unsubscribe') },
		class : 'unsubscribe'
	},
}

if(author){
	if(author.address != user.address.value.toString('hex')){
		var me = psdk.userInfo.getmy()
		
		if (me){
			if (!me.relation(author.address, 'subscribes')){
			}
			else
			{
				m.push('unsubscribe')
			}
			if(app.platform.matrixchat.core){
				m.push('startchat')
			}
			if(me.relation(author.address, 'blocking')){
				m.push('unblock')
			}
			else
			{
				m.push('block')
			}
			if(true){
				m.push('complain')
				if(!author.isGroup) {
					m.push('donate')
				}
			}
		}
	}
}
%>
<div class="sharepostmenu">
	<% _.each(m, function(m){ var mo = all[m] %>
	<div elementsid="author_menuitem_<%-mo.class||''%>" class="menuitem <%-mo.class||''%> table">
		<div class="icon"><span><%=mo.icon%></span></div>
		<div class="label">
			<span>
				<% if(typeof mo.text === 'function') { %>
					<%-mo.text()%>
				<% } else { %>
					<%-mo.text%>
				<% } %>
			</span>
		</div>
	</div>
	<% }) %>
</div>