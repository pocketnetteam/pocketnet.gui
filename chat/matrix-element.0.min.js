(window["matrixElement_jsonp"]=window["matrixElement_jsonp"]||[]).push([[0],{"0826":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"typingBlock",staticStyle:{position:"relative"}},[i("div",{staticClass:"typingBlockWrapper"},[i("div",[i("span",[e._v(e._s(e.$t("caption.typing")))])]),i("div",[i("PulseLoader",{attrs:{color:e.color,size:e.size,loading:!0}})],1)])])},r=[],s=i("8a5d"),o={name:"typing",props:{},components:{PulseLoader:s["a"]},data:()=>({color:"#868686",size:"2px",loading:!0}),methods:{},computed:{}},a=o,l=i("2877");function c(e){var t=i("1b86");t.__inject__&&t.__inject__(e)}var d=Object(l["a"])(a,n,r,!1,c,null,null,!0);t["a"]=d.exports},"0a35":function(e,t,i){var n=i("24fb");t=n(!1),t.push([e.i,".eventWrapper[data-v-27e149cf] .event{padding:.25em 0}.list-enter-active[data-v-27e149cf],.list-leave-active[data-v-27e149cf]{transition:all 1s}.list-enter[data-v-27e149cf],.list-leave-to[data-v-27e149cf]{opacity:0}#events[data-v-27e149cf]{left:0;right:0;top:0;bottom:0;padding-bottom:46px;position:absolute;transition:.3s}#events.mobile[data-v-27e149cf]{padding-bottom:77px;transform:translate3d(0,calc(var(--keyboardheight, 0)*-1 - -1px),0)}#events.mobile .scrollbottom[data-v-27e149cf]{bottom:5em}.dummyheight[data-v-27e149cf]{height:100%;width:2px;left:0;right:0;top:0;bottom:0;background:rgb(var(--color-shadow-base))}.preloadingWrapper[data-v-27e149cf]{padding:2em;text-align:center;opacity:.5;color:rgb(var(--text-color))}.scrollbottom[data-v-27e149cf]{position:absolute;right:.5em;bottom:4em;cursor:pointer;border-radius:50%;background:rgb(var(--background-main));box-shadow:0 5px 7px -5px rgba(var(--color-shadow-base),.7);color:rgb(var(--color-txt-gray-dark));width:35px;height:35px;line-height:35px;text-align:center;z-index:3}.scrollbottom i[data-v-27e149cf]{font-size:.7em}.eventsflex[data-v-27e149cf]{display:flex;flex-flow:column;overflow-y:overlay;overflow-x:hidden;max-width:640px;margin:0 auto;-webkit-overflow-scrolling:touch;overscroll-behavior:contain;flex-wrap:nowrap;width:100%;height:100%;scroll-behavior:auto;continue:fragments;justify-content:flex-start;transform:scaleY(-1);contain:strict}.eventsflex.freeze[data-v-27e149cf]{overflow-y:hidden}.eventsflex .eventspage[data-v-27e149cf],.eventsflex .ewr[data-v-27e149cf]{width:100%;display:flex;flex-flow:column;flex-wrap:nowrap;justify-content:flex-start}.eventsflex .errorWrapper[data-v-27e149cf]{padding:.5em}.eventsflex .errorWrapper .btnwrp[data-v-27e149cf]{padding-top:.5em}.eventsflex .errorWrapper .error[data-v-27e149cf]{padding:1em;border-radius:1em;background:rgb(var(--neutral-grad-0))}.eventsflex .errorWrapper[data-v-27e149cf],.eventsflex .eventWrapper[data-v-27e149cf]{width:100%;transform:scaleY(-1)}.eventsflex.mobile[data-v-27e149cf]{scroll-behavior:smooth}.eventsflex.mobile[data-v-27e149cf] .dropdown.visible{top:-55px}.eventsflex.mobile[data-v-27e149cf] .outer-div .backgr,.eventsflex.mobile[data-v-27e149cf] .outer-div .menuwrapper{position:absolute}.eventsflex.mobile.ios.menuOpen[data-v-27e149cf]{overflow:visible}.galleryRow[data-v-27e149cf]{display:flex;align-items:flex-end}.galleryRow .messageImg[data-v-27e149cf]{max-width:50%;margin:0 10px;position:relative}.galleryRow .messageImg .img[data-v-27e149cf]{display:block;border-radius:.5em;position:relative;max-width:100%}.galleryRow .messageImg .loadingImg[data-v-27e149cf]{display:flex;align-items:center;justify-content:center;border-radius:.5em;position:relative;max-width:300px;height:250px}.galleryRow .messageImg .loadingImg .imgPreview[data-v-27e149cf]{border-radius:.5em;position:relative;max-width:100%;height:100%;opacity:.6}.galleryRow .messageImg .loadingImg .clipLoader[data-v-27e149cf]{position:absolute;z-index:9999;left:50%;right:0;top:50%;bottom:0;transform:translate(-50,50);display:flex;align-items:center;justify-content:center}.galleryRow .messageImg .imgMsg img[data-v-27e149cf]{max-width:100%;-o-object-fit:cover;object-fit:cover;border-radius:1em;display:block}.galleryRow .messageImg .metaLink[data-v-27e149cf]{background:#000}.galleryRow .messageImg .metaLink .metaMessageLink .metaTitle[data-v-27e149cf]{font-weight:700;font-size:.9em}.galleryRow .messageImg .metaLink .metaMessageLink .metaDescription[data-v-27e149cf]{margin:.5em 0;font-size:.8em}.galleryRow .messageImg .metaLink .metaMessageLink .metaImgWrapper[data-v-27e149cf]{display:block;max-width:300px;-o-object-fit:cover;object-fit:cover}.galleryRow .messageImg .metaLink .metaMessageLink .metaImgWrapper img[data-v-27e149cf]{display:block;width:100%;height:100%}",""]),e.exports=t},"1b86":function(e,t,i){"use strict";i.r(t);var n=i("5f7e");for(var r in n)["default"].indexOf(r)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(r)},2460:function(e,t,i){"use strict";i.r(t);var n=i("c2c1");for(var r in n)["default"].indexOf(r)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(r)},"4e29":function(e,t,i){"use strict";var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{class:{bin:e.pocketnet,bout:!e.pocketnet,minimized:e.minimized,fix:e.pocketnet,active:e.active},attrs:{id:"chatList"}},[i("div",{ref:"work",staticClass:"work"},[i("div",{ref:"events",staticClass:"timeLineWrapper"},[e.timeline?i("events",{ref:"eventslist",attrs:{error:e.error,timeline:e.timeline,events:e.events,chat:e.chat,loading:e.lloading,scrollType:e.scrollType},on:{updated:e.updatedSize,scroll:e.scrollE,removeEvent:e.removeEvent,editingEvent:e.editingEvent,replyEvent:e.replyEvent,galleryEventOpen:function(t){return e.imageGallery(t)},menuIsVisible:e.menuIsVisibleHandler}}):e._e()],1)])])},r=[],s=i("1da1"),o=(i("d9e2"),i("2f62")),a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"maskedtop",class:{mobile:e.mobile,ios:e.ios,menuOpen:e.menuOpen,imagesList:"custom"===this.scrollType?"imagesList":""},attrs:{id:"events"}},[i("div",{ref:"container",staticClass:"eventsflex",class:{mobile:e.mobile,ios:e.ios,menuOpen:e.menuOpen},on:{mousewheel:e.mousewheel,scroll:e.dscroll}},[i("div",{staticClass:"ewr"},[e.stringifyiedError?i("div",{staticClass:"errorWrapper"},[i("div",{staticClass:"error"},[i("div",[e._v(e._s(e.$t("sendingerror")))]),i("div",{staticClass:"btnwrp"},[i("button",{staticClass:"button small",on:{click:e.showerror}},[e._v(e._s(e.$t("details")))])])])]):e._e(),e._l(e.events,(function(t,n){return i("div",{key:t.event.event_id,staticClass:"eventWrapper"},[i("eventsEvent",{attrs:{event:t,prevevent:e.events[n+1],galleryData:e.events,chat:e.chat,timeline:e.timeline,last:0==n},on:{openImageEvent:function(t){return e.galleryOpen(t)},removeEvent:function(i){return e.removeEvent(t)},editing:function(i){return e.editingEvent({event:t,text:i})},reply:function(i){return e.replyEvent({event:t})},mounted:e.emounted,menuIsVisible:e.menuIsVisibleHandler}})],1)}))],2),e.loading?i("div",{staticClass:"preloadingWrapper"},[i("linepreloader")],1):e._e()]),i("transition",{attrs:{name:"fade"}},[i("div",{directives:[{name:"show",rawName:"v-show",value:e.scrollbottomshow,expression:"scrollbottomshow"}],staticClass:"scrollbottom",on:{click:e.scrolldown}},[i("i",{staticClass:"fas fa-chevron-down"})])])],1)},l=[],c=i("3139"),d=i("c46f"),m={name:"events",props:{timeline:Object,events:Array,chat:Object,loading:Boolean,scrollType:"",error:[Object,Error,String]},components:{},data:function(){return{type:"",tmt:null,lscroll:null,menuOpen:!1,c:1,ls:0,voiceMessageQueue:[]}},provide(){return{addToQueue:(e,t)=>{var i=d["find"](this.voiceMessageQueue,e=>e.id==t);i||(this.voiceMessageQueue=[...this.voiceMessageQueue,{message:e,id:t}])},playNext:e=>{let t=this.sortedVoiceMessageQueue.findIndex(t=>t.id===e),i=-1===t?null:this.sortedVoiceMessageQueue[t+1];i&&(i.message.setTime(0),i.message.play())}}},watch:{events:function(){}},computed:{sortedVoiceMessageQueue(){return d["sortBy"](this.voiceMessageQueue,e=>e.id)},ios(){return c["a"].isios()},...Object(o["c"])({auth:e=>e.auth,mobile:e=>e.mobile,scrollbottomshow:function(){return this.lscroll&&this.lscroll.scrollTop>500}}),eventsByPages:function(){var e=[],t=0;return d["each"](this.events,(function(i){t||e.push([]),e[e.length-1].push(i),t++,t>19&&(t=0)})),e},stringifyiedError:function(){return c["a"].stringify(this.error)}},destroyed:function(){this.core.menu(null)},mounted:function(){},methods:{showerror:function(){return this.$dialog.alert(this.stringifyiedError,{okText:"Ok",backdropClose:!0}).catch(e=>{})},dupdated:d["debounce"]((function(){this.$emit("updated",this.size())}),75),dscroll:d["debounce"]((function(){return this.scroll()}),35),ddscroll:function(e){this.dscroll()},emounted:function(){this.$nextTick((function(){this.scrollCorrection(),this.dupdated()}))},scroll:function(){this.$emit("scroll",this.size())},size:function(){var e={scrollHeight:0,scrollTop:0,clientHeight:0};return this.$refs["container"]&&(e.scrollHeight=this.$refs["container"].scrollHeight,e.scrollTop=this.c*this.$refs["container"].scrollTop,e.clientHeight=this.$refs["container"].clientHeight),this.lscroll=e,e},editingEvent:function(e){let{event:t,text:i}=e;this.$emit("editingEvent",{event:t,text:i})},replyEvent:function(e){let{event:t}=e;this.$emit("replyEvent",{event:t})},removeEvent:function(e){this.$emit("removeEvent",e)},showPhotoSwipe(e){this.isOpen=!0,this.$set(this.options,"index",e)},hidePhotoSwipe(){this.isOpen=!1},galleryOpen(e){this.$emit("galleryEventOpen",e)},scrolldown(){this.scrollToNew(0)},scrollCorrection(){},scrollToNew(e){this.$refs["container"]&&(this.$refs["container"].scrollTop=this.c*e)},menuIsVisibleHandler:function(e){this.menuOpen=e,this.$emit("menuIsVisible",e)},mousewheel:function(e){return"custom"===this.scrollType?void 0:(e.preventDefault(),this.$refs["container"].scrollTop+=-e.deltaY,!1)}}},v=m,h=i("2877");function u(e){var t=i("2460");t.__inject__&&t.__inject__(e)}var p=Object(h["a"])(v,a,l,!1,u,"27e149cf",null,!0),f=p.exports,g={name:"chatList",props:{chat:Object,filterType:String,error:[Object,Error,String]},components:{events:f},data:function(){return{encryptedEvents:[],loading:!1,scrolling:!1,scrollingTo:0,cancelNextScroll:!1,timeline:null,lastEvent:{},scrollType:String,esize:{},p_b:!1,p_f:!1,updateTimeout:null,updateInterval:null,events:[],firstPaginate:!0}},mounted:function(){this.init(),this.chat&&this.readAll()},watch:{active:function(){this.minimized&&!this.active&&this.scrollToNew(0),this.minimized&&this.active&&this.readAll()}},computed:Object(o["c"])({lloading:function(){return this.loading||this["p_f"]||this["p_b"]},auth:e=>e.auth,settings_read:e=>!e.dontreadreceipts,eventsTypes:function(){var e={"m.room.message":!0,"p.room.encrypt.message":!0,"m.room.image":!0,"m.room.audio":!0,"m.room.file":!0,"m.room.member":!0,"m.fully_read":!0};return _.toArray(this.chat&&this.chat.currentState.members||{}).length>2&&(e["m.room.member"]=!0,e["m.room.power_levels"]=!0),e},pocketnet:e=>e.pocketnet,minimized:e=>e.minimized,active:e=>e.active,bin:function(e){return e.pocketnet}}),created(){this.updateInterval=setInterval(this.update,300)},destroyed(){this.timeline&&this.timeline.unpaginate(this.timeline._eventCount,!0),clearInterval(this.updateInterval)},methods:{editingEvent:function(e){let{event:t,text:i}=e;this.$emit("editingEvent",{event:t,text:i})},replyEvent:function(e){let{event:t}=e;this.$emit("replyEvent",{event:t})},removeEvent:function(e){this.chat.getLiveTimeline().removeEvent(e.event.event_id)},wh:function(){if(this.esize.clientHeight)return this.esize.clientHeight},getEvents:function(){var e=this.timeline.getEvents();return e=_.filter(e,e=>{var t=e.event.type;if(!e.localRedactionEvent()&&!e.getRedactionEvent()&&("m.room.power_levels"!==e.event.type||1!==Object.keys(e.event.content.users).length)&&!(this.chat.currentState.getMembers().length<=2&&"m.room.member"===e.event.type))return!this.eventsTypes||this.eventsTypes[t]}),e=e.reverse(),this.relations(e),e=_.sortBy(e,(function(e){return e.replacingEventDate()||e.getDate()||1/0})),e=e.reverse(),e=_.uniq(e,e=>this.core.mtrx.clearEventId(e)||c["a"].makeid()),e=_.sortBy(e,(function(e){return e.getDate()||1/0})),e=e.reverse(),this.$emit("getEvents",e),e},getEventsAndEncrypt:function(){var e=this.getEvents();return Promise.all(_.map(e,e=>{if(!this.chat.pcrypto)return Promise.resolve();if(e.event.decrypted)return Promise.resolve();var t=null,i=c["a"].deep(e,"event.content.msgtype"),n=c["a"].deep(e,"event.content.info.secrets")||c["a"].deep(e,"event.content.pbody.secrets");return n?("m.audio"==i&&(t=this.core.mtrx.getAudio(this.chat,e).catch(t=>{console.error(t),e.event.decrypted={msgtype:"m.bad.encrypted"}})),"m.encrypted"==i&&(t=this.chat.pcrypto.decryptEvent(e.event).then(t=>(e.event.decrypted=t,Promise.resolve())).catch(e=>(e.event.decrypted={msgtype:"m.bad.encrypted"},Promise.resolve())))):"m.audio"==i&&(t=this.core.mtrx.getAudioUnencrypt(this.chat,e)),t?t.catch(e=>Promise.resolve()):Promise.resolve()})).then(()=>Promise.resolve(e))},relations:function(e){var t=this.timeline._timelineSet;_.each(e,e=>{try{var i=t.getRelationsForEvent(e.event.event_id,"m.replace","m.room.message");if(i){var n=i.getLastReplacement();n&&(e.event.content.body=n.event.content.body,e.event.content.edited=n.event.event_id,e.event.content.block=n.event.content.block,e.event.content.msgtype=n.event.content.msgtype)}}catch(e){console.error(e)}})},mediaTimelineSet:function(){var e=Object(s["a"])((function*(){var e=new this.core.mtrx.sdk.Filter(client.getUserId());return e.setDefinition({room:{timeline:{contains_url:!0,types:["m.room.message"]}}}),e.filterId=yield this.core.mtrx.client.getOrCreateFilter("FILTER_FILES_"+this.core.mtrx.client.credentials.userId,e),this.chat.getOrCreateFilteredTimelineSet(e)}));return function(){return e.apply(this,arguments)}}(),init:function(){var e=Object(s["a"])((function*(){this.loading=!0,this.firstPaginate=!0;var e,t=this.chat.getLiveTimeline();"images"===this.filterType?(this.scrollType="custom",e=yield this.mediaTimelineSet()):e=t.getTimelineSet(),this.timeline=new this.core.mtrx.sdk.TimelineWindow(this.core.mtrx.client,e),setTimeout(()=>{this.timeline.load().then(e=>this.getEventsAndEncrypt()).then(e=>{this.events=e,this.loading=!1,setTimeout(()=>{this.autoPaginateAll()},300)}).catch(e=>{this.loading=!1})},30)}));return function(){return e.apply(this,arguments)}}(),autoPaginate:function(e){this.needLoad(e)&&this.paginate(e)},paginate:function(e,t){if(!this.loading&&this.timeline&&!this["p_"+e])if(this.timeline.canPaginate(e)||t){this["p_"+e]=!0;let t=20;this.timeline.paginate(e,t).then(e=>Promise.resolve()).catch(e=>Promise.resolve()).then(e=>this.getEventsAndEncrypt()).then(t=>{this.events=t,this.firstPaginate=!1,this.readAll(),this["p_"+e]=!1})}else this.readAll()},autoPaginateAll:function(){"images"===this.filterType?this.autoPaginate("b"):(this.autoPaginate("b"),this.autoPaginate("f"))},needLoad:function(e){var t=!1,i=this.esize.scrollHeight||0,n=this.esize.scrollTop||0,r=Math.max(this.esize.clientHeight||0,800);if("b"==e){var s=r;i-n<r+s&&(t=!0)}else n<r&&(t=!0);return t},readEvent:function(e){var t=this.core.mtrx.me(e.event.sender);t||this.core.mtrx.client.sendReadReceipt(e)},readFirst:function(){var e=this.timeline.getEvents();this.readEvent(e[0])},readLast:function(){var e=this.timeline.getEvents();this.readEvent(e[e.length-1])},readEvents:function(e){_.each(e,e=>{this.readEvent(e)})},readOne(){this.core.mtrx.client(this.chat.timeline[this.chat.timeline.length-1]).then(e=>e)},readAll:function(){document.hasFocus()&&(!this.pocketnet||this.active)&&!this.core.hiddenInParent&&this.chat&&this.chat.getJoinedMemberCount()>0&&0!==this.chat.getUnreadNotificationCount()&&setTimeout(()=>{if(this.chat){var e=this.chat.timeline.length-1,t=null;while(e>=0&&!t){var i=this.chat.timeline[e];this.core.mtrx.me(i.sender.userId)||(t=i),e--}i&&this.core.mtrx.client.setRoomReadMarkers(this.chat.currentState.roomId,i.eventId,i,{hidden:!this.settings_read}).then(e=>e)}},1e3)},scrollE:function(e){this.updatedSize(e),this.$emit("scroll",e)},updatedSize:function(e){this.esize=e},update:function(e){this.scrolling||this.autoPaginateAll()},scrollToNew:function(e){this.scrolling=!0,this.$refs.eventslist.scrollToNew(e),this.scrolling=!1},imageGallery:function(e){this.$emit("eventImage",e)},menuIsVisibleHandler:function(e){this.$emit("menuIsVisible",e)}}},b=g;function y(e){var t=i("e127");t.__inject__&&t.__inject__(e)}var x=Object(h["a"])(b,n,r,!1,y,"ef061e4a",null,!0);t["a"]=x.exports},"5b0c":function(e,t,i){var n=i("24fb");t=n(!1),t.push([e.i,"[data-v-ef061e4a] .eventMember{text-align:left}[data-v-ef061e4a] .eventMember span{font-size:.9em}.pswp img[data-v-ef061e4a]{max-width:none;-o-object-fit:contain;object-fit:contain}#chatList.minimized:not(.active) .timeLineWrapper[data-v-ef061e4a]{padding-left:.5em}",""]),e.exports=t},"5f7e":function(e,t,i){var n=i("bd86");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var r=i("35d6").default;e.exports.__inject__=function(e){r("e96d3eb2",n,e)}},"7b62":function(e,t,i){var n=i("5b0c");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var r=i("35d6").default;e.exports.__inject__=function(e){r("3b601183",n,e)}},bd86:function(e,t,i){var n=i("24fb");t=n(!1),t.push([e.i,".typingBlock{position:relative}.typingBlock .typingBlockWrapper{position:absolute;left:50%;transform:translateX(-50%);top:-5px;display:flex;align-items:center}.typingBlock .typingBlockWrapper>div{padding:0 .5em}.typingBlock .typingBlockWrapper span{font-size:.7em;color:rgb(var(--neutral-grad-3));opacity:.8}",""]),e.exports=t},c2c1:function(e,t,i){var n=i("0a35");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var r=i("35d6").default;e.exports.__inject__=function(e){r("68313033",n,e)}},e127:function(e,t,i){"use strict";i.r(t);var n=i("7b62");for(var r in n)["default"].indexOf(r)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(r)}}]);
//# sourceMappingURL=matrix-element.0.min.js.map