(window["matrixElement_jsonp"]=window["matrixElement_jsonp"]||[]).push([[17],{"13ac":function(t,e,a){"use strict";a.r(e);var o=a("88bf");for(var i in o)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return o[t]}))}(i)},2245:function(t,e,a){var o=a("bddc");o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);var i=a("35d6").default;t.exports.__inject__=function(t){i("5f181b9c",o,t)}},3094:function(t,e,a){"use strict";var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"chatIcon",class:{unknowngroupusers:t.unknowngroupusers}},[t.groupAvatar?e("div",{staticClass:"chatGroupIcon"},[e("userpic",{attrs:{image:t.groupAvatar,appIcon:t.appIcon}})],1):e("userspic",{key:t.allnotifications,class:{opacity:t.groupAvatar},attrs:{slidesPerView:t.slidesPerView,users:t.usersinfo,status:t.status,unseen:t.unseen,single:t.singleAvatar,appIcon:t.appIcon}}),t.unknowngroupusers?e("div",{staticClass:"unknowngroupusersicon"},[e("i",{staticClass:"fas fa-question"})]):t._e()],1)},i=[],c=a("3139"),r={name:"chatIcon",data:function(){return{single:[]}},props:{chat:{},m_chat:{},slidesPerView:Number,hideunseen:Boolean,dontuseslides:Boolean},computed:{allnotifications:function(){return this.$store.state.allnotifications||"0"},unseen:function(){return this.hideunseen||this.blockedCheck?0:"invite"===this.m_chat.selfMembership&&c["a"].date.addseconds(moment.utc(this.m_chat.summary.lastModified).toDate(),86400)>new Date?1:(this.allnotifications,this.m_chat.getUnreadNotificationCount())},users:function(){if(!this.chat)return[];var t=this.core.mtrx.anotherChatUsers(this.chat.roomId);return this.dontuseslides&&(t=_.first(t,4)),_.first(_.shuffle(t),49)},singleAvatar:function(){if(!this.chat&&!this.m_chat)return{};if("public"===this.m_chat.getJoinRule()&&1===this.m_chat.currentState.getMembers().length){var t=this.m_chat.currentState.getMembers()[0],e=this.$store.state.users[c["a"].getmatrixid(t.userId)];if(e)return e.status=t.membership,e.image=e.source.i,e}return{}},blockedCheck:function(){var t=this.core.mtrx.anotherChatUsers(this.m_chat.roomId);if(1==t.length)return this.core.mtrx.blockeduser(t[0].userId)},usersinfo:function(){var t=this.core.mtrx.chatUsersInfo(this.chat.roomId,"anotherChatUsers");return this.dontuseslides&&(t=_.first(t,4)),_.first(_.shuffle(t),49)},status:function(){var t={};return _.each(this.users,e=>{t[e.userId]=this.core.mtrx.blockeduser(e.userId)?"blocked":e.membership}),t},unknowngroupusers:function(){return this.core.mtrx.kit.unknowngroupusers(this.m_chat)},groupAvatar:function(){var t;const e=null===(t=this.m_chat.currentState.getStateEvents("m.room.avatar")[0])||void 0===t?void 0:t.event.content.avatarUrl;return""!==e?e:""},appIcon:function(){console.log("appIcon",this.chat,this.m_chat)}}},n=r,s=a("2877");function u(t){var e=a("75f5");e.__inject__&&e.__inject__(t)}var d=Object(s["a"])(n,o,i,!1,u,"62ac1bf0",null,!0);e["a"]=d.exports},"3fce":function(t,e,a){var o=a("63cd");o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);var i=a("35d6").default;t.exports.__inject__=function(t){i("63c96eb2",o,t)}},"455b":function(t,e,a){"use strict";a.r(e);var o=a("2245");for(var i in o)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return o[t]}))}(i)},"5f71":function(t,e,a){var o=a("24fb");e=o(!1),e.push([t.i,".chatGroupIcon img[data-v-58240c0c]{width:50%!important}.chatIconWrapper[data-v-58240c0c]{position:relative}.chatIconWrapper img[data-v-58240c0c]{-o-object-fit:cover;object-fit:cover;border-radius:50%}.chatIconEditImage[data-v-58240c0c],.chatIconWrapper img[data-v-58240c0c]{width:100%;height:100%;position:absolute;top:0;left:0}.chatIconEditImage[data-v-58240c0c]{z-index:200;opacity:.9;display:flex;align-items:center;flex-direction:column;justify-content:center}.chatIconEditImage i[data-v-58240c0c]{transform:scale(2);color:rgb(var(--color-bg-ac))}.chatIconFile[data-v-58240c0c]{display:none}.userImagebase64[data-v-58240c0c]{z-index:150}",""]),t.exports=e},"63cd":function(t,e,a){var o=a("24fb");e=o(!1),e.push([t.i,".opacity[data-v-62ac1bf0]{opacity:0}.chatIcon[data-v-62ac1bf0]{width:100%;position:relative}.unknowngroupusersicon[data-v-62ac1bf0]{position:absolute;left:0;top:0;bottom:0;right:0;font-size:.7em;display:flex;justify-content:center;align-items:center;color:#fff;text-shadow:0 0 2px rgba(0,11,58,.714),0 0 3px rgba(0,8,43,.519)}.unknowngroupusers .bgimage[data-v-62ac1bf0]{transform:scale(.7)}.chatGroupIcon[data-v-62ac1bf0],.chatGroupIcon img[data-v-62ac1bf0]{width:100%;height:100%}.chatGroupIcon img[data-v-62ac1bf0]{border-radius:50%;-o-object-fit:cover;object-fit:cover;-o-object-position:50% 50%;object-position:50% 50%;position:absolute;top:0;z-index:100}",""]),t.exports=e},"75f5":function(t,e,a){"use strict";a.r(e);var o=a("3fce");for(var i in o)["default"].indexOf(i)<0&&function(t){a.d(e,t,(function(){return o[t]}))}(i)},"88bf":function(t,e,a){var o=a("5f71");o.__esModule&&(o=o.default),"string"===typeof o&&(o=[[t.i,o,""]]),o.locals&&(t.exports=o.locals);var i=a("35d6").default;t.exports.__inject__=function(t){i("3935ecf8",o,t)}},9394:function(t,e,a){"use strict";a.r(e);var o=function(){var t=this,e=t._self._c;return t.chat?e("div",{staticClass:"page"},[e("topheader",{staticClass:"topheader"}),e("maincontent",{scopedSlots:t._u([{key:"content",fn:function(){return[e("settings",{attrs:{chat:t.chat}})]},proxy:!0}],null,!1,32150248)})],1):t._e()},i=[],c=function(){var t=this,e=t._self._c;return e("div",{attrs:{id:"chatTopheader"}},[e("topheader",{scopedSlots:t._u([{key:"left",fn:function(){return[e("backButton",{attrs:{action:"back"}})]},proxy:!0},{key:"info",fn:function(){return[e("span",[t._v(t._s(t.$t("caption.settings")))])]},proxy:!0},{key:"right",fn:function(){},proxy:!0}])})],1)},r=[],n={methods:{}},s=n,u=a("2877"),d=Object(u["a"])(s,c,r,!1,null,null,null,!0),p=d.exports,h=function(){var t=this,e=t._self._c;t._self._setupProxy;return e("div",{class:{minimized:t.minimized,active:t.active},attrs:{id:"chatSettings"}},[e("div",{staticClass:"chatSettingAbout"},[e("div",{class:{chatIconWrapper:"chatIconWrapper",noSwipe:!0}},[e("upload",{attrs:{onlyimage:!0,multiple:!1,extensions:t.upl.extensions,images:t.upl.images},on:{uploaded:e=>t.uploadUploaded(e),error:e=>t.uploadError(e)},scopedSlots:t._u([{key:"content",fn:function(){return[e("label",{staticClass:"chatIconEditImage",attrs:{for:"roomImage"}},[e("i",{staticClass:"fas fa-camera"})]),e("chatIcon",{attrs:{slidesPerView:4,dontuseslides:t.minimized&&!t.active,chat:t.chat,m_chat:t.m_chat,hideunseen:!0}}),t.userImagebase64?e("img",{staticClass:"userImagebase64",attrs:{src:t.userImagebase64,alt:""}}):t._e()]},proxy:!0},{key:"dropzone",fn:function(){},proxy:!0}])})],1),e("div",{staticClass:"chatNameEdit"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.m_chat.name,expression:"m_chat.name"}],attrs:{type:"text",placeholder:"Name"},domProps:{value:t.m_chat.name},on:{input:function(e){e.target.composing||t.$set(t.m_chat,"name",e.target.value)}}})]),t.topic?e("div",{staticClass:"chatDescription"},[e("textarea",{directives:[{name:"model",rawName:"v-model",value:t.topicTxt,expression:"topicTxt"}],attrs:{type:"text",placeholder:"Description",maxlength:"1000"},domProps:{value:t.topicTxt},on:{input:function(e){e.target.composing||(t.topicTxt=e.target.value)}}})]):t._e(),e("button",{staticClass:"button small rounded inSettings",on:{click:function(e){return t.saveEdited()}}},[t._v(" "+t._s(t.$t("button.save"))+" ")])])])},l=[],m=(a("14d9"),a("2f62")),v=a("3094"),g=a("6b57"),b={data:()=>({pubChat:Object,topicTxt:"",topic:!1,userImagebase64:null,upl:{extensions:["jpg","jpeg","png","webp"],images:{resize:{width:200,height:200,type:"fit"}}}}),props:{chat:Object,saveClicked:!1},components:{chatIcon:v["a"],upload:g["a"]},computed:Object(m["c"])({pocketnet:t=>t.pocketnet,minimized:t=>t.minimized,active:t=>t.active,auth:t=>t.auth,m_chat:function(){return this.core.mtrx.client.getRoom(this.chat.roomId)},shareRoomLink:function(){return`https://${this.core.domain}/publicPreview/welcome?connect=${this.chat.roomId.replace("!","%")}`}}),mounted(){var t;const e=null===(t=this.m_chat.currentState.getStateEvents("m.room.avatar")[0])||void 0===t?void 0:t.event.content.avatarUrl;this.userImagebase64=""!==e?e:null,"public"===this.m_chat.getJoinRule()&&(this.getPublicRoom(),this.topic=!0)},methods:{cameraHandlerCustom:function(){var t=[];window.POCKETNETINSTANCE.platform.ui.uploadImage({multiple:!0,action:(e,a)=>{let{base64:o}=e;return this.resizeImage(o).then(e=>f.Base64.toFile(e).then(o=>{var i={base64:e,file:o};t.push(i),this.uploadUploaded(i),a()})).catch(t=>{console.error(t),a()})},onSuccess:t=>{}})},saveEdited(){var t=[];t.push(this.core.mtrx.client.setRoomAvatarUrl(this.m_chat.roomId,this.userImagebase64).catch(t=>Promise.reject("image"))),t.push(this.core.mtrx.client.setRoomName(this.m_chat.roomId,"@"+this.m_chat.name.replace(/[@]*/g,"")).catch(t=>Promise.reject("image"))),t.push(this.core.mtrx.client.setRoomTopic(this.chat.roomId,this.topicTxt.replace(/ /g,"_")).then(t=>t).catch(t=>Promise.reject("topic"))),this.$store.state.globalpreloader=!0,Promise.all(t).then(()=>{this.$store.commit("icon",{icon:"success"})}).catch(t=>{this.$store.commit("icon",{icon:"error"})}).finally(()=>{this.$store.state.globalpreloader=!1})},getPublicRoom(){this.core.mtrx.client.publicRooms().then(t=>{this.pubChat=t.chunk.filter(t=>t.room_id===this.chat.roomId)[0],this.pubChat["topic"]&&(this.topicTxt=this.pubChat["topic"].replace(/_/g," "))})},handleImage(t){const e=t.target.files[0];this.createBase64Image(e)},uploadUploaded(t){this.userImagebase64=t.base64},uploadError(){},createBase64Image(t){const e=new FileReader;e.onload=t=>{this.userImagebase64=t.target.result},e.readAsDataURL(t)}}},_=b;function x(t){var e=a("455b");e.__inject__&&e.__inject__(t);var o=a("13ac");o.__inject__&&o.__inject__(t)}var I=Object(u["a"])(_,h,l,!1,x,"58240c0c",null,!0),w=I.exports,k={name:"chatSettings",data:function(){return{}},components:{topheader:p,settings:w},computed:{chat(){return this.$store.state.chatsMap[this.$route.query.id.replace("%","!")]}},methods:{}},y=k,j=Object(u["a"])(y,o,i,!1,null,null,null,!0);e["default"]=j.exports},bddc:function(t,e,a){var o=a("24fb");e=o(!1),e.push([t.i,".inSettings[data-v-58240c0c]{margin:30px auto;display:block}.chatIconWrapper[data-v-58240c0c]{width:120px}.linkPlace[data-v-58240c0c]{margin-top:30px;padding:.5em 0;cursor:pointer;border-top:1px solid rgb(var(--background-main))}.linkPlace span[data-v-58240c0c]{font-size:1em;display:block;text-align:left;max-width:400px;overflow:hidden;white-space:nowrap;text-overflow:ellipsis}.linkPlace .shareLink[data-v-58240c0c]:hover{color:rgb(var(--color-txt-ac))}.chatSettingAbout[data-v-58240c0c]{padding:1em 0}.chatSettingAbout .chatNameEdit[data-v-58240c0c]{margin-top:1em}.chatSettingAbout .chatNameEdit input[data-v-58240c0c]{padding:1em;display:block;width:100%}.chatSettingAbout .chatNameEdit input[data-v-58240c0c],.chatSettingAbout .chatNameEdit input[data-v-58240c0c]:focus{border-bottom:1px solid rgb(var(--neutral-grad-1));border-top:1px solid rgb(var(--neutral-grad-1))}.chatSettingAbout .chatDescription textarea[data-v-58240c0c]{font-size:.9em;display:block;width:100%;resize:none;padding:1em}.chatIconWrapper[data-v-58240c0c]{width:200px;height:200px;margin:0 auto}.chatIconWrapper .chatIcon[data-v-58240c0c]{width:100%;height:100%;overflow:hidden;position:absolute}.chatIconWrapper .upload[data-v-58240c0c],.chatIconWrapper[data-v-58240c0c] .uploadWrapper{height:100%}.chatIconWrapper[data-v-58240c0c] .inputWrapper{z-index:201}.chatIconWrapper[data-v-58240c0c] .swiperWrapperFlex .imageSwiper{width:100px;height:100px;line-height:100px}.chatIconWrapper[data-v-58240c0c] .swiperWrapperFlex{padding-bottom:1em}.chatIconWrapper[data-v-58240c0c] .fourAvatars,.chatIconWrapper[data-v-58240c0c] .threeAvatars,.chatIconWrapper[data-v-58240c0c] .twoAvatars{width:100%;padding-bottom:100%;box-shadow:0 5px 7px -5px rgba(var(--color-shadow-base),.7);background:rgba(var(--background-total-theme),.3)}.chatIconWrapper[data-v-58240c0c] .oneuser{width:100%;margin:0 auto}.chatIconWrapper[data-v-58240c0c] .bgimage{box-shadow:0 5px 7px -5px rgba(var(--color-shadow-base),.7)}.minimized:not(.active) .chatDescription[data-v-58240c0c],.minimized:not(.active) .chatNameEdit[data-v-58240c0c]{display:none}.minimized[data-v-58240c0c]:not(.active) .chatIconWrapper{width:52px;margin:0}",""]),t.exports=e}}]);
//# sourceMappingURL=matrix-element.17.min.js.map