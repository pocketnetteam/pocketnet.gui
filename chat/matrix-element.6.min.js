(window["matrixElement_jsonp"]=window["matrixElement_jsonp"]||[]).push([[6],{"0bb9":function(e,t,i){var r,n,o;function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}(function(i,a){n=[t],r=a,o="function"===typeof r?r.apply(t,n):r,void 0===o||(e.exports=o)})("undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self&&self,(function(e){"use strict";function t(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&i(e,t)}function i(e,t){return i=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},i(e,t)}function r(e){var t=s();return function(){var i,r=c(e);if(t){var o=c(this).constructor;i=Reflect.construct(r,arguments,o)}else i=r.apply(this,arguments);return n(this,i)}}function n(e,t){if(t&&("object"===a(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return o(e)}function o(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function s(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function c(e){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},c(e)}function l(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function d(e,t){var i="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!i){if(Array.isArray(e)||(i=u(e))||t&&e&&"number"===typeof e.length){i&&(e=i);var r=0,n=function(){};return{s:n,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){i=i.call(e)},n:function(){var e=i.next();return a=e.done,e},e:function(e){s=!0,o=e},f:function(){try{a||null==i.return||i.return()}finally{if(s)throw o}}}}function u(e,t){if(e){if("string"===typeof e)return h(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?h(e,t):void 0}}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,r=new Array(t);i<t;i++)r[i]=e[i];return r}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function m(e,t,i){return t&&f(e.prototype,t),i&&f(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function v(e,t,i){g(e,t),t.set(e,i)}function g(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")}function b(e,t){var i=w(e,t,"get");return y(e,i)}function y(e,t){return t.get?t.get.call(e):t.value}function x(e,t,i){var r=w(e,t,"set");return _(e,r,i),i}function w(e,t,i){if(!t.has(e))throw new TypeError("attempted to "+i+" private field on non-instance");return t.get(e)}function _(e,t,i){if(t.set)t.set.call(e,i);else{if(!t.writable)throw new TypeError("attempted to set read only private field");t.value=i}}Object.defineProperty(e,"__esModule",{value:!0}),e.CancelablePromise=void 0,e.cancelable=P,e.default=void 0,e.isCancelablePromise=T;var E=new WeakMap,R=new WeakMap,$=function(){function e(t){var i=t.executor,r=void 0===i?function(){}:i,n=t.internals,o=void 0===n?S():n,a=t.promise,s=void 0===a?new Promise((function(e,t){return r(e,t,(function(e){o.onCancelList.push(e)}))})):a;p(this,e),v(this,E,{writable:!0,value:void 0}),v(this,R,{writable:!0,value:void 0}),this.cancel=this.cancel.bind(this),x(this,E,o),x(this,R,s||new Promise((function(e,t){return r(e,t,(function(e){o.onCancelList.push(e)}))})))}return m(e,[{key:"then",value:function(e,t){return j(b(this,R).then(M(e,b(this,E)),M(t,b(this,E))),b(this,E))}},{key:"catch",value:function(e){return j(b(this,R).catch(M(e,b(this,E))),b(this,E))}},{key:"finally",value:function(e,t){var i=this;return t&&b(this,E).onCancelList.push(e),j(b(this,R).finally(M((function(){if(e)return t&&(b(i,E).onCancelList=b(i,E).onCancelList.filter((function(t){return t!==e}))),e()}),b(this,E))),b(this,E))}},{key:"cancel",value:function(){b(this,E).isCanceled=!0;var e=b(this,E).onCancelList;b(this,E).onCancelList=[];var t,i=d(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;if("function"===typeof r)try{r()}catch(n){console.error(n)}}}catch(n){i.e(n)}finally{i.f()}}},{key:"isCanceled",value:function(){return!0===b(this,E).isCanceled}}]),e}(),C=function(e){t(n,e);var i=r(n);function n(e){return p(this,n),i.call(this,{executor:e})}return m(n)}($);e.CancelablePromise=C,l(C,"all",(function(e){return I(e,Promise.all(e))})),l(C,"allSettled",(function(e){return I(e,Promise.allSettled(e))})),l(C,"any",(function(e){return I(e,Promise.any(e))})),l(C,"race",(function(e){return I(e,Promise.race(e))})),l(C,"resolve",(function(e){return P(Promise.resolve(e))})),l(C,"reject",(function(e){return P(Promise.reject(e))})),l(C,"isCancelable",T);var k=C;function P(e){return j(e,S())}function T(e){return e instanceof C||e instanceof $}function M(e,t){if(e)return function(i){if(!t.isCanceled){var r=e(i);return T(r)&&t.onCancelList.push(r.cancel),r}return i}}function j(e,t){return new $({internals:t,promise:e})}function I(e,t){var i=S();return i.onCancelList.push((function(){var t,i=d(e);try{for(i.s();!(t=i.n()).done;){var r=t.value;T(r)&&r.cancel()}}catch(n){i.e(n)}finally{i.f()}})),new $({internals:i,promise:t})}function S(){return{isCanceled:!1,onCancelList:[]}}e.default=k}))},1097:function(e,t,i){var r=i("f2bc");r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var n=i("35d6").default;e.exports.__inject__=function(e){n("2ab77a92",r,e)}},"16e59":function(e,t,i){var r=i("5c95");r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var n=i("35d6").default;e.exports.__inject__=function(e){n("cb65d9a2",r,e)}},"2bea":function(e,t,i){var r,n;(function(i){"use strict";var o=function(e,t,i){if(!Array.isArray(e))throw new TypeError("each() expects array as first argument");if("function"!==typeof t)throw new TypeError("each() expects function as second argument");if("function"!==typeof i&&(i=Function.prototype),0===e.length)return i(void 0,e);var r=new Array(e.length),n=0,o=!1;e.forEach((function(a,s){t(a,(function(t,a){if(!o)return t?(o=!0,i(t)):(r[s]=a,n+=1,n===e.length?i(void 0,r):void 0)}))}))};r=[],n=function(){return o}.apply(t,r),void 0===n||(e.exports=n)})()},"2e53":function(e,t,i){"use strict";i("1097")},3136:function(e,t,i){"use strict";i("53b4")},"439c":function(e,t,i){"use strict";i("16e59")},4994:function(e,t,i){"use strict";i("5a58")},"53b4":function(e,t,i){var r=i("aeb2");r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var n=i("35d6").default;e.exports.__inject__=function(e){n("3160b183",r,e)}},"5a58":function(e,t,i){var r=i("ead2");r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var n=i("35d6").default;e.exports.__inject__=function(e){n("0810035e",r,e)}},"5c95":function(e,t,i){var r=i("24fb");t=r(!1),t.push([e.i,".upload[data-v-a28e80a8]{width:100%}.uploadWrapper[data-v-a28e80a8]{position:relative}.uploadWrapper .inputWrapper[data-v-a28e80a8],.uploadWrapper .inputWrapper input[data-v-a28e80a8]{position:absolute;left:0;right:0;top:0;bottom:0;opacity:0}",""]),e.exports=t},aeb2:function(e,t,i){var r=i("24fb");t=r(!1),t.push([e.i,"#chatInput[data-v-e8b463ac]{padding-bottom:.5em}[data-v-e8b463ac] #modal.minimized .modal-wrapper{left:0}[data-v-e8b463ac] .previewWrapper{padding-left:.5em!important;padding-right:.5em!important}.inputWrapper[data-v-e8b463ac]{display:flex}.inputWrapper .left[data-v-e8b463ac]{width:35px;display:flex;justify-content:flex-end;align-items:center;text-align:center}.inputWrapper .left .iconbutton[data-v-e8b463ac]{display:flex;align-items:center;justify-content:center;height:35px;width:35px;-webkit-tap-highlight-color:transparent}.inputWrapper .extended[data-v-e8b463ac]{width:70px;margin-left:7px}.inputWrapper .leftdummy[data-v-e8b463ac]{width:.5em}.inputWrapper>div[data-v-e8b463ac]{transition:.3s}.inputWrapper .center[data-v-e8b463ac]{max-height:110px;max-width:100%;display:flex;justify-content:space-between;align-items:center;flex-grow:1;border:1px solid transparent;border-radius:30px;background:rgb(var(--background-secondary-theme))}.inputWrapper input[data-v-e8b463ac]{border:1px solid rgb(var(--neutral-grad-0));background:rgba(var(--background-main),.5);border-radius:30px;width:100%;padding:.5em 1em}.notready[data-v-e8b463ac],.waitjoined[data-v-e8b463ac]{padding:.5em 0;text-align:center}.waitjoined span[data-v-e8b463ac]{font-size:.8em}.greetings[data-v-e8b463ac]{padding:.5em 0}.greetings[data-v-e8b463ac],[data-v-e8b463ac] .iconWrapper{text-align:center}.menu-item[data-v-e8b463ac]{padding:.5em;background:rgb(var(--background-total-theme));line-height:44px;border-radius:5px;display:flex}.menu-item .title[data-v-e8b463ac]{flex-grow:2;padding-right:44px;text-align:center}.menu-item .iconWrapper[data-v-e8b463ac]{width:44px}.tipusers[data-v-e8b463ac]{position:absolute;max-height:300px;border-radius:.5em;border:1px solid rgba(var(--neutral-grad-0),.9);overflow-y:overlay;background-color:rgba(var(--background-total-theme),.95);backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(4px);padding:.25em 0;bottom:100%;margin-bottom:.5em;left:.25em;right:.25em}.tipusers .previewWrapperExt[data-v-e8b463ac]{border-radius:.75em;margin-left:.25em;margin-right:.25em;padding-top:.25em;padding-bottom:.25em;transition:.4s}.tipusers .previewWrapperExt[data-v-e8b463ac] .previewWrapper{padding-left:.25em!important;padding-right:.25em!important}.tipusers .previewWrapperExt[data-v-e8b463ac]:hover{cursor:pointer;transition:.4s}.tipusers .previewWrapperExt.selected[data-v-e8b463ac],.tipusers .previewWrapperExt[data-v-e8b463ac]:hover{background:rgb(var(--background-main))}.disabled[data-v-e8b463ac]{display:flex;justify-content:center;align-items:center;width:35px;height:35px;color:rgb(var(--neutral-grad-3))}.disabled i[data-v-e8b463ac]{padding-top:1px}",""]),e.exports=t},ead2:function(e,t,i){var r=i("24fb");t=r(!1),t.push([e.i,'.recordButton_wrapper[data-v-34d15f18]{position:relative}.recordButton_holder[data-v-34d15f18]{visibility:hidden;position:absolute;display:flex;justify-content:center;align-items:center;height:16px;width:16px;background:#789;border-radius:50%;bottom:98px;transition:.1s;right:9px}.recordButton_holder .icon[data-v-34d15f18]{color:#fff;font-size:7px}.recordButton_holder.active[data-v-34d15f18]{visibility:visible}.recordButton_holder.hold[data-v-34d15f18]{background:#789;visibility:visible;bottom:38px}.recordButton_holder.hold .icon[data-v-34d15f18]{color:#fff}.recordButton_main[data-v-34d15f18]{padding-top:1px;touch-action:none;display:flex;align-items:center;justify-content:center;width:35px;height:35px;line-height:35px!important;background:transparent;border-radius:50%;outline:none;position:relative}.recordButton_main.active[data-v-34d15f18]{background:rgb(var(--color-bg-ac));-webkit-animation:pulse-data-v-34d15f18 1.2s infinite;animation:pulse-data-v-34d15f18 1.2s infinite}.recordButton_main.active .icon[data-v-34d15f18]{color:rgb(var(--text-on-bg-shadow-color))}.recordButton_main.active[data-v-34d15f18]:before{position:absolute;left:-30px;bottom:-30px;right:-30px;top:-30px;content:"";border-radius:50%;border:35px solid rgba(var(--color-bg-ac),.5);-webkit-animation:pulse-data-v-34d15f18 1.2s infinite;animation:pulse-data-v-34d15f18 1.2s infinite}.recordButton_main.disabled .icon[data-v-34d15f18]{color:rgb(var(--neutral-grad-2))}.recordButton_main.outside[data-v-34d15f18],.recordButton_stop[data-v-34d15f18]{background:rgb(var(--color-bad))}.recordButton_stop[data-v-34d15f18]{color:rgb(var(--text-on-bg-shadow-color));font-size:.7em}@-webkit-keyframes pulse-data-v-34d15f18{0%{opacity:1}50%{opacity:.8}to{opacity:1}}@keyframes pulse-data-v-34d15f18{0%{opacity:1}50%{opacity:.8}to{opacity:1}}',""]),e.exports=t},f2bc:function(e,t,i){var r=i("24fb");t=r(!1),t.push([e.i,".recordProgress[data-v-3f87c0fa]{display:flex;height:20px;justify-content:flex-start;padding:0 1em;align-items:center;max-width:80%;flex-grow:2}.recordProgress .indicatorWrapper[data-v-3f87c0fa]{min-width:20px;width:20px;margin-right:1em;display:flex;justify-content:center;align-items:center}.recordProgress .indicator[data-v-3f87c0fa]{height:6px;width:6px;background:#ff033e;border-radius:50%}.recordProgress .indicator.recording[data-v-3f87c0fa]{-webkit-animation:pulse-data-v-3f87c0fa 1.2s ease infinite;animation:pulse-data-v-3f87c0fa 1.2s ease infinite}.recordProgress .del[data-v-3f87c0fa]{min-width:20px;cursor:pointer;display:flex;justify-content:center;align-items:center;width:20px;height:20px;margin-right:1em}.recordProgress .del i[data-v-3f87c0fa]{color:red;font-size:13px}.recordProgress .timer[data-v-3f87c0fa]{margin-right:1em}.recordProgress .graph[data-v-3f87c0fa]{margin:0 auto;width:100px;overflow:hidden;border-radius:15px}.cancel[data-v-3f87c0fa],.recordProgress .graph[data-v-3f87c0fa]{display:flex;justify-content:center}.cancel[data-v-3f87c0fa]{position:absolute;left:0;right:0;top:0;bottom:0;background:rgb(var(--background-secondary-theme));opacity:0;text-align:center;align-items:center}.cancel span[data-v-3f87c0fa]{white-space:nowrap;font-size:.9em}@-webkit-keyframes pulse-data-v-3f87c0fa{0%{opacity:1}50%{opacity:.1}to{opacity:1}}@keyframes pulse-data-v-3f87c0fa{0%{opacity:1}50%{opacity:.1}to{opacity:1}}",""]),e.exports=t},fe01:function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"noswipepnt",attrs:{id:"chatInput"}},[e.ready?i("div",{staticClass:"work"},[e.chat?i("div",{staticClass:"inputWrapper"},[e.tipusers.length?i("div",{staticClass:"tipusers"},e._l(e.tipusers,(function(t,r){return i("div",{key:t.id,staticClass:"previewWrapperExt",class:{selected:e.tipuserindex==r},on:{click:function(i){return e.insertuser(t)}}},[i("preview",{attrs:{contact:t,mode:""}})],1)})),0):e._e(),i("div",{staticClass:"center"},[e.voiceEnable&&(e.isRecording||e.record)?i("record-progress",{attrs:{recordTime:e.recordTime,isRecording:e.isRecording,rmsData:e.recordRmsData,opacity:e.cancelOpacity},on:{onClear:e.clear}}):i("InputField",{ref:"newinput",attrs:{storagekey:"chatinput"+e.chat.roomId,tipusers:e.tipusers},on:{chatMessage:e.sendinput,emptyInput:e.emitInputData,FilledInput:e.HideUploadPic,base64:e.pasteImage,focused:e.focused,tipsearchrequest:e.tipBySearch,browsetip:e.browsetip,selectcurrenttip:e.selectcurrenttip}}),e.upload&&e.chat?i("div",{staticClass:"left",class:{extended:e.voiceEnable}},[e.isRecording||e.record?e._e():i("div",{staticClass:"iconbutton"},[i("dropdownMenu",{ref:"dropdownMenu",attrs:{menuItems:e.menuItems,rowObject:{},icon:"fas fa-plus"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.item.upload?i("upload",{attrs:{onlyimage:t.item.upload.onlyimage,multiple:t.item.upload.multiple,extensions:t.item.upload.extensions,images:t.item.upload.images},on:{start:function(i){return e.uploadStart(t.item,i)},uploaded:function(i){return e.uploadUploaded(t.item,i)},uploadedAll:function(i){return e.uploadUploadedAll(t.item,i)},error:function(i){return e.uploadError(t.item,i)}},scopedSlots:e._u([{key:"content",fn:function(){return[i("div",{staticClass:"menu-item"},[i("div",{staticClass:"iconWrapper"},[t.item.icon?i("i",{class:t.item.icon}):e._e()]),i("div",{staticClass:"title"},[e._v(" "+e._s(t.item.title)+" ")])])]},proxy:!0},{key:"dropzone",fn:function(){},proxy:!0}],null,!0)}):i("div",{staticClass:"menu-item",on:{click:function(i){return e.menuItemClick(t.item)}}},[i("div",{staticClass:"iconWrapper"},[t.item.icon?i("i",{class:t.item.icon}):e._e()]),i("div",{staticClass:"title"},[e._v(" "+e._s(t.item.title)+" ")])])]}}],null,!1,3187246467)})],1),e.voiceEnable?[i("div",{directives:[{name:"show",rawName:"v-show",value:e.isRecording||!e.record,expression:"(isRecording || !record)"}],staticClass:"iconbutton"},[i("recordVoice",{attrs:{prepareRecording:!!e.prepareRecording,isRecording:e.isRecording,disabled:e.microphoneDisabled},on:{onRecordingStart:e.initRecording,onRecordingStop:e.stopRecording,onClear:e.clear,canceling:e.setOpacity}})],1)]:e._e(),!e.isRecording&&e.record?i("div",{staticClass:"iconbutton",on:{click:function(t){e.sendVoiceMessage()}}},[e._m(0)]):e._e()],2):e._e()],1)]):e._e()]):i("div",{staticClass:"notready"},[i("linepreloader")],1)])},n=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("i",{staticClass:"icon fas fa-paper-plane"})])}],o=i("1da1"),a=(i("907a"),i("3c5d"),i("3139")),s=i("ed32"),c=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"recordButton_wrapper"},[i("div",{ref:"holder",staticClass:"recordButton_holder",class:{hold:e.isHold}},[i("i",{staticClass:"icon fas",class:e.isHold?"fa-lock":"fa-lock-open"})]),e.isHold?e._e():i("div",{ref:"toggle",staticClass:"recordButton_micro recordButton_main",class:{active:e.isRecording,disabled:e.disabled},on:{mousedown:e.mousedown,mouseup:e.mouseup,touchstart:e.handleTouchStart,touchend:e.handleTouchEnd,touchcancel:e.handleTouchEnd}},[i("i",{staticClass:"icon fas fa-microphone"})]),e.isHold?i("div",{ref:"stop",staticClass:"recordButton_stop recordButton_main",on:{click:e.recordEnd}},[i("i",{staticClass:"icon fas fa-stop"})]):e._e()])},l=[],d=i("2f62"),u={name:"recordVoice",props:{isRecording:{type:Boolean,required:!0},prepareRecording:{type:Boolean},disabled:Boolean},data(){return{start:0,isHold:!1,direction:null}},computed:{...Object(d["c"])({mobile:e=>e.mobile})},mounted(){},beforeDestroy(){document.removeEventListener("mousemove",this.handleMove),document.removeEventListener("touchmove",this.handleMove),this.isRecording&&this.$emit("onRecordingStop",{cancel:!0})},methods:{mouseup:function(e){this.mobile||this.handleTouchEnd(e)},mousedown:function(e){this.mobile||this.handleTouchStart(e)},handleTouchStart(e){if(this.isRecording){if(this.isHold)return}else this.$emit("onRecordingStart");this.start={Y:e.changedTouches?e.changedTouches[0].pageY:e.pageY,X:e.changedTouches?e.changedTouches[0].pageX:e.pageX},this.mobile?document.addEventListener("touchmove",this.handleMove):document.addEventListener("mousemove",this.handleMove)},handleTouchEnd(e){this.isHold||((this.isRecording||this.prepareRecording)&&this.$emit("onRecordingStop",{sendnow:!0}),document.removeEventListener("mousemove",this.handleMove),document.removeEventListener("touchmove",this.handleMove),this.clearStyle())},clearStyle(){this.$refs.toggle&&(this.$refs.toggle.style.transform="translate(0,0)",this.$refs.toggle.classList.remove("outside")),this.$refs.holder&&this.$refs.holder.classList.remove("active")},handleMove(e){var t;if(!this.isRecording)return;let i=this.start.Y-e.pageY,r=this.start.X-e.pageX;null!==e&&void 0!==e&&null!==(t=e.changedTouches)&&void 0!==t&&t.length&&(i=this.start.Y-e.changedTouches[0].pageY,r=this.start.X-e.changedTouches[0].pageX),this.direction=i>5&&r<5?"Y":"X",i>5&&"Y"===this.direction?(this.$refs.holder.classList.contains("active")||this.$refs.holder.classList.add("active"),this.$refs.toggle.style.transform=`translate(0,-${i}px)`,i>70&&(this.$refs.toggle.style.transform="translate(0,0)",document.removeEventListener("mousemove",this.handleMove),document.removeEventListener("touchmove",this.handleMove),this.isHold=!0)):r>5&&"X"===this.direction?(this.$refs.toggle.style.transform=`translate(-${r}px, 0)`,this.$refs.holder.classList.contains("outside")||this.$refs.toggle.classList.add("outside"),this.$emit("canceling",(r-5)/130),r>130&&(this.$refs.toggle.style.transform="translate(0,0)",document.removeEventListener("mousemove",this.handleMove),document.removeEventListener("touchmove",this.handleMove),this.$emit("onRecordingStop",{cancel:!0}),this.$emit("onClear"))):this.clearStyle()},recordEnd(e){if(this.clearStyle(),this.isRecording&&this.isHold)return this.$emit("onRecordingStop",{}),void(this.isHold=!1)}}},h=u,p=(i("4994"),i("2877")),f=Object(p["a"])(h,c,l,!1,null,"34d15f18",null),m=f.exports,v=i("5059"),g=i("f978"),b=i("92a6"),y=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"recordProgress"},[e.isRecording?i("div",{staticClass:"indicatorWrapper"},[i("div",{staticClass:"indicator",class:{recording:e.isRecording}})]):i("div",{staticClass:"del",on:{click:e.clear}},[i("i",{staticClass:"fas fa-trash"})]),i("div",{staticClass:"timer"},[e._v(e._s(e.timer))]),i("div",{ref:"graph",staticClass:"graph"},[i("canvas",{ref:"canvas",attrs:{id:"canvas",width:e.width,height:"20"}})]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isRecording&&e.opacity,expression:"isRecording && opacity"}],ref:"cancel",staticClass:"cancel"},[i("span",[e._v("Slide left to cancel")])])])},x=[],w={name:"recordProgress",props:{recordTime:{type:Number,required:!0},rmsData:{type:Array,required:!0},isRecording:{type:Boolean},opacity:{}},data(){return{width:0}},computed:{timer(){let e=Math.floor(this.recordTime/6e4),t=Math.floor(this.recordTime/1e3)%60;return`${e?e+":":"0:"}${t<10?"0"+t:t}`},rmsDataLast(){return _.last(this.rmsData,25)}},watch:{rmsData:_.throttle((function(){this.draw()}),30),opacity:function(){this.$refs.cancel.style.opacity=this.opacity}},mounted(){this.$refs.cancel.style.opacity=0;let e=this.$refs.graph.offsetWidth;this.width=e-e%100,window.addEventListener("resize",this.resize)},beforeDestroy(){window.removeEventListener("resize",this.resize)},methods:{resize(){let e=null;var t=()=>{e||(e=setTimeout(()=>{e=null;let t=this.$refs.graph.offsetWidth;this.width=t-t%100},50))};t()},draw(){if(!this.$refs.canvas)return;const e=this.$refs.canvas.getContext("2d");let t=50,i=2;var r=this.rmsDataLast.length,n=Math.max(Math.floor(r/t),1);e.clearRect(0,0,this.width,20);for(let o=0;o<r;o+=n)e.fillStyle="#00a4ff",e.fillRect(2*o*i,10-this.rmsDataLast[o]/8,i,this.rmsDataLast[o]/4+1)},clear(){this.$emit("onClear")}}},E=w,R=(i("2e53"),Object(p["a"])(E,y,x,!1,null,"3f87c0fa",null)),$=R.exports,C=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"upload"},[i("div",{staticClass:"uploadWrapper"},[i("div",{staticClass:"contentWrapper"},[e._t("content",(function(){return[i("i",{staticClass:"fas fa-plus"})]}))],2),i("div",{staticClass:"inputWrapper"},[i("input",{attrs:{type:"file",multiple:e.multiple},on:{change:e.upload}})])]),e.dropzone?i("div",{ref:"dropzone",staticClass:"dropzone",class:{dropzone:e.dropzone}},[e._t("dropzone",(function(){return[i("i",{staticClass:"fas fa-plus"}),e._v(" "+e._s(e.$t("caption.dragAndDropAFile"))+" ")]}))],2):e._e()])},k=[],P=(i("d9e2"),i("2bea")),T=new v["a"],M={name:"upload",directives:{},props:{dropzone:String,multiple:Boolean,onlyimage:Boolean,maxsize:{default:25,type:Number},extensions:{type:Array,default:()=>[]},images:{type:Object,default:()=>{}}},data:function(){return{loading:!1}},computed:{maxSize(){return 1024*this.maxsize*1024}},created:()=>{},methods:{read:function(e){var t=new FileReader;return new Promise((i,r)=>{t.onloadend=function(t){i({base64:t.target.result,file:e})},t.readAsDataURL(e)})},upload:function(e){var t,i;e.stopPropagation(),e.preventDefault();var r=(null===(t=e.dataTransfer)||void 0===t?void 0:t.files)||(null===(i=e.target)||void 0===i?void 0:i.files)||e.files||[],n={};this.loading=!0,this.$emit("start",r);var o=this;P(_.toArray(r),(e,t)=>{var i=this.check(e);if(i)return o.$emit("error",{error:i,file:e,text:this.errorText(i,e)}),void t(new Error(i));this.read(e).then(e=>(n[e.file.name]=e,this.handle(e))).then(e=>{o.$emit("uploaded",e),t()}).catch(r=>{o.$emit("error",{error:r,file:e,text:this.errorText(r,e)}),t(new Error(i))})},e=>{this.loading=!1,o.$emit("uploadedAll",n)})},errorText:function(e,t){return"filesize"===e?"File Size Error: ("+t.name+"). The File can't be more than "+this.maxsize+" mbytes":"fileext"===e?"File Extension Error:"+t.name:void 0},check:function(e){return this.checkSize(e)?this.checkExtension(e)?void 0:"fileext":"filesize"},checkSize:function(e){return e.size<=this.maxSize},getExtension:function(e){var t=e.name.split("."),i=t[t.length-1].toLowerCase();return i},checkExtension:function(e){return!this.extensions.length||-1!=_.indexOf(this.extensions,this.getExtension(e))},handle:function(e){return"image/jpeg"===e.file.type||"image/png"===e.file.type||"image/webp"===e.file.type?this.handleImages(e):Promise.resolve(e)},sendAnyFile:function(e){this.$emit("anyFile",e)},resizeIfNeed:function(e,t){if(this.images.resize){var i=this.images.resize.type||"def";return T.resize[i](e,this.images.resize.width||1024,this.images.resize.height||1024,t,this.images.resize.quality||.85).then(e=>Promise.resolve(e)).catch(e=>Promise.reject(e))}return Promise.resolve(e)},handleImages:function(e){return T.autorotation(e.file,e.base64).then(t=>(e.base64=t,Promise.resolve(e))).then(e=>this.resizeIfNeed(e.base64,e.file.type).then(t=>(e.base64=t,Promise.resolve(e))))}}},j=M,I=(i("439c"),Object(p["a"])(j,C,k,!1,null,"a28e80a8",null)),S=I.exports,O=i("0bb9"),z={name:"chatInput",props:{chat:Object,u:String,relationEvent:Object},components:{InputField:s["a"],contacts:g["default"],preview:b["a"],recordProgress:$,recordVoice:m,upload:S},data:function(){return{upload:!0,test:[],loading:!1,text:"",file:{},fileInfo:{},ready:!1,creating:!1,userId:"",showuserselect:null,anyUrlMeta:String,joinedMembers:[],tipvalue:null,tipuserindex:0,record:null,recordRmsData:[],isRecording:!1,mediaRecorder:null,audioContext:null,audioAnalyser:null,recordTime:0,interval:null,cancelOpacity:0,microphoneDisabled:!1,prepareRecording:!1,cancelledCordovaMediaRecorder:!1}},watch:{usersForKeysHash:{handler:function(){}},tipusers:function(){this.tipusers.length?this.tipuserindex>this.tipusers.length-1&&(this.tipuserindex=this.tipusers.length-1):this.tipuserindex=0}},beforeDestroy(){this.audioContext&&this.audioContext.close()},computed:{voiceEnable(){return this.$store.state.voiceMessagesEnabled},connect:function(){return this.$store.state.contact},pkoindisabled:function(){return this.$store.state.pkoindisabled},menuItems:function(){var e=[];return window.POCKETNETINSTANCE?window.POCKETNETINSTANCE.mobile.supportimagegallery()&&e.push({click:"cameraHandlerCustom",title:this.$i18n.t("button.takePhotoOrVideo"),icon:"fas fa-camera"}):e.push({click:"cameraHandler",title:this.$i18n.t("button.takePhotoOrVideo"),icon:"fas fa-camera",upload:{multiple:!0,extensions:["jpg","jpeg","png","webp"],maxsize:100,images:{resize:{type:"fit"}}}}),e.push({click:"fileHandler",title:this.$i18n.t("button.sendFile"),icon:"fas fa-sticky-note",upload:{multiple:!0,extensions:[],maxsize:25,images:{resize:{type:"fit"}}}}),this.transaction&&!this.pkoindisabled&&e.unshift({click:"sendtransactionWrapper",title:this.$i18n.t("button.sendCoins"),icon:"fas fa-wallet"}),e},...Object(d["c"])(["chats"]),userlist:function(){return this.chat?this.core.mtrx.chatUsersInfo(this.chat.roomId,"anotherChatUsers"):[]},transaction:function(){return a["a"].deep(window,"POCKETNETINSTANCE.platform.ui.wallet.send")},uusers:function(){return this.u?_.map(this.u.split(","),e=>e):[]},ausers:function(){return this.u?_.map(this.u.split(","),e=>this.core.user.matrixId(e)):[]},stateChat:function(){var e=this.$route.query.id;return this.$store.state.chatsMap[e]},invited:function(){return this.chat?_.map(_.filter(this.chat.currentState.getMembers(),(function(e,t){return"invite"===e.membership})),(function(e){return e.userId})):this.u?this.ausers:[]},joined:function(){if(!this.chat)return[];this.chat.roomId;let e=[];return this.chat.currentState.getMembers().forEach((function(t){"join"===t.membership&&e.push(t.userId)})),e},tipusers:function(){if(null===this.tipvalue)return[];if(""===this.tipvalue)return this.userlist;var e=this.tipvalue.toLowerCase(),t=_.filter(this.userlist,(function(t){return 0==t.name.toLowerCase().indexOf(e)&&t.name.toLowerCase()!=e}));return t},maintipuser:function(){return this.tipusers.length?this.tipusers[this.tipuserindex||0]:null}},created(){},mounted(){this.ready=!0,!this.chat&&this.core.mtrx.client&&this.newchat().catch(e=>Promise.resolve())},methods:{wait:function(){return this.$f.pretry(()=>this.core.mtrx.client&&this.core.mtrx.access)},browsetip:function(e){e?this.tipuserindex++:this.tipuserindex--,this.tipuserindex>this.tipusers.length-1&&(this.tipuserindex=0),this.tipuserindex<0&&(this.tipuserindex=this.tipusers.length-1)},selectcurrenttip:function(){this.insertuser(this.tipusers[this.tipuserindex||0])},insertuser:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t=e.name||"";this.$refs["newinput"].inserttip(t)},tipBySearch:function(e){this.tipvalue=e},showuserselected:function(e,t){this[t](e)},resizeImage:function(e){var t=e.split(";")[0].split("/")[1],i=new v["a"];return i.resize["fit"](e,1024,1024,t,.95).then(e=>Promise.resolve(e)).catch(e=>Promise.reject(e))},cameraHandlerCustom:function(){var e=[];this.$refs.dropdownMenu.hidePopup(),window.POCKETNETINSTANCE.platform.ui.uploadImage({multiple:!0,action:(t,i)=>{let{base64:r}=t;return this.resizeImage(r).then(t=>a["a"].Base64.toFile(t).then(r=>{var n={base64:t,file:r};e.push(n),this.uploadUploaded(null,n),i()})).catch(e=>{console.error(e),i()})},onSuccess:e=>{this.uploadUploadedAll()}})},sendtransactionWrapper:function(){this.menuIsVisible=!1;var e=_.filter(_.map(this.joined,e=>this.$f.deep(this,"$store.state.users."+this.$f.getmatrixid(e))||null),e=>{var t;return e&&e.source&&e.id!=(null===(t=this.core.user.userinfo)||void 0===t?void 0:t.id)});if(!e.length)return"users.length";e.length>1?this.core.store.commit("setmodal",{caption:this.$i18n.t("caption.sendTransactionTo"),type:"showuserselect",data:{users:e,action:"sendtransaction",userselected:e=>{this.showuserselected(e,"sendtransaction")}}}):this.sendtransaction(e[0]),this.$refs.dropdownMenu.hidePopup()},sendtransaction:function(e){var t=this.transaction;t({roomid:this.chat.roomId,address:e.source.address})},emitInputData:function(){this.$emit("emptyInput"),this.upload=!0},HideUploadPic(){this.upload=!1},emitUrl:function(e){this.$emit("setMetaUrl",e)},newchat(){if(this.u){this.$store.state.globalpreloader=!0;var e=null,t=null,i="";return this.creating=!0,this.core.user.usersInfo(this.uusers).then(t=>{if(1==this.uusers.length){var r=t[0];if(!r||!r.keys||r.keys.length<12)return this.$emit("cantchatcrypto"),Promise.reject("ny2")}if(this.core.user.userinfo.keys.length<12)return this.$emit("cantchatcrypto"),Promise.reject("ny2");i=this.core.mtrx.kit.tetatetid(t[0],this.core.user.userinfo),e=this.core.user.matrixId(t[0].id),this.core.user.matrixId(this.core.user.userinfo.id);var n=[{type:"m.set.encrypted",state_key:"",content:{encrypted:!0}}];return this.core.mtrx.client.createRoom({room_alias_name:i,visibility:"private",invite:[e],name:"#"+i,initial_state:n})}).then(i=>{t=i,this.$store.state.globalpreloader=!1;let r=this.core.mtrx.client.getRoom(i.room_id),n=r.currentState.getStateEvents("m.room.power_levels");return this.core.mtrx.client.setPowerLevel(t.room_id,e,100,n[0]).catch(e=>{})}).then(e=>(this.creating=!1,this.connect&&this.connect==i&&this.greetings(),this.$store.commit("CONTACT",!1),Promise.resolve())).catch(e=>(this.creating=!1,this.$store.state.globalpreloader=!1,e&&"M_ROOM_IN_USE"==e.errcode?this.core.mtrx.client.joinRoom("#"+i+":"+this.core.mtrx.baseUrl.replace("https://","")).then(()=>{}).catch(e=>{}):Promise.reject(e)))}return Promise.reject("u")},maySendMessage(){return this.chat&&this.chat.maySendMessage()},greetings(){this.send("ðŸ‘‹").then(e=>Promise.resolve(e))},sendinput(e){this.send(e).then(e=>Promise.resolve(e))},textCutLimit:function(e,t){return e=e.trim(),e.length<=t?e:(e=e.slice(0,t),e.trim()+"...")},replaceMentions(e){return _.each(this.userlist,(function(t){e=e.replace(new RegExp("@"+t.name,"g"),"@"+t.id+":"+t.name)})),e},send(e){return this.chat||this.newchat().catch(e=>{}),this.$emit("sending"),this.relationEvent||this.focus(),this.$f.pretry(()=>this.chat&&!this.creating).then(t=>(this.$emit("sent"),e=this.replaceMentions(e),this.relationEvent&&"m.replace"==this.relationEvent.type&&this.relationEvent.event?this.core.mtrx.textEvent(this.chat,e).then(e=>{e["m.relates_to"]={rel_type:"m.replace",event_id:this.core.mtrx.clearEventId(this.relationEvent.event)||a["a"].makeid()};var t=e;return this.relationEvent.event.event.content.body=e.body,this.relationEvent.event.event.content.block=e.block,this.relationEvent.event.event.content.msgtype=e.msgtype,delete this.relationEvent.event.event.decryptKey,delete this.relationEvent.event.event.decrypted,this.core.mtrx.client.sendEvent(this.chat.roomId,"m.room.message",t)}).then(e=>(this.core.store.dispatch("FETCH_EVENTS"),this.$emit("clearRelationEvent"),this.$emit("force"),Promise.resolve())).catch(e=>(console.error(e),Promise.reject(e))):this.core.mtrx.sendtext(this.chat,e,{relation:this.relationEvent}))).catch(e=>{this.$emit("sentMessageError",{error:e})})},pasteImage(e){this.sendImage({base64:e})},sendImage:function(e){let{base64:t,file:i}=e;var r=a["a"].makeid(),n={type:"image",id:r,base64:t};this.$emit("sendingData",n),this.$f.pretry(()=>this.chat).then(()=>n.aborted?Promise.reject("aborted"):(this.relationEvent&&(n.event=this.relationEvent?this.relationEvent:{},this.$emit("sent")),this.core.mtrx.sendImage(this.chat,t,null,n,{relation:this.relationEvent}))).then(e=>(this.$emit("sentData",{id:r}),Promise.resolve())).catch(e=>(this.$emit("sentError",{id:r,error:e}),Promise.resolve()))},canencryptfilesize:function(e){var t=10485760;return this.chat.pcrypto.canBeEncrypt()&&e.size>t?this.$dialog.confirm("Files larger than 10 megabytes are not encrypted. Do you want to send the file unencrypted?",{okText:"Yes",cancelText:"No, cancel"}).then(e=>Promise.resolve(!0)).catch(e=>Promise.reject("cancel")):Promise.resolve(!1)},sendFile:function(e){let{file:t}=e;var i=a["a"].makeid(),r={type:"file",id:i,info:{name:t.name,size:t.size}};this.$emit("sendingData",r),this.$f.pretry(()=>this.chat).then(()=>this.canencryptfilesize(t)).then(e=>(this.relationEvent&&this.$emit("sent"),this.core.mtrx.sendFile(this.chat,t,r,{relation:this.relationEvent},e))).then(()=>(this.$emit("sentData",{id:i}),Promise.resolve())).catch(e=>{console.error(e),this.$emit("sentError",{id:i,error:e})})},focus:function(){this.$refs["newinput"]&&this.$refs["newinput"].focus()},focused:function(){this.$emit("focused")},blur:function(){this.$refs["newinput"]&&this.$refs["newinput"].blur()},blurifempty:function(){this.$refs["newinput"]&&this.$refs["newinput"].blurifempty()},change:function(){},setText:function(e){this.text=e,this.$refs["newinput"]&&this.$refs["newinput"].setText(e)},keyup:function(e){var t=e.target.value;""!==t?(this.$emit("inputClean",!0),this.text=t,this.anyUrlMeta=a["a"].getUrl(this.text),void 0!==this.anyUrlMeta?this.$emit("setMetaUrl",this.anyUrlMeta):this.$emit("inputClean",!1),this.chat&&this.core.mtrx.client.sendTyping(this.chat.roomId,!0,100)):this.$emit("inputClean",!1)},menuItemClick(e,t){this[e.click](t)},menuItemLoadedHandler:function(e){return this.menuIsVisible=e,this.menuIsVisible},uploadStart(e,t){},uploadError(e,t){this.$store.commit("icon",{icon:"error",message:t.text})},getImg(){return this.imgs=!0},uploadSizeError(e){e||this.$refs.dropdownMenu.hidePopup()},uploadUploaded(e,t){const i=["image/gif","image/jpeg","image/png","image/webp"];if(i.includes(t.file.type))return this.sendImage(t);this.sendFile(t)},imageWH(e){const t=new Image;var i={};return new Promise((r,n)=>{t.onload=function(){i.w=this.width,i.h=this.height,r(i)},t.onerror=function(e){n(e)},t.src=e.base64})},uploadUploadedAll(e,t){this.$store.state.loading=!1,this.$refs.dropdownMenu.hidePopup()},catchPermissonsError(e){if("permissions"==e||e.toString&&e.toString().indexOf("Permission")>-1)return this.microphoneDisabled=!0,void(window.cordova?this.$dialog.confirm(this.$i18n.t("micaccesscordova"),{okText:this.$i18n.t("button.ok")}):this.$dialog.confirm(this.$i18n.t("micaccessbrowser"),{okText:this.$i18n.t("button.ok")}));e.toString&&e.toString().indexOf("device not found")>-1?this.$dialog.confirm(this.$i18n.t("micdevicenotfound"),{okText:this.$i18n.t("button.ok")}):(this.$dialog.confirm(this.$i18n.t("micaccesscommonproblem"),{okText:this.$i18n.t("button.ok")}),console.error(e))},getFileIosCordova(e){return new Promise((t,i)=>{window.resolveLocalFileSystemURL(e,e=>{if(!e)return i("noentry");e.file(r=>{var n=new FileReader;n.onloadend=function(){var i=new Blob([new Uint8Array(this.result)],{type:r.type});e.remove(),t(i)},n.onerror=t=>{e.remove(),i(t)},n.readAsArrayBuffer(r)})},e=>{i(e)})})},initRecordingCordova(){this.prepareRecording=Object(O["cancelable"])(this.core.media.permissions({audio:!0}).then(()=>(this.microphoneDisabled=!1,Promise.resolve())).catch(e=>(console.error(e),this.catchPermissonsError(e),Promise.reject(e)))),this.prepareRecording.then(()=>{this.microphoneDisabled=!1;var e="recording.mp3";a["a"].isios()&&(e="cdvfile://localhost/temporary/recording.m4a");var t=0;this.audioContext=this.core.getAudioContext();var i=this.cordovaMediaRecorder=new Media(e,()=>{if(this.recordTime=0,i.release(),this.cancelledCordovaMediaRecorder)this.cancelledCordovaMediaRecorder=!1;else{var t=null;t=this.getFileIosCordova(a["a"].isios()?e:window.cordova.file.externalDataDirectory+e).then(e=>Promise.resolve({data:e})),t.then(e=>(i.duration&&i.duration>0&&(e.duration=i.duration),this.createVoiceMessage(e,!0),Promise.resolve())).catch(e=>{this.clear(),console.error(e)}).finally(()=>{})}},e=>{console.error(e),this.isRecording=!1,this.clear()}),r=[];let n=this.$store.state.currentPlayingVoiceMessage;n&&n.pause(),this.interval=setInterval(()=>{a["a"].isios()?(r.push(1),r.length>50&&(r=_.last(r,50)),this.recordRmsData=_.clone(r)):this.cordovaMediaRecorder.getCurrentAmplitude(e=>{r.push(1e3*e),r.length>50&&(r=_.last(r,50)),this.recordRmsData=_.clone(r)},(function(e){console.log("E",e)})),t+=50,t%1e3===0&&(this.recordTime=t)},50),this.isRecording=!0,this.cancelOpacity=0,this.recordRmsData=[],this.recordTime=0,this.record=null,this.cordovaMediaRecorder.startRecord()}).catch(e=>{console.error(e)}).finally(()=>{this.prepareRecording=null})},initRecording(){if(!(this.prepareRecording||this.isRecording||this.cordovaMediaRecorder)){if(window.cordova)return this.initRecordingCordova();this.prepareRecording=Object(O["cancelable"])(this.core.initMediaRecorder().then(e=>{if(this.microphoneDisabled=!1,this.prepareRecording)return Promise.resolve(e);e.stream.getTracks().forEach(e=>{e.stop()})}).catch(e=>(this.catchPermissonsError(e),Promise.reject(e)))),this.prepareRecording.then(e=>{this.mediaRecorder=e,this.audioContext=this.core.getAudioContext(),this.audioAnalyser=this.audioContext.createAnalyser();var t=this.audioContext.createMediaStreamSource(this.mediaRecorder.stream);t.connect(this.audioAnalyser),this.startRecording()}).catch(()=>{}).finally(()=>{this.prepareRecording=null})}},startRecording(){let e=this.$store.state.currentPlayingVoiceMessage;e&&e.pause(),this.$store.commit("SET_VOICERECORDING",!0),this.isRecording=!0,this.cancelOpacity=0,this.recordRmsData=[],this.recordTime=0,this.record=null,this.mediaRecorder.start();var t=0,i=[];this.interval=setInterval(()=>{var e=new Uint8Array(this.audioAnalyser.frequencyBinCount);this.audioAnalyser.getByteFrequencyData(e),i.push(this.generateRms(e)),i.length>50&&(i=_.last(i,50)),t+=50,this.recordRmsData=_.clone(i),t%1e3===0&&(this.recordTime=t)},50)},checkaudioForSend:function(e,t){e.duration<1?this.clear():t?this.sendVoiceMessage(e):this.record=e},getduration(e){return new Promise((t,i)=>{a["a"].readFile(e).then(e=>{try{this.audioContext.decodeAudioData(e,e=>{t(e.duration)})}catch(r){i(r)}}).catch(i)})},createVoiceMessage(e,t){var i=()=>{this.checkaudioForSend({file:e.data,id:a["a"].makeid(),duration:e.duration},t)};e.duration?i():this.getduration(e.data).then(t=>{e.duration=t,i()}).catch(e=>{console.error(e),this.clear()})},generateRms(e){return+Math.sqrt(e.reduce((e,t)=>e+t**2)/e.length).toPrecision(4)},stopRecording(e){let{cancel:t,sendnow:i}=e;if(console.log("STOP RECORDING",this.isRecording),this.$store.commit("SET_VOICERECORDING",!1),this.prepareRecording)return this.prepareRecording.cancel(),void(this.prepareRecording=null);this.isRecording=!1,this.interval&&(clearInterval(this.interval),this.interval=null),this.mediaRecorder&&(t||this.mediaRecorder.addEventListener("dataavailable",e=>{this.createVoiceMessage(e,i)}),this.mediaRecorder.stop(),this.mediaRecorder.stream.getTracks().forEach(e=>{e.stop()}),this.mediaRecorder=null),this.cordovaMediaRecorder&&(this.cancelledCordovaMediaRecorder=!!t,this.cordovaMediaRecorder.stopRecord(),this.cordovaMediaRecorder=null)},sendVoiceMessage(e){var t=this;return Object(o["a"])((function*(){e||(e=t.record),e||t.clear(),t.recordRmsData=[];const i=yield t.core.convertAudioToBase64(e.file),r=a["a"].makeid(),n={type:"audio",id:r,base64:i};t.clear(),t.$f.pretry(()=>t.chat).then(()=>(t.relationEvent&&(n.event=t.relationEvent?t.relationEvent:{},t.$emit("sent")),t.core.mtrx.sendAudio(t.chat,i,null,n,{relation:t.relationEvent}))).catch(e=>(t.$emit("sentError",{id:r,error:e}),Promise.resolve()))}))()},clear(){this.record=null,this.recordRmsData=[],this.recordTime=0,this.interval&&(clearInterval(this.interval),this.interval=null),this.cordovaMediaRecorder&&(this.cordovaMediaRecorder=null),this.mediaRecorder&&(this.mediaRecorder.stop(),this.mediaRecorder.stream.getTracks().forEach(e=>{e.stop()}),this.mediaRecorder=null)},setOpacity(e){this.cancelOpacity=e}}},D=z,L=(i("3136"),Object(p["a"])(D,r,n,!1,null,"e8b463ac",null));t["default"]=L.exports}}]);
//# sourceMappingURL=matrix-element.6.min.js.map