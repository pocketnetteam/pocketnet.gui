(window["matrixElement_jsonp"]=window["matrixElement_jsonp"]||[]).push([[6],{"0a92":function(e,t,i){var r=i("5ce7");r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var a=i("35d6").default;e.exports.__inject__=function(e){a("06c84aee",r,e)}},"3edc":function(e,t,i){var r=i("fab8");r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var a=i("35d6").default;e.exports.__inject__=function(e){a("2bb68a16",r,e)}},"5ce7":function(e,t,i){var r=i("24fb");t=r(!1),t.push([e.i,".wrapper[data-v-4b882d9f]{position:relative}.fas[data-v-4b882d9f]{position:absolute;right:-8px;top:-8px}.preview-picture[data-v-4b882d9f]{width:50px;height:50px;border-radius:10px}",""]),e.exports=t},cd70:function(e,t,i){var r=i("d9c8");r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var a=i("35d6").default;e.exports.__inject__=function(e){a("689bb725",r,e)}},cf20:function(e,t,i){var r=i("ee23");r.__esModule&&(r=r.default),"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var a=i("35d6").default;e.exports.__inject__=function(e){a("707928b0",r,e)}},cff80:function(e,t,i){"use strict";i.r(t);var r=i("0a92");for(var a in r)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return r[e]}))}(a)},d0a4:function(e,t,i){"use strict";i.r(t);var r=i("cf20");for(var a in r)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return r[e]}))}(a)},d9c8:function(e,t,i){var r=i("24fb");t=r(!1),t.push([e.i,"#chatInput[data-v-22eb6a42]{padding-bottom:.5em}[data-v-22eb6a42] #modal.minimized .modal-wrapper{left:0}[data-v-22eb6a42] .previewWrapper{padding-left:.5em!important;padding-right:.5em!important}.inputWrapper[data-v-22eb6a42]{display:flex}.inputWrapper .left[data-v-22eb6a42]{width:35px;display:flex;justify-content:flex-end;align-items:center;text-align:center}.inputWrapper .left .iconbutton[data-v-22eb6a42]{display:flex;align-items:center;justify-content:center;height:35px;width:35px;-webkit-tap-highlight-color:transparent}.inputWrapper .extended[data-v-22eb6a42]{width:70px;margin-left:7px}.inputWrapper .leftdummy[data-v-22eb6a42]{width:.5em}.inputWrapper>div[data-v-22eb6a42]{transition:.3s}.inputWrapper .center[data-v-22eb6a42]{max-height:110px;max-width:100%;display:flex;justify-content:center;align-items:center;flex-grow:1;border:1px solid transparent;border-radius:30px;background:rgb(var(--background-secondary-theme))}.inputWrapper input[data-v-22eb6a42]{border:1px solid rgb(var(--neutral-grad-0));background:rgba(var(--background-main),.5);border-radius:30px;width:100%;padding:.5em 1em}.notready[data-v-22eb6a42],.waitjoined[data-v-22eb6a42]{padding:.5em 0;text-align:center}.waitjoined span[data-v-22eb6a42]{font-size:.8em}.greetings[data-v-22eb6a42]{padding:.5em 0}.greetings[data-v-22eb6a42],[data-v-22eb6a42] .iconWrapper{text-align:center}.menu-item[data-v-22eb6a42]{padding:.5em;background:rgb(var(--background-total-theme));line-height:44px;border-radius:5px;display:flex}.menu-item .title[data-v-22eb6a42]{flex-grow:2;padding-right:44px;text-align:center}.menu-item .iconWrapper[data-v-22eb6a42]{width:44px}.tipusers[data-v-22eb6a42]{position:absolute;max-height:300px;border-radius:.5em;border:1px solid rgba(var(--neutral-grad-0),.9);overflow-y:overlay;background-color:rgba(var(--background-total-theme),.95);backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(4px);padding:.25em 0;bottom:100%;margin-bottom:.5em;left:.25em;right:.25em}.tipusers .previewWrapperExt[data-v-22eb6a42]{border-radius:.75em;margin-left:.25em;margin-right:.25em;padding-top:.25em;padding-bottom:.25em}.tipusers .previewWrapperExt[data-v-22eb6a42] .previewWrapper{padding-left:.25em!important;padding-right:.25em!important}.tipusers .previewWrapperExt.selected[data-v-22eb6a42]{background:rgb(var(--background-main))}.disabled[data-v-22eb6a42]{display:flex;justify-content:center;align-items:center;width:35px;height:35px;color:rgb(var(--neutral-grad-3))}.disabled i[data-v-22eb6a42]{padding-top:1px}",""]),e.exports=t},e423:function(e,t,i){"use strict";i.r(t);var r=i("cd70");for(var a in r)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return r[e]}))}(a)},e4da:function(e,t,i){"use strict";i.r(t);var r=i("3edc");for(var a in r)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return r[e]}))}(a)},ee23:function(e,t,i){var r=i("24fb");t=r(!1),t.push([e.i,".recordProgress[data-v-5cbd823e]{display:flex;position:relative;height:20px;justify-content:flex-start;padding:0 1em;align-items:center;max-width:90%}.recordProgress .indicator[data-v-5cbd823e]{margin-right:1em;min-width:8px;height:8px;background:red;border-radius:50%}.recordProgress .indicator.recording[data-v-5cbd823e]{-webkit-animation:pulse-data-v-5cbd823e 1.2s ease infinite;animation:pulse-data-v-5cbd823e 1.2s ease infinite}.recordProgress .del[data-v-5cbd823e]{cursor:pointer;display:flex;justify-content:center;align-items:center;width:20px;height:20px;margin-right:1em}.recordProgress .del i[data-v-5cbd823e]{color:red;font-size:13px}.recordProgress .timer[data-v-5cbd823e]{margin-right:1em}.recordProgress .graph[data-v-5cbd823e]{width:calc(100vw - 150px);min-width:100px}.cancel[data-v-5cbd823e],.recordProgress .graph[data-v-5cbd823e]{display:flex;justify-content:center}.cancel[data-v-5cbd823e]{position:absolute;left:80px;right:0;top:0;bottom:0;background:#fff;opacity:0}@-webkit-keyframes pulse-data-v-5cbd823e{0%{opacity:1}50%{opacity:.1}to{opacity:1}}@keyframes pulse-data-v-5cbd823e{0%{opacity:1}50%{opacity:.1}to{opacity:1}}",""]),e.exports=t},fab8:function(e,t,i){var r=i("24fb");t=r(!1),t.push([e.i,".input_component[data-v-036f9580]{width:100%;display:flex;justify-content:center;align-items:center;padding:0 1em;padding-right:0}.input_component[data-v-036f9580] .emoji-mart .emoji-mart-emoji{width:25%;height:40px;cursor:pointer}.input_component[data-v-036f9580] .emoji-mart .emoji-mart-emoji span{cursor:pointer}.input_component[data-v-036f9580] .emoji-mart .emoji-mart-emoji:hover{background:none;box-shadow:none}.input_component[data-v-036f9580] .emoji-mart .emoji-mart-emoji:hover:before{display:none}.input_component .input-wrapper[data-v-036f9580]{display:flex;flex-direction:column;justify-content:center;align-items:flex-start;position:relative;width:100%}.input_component .right[data-v-036f9580]{margin:0 .5em}.input_component .iconbutton .leftdummy[data-v-036f9580]{width:20px}.input_component .iconbutton .rightdummy[data-v-036f9580]{width:35px}.input_component .iconbutton .idummy[data-v-036f9580]{width:100%;height:35px;line-height:35px}.input_component .iconbutton .idummy i[data-v-036f9580]{line-height:35px!important}.input_component .previews[data-v-036f9580]{width:100%;max-width:198px;height:30px;display:flex;align-items:flex-start;padding:2px 0;overflow:hidden}.input_component .previews[data-v-036f9580]:first-child{margin-left:0}.input_component .textarea[data-v-036f9580]{width:100%;display:flex;justify-content:flex-start;align-items:center}.chat-input[data-v-036f9580]{width:100%;max-height:100px;overflow-y:auto;resize:none}.chat-input[data-v-036f9580]::-webkit-scrollbar{width:0!important}.fade-enter-active[data-v-036f9580],.fade-leave-active[data-v-036f9580]{transition:all .2s ease-in}.fade-enter[data-v-036f9580],.fade-leave-to[data-v-036f9580]{opacity:0}",""]),e.exports=t},fe01:function(e,t,i){"use strict";i.r(t);var r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{attrs:{id:"chatInput"}},[e.ready?i("div",{staticClass:"work"},[e.chat?i("div",{staticClass:"inputWrapper"},[e.tipusers.length?i("div",{staticClass:"tipusers"},e._l(e.tipusers,(function(t,r){return i("div",{key:t.id,staticClass:"previewWrapperExt",class:{selected:e.tipuserindex==r},on:{click:function(i){return e.insertuser(t)}}},[i("preview",{attrs:{contact:t,mode:""}})],1)})),0):e._e(),i("div",{staticClass:"center"},[e.voiceEnable&&(e.isRecording||e.recordViewData.length)?i("record-progress",{attrs:{recordTime:e.recordTime,isRecording:e.isRecording,rmsData:e.recordViewData,opacity:e.cancelOpacity},on:{onClear:e.clear}}):i("InputField",{ref:"newinput",attrs:{storagekey:"chatinput"+e.chat.roomId,tipusers:e.tipusers},on:{transaction:e.sendtransaction,chatMessage:e.sendinput,setMetaUrl:e.emitUrl,emptyInput:e.emitInputData,FilledInput:e.HideUploadPic,base64:e.pasteImage,focused:e.focused,tipsearchrequest:e.tipBySearch,browsetip:e.browsetip,selectcurrenttip:e.selectcurrenttip}}),e.upload&&e.chat?i("div",{staticClass:"left",class:{extended:e.voiceEnable}},[e.isRecording||e.recordViewData.length?e._e():i("div",{staticClass:"iconbutton"},[i("dropdownMenu",{ref:"dropdownMenu",attrs:{menuItems:e.menuItems,rowObject:{},icon:"fas fa-plus"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.item.upload?i("upload",{attrs:{multiple:t.item.upload.multiple,extensions:t.item.upload.extensions,images:t.item.upload.images},on:{start:function(i){return e.uploadStart(t.item,i)},uploaded:function(i){return e.uploadUploaded(t.item,i)},uploadedAll:function(i){return e.uploadUploadedAll(t.item,i)},error:function(i){return e.uploadError(t.item,i)}},scopedSlots:e._u([{key:"content",fn:function(){return[i("div",{staticClass:"menu-item"},[i("div",{staticClass:"iconWrapper"},[t.item.icon?i("i",{class:t.item.icon}):e._e()]),i("div",{staticClass:"title"},[e._v(" "+e._s(t.item.title)+" ")])])]},proxy:!0},{key:"dropzone",fn:function(){},proxy:!0}],null,!0)}):i("div",{staticClass:"menu-item",on:{click:function(i){return e.menuItemClick(t.item)}}},[i("div",{staticClass:"iconWrapper"},[t.item.icon?i("i",{class:t.item.icon}):e._e()]),i("div",{staticClass:"title"},[e._v(" "+e._s(t.item.title)+" ")])])]}}],null,!1,2831926823)})],1),e.voiceEnable?[!e.isRecording&&e.recordRmsData.length||e.microphoneDisabled?e._e():i("div",{staticClass:"iconbutton"},[i("recordVoice",{attrs:{isRecording:e.isRecording},on:{onRecordingStart:e.initRecording,onRecordingStop:e.stopRecording,onClear:e.clear,canceling:e.setOpacity}})],1),e.microphoneDisabled?i("div",{staticClass:"disabled"},[i("i",{staticClass:"icon fas fa-microphone-slash",on:{click:e.initRecording}})]):e._e()]:e._e(),!e.isRecording&&e.recordViewData.length?i("div",{staticClass:"iconbutton",on:{click:e.sendVoiceMessage}},[e._m(0)]):e._e()],2):e._e()],1)]):e._e()]):i("div",{staticClass:"notready"},[i("linepreloader")],1)])},a=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("i",{staticClass:"icon fas fa-paper-plane"})])}],s=i("1da1"),n=(i("d9e2"),i("907a"),i("3139")),o=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"input_component"},[i("div",{staticClass:"input-wrapper"},[i("div",{staticClass:"textarea"},[i("textarea",{ref:"textarea",staticClass:"chat-input",attrs:{id:"textInput",type:"text",row:"1",spellcheck:"true",autocorrect:"on",placeholder:e.$t("caption.sendmessage")},domProps:{value:e.text},on:{focus:e.focused,blur:e.blured,keydown:e.keydown,input:e.textchange,keyup:e.keyup,click:e.keyup,paste:e.paste_image}}),e.mobile?e._e():i("transition",{attrs:{name:"fade",mode:"out-in"}},[i("picker",{directives:[{name:"show",rawName:"v-show",value:e.display_emoji,expression:"display_emoji"},{name:"click-outside",rawName:"v-click-outside",value:e.close_emoji_picker,expression:"close_emoji_picker"}],style:{width:"325px",position:"absolute",bottom:"32px",right:"-60px",fontSize:"0.8em",fontFamily:"Segoe UI"},attrs:{data:e.emojiIndex,exclude:e.exclude,showPreview:!1,showSearch:!1,native:!0,set:"emojione"},on:{select:e.insert_emoji}})],1)],1)]),e.mobile?e._e():i("div",{staticClass:"iconbutton emojipicker",on:{click:function(t){return e.toggle_emoji_picker()}}},[i("div",{staticClass:"leftdummy"},[i("div",{staticClass:"idummy"},[e.display_emoji?i("i",{staticClass:"fas fa-times"}):i("i",{staticClass:"far fa-smile"})])])]),e.send?i("div",{staticClass:"iconbutton",on:{click:function(t){return e.send_text(t)}}},[e._m(0)]):e._e()])},c=[function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"rightdummy"},[i("div",{staticClass:"idummy"},[i("i",{staticClass:"far fa-paper-plane"})])])}],d=i("5059"),l=i("364d"),u=(i("01ce"),i("41fb")),h=i("c28b"),p=i.n(h),m=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.is_opened?i("div",{staticClass:"wrapper"},[i("img",{staticClass:"preview-picture",attrs:{src:e.base64,alt:"picture preview"}}),i("i",{staticClass:"fas fa-times fa-sm",on:{click:e.hide}})]):e._e()},f=[],g={name:"picturePreview",props:["base64"],data(){return{is_opened:!0}},methods:{hide(){this.is_opened=!1}}},v=g,x=i("2877");function b(e){var t=i("cff80");t.__inject__&&t.__inject__(e)}var y=Object(x["a"])(v,m,f,!1,b,"4b882d9f",null,!0),w=y.exports;let _=new d["a"];var k={name:"InputField",components:{Picker:u["Picker"],picturePreview:w},directives:{clickOutside:p.a.directive},watch:{text:{immediately:!0,handler:function(e,t){e?(this.send=!0,this.$emit("FilledInput")):(this.send=!1,this.$emit("emptyInput")),this.textarea_resize()}}},computed:{mobile:function(){return!this.$store.state.pocketnet&&this.$store.state.mobile},emojiIndex:function(){return window.emojiIndex||(window.emojiIndex=new u["EmojiIndex"](l)),window.emojiIndex}},methods:{setText:function(e){this.text=e,this.savetextinstorage(),setTimeout(()=>{this.textarea_resize(),this.focus()})},focused:function(){this.$emit("focused")},textchange:function(e){this.text=e.target.value||""},savetextinstorage:function(){this.storagekey&&(localStorage[this.storagekey]=this.text||"")},send_empty_array(){this.$emit("userSearched",[])},focus(){this.$refs["textarea"].focus()},blur(){this.$refs["textarea"].blur()},blurifempty(){this.text||this.blur()},close_emoji_picker(e){"i"!==e.target.localName&&"matrix-element"!==e.target.localName&&(this.display_emoji=!1)},textarea_resize(){this.text?(this.$refs.textarea.style.height="1px",this.$refs.textarea.style.height=this.$refs.textarea.scrollHeight+"px",this.display_emoji=!1):this.textarea_resize_reset()},textarea_resize_reset(){this.$refs.textarea.style.height="26px"},toggle_emoji_picker(){this.display_emoji=!this.display_emoji},send_text(e){this.text&&"\n"!==this.text&&(this.display_emoji=!1,this.$emit("chatMessage",this.text),this.$emit("emptyInput"),this.send=!1,this.text=""),this.savetextinstorage()},insert_emoji(e){this.text+=e.native,this.savetextinstorage()},paste_image(e){this.get_base64(e)},get_base64(e){if(this.pasted_data=e.clipboardData.items,this.pasted_data.length)for(let r in this.pasted_data){let e=this.pasted_data[r],a=this.upload.extensions.includes(e.type);if(a){var t=e.getAsFile(),i=new FileReader;i.onload=t=>{this.$dialog.confirm("Do you really want to send attachment?",{okText:"Yes",cancelText:"No, cancel"}).then(i=>{var r=t.target.result;this.resize_image(r,e.type)})},i.readAsDataURL(t)}}},resize_image(e,t){return _.autorotation(null,e).then(e=>{let i=this.upload.images.resize.type||"def";return _.resize[i](e,1024,1024,t,.9).then(e=>{this.$emit("base64",e)}).catch(e=>console.error("Failed to resize image",e))}).catch(e=>console.error("Failed to resize image",e))},getsearchposition(e){if(!e.start||!this.text.length)return null;var t={start:e.start,middle:0,end:e.end},i=e.start,r=!1,a=!1,s=/[a-zA-Z0-9]{1}/;t.middle=i;do{var n=this.text[i];"@"==n?e.start==i||i>0&&s.test(this.text[i-1])?a=!0:r=!0:s.test(n)?t.start=i:a=!0,i--}while(i>=0&&i<=e.start&&!r&&!a);if(r){a=!1,i=e.end;do{!this.text[i]||s.test(this.text[i])?t.end=i:a=!0,i++}while(i<=this.text.length&&!a)}else t=null;return t},getsearch(e){var t=this.getsearchposition(e);return t?this.text.substring(t.start,t.middle):null},keydown(e){return(40===e.keyCode||38===e.keyCode)&&this.tipusers&&this.tipusers.length?(this.$emit("browsetip",40===e.keyCode),e.preventDefault(),!1):(39===e.keyCode||13===e.keyCode)&&this.tipusers&&this.tipusers.length?(this.$emit("selectcurrenttip"),e.preventDefault(),!1):13===e.keyCode?(this.mobile?this.text=this.text+"\n":this.send_text(e),e.preventDefault(),!1):void 0},keyup(e){if(this.block)return e.preventDefault(),!1;var t=n["a"].getCaretPosition(this.$refs["textarea"]),i=this.getsearch(t);this.$emit("tipsearchrequest",i),this.savetextinstorage()},blured(){setTimeout(()=>{this.$emit("tipsearchrequest",null)},300)},inserttip(e){this.$emit("tipsearchrequest",null),this.block=!0,this.$refs["textarea"];var t=this.getsearchposition(n["a"].getCaretPosition(this.$refs["textarea"]));this.text=this.text.substring(0,t.start)+e+this.text.substring(t.end+1),this.text[t.end+1]||(this.text=this.text+" ")," "==!this.text[t.end+1]&&t.end++,n["a"].setCaretPosition(this.$refs["textarea"],t.end+1,t.end+1),setTimeout(()=>{this.block=!1},350)}},props:{storagekey:String,tipusers:Array},data(){return{send:!1,toMatch:[/Android/i,/webOS/i,/iPhone/i,/iPad/i,/iPod/i,/BlackBerry/i,/Windows Phone/i],isPhone:!0,heightUp:40,areaValue:"",ready:!1,text:"",exclude:["flags"],display_emoji:!1,content_height:26,pasted_data:[],block:!1,upload:{multiple:!0,extensions:["image/jpg","image/jpeg","image/png"],images:{resize:{type:"fit"}}},hidden_previews:null}},creared(){},mounted(){this.mobile||this.focus(),this.isPhone=this.toMatch.some(e=>navigator.userAgent.match(e)),this.$refs.textarea.style.height="26px",this.storagekey&&localStorage[this.storagekey]&&(this.text=localStorage[this.storagekey])}},$=k;function j(e){var t=i("e4da");t.__inject__&&t.__inject__(e)}var C=Object(x["a"])($,o,c,!1,j,"036f9580",null,!0),R=C.exports,E=i("c46f"),I=i("2f62"),P=i("f978"),D=i("92a6"),M=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"recordProgress"},[e.isRecording?i("div",{staticClass:"indicator",class:{recording:e.isRecording}}):i("div",{staticClass:"del",on:{click:e.clear}},[i("i",{staticClass:"fas fa-trash"})]),i("div",{staticClass:"timer"},[e._v(e._s(e.timer))]),i("div",{ref:"graph",staticClass:"graph"},[i("canvas",{ref:"canvas",attrs:{id:"canvas",width:e.width,height:"60"}})]),i("div",{directives:[{name:"show",rawName:"v-show",value:e.isRecording&&e.opacity,expression:"isRecording && opacity"}],ref:"cancel",staticClass:"cancel"},[i("i"),e._v(" "),i("span",[e._v("Slide left to cancel")])])])},T=[],z={name:"recordProgress",props:{recordTime:{type:Number,required:!0},rmsData:{type:Array,required:!0},isRecording:{type:Boolean},opacity:{}},data(){return{width:0}},computed:{timer(){let e=Math.floor(this.recordTime/6e4),t=Math.floor(this.recordTime/1e3)%60;return`${e?e+":":"0:"}${t<10?"0"+t:t}`}},mounted(){this.$refs.cancel.style.opacity=0;let e=this.$refs.graph.offsetWidth;this.width=e-e%100,window.addEventListener("resize",this.resize)},beforeDestroy(){window.removeEventListener("resize",this.resize)},updated(){this.draw(),this.$nextTick(()=>{this.$refs.cancel.style.opacity=this.opacity})},methods:{resize(){let e=null;var t=()=>{e||(e=setTimeout(()=>{e=null;let t=this.$refs.graph.offsetWidth;this.width=t-t%100},50))};t()},draw(){const e=this.$refs.canvas.getContext("2d");let t=this.width/200;e.clearRect(0,0,this.width,60);for(let i=0;i<this.rmsData.length;i++)e.fillStyle="#00a4ff",e.fillRect(2*i*t,30-this.rmsData[i]/8,t,this.rmsData[i]/4+1)},clear(){this.$emit("onClear")}}},A=z;function S(e){var t=i("d0a4");t.__inject__&&t.__inject__(e)}var O=Object(x["a"])(A,M,T,!1,S,"5cbd823e",null,!0),U=O.exports,W=i("0319"),F={name:"chatInput",props:{chat:Object,u:String,relationEvent:Object},components:{InputField:R,contacts:P["default"],preview:D["a"],recordProgress:U},data:function(){return{upload:!0,test:[],loading:!1,text:"",file:{},fileInfo:{},ready:!1,creating:!1,userId:"",showuserselect:null,anyUrlMeta:String,joinedMembers:[],tipvalue:null,tipuserindex:0,record:null,recordRmsData:[],isRecording:!1,mediaRecorder:null,audioContext:null,audioAnalyser:null,audioDataArray:null,recordTime:0,interval:null,cancelOpacity:0,microphoneDisabled:!1}},watch:{usersForKeysHash:{handler:function(){}},tipusers:function(){this.tipusers.length?this.tipuserindex>this.tipusers.length-1&&(this.tipuserindex=this.tipusers.length-1):this.tipuserindex=0}},computed:{voiceEnable(){return this.$store.state.voiceMessagesEnabled},connect:function(){return this.$store.state.contact},menuItems:function(){var e=[];return this.relationEvent||(e.push({click:"cameraHandler",title:this.$i18n.t("button.takePhotoOrVideo"),icon:"fas fa-camera",upload:{multiple:!0,extensions:["jpg","jpeg","png","webp"],maxsize:100,images:{resize:{type:"fit"}}}}),e.push({click:"fileHandler",title:this.$i18n.t("button.sendFile"),icon:"fas fa-sticky-note",upload:{multiple:!0,extensions:[],maxsize:25,images:{resize:{type:"fit"}}}})),this.transaction&&e.unshift({click:"sendtransactionWrapper",title:this.$i18n.t("button.sendCoins"),icon:"fas fa-wallet"}),e},...Object(I["c"])(["chats"]),userlist:function(){return this.chat?this.core.mtrx.chatUsersInfo(this.chat.roomId,"anotherChatUsers"):[]},transaction:function(){return n["a"].deep(window,"POCKETNETINSTANCE.platform.ui.wallet.send")},uusers:function(){return this.u?E["default"].map(this.u.split(","),e=>e):[]},ausers:function(){return this.u?E["default"].map(this.u.split(","),e=>this.core.user.matrixId(e)):[]},stateChat:function(){var e=this.$route.query.id;return this.$store.state.chatsMap[e]},invited:function(){return this.chat?E["default"].map(E["default"].filter(this.chat.currentState.getMembers(),(function(e,t){return"invite"===e.membership})),(function(e){return e.userId})):this.u?this.ausers:[]},joined:function(){if(!this.chat)return[];this.chat.roomId;let e=[];return this.chat.currentState.getMembers().forEach((function(t){"join"===t.membership&&e.push(t.userId)})),e},tipusers:function(){if(null===this.tipvalue)return[];if(""===this.tipvalue)return this.userlist;var e=this.tipvalue.toLowerCase(),t=E["default"].filter(this.userlist,(function(t){return 0==t.name.toLowerCase().indexOf(e)&&t.name.toLowerCase()!=e}));return t},maintipuser:function(){return this.tipusers.length?this.tipusers[this.tipuserindex||0]:null},recordViewData(){if(this.recordRmsData.length){let e=this.recordRmsData.length,t=this.recordRmsData.length/100;if(e>100){let e=[];for(let i=0;i<100;i++)e.push(this.recordRmsData[Math.round(i*t)]);return e}}return this.recordRmsData}},created(){},mounted(){this.ready=!0,!this.chat&&this.core.mtrx.client&&this.newchat().catch(e=>Promise.resolve())},methods:{wait:function(){return this.$f.pretry(()=>this.core.mtrx.client&&this.core.mtrx.access)},browsetip:function(e){e?this.tipuserindex++:this.tipuserindex--,this.tipuserindex>this.tipusers.length-1&&(this.tipuserindex=0),this.tipuserindex<0&&(this.tipuserindex=this.tipusers.length-1)},selectcurrenttip:function(){this.insertuser(this.tipusers[this.tipuserindex||0])},insertuser:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};var t=e.name||"";this.$refs["newinput"].inserttip(t)},tipBySearch:function(e){this.tipvalue=e},showuserselected:function(e,t){this[t](e)},sendtransactionWrapper:function(){this.menuIsVisible=!1;var e=E["default"].filter(E["default"].map(this.joined,e=>this.$f.deep(this,"$store.state.users."+this.$f.getmatrixid(e))||null),e=>{var t;return e&&e.source&&e.id!=(null===(t=this.core.user.userinfo)||void 0===t?void 0:t.id)});if(!e.length)return"users.length";e.length>1?this.core.store.commit("setmodal",{caption:this.$i18n.t("caption.sendTransactionTo"),type:"showuserselect",data:{users:e,action:"sendtransaction",userselected:e=>{this.showuserselected(e,"sendtransaction")}}}):this.sendtransaction(e[0]),this.$refs.dropdownMenu.hidePopup()},sendtransaction:function(e){var t=this.transaction;t({roomid:this.chat.roomId,address:e.source.address})},emitInputData:function(){this.$emit("emptyInput"),this.upload=!0},HideUploadPic(){this.upload=!1},emitUrl:function(e){this.$emit("setMetaUrl",e)},newchat(){if(this.u){this.$store.state.globalpreloader=!0;var e=null,t=null,i="";return this.creating=!0,this.core.user.usersInfo(this.uusers).then(t=>{if(1==this.uusers.length){var r=t[0];if(!r||!r.keys||r.keys.length<12)return this.$emit("cantchatcrypto"),Promise.reject("ny2")}if(this.core.user.userinfo.keys.length<12)return this.$emit("cantchatcrypto"),Promise.reject("ny2");i=this.core.mtrx.kit.tetatetid(t[0],this.core.user.userinfo),e=this.core.user.matrixId(t[0].id),this.core.user.matrixId(this.core.user.userinfo.id);var a=[{type:"m.set.encrypted",state_key:"",content:{encrypted:!0}}];return this.core.mtrx.client.createRoom({room_alias_name:i,visibility:"private",invite:[e],name:"#"+i,initial_state:a})}).then(i=>{t=i,this.$store.state.globalpreloader=!1;let r=this.core.mtrx.client.getRoom(i.room_id),a=r.currentState.getStateEvents("m.room.power_levels");return this.core.mtrx.client.setPowerLevel(t.room_id,e,100,a[0]).catch(e=>{})}).then(e=>(this.creating=!1,this.connect&&this.connect==i&&this.greetings(),this.$store.commit("CONTACT",!1),Promise.resolve())).catch(e=>(this.creating=!1,this.$store.state.globalpreloader=!1,e&&"M_ROOM_IN_USE"==e.errcode?this.core.mtrx.client.joinRoom("#"+i+":"+this.core.mtrx.baseUrl.replace("https://","")).then(()=>{}).catch(e=>{}):Promise.reject(e)))}return Promise.reject("u")},maySendMessage(){return this.chat&&this.chat.maySendMessage()},greetings(){this.send("ðŸ‘‹").then(e=>Promise.resolve(e))},sendinput(e){this.send(e).then(e=>Promise.resolve(e))},textCutLimit:function(e,t){return e=e.trim(),e.length<=t?e:(e=e.slice(0,t),e.trim()+"...")},replaceMentions(e){return E["default"].each(this.userlist,(function(t){e=e.replace(new RegExp("@"+t.name,"g"),"@"+t.id+":"+t.name)})),e},send(e){return this.chat||this.newchat().catch(e=>{}),this.$emit("sending"),this.relationEvent||this.focus(),this.$f.pretry(()=>this.chat&&!this.creating).then(t=>(this.$emit("sent"),e=this.replaceMentions(e),this.relationEvent&&"m.replace"==this.relationEvent.type&&this.relationEvent.event?this.core.mtrx.textEvent(this.chat,e).then(e=>{e["m.relates_to"]={rel_type:"m.replace",event_id:this.core.mtrx.clearEventId(this.relationEvent.event)||n["a"].makeid()};var t=e;return this.relationEvent.event.event.content.body=e.body,this.relationEvent.event.event.content.block=e.block,this.relationEvent.event.event.content.msgtype=e.msgtype,delete this.relationEvent.event.event.decryptKey,delete this.relationEvent.event.event.decrypted,this.core.mtrx.client.sendEvent(this.chat.roomId,"m.room.message",t)}).then(e=>(this.core.store.dispatch("FETCH_EVENTS"),this.$emit("clearRelationEvent"),this.$emit("force"),Promise.resolve())).catch(e=>Promise.reject(e)):this.core.mtrx.sendtext(this.chat,e,{relation:this.relationEvent}))).catch(e=>{this.$emit("sentMessageError",{error:e})})},pasteImage(e){this.sendImage({base64:e})},sendImage:function(e){let{base64:t,file:i}=e;var r=n["a"].makeid(),a={type:"image",id:r,base64:t};this.$emit("sendingData",a),this.$f.pretry(()=>this.chat).then(()=>a.aborted?Promise.reject("aborted"):this.core.mtrx.sendImage(this.chat,t,null,a,{relation:this.relationEvent})).then(e=>(this.$emit("sentData",{id:r}),Promise.resolve())).catch(e=>(this.$emit("sentError",{id:r,error:e}),Promise.resolve()))},canencryptfilesize:function(e){var t=10485760;return this.chat.pcrypto.canBeEncrypt()&&e.size>t?this.$dialog.confirm("Files larger than 10 megabytes are not encrypted. Do you want to send the file unencrypted?",{okText:"Yes",cancelText:"No, cancel"}).then(e=>Promise.resolve(!0)).catch(e=>Promise.reject("cancel")):Promise.resolve(!1)},sendFile:function(e){let{file:t}=e;var i=n["a"].makeid(),r={type:"file",id:i,info:{name:t.name,size:t.size}};this.$emit("sendingData",r),this.$f.pretry(()=>this.chat).then(()=>this.canencryptfilesize(t)).then(e=>this.core.mtrx.sendFile(this.chat,t,r,{relation:this.relationEvent},e)).then(()=>(this.$emit("sentData",{id:i}),Promise.resolve())).catch(e=>{this.$emit("sentError",{id:i,error:e})})},focus:function(){this.$refs["newinput"]&&this.$refs["newinput"].focus()},focused:function(){this.$emit("focused")},blur:function(){this.$refs["newinput"]&&this.$refs["newinput"].blur()},blurifempty:function(){this.$refs["newinput"]&&this.$refs["newinput"].blurifempty()},change:function(){},setText:function(e){this.text=e,this.$refs["newinput"]&&this.$refs["newinput"].setText(e)},keyup:function(e){var t=e.target.value;""!==t?(this.$emit("inputClean",!0),this.text=t,this.anyUrlMeta=n["a"].getUrl(this.text),void 0!==this.anyUrlMeta?this.$emit("setMetaUrl",this.anyUrlMeta):this.$emit("inputClean",!1),this.chat&&this.core.mtrx.client.sendTyping(this.chat.roomId,!0,100)):this.$emit("inputClean",!1)},menuItemClick(e,t){this[e.click](t)},menuItemLoadedHandler:function(e){return this.menuIsVisible=e,this.menuIsVisible},uploadStart(e,t){},uploadError(e,t){this.$store.commit("icon",{icon:"error",message:t.text})},getImg(){return this.imgs=!0},uploadSizeError(e){e||this.$refs.dropdownMenu.hidePopup()},uploadUploaded(e,t){const i=["image/gif","image/jpeg","image/png","image/webp"];if(i.includes(t.file.type))return this.sendImage(t);this.sendFile(t)},imageWH(e){const t=new Image;var i={};return new Promise((r,a)=>{t.onload=function(){i.w=this.width,i.h=this.height,r(i)},t.onerror=function(e){a(e)},t.src=e.base64})},uploadUploadedAll(e,t){this.$store.state.loading=!1,this.$refs.dropdownMenu.hidePopup()},initMediaRecorder(){var e=this;return Object(s["a"])((function*(){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?(console.log("getUserMedia supported."),navigator.mediaDevices.getUserMedia({audio:!0}).then(e=>{let t=new W["a"](e,{mimeType:"audio/wav"});return t.stream=e,t}).catch((function(e){throw console.log("The following getUserMedia error occured: "+e),this.microphoneDisabled=!0,new Error(e)}))):(console.log("getUserMedia not supported on your browser!"),e.microphoneDisabled=!0,!1)}))()},initRecording(){var e=this;return Object(s["a"])((function*(){try{if(e.mediaRecorder||(e.mediaRecorder=yield e.initMediaRecorder(),e.audioContext=new(window.AudioContext||window.webkitAudioContext),e.audioAnalyser=e.audioContext.createAnalyser(),e.audioDataArray=new Uint8Array(e.audioAnalyser.frequencyBinCount),e.mediaRecorder.ondataavailable=function(){var t=Object(s["a"])((function*(t){return e.createVoiceMessage(t)}));return function(e){return t.apply(this,arguments)}}(),e.src=e.audioContext.createMediaStreamSource(e.mediaRecorder.stream),e.src.connect(e.audioAnalyser)),e.microphoneDisabled&&e.mediaRecorder)return void(e.microphoneDisabled=!1);e.startRecording()}catch(t){return e.microphoneDisabled=!0,e.$dialog.confirm("Access to the microphone is restricted, please check your browser settings.",{okText:"Yes"})}}))()},startRecording(){try{this.cancelOpacity=0,this.recordRmsData=[],this.recordTime=0,this.record=null,this.mediaRecorder.start(),this.isRecording=!0,this.interval=setInterval(()=>{this.dataArray=new Uint8Array(this.audioAnalyser.frequencyBinCount),this.audioAnalyser.getByteFrequencyData(this.dataArray),this.recordRmsData.push(this.generateRms(this.dataArray)),this.recordTime=this.recordTime+50},50)}catch(e){console.log("startRecord",e)}},createVoiceMessage(e){var t=this;return Object(s["a"])((function*(){const i=URL.createObjectURL(e.data),r=new Audio(i),a=t.audioContext.createMediaElementSource(r),s=n["a"].makeid();r.addEventListener("loadedmetadata",()=>{const e=()=>{r.removeEventListener("timeupdate",e),r.currentTime=0,r.duration<1?t.clear():t.record.duration=r.duration.toPrecision(4)};r.duration===1/0&&(r.currentTime=1e101,r.addEventListener("timeupdate",e))}),t.record={audio:r,file:e.data,track:a,id:s,isPlaying:!1},t.mediaRecorder.stream.getTracks()[0].stop(),t.mediaRecorder=null}))()},generateRms(e){return+Math.sqrt(e.reduce((e,t)=>e+t**2)/e.length).toPrecision(4)},stopRecording(){clearInterval(this.interval),this.isRecording=!1,this.mediaRecorder&&this.mediaRecorder.stop()},sendVoiceMessage(){var e=this;return Object(s["a"])((function*(){e.recordRmsData=[];const t=yield e.convertAudioToBase64(e.record.file),i=n["a"].makeid(),r={type:"audio",id:i,base64:t};e.$f.pretry(()=>e.chat).then(()=>e.core.mtrx.sendAudio(e.chat,t,null,r,{relation:e.relationEvent})).catch(t=>(e.$emit("sentError",{id:i,error:t}),Promise.resolve()))}))()},clear(){this.record=null,this.recordRmsData=[]},convertAudioToBase64(e){return Object(s["a"])((function*(){const t=new FileReader;return t.readAsDataURL(e),new Promise(e=>{t.onloadend=()=>{e(t.result)}})}))()},setOpacity(e){this.cancelOpacity=e}}},V=F;function L(e){var t=i("e423");t.__inject__&&t.__inject__(e)}var N=Object(x["a"])(V,r,a,!1,L,"22eb6a42",null,!0);t["default"]=N.exports}}]);
//# sourceMappingURL=matrix-element.6.min.js.map